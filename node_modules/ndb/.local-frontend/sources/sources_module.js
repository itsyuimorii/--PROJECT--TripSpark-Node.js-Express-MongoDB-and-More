self["Sources"]=self["Sources"]||{};Sources.AddSourceMapURLDialog=class extends UI.HBox{constructor(e){super(true);this.registerRequiredCSS("sources/dialog.css");this.contentElement.createChild("label").textContent=Common.UIString("Source map URL: ");this._input=UI.createInput();this.contentElement.appendChild(this._input);this._input.setAttribute("type","text");this._input.addEventListener("keydown",this._onKeyDown.bind(this),false);const t=this.contentElement.createChild("button");t.textContent=Common.UIString("Add");t.addEventListener("click",this._apply.bind(this),false);this.setDefaultFocusedElement(this._input);this._callback=e;this.contentElement.tabIndex=0}static show(e){const t=new UI.Dialog;const i=new Sources.AddSourceMapURLDialog(o);i.show(t.contentElement);t.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);t.show();function o(i){t.hide();e(i)}}_apply(){this._callback(this._input.value)}_onKeyDown(e){if(e.keyCode===UI.KeyboardShortcut.Keys.Enter.code){e.preventDefault();this._apply()}}};Sources.BreakpointEditDialog=class extends UI.Widget{constructor(e,t,i,o){super(true);this.registerRequiredCSS("sources/breakpointEditDialog.css");this._onFinish=o;this._finished=false;this._editor=null;this.element.tabIndex=-1;const s=Sources.BreakpointEditDialog.LogpointPrefix;const n=Sources.BreakpointEditDialog._LogpointSuffix;this._isLogpoint=t.startsWith(s)&&t.endsWith(n);if(this._isLogpoint)t=t.substring(s.length,t.length-n.length);this._isLogpoint=this._isLogpoint||i;this.element.classList.add("sources-edit-breakpoint-dialog");const r=new UI.Toolbar("source-frame-breakpoint-toolbar",this.contentElement);r.appendText(`Line ${e+1}:`);this._typeSelector=new UI.ToolbarComboBox(this._onTypeChanged.bind(this));this._typeSelector.createOption(ls`Breakpoint`,"",Sources.BreakpointEditDialog.BreakpointType.Breakpoint);const a=this._typeSelector.createOption(ls`Conditional breakpoint`,"",Sources.BreakpointEditDialog.BreakpointType.Conditional);const c=this._typeSelector.createOption(ls`Logpoint`,"",Sources.BreakpointEditDialog.BreakpointType.Logpoint);this._typeSelector.select(this._isLogpoint?c:a);r.appendToolbarItem(this._typeSelector);self.runtime.extension(UI.TextEditorFactory).instance().then(e=>{const i={lineNumbers:false,lineWrapping:true,mimeType:"javascript",autoHeight:true};this._editor=e.createEditor(i);this._updatePlaceholder();this._editor.widget().element.classList.add("condition-editor");this._editor.configureAutocomplete(ObjectUI.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor));if(t)this._editor.setText(t);this._editor.widget().show(this.contentElement);this._editor.setSelection(this._editor.fullRange());this._editor.widget().focus();this._editor.widget().element.addEventListener("keydown",this._onKeyDown.bind(this),true);this.contentElement.addEventListener("blur",e=>{if(e.relatedTarget&&!e.relatedTarget.isSelfOrDescendant(this.element))this._finishEditing(true)},true)})}static _conditionForLogpoint(e){return`${Sources.BreakpointEditDialog.LogpointPrefix}${e}${Sources.BreakpointEditDialog._LogpointSuffix}`}_onTypeChanged(){const e=this._typeSelector.selectedOption().value;this._isLogpoint=e===Sources.BreakpointEditDialog.BreakpointType.Logpoint;this._updatePlaceholder();if(e===Sources.BreakpointEditDialog.BreakpointType.Breakpoint){this._editor.setText("");this._finishEditing(true)}}_updatePlaceholder(){const e=this._typeSelector.selectedOption().value;if(e===Sources.BreakpointEditDialog.BreakpointType.Conditional){this._editor.setPlaceholder(ls`Expression to check before pausing, e.g. x > 5`);this._typeSelector.element.title=ls`Pause only when the condition is true`}else if(e===Sources.BreakpointEditDialog.BreakpointType.Logpoint){this._editor.setPlaceholder(ls`Log message, e.g. 'x is', x`);this._typeSelector.element.title=ls`Log a message to Console, do not break`}}_finishEditing(e){if(this._finished)return;this._finished=true;this._editor.widget().detach();let t=this._editor.text();if(this._isLogpoint)t=Sources.BreakpointEditDialog._conditionForLogpoint(t);this._onFinish({committed:e,condition:t})}async _onKeyDown(e){if(isEnterKey(e)&&!e.shiftKey){e.consume(true);const t=this._editor.text();if(e.ctrlKey||await ObjectUI.JavaScriptAutocomplete.isExpressionComplete(t))this._finishEditing(true);else this._editor.newlineAndIndent()}if(isEscKey(e))this._finishEditing(false)}};Sources.BreakpointEditDialog.LogpointPrefix="/** DEVTOOLS_LOGPOINT */ console.log(";Sources.BreakpointEditDialog._LogpointSuffix=")";Sources.BreakpointEditDialog.BreakpointType={Breakpoint:"Breakpoint",Conditional:"Conditional",Logpoint:"Logpoint"};Sources.CallStackSidebarPane=class extends UI.SimpleView{constructor(){super(Common.UIString("Call Stack"),true);this.registerRequiredCSS("sources/callStackSidebarPane.css");this._blackboxedMessageElement=this._createBlackboxedMessageElement();this.contentElement.appendChild(this._blackboxedMessageElement);this._notPausedMessageElement=this.contentElement.createChild("div","gray-info-message");this._notPausedMessageElement.textContent=Common.UIString("Not paused");this._items=new UI.ListModel;this._list=new UI.ListControl(this._items,this,UI.ListMode.NonViewport);this.contentElement.appendChild(this._list.element);this._list.element.addEventListener("contextmenu",this._onContextMenu.bind(this),false);this._list.element.addEventListener("click",this._onClick.bind(this),false);this._showMoreMessageElement=this._createShowMoreMessageElement();this._showMoreMessageElement.classList.add("hidden");this.contentElement.appendChild(this._showMoreMessageElement);this._showBlackboxed=false;this._locationPool=new Bindings.LiveLocationPool;this._updateThrottler=new Common.Throttler(100);this._maxAsyncStackChainDepth=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update();this._updateItemThrottler=new Common.Throttler(100);this._scheduledForUpdateItems=new Set}flavorChanged(e){this._showBlackboxed=false;this._maxAsyncStackChainDepth=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update()}_update(){this._updateThrottler.schedule(()=>this._doUpdate())}async _doUpdate(){this._locationPool.disposeAll();const e=UI.context.flavor(SDK.DebuggerPausedDetails);if(!e){this._notPausedMessageElement.classList.remove("hidden");this._blackboxedMessageElement.classList.add("hidden");this._showMoreMessageElement.classList.add("hidden");this._items.replaceAll([]);UI.context.setFlavor(SDK.DebuggerModel.CallFrame,null);return}let t=e.debuggerModel;this._notPausedMessageElement.classList.add("hidden");const i=e.callFrames.map(e=>{const t=Sources.CallStackSidebarPane.Item.createForDebuggerCallFrame(e,this._locationPool,this._refreshItem.bind(this));t[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]=e;return t});let o=e.asyncStackTrace;if(!o&&e.asyncStackTraceId){if(e.asyncStackTraceId.debuggerId)t=SDK.DebuggerModel.modelForDebuggerId(e.asyncStackTraceId.debuggerId);o=t?await t.fetchAsyncStackTrace(e.asyncStackTraceId):null}let s=e.callFrames;let n=this._maxAsyncStackChainDepth;while(o&&n>0){let e="";const r=o.description==="async function";if(r&&s.length&&o.callFrames.length){const t=s[s.length-1];const i=UI.beautifyFunctionName(t.functionName);e=UI.asyncStackTraceLabel("await in "+i)}else{e=UI.asyncStackTraceLabel(o.description)}i.push(...Sources.CallStackSidebarPane.Item.createItemsForAsyncStack(e,t,o.callFrames,this._locationPool,this._refreshItem.bind(this)));--n;s=o.callFrames;if(o.parent){o=o.parent}else if(o.parentId){if(o.parentId.debuggerId)t=SDK.DebuggerModel.modelForDebuggerId(o.parentId.debuggerId);o=t?await t.fetchAsyncStackTrace(o.parentId):null}else{o=null}}this._showMoreMessageElement.classList.toggle("hidden",!o);this._items.replaceAll(i);if(this._maxAsyncStackChainDepth===Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth)this._list.selectNextItem(true,false);this._updatedForTest()}_updatedForTest(){}_refreshItem(e){this._scheduledForUpdateItems.add(e);this._updateItemThrottler.schedule(t.bind(this));function t(){const e=Array.from(this._scheduledForUpdateItems);this._scheduledForUpdateItems.clear();this._muteActivateItem=true;if(!this._showBlackboxed&&this._items.every(e=>e.isBlackboxed)){this._showBlackboxed=true;for(let e=0;e<this._items.length;++e)this._list.refreshItemByIndex(e);this._blackboxedMessageElement.classList.toggle("hidden",true)}else{const t=new Set(e);let i=false;for(let e=0;e<this._items.length;++e){const o=this._items.at(e);if(t.has(o))this._list.refreshItemByIndex(e);i=i||o.isBlackboxed}this._blackboxedMessageElement.classList.toggle("hidden",this._showBlackboxed||!i)}delete this._muteActivateItem;return Promise.resolve()}}createElementForItem(e){const t=createElementWithClass("div","call-frame-item");const i=t.createChild("div","call-frame-item-title");i.createChild("div","call-frame-title-text").textContent=e.title;if(e.isAsyncHeader){t.classList.add("async-header")}else{const i=t.createChild("div","call-frame-location");i.textContent=e.linkText.trimMiddle(30);i.title=e.linkText;t.classList.toggle("blackboxed-call-frame",e.isBlackboxed)}t.classList.toggle("hidden",!this._showBlackboxed&&e.isBlackboxed);t.appendChild(UI.Icon.create("smallicon-thick-right-arrow","selected-call-frame-icon"));return t}heightForItem(e){console.assert(false);return 0}isItemSelectable(e){return!!e[Sources.CallStackSidebarPane._debuggerCallFrameSymbol]}selectedItemChanged(e,t,i,o){if(i)i.classList.remove("selected");if(o)o.classList.add("selected");if(t)this._activateItem(t)}_createBlackboxedMessageElement(){const e=createElementWithClass("div","blackboxed-message");e.createChild("span");const t=e.createChild("span","link");t.textContent=Common.UIString("Show blackboxed frames");t.addEventListener("click",()=>{this._showBlackboxed=true;for(const e of this._items)this._refreshItem(e);this._blackboxedMessageElement.classList.toggle("hidden",true)});return e}_createShowMoreMessageElement(){const e=createElementWithClass("div","show-more-message");e.createChild("span");const t=e.createChild("span","link");t.textContent=Common.UIString("Show more");t.addEventListener("click",()=>{this._maxAsyncStackChainDepth+=Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth;this._update()},false);return e}_onContextMenu(e){const t=this._list.itemForNode(e.target);if(!t)return;const i=new UI.ContextMenu(e);const o=t[Sources.CallStackSidebarPane._debuggerCallFrameSymbol];if(o)i.defaultSection().appendItem(Common.UIString("Restart frame"),()=>o.restart());i.defaultSection().appendItem(Common.UIString("Copy stack trace"),this._copyStackTrace.bind(this));if(t.uiLocation)this.appendBlackboxURLContextMenuItems(i,t.uiLocation.uiSourceCode);i.show()}_onClick(e){const t=this._list.itemForNode(e.target);if(t)this._activateItem(t)}_activateItem(e){const t=e.uiLocation;if(this._muteActivateItem||!t)return;const i=e[Sources.CallStackSidebarPane._debuggerCallFrameSymbol];if(i&&UI.context.flavor(SDK.DebuggerModel.CallFrame)!==i){i.debuggerModel.setSelectedCallFrame(i);UI.context.setFlavor(SDK.DebuggerModel.CallFrame,i)}else{Common.Revealer.reveal(t)}}appendBlackboxURLContextMenuItems(e,t){const i=Persistence.persistence.binding(t);if(i)t=i.network;if(t.project().type()===Workspace.projectTypes.FileSystem)return;const o=Bindings.blackboxManager.canBlackboxUISourceCode(t);const s=Bindings.blackboxManager.isBlackboxedUISourceCode(t);const n=t.project().type()===Workspace.projectTypes.ContentScripts;const r=Bindings.blackboxManager;if(o){if(s){e.defaultSection().appendItem(Common.UIString("Stop blackboxing"),r.unblackboxUISourceCode.bind(r,t))}else{e.defaultSection().appendItem(Common.UIString("Blackbox script"),r.blackboxUISourceCode.bind(r,t))}}if(n){if(s){e.defaultSection().appendItem(Common.UIString("Stop blackboxing all content scripts"),r.blackboxContentScripts.bind(r))}else{e.defaultSection().appendItem(Common.UIString("Blackbox all content scripts"),r.unblackboxContentScripts.bind(r))}}}_selectNextCallFrameOnStack(){return this._list.selectNextItem(false,false)}_selectPreviousCallFrameOnStack(){return this._list.selectPreviousItem(false,false)}_copyStackTrace(){const e=[];for(const t of this._items){let i=t.title;if(t.uiLocation)i+=" ("+t.uiLocation.linkText(true)+")";e.push(i)}InspectorFrontendHost.copyText(e.join("\n"))}};Sources.CallStackSidebarPane._debuggerCallFrameSymbol=Symbol("debuggerCallFrame");Sources.CallStackSidebarPane._elementSymbol=Symbol("element");Sources.CallStackSidebarPane._defaultMaxAsyncStackChainDepth=32;Sources.CallStackSidebarPane.ActionDelegate=class{handleAction(e,t){const i=self.runtime.sharedInstance(Sources.CallStackSidebarPane);switch(t){case"debugger.next-call-frame":i._selectNextCallFrameOnStack();return true;case"debugger.previous-call-frame":i._selectPreviousCallFrameOnStack();return true}return false}};Sources.CallStackSidebarPane.Item=class{static createForDebuggerCallFrame(e,t,i){const o=new Sources.CallStackSidebarPane.Item(UI.beautifyFunctionName(e.functionName),i);Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(e.location(),o._update.bind(o),t);return o}static createItemsForAsyncStack(e,t,i,o,s){const n=Symbol("whiteboxedItems");const r=new Sources.CallStackSidebarPane.Item(e,s);r[n]=new Set;r.isAsyncHeader=true;const a=i.map(e=>{const i=new Sources.CallStackSidebarPane.Item(UI.beautifyFunctionName(e.functionName),c);const s=t?t.createRawLocationByScriptId(e.scriptId,e.lineNumber,e.columnNumber):null;if(!s){i.linkText=(e.url||"<unknown>")+":"+(e.lineNumber+1);i.updateDelegate(i)}else{Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(s,i._update.bind(i),o)}return i});s(r);return[r,...a];function c(e){s(e);let t=false;const i=r[n];if(e.isBlackboxed){i.delete(e);t=i.size===0}else{t=i.size===0;i.add(e)}r.isBlackboxed=r[n].size===0;if(t)s(r)}}constructor(e,t){this.isBlackboxed=false;this.title=e;this.linkText="";this.uiLocation=null;this.isAsyncHeader=false;this.updateDelegate=t}_update(e){const t=e.uiLocation();this.isBlackboxed=t?Bindings.blackboxManager.isBlackboxedUISourceCode(t.uiSourceCode):false;this.linkText=t?t.linkText():"";this.uiLocation=t;this.updateDelegate(this)}};Sources.DebuggerPausedMessage=class{constructor(){this._element=createElementWithClass("div","paused-message flex-none");const e=UI.createShadowRootWithCoreStyles(this._element,"sources/debuggerPausedMessage.css");this._contentElement=e.createChild("div")}element(){return this._element}static _descriptionWithoutStack(e){const t=/^\s+at\s/m.exec(e);return t?e.substring(0,t.index-1):e.substring(0,e.lastIndexOf("\n"))}static async _createDOMBreakpointHitMessage(e){const t=createElement("span");const i=e.debuggerModel.target().model(SDK.DOMDebuggerModel);if(!e.auxData||!i)return t;const o=i.resolveDOMBreakpointData(e.auxData);if(!o)return t;const s=t.createChild("div","status-main");s.appendChild(UI.Icon.create("smallicon-info","status-icon"));const n=Sources.DebuggerPausedMessage.BreakpointTypeNouns.get(o.type);s.appendChild(createTextNode(ls`Paused on ${n}`));const r=t.createChild("div","status-sub monospace");const a=await Common.Linkifier.linkify(o.node);r.appendChild(a);if(o.targetNode){const e=await Common.Linkifier.linkify(o.targetNode);let t;if(o.insertion){if(o.targetNode===o.node)t=UI.formatLocalized("Child %s added",[e]);else t=UI.formatLocalized("Descendant %s added",[e])}else{t=UI.formatLocalized("Descendant %s removed",[e])}r.appendChild(createElement("br"));r.appendChild(t)}return t}async render(e,t,i){this._contentElement.removeChildren();this._contentElement.hidden=!e;if(!e)return;const o=this._contentElement.createChild("div","paused-status");const s=e.reason===SDK.DebuggerModel.BreakReason.Exception||e.reason===SDK.DebuggerModel.BreakReason.PromiseRejection||e.reason===SDK.DebuggerModel.BreakReason.Assert||e.reason===SDK.DebuggerModel.BreakReason.OOM;let n;if(e.reason===SDK.DebuggerModel.BreakReason.DOM){n=await Sources.DebuggerPausedMessage._createDOMBreakpointHitMessage(e)}else if(e.reason===SDK.DebuggerModel.BreakReason.EventListener){let t="";if(e.auxData){t=SDK.domDebuggerManager.resolveEventListenerBreakpointTitle(e.auxData)}n=r(Common.UIString("Paused on event listener"),t)}else if(e.reason===SDK.DebuggerModel.BreakReason.XHR){n=r(Common.UIString("Paused on XHR or fetch"),e.auxData["url"]||"")}else if(e.reason===SDK.DebuggerModel.BreakReason.Exception){const t=e.auxData["description"]||e.auxData["value"]||"";const i=Sources.DebuggerPausedMessage._descriptionWithoutStack(t);n=r(Common.UIString("Paused on exception"),i,t)}else if(e.reason===SDK.DebuggerModel.BreakReason.PromiseRejection){const t=e.auxData["description"]||e.auxData["value"]||"";const i=Sources.DebuggerPausedMessage._descriptionWithoutStack(t);n=r(Common.UIString("Paused on promise rejection"),i,t)}else if(e.reason===SDK.DebuggerModel.BreakReason.Assert){n=r(Common.UIString("Paused on assertion"))}else if(e.reason===SDK.DebuggerModel.BreakReason.DebugCommand){n=r(Common.UIString("Paused on debugged function"))}else if(e.reason===SDK.DebuggerModel.BreakReason.OOM){n=r(Common.UIString("Paused before potential out-of-memory crash"))}else if(e.callFrames.length){const o=t.rawLocationToUILocation(e.callFrames[0].location());const s=o?i.findBreakpoint(o):null;const a=s?Common.UIString("Paused on breakpoint"):Common.UIString("Debugger paused");n=r(a)}else{console.warn("ScriptsPanel paused, but callFrames.length is zero.")}o.classList.toggle("error-reason",s);if(n)o.appendChild(n);function r(e,t,i){const o=createElement("span");const n=o.createChild("div","status-main");const r=UI.Icon.create(s?"smallicon-error":"smallicon-info","status-icon");n.appendChild(r);n.appendChild(createTextNode(e));if(t){const e=o.createChild("div","status-sub monospace");e.textContent=t;e.title=i||t}return o}}};Sources.DebuggerPausedMessage.BreakpointTypeNouns=new Map([[SDK.DOMDebuggerModel.DOMBreakpoint.Type.SubtreeModified,Common.UIString("subtree modifications")],[SDK.DOMDebuggerModel.DOMBreakpoint.Type.AttributeModified,Common.UIString("attribute modifications")],[SDK.DOMDebuggerModel.DOMBreakpoint.Type.NodeRemoved,Common.UIString("node removal")]]);Sources.HistoryEntry=function(){};Sources.HistoryEntry.prototype={valid(){},reveal(){}};Sources.SimpleHistoryManager=class{constructor(e){this._entries=[];this._activeEntryIndex=-1;this._coalescingReadonly=0;this._historyDepth=e}readOnlyLock(){++this._coalescingReadonly}releaseReadOnlyLock(){--this._coalescingReadonly}readOnly(){return!!this._coalescingReadonly}filterOut(e){if(this.readOnly())return;const t=[];let i=0;for(let o=0;o<this._entries.length;++o){if(!e(this._entries[o]))t.push(this._entries[o]);else if(o<=this._activeEntryIndex)++i}this._entries=t;this._activeEntryIndex=Math.max(0,this._activeEntryIndex-i)}empty(){return!this._entries.length}active(){return this.empty()?null:this._entries[this._activeEntryIndex]}push(e){if(this.readOnly())return;if(!this.empty())this._entries.splice(this._activeEntryIndex+1);this._entries.push(e);if(this._entries.length>this._historyDepth)this._entries.shift();this._activeEntryIndex=this._entries.length-1}rollback(){if(this.empty())return false;let e=this._activeEntryIndex-1;while(e>=0&&!this._entries[e].valid())--e;if(e<0)return false;this.readOnlyLock();this._entries[e].reveal();this.releaseReadOnlyLock();this._activeEntryIndex=e;return true}rollover(){let e=this._activeEntryIndex+1;while(e<this._entries.length&&!this._entries[e].valid())++e;if(e>=this._entries.length)return false;this.readOnlyLock();this._entries[e].reveal();this.releaseReadOnlyLock();this._activeEntryIndex=e;return true}};Sources.EditingLocationHistoryManager=class{constructor(e,t){this._sourcesView=e;this._historyManager=new Sources.SimpleHistoryManager(Sources.EditingLocationHistoryManager.HistoryDepth);this._currentSourceFrameCallback=t}trackSourceFrameCursorJumps(e){e.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.JumpHappened,this._onJumpHappened.bind(this))}_onJumpHappened(e){if(e.data.from)this._updateActiveState(e.data.from);if(e.data.to)this._pushActiveState(e.data.to)}rollback(){this._historyManager.rollback()}rollover(){this._historyManager.rollover()}updateCurrentState(){const e=this._currentSourceFrameCallback();if(!e)return;this._updateActiveState(e.textEditor.selection())}pushNewState(){const e=this._currentSourceFrameCallback();if(!e)return;this._pushActiveState(e.textEditor.selection())}_updateActiveState(e){const t=this._historyManager.active();if(!t)return;const i=this._currentSourceFrameCallback();if(!i)return;const o=new Sources.EditingLocationHistoryEntry(this._sourcesView,this,i,e);t.merge(o)}_pushActiveState(e){const t=this._currentSourceFrameCallback();if(!t)return;const i=new Sources.EditingLocationHistoryEntry(this._sourcesView,this,t,e);this._historyManager.push(i)}removeHistoryForSourceCode(e){function t(t){return t._projectId===e.project().id()&&t._url===e.url()}this._historyManager.filterOut(t)}};Sources.EditingLocationHistoryManager.HistoryDepth=20;Sources.EditingLocationHistoryEntry=class{constructor(e,t,i,o){this._sourcesView=e;this._editingLocationManager=t;const s=i.uiSourceCode();this._projectId=s.project().id();this._url=s.url();const n=this._positionFromSelection(o);this._positionHandle=i.textEditor.textEditorPositionHandle(n.lineNumber,n.columnNumber)}merge(e){if(this._projectId!==e._projectId||this._url!==e._url)return;this._positionHandle=e._positionHandle}_positionFromSelection(e){return{lineNumber:e.endLine,columnNumber:e.endColumn}}valid(){const e=this._positionHandle.resolve();const t=Workspace.workspace.uiSourceCode(this._projectId,this._url);return!!(e&&t)}reveal(){const e=this._positionHandle.resolve();const t=Workspace.workspace.uiSourceCode(this._projectId,this._url);if(!e||!t)return;this._editingLocationManager.updateCurrentState();this._sourcesView.showSourceLocation(t,e.lineNumber,e.columnNumber)}};Sources.FilePathScoreFunction=class{constructor(e){this._query=e;this._queryUpperCase=e.toUpperCase();this._score=new Int32Array(20*100);this._sequence=new Int32Array(20*100);this._dataUpperCase="";this._fileNameIndex=0}score(e,t){if(!e||!this._query)return 0;const i=this._query.length;const o=e.length;if(!this._score||this._score.length<i*o){this._score=new Int32Array(i*o*2);this._sequence=new Int32Array(i*o*2)}const s=this._score;const n=this._sequence;this._dataUpperCase=e.toUpperCase();this._fileNameIndex=e.lastIndexOf("/");for(let t=0;t<i;++t){for(let i=0;i<o;++i){const r=i===0?0:s[t*o+i-1];const a=t===0||i===0?0:s[(t-1)*o+i-1];const c=t===0||i===0?0:n[(t-1)*o+i-1];const l=this._match(this._query,e,t,i,c);if(l&&a+l>=r){n[t*o+i]=c+1;s[t*o+i]=a+l}else{n[t*o+i]=0;s[t*o+i]=r}}}if(t)this._restoreMatchIndexes(n,i,o,t);const r=256;return s[i*o-1]*r+(r-e.length)}_testWordStart(e,t){if(t===0)return true;const i=e.charAt(t-1);return i==="_"||i==="-"||i==="/"||e[t-1]!==this._dataUpperCase[t-1]&&e[t]===this._dataUpperCase[t]}_restoreMatchIndexes(e,t,i,o){let s=t-1,n=i-1;while(s>=0&&n>=0){switch(e[s*i+n]){case 0:--n;break;default:o.push(n);--s;--n;break}}o.reverse()}_singleCharScore(e,t,i,o){const s=this._testWordStart(t,o);const n=o>this._fileNameIndex;const r=o===0||t[o-1]==="/";const a=e[i]===t[o]&&e[i]===this._queryUpperCase[i];let c=10;if(r)c+=4;if(s)c+=2;if(a)c+=6;if(n)c+=4;if(o===this._fileNameIndex+1&&i===0)c+=5;if(n&&s)c+=3;return c}_sequenceCharScore(e,t,i,o,s){const n=o>this._fileNameIndex;const r=o===0||t[o-1]==="/";let a=10;if(n)a+=4;if(r)a+=5;a+=s*4;return a}_match(e,t,i,o,s){if(this._queryUpperCase[i]!==this._dataUpperCase[o])return 0;if(!s)return this._singleCharScore(e,t,i,o);else return this._sequenceCharScore(e,t,i,o-s,s)}};Sources.FilteredUISourceCodeListProvider=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._queryLineNumberAndColumnNumber="";this._defaultScores=null;this._scorer=new Sources.FilePathScoreFunction("")}_projectRemoved(e){const t=e.data;this._populate(t);this.refresh()}_populate(e){this._uiSourceCodes=[];const t=Workspace.workspace.projects().filter(this.filterProject.bind(this));for(let i=0;i<t.length;++i){if(e&&t[i]===e)continue;const o=t[i].uiSourceCodes().filter(this._filterUISourceCode.bind(this));this._uiSourceCodes=this._uiSourceCodes.concat(o)}}_filterUISourceCode(e){const t=Persistence.persistence.binding(e);return!t||t.fileSystem===e}uiSourceCodeSelected(e,t,i){}filterProject(e){return true}itemCount(){return this._uiSourceCodes.length}itemKeyAt(e){return this._uiSourceCodes[e].url()}setDefaultScores(e){this._defaultScores=e}itemScoreAt(e,t){const i=this._uiSourceCodes[e];const o=this._defaultScores?this._defaultScores.get(i)||0:0;if(!t||t.length<2)return o;if(this._query!==t){this._query=t;this._scorer=new Sources.FilePathScoreFunction(t)}let s=10;if(i.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(i))s=5;const n=i.fullDisplayName();return o+s*this._scorer.score(n,null)}renderItem(e,t,i,o){t=this.rewriteQuery(t);const s=this._uiSourceCodes[e];const n=s.fullDisplayName();const r=[];new Sources.FilePathScoreFunction(t).score(n,r);const a=n.lastIndexOf("/");i.classList.add("monospace");o.classList.add("monospace");i.textContent=s.displayName()+(this._queryLineNumberAndColumnNumber||"");this._renderSubtitleElement(o,n);o.title=n;const c=[];for(let e=0;e<r.length;++e)c.push({offset:r[e],length:1});if(r[0]>a){for(let e=0;e<c.length;++e)c[e].offset-=a+1;UI.highlightRangesWithStyleClass(i,c,"highlight")}else{UI.highlightRangesWithStyleClass(o,c,"highlight")}}_renderSubtitleElement(e,t){e.removeChildren();let i=t.lastIndexOf("/");if(t.length>55)i=t.length-55;const o=e.createChild("div","first-part");o.textContent=t.substring(0,i);const s=e.createChild("div","second-part");s.textContent=t.substring(i);e.title=t}selectItem(e,t){const i=t.trim().match(/^([^:]*)(:\d+)?(:\d+)?$/);if(!i)return;let o;let s;if(i[2])o=parseInt(i[2].substr(1),10)-1;if(i[3])s=parseInt(i[3].substr(1),10)-1;const n=e!==null?this._uiSourceCodes[e]:null;this.uiSourceCodeSelected(n,o,s)}rewriteQuery(e){e=e?e.trim():"";if(!e||e===":")return"";const t=e.match(/^([^:]+)((?::[^:]*){0,2})$/);this._queryLineNumberAndColumnNumber=t?t[2]:"";return t?t[1]:e}_uiSourceCodeAdded(e){const t=e.data;if(!this._filterUISourceCode(t)||!this.filterProject(t.project()))return;this._uiSourceCodes.push(t);this.refresh()}notFoundText(){return Common.UIString("No files found")}attach(){Workspace.workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);Workspace.workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved,this);this._populate()}detach(){Workspace.workspace.removeEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);Workspace.workspace.removeEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved,this);this._queryLineNumberAndColumnNumber="";this._defaultScores=null}};Sources.GoToLineQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{selectItem(e,t){const i=this._currentUISourceCode();if(!i)return;const o=this._parsePosition(t);if(!o)return;Common.Revealer.reveal(i.uiLocation(o.line-1,o.column-1))}notFoundText(e){if(!this._currentUISourceCode())return Common.UIString("No file selected.");const t=this._parsePosition(e);if(!t)return Common.UIString("Type a number to go to that line.");if(t.column&&t.column>1)return ls`Go to line ${t.line} and column ${t.column}.`;return ls`Go to line ${t.line}.`}_parsePosition(e){const t=e.match(/([0-9]+)(\:[0-9]*)?/);if(!t||!t[0]||t[0].length!==e.length)return null;const i=parseInt(t[1],10);let o;if(t[2])o=parseInt(t[2].substring(1),10);return{line:Math.max(i|0,1),column:Math.max(o|0,1)}}_currentUISourceCode(){const e=UI.context.flavor(Sources.SourcesView);if(!e)return null;return e.currentUISourceCode()}};Sources.SourceMapNamesResolver={};Sources.SourceMapNamesResolver._cachedMapSymbol=Symbol("cache");Sources.SourceMapNamesResolver._cachedIdentifiersSymbol=Symbol("cachedIdentifiers");Sources.SourceMapNamesResolver.Identifier=class{constructor(e,t,i){this.name=e;this.lineNumber=t;this.columnNumber=i}};Sources.SourceMapNamesResolver._scopeIdentifiers=function(e){const t=e.startLocation();const i=e.endLocation();if(e.type()===Protocol.Debugger.ScopeType.Global||!t||!i||!t.script()||!t.script().sourceMapURL||t.script()!==i.script())return Promise.resolve([]);const o=t.script();return o.requestContent().then(s);function s(e){if(!e)return Promise.resolve([]);const o=new TextUtils.Text(e);const s=new TextUtils.TextRange(t.lineNumber,t.columnNumber,i.lineNumber,i.columnNumber);const r=o.extract(s);const a=o.toSourceRange(s).offset;const c="function fui";return Formatter.formatterWorkerPool().javaScriptIdentifiers(c+r).then(n.bind(null,o,a,c))}function n(e,t,i,o){const s=[];const n=new TextUtils.TextCursor(e.lineEndings());for(let e=0;e<o.length;++e){const r=o[e];if(r.offset<i.length)continue;const a=t+r.offset-i.length;n.resetTo(a);s.push(new Sources.SourceMapNamesResolver.Identifier(r.name,n.lineNumber(),n.columnNumber()))}return s}};Sources.SourceMapNamesResolver._resolveScope=function(e){let t=e[Sources.SourceMapNamesResolver._cachedIdentifiersSymbol];if(t)return t;const i=e.callFrame().script;const o=Bindings.debuggerWorkspaceBinding.sourceMapForScript(i);if(!o)return Promise.resolve(new Map);const s=new Map;t=Sources.SourceMapNamesResolver._scopeIdentifiers(e).then(n);e[Sources.SourceMapNamesResolver._cachedIdentifiersSymbol]=t;return t;function n(e){const t=new Map;for(let i=0;i<e.length;++i){const s=e[i];const n=o.findEntry(s.lineNumber,s.columnNumber);if(n&&n.name)t.set(s.name,n.name)}const i=[];for(let o=0;o<e.length;++o){const s=e[o];if(t.has(s.name))continue;const n=a(s).then(r.bind(null,t,s));i.push(n)}return Promise.all(i).then(()=>Sources.SourceMapNamesResolver._scopeResolvedForTest()).then(()=>t)}function r(e,t,i){if(!i)return;e.set(t.name,i)}function a(e){const t=o.findEntry(e.lineNumber,e.columnNumber);const s=o.findEntry(e.lineNumber,e.columnNumber+e.name.length);if(!t||!s||!t.sourceURL||t.sourceURL!==s.sourceURL||!t.sourceLineNumber||!t.sourceColumnNumber||!s.sourceLineNumber||!s.sourceColumnNumber)return Promise.resolve(null);const n=new TextUtils.TextRange(t.sourceLineNumber,t.sourceColumnNumber,s.sourceLineNumber,s.sourceColumnNumber);const r=Bindings.debuggerWorkspaceBinding.uiSourceCodeForSourceMapSourceURL(i.debuggerModel,t.sourceURL,i.isContentScript());if(!r)return Promise.resolve(null);return r.requestContent().then(c.bind(null,n))}function c(e,t){if(!t)return null;let i=s.get(t);if(!i){i=new TextUtils.Text(t);s.set(t,i)}const o=i.extract(e).trim();return/[a-zA-Z0-9_$]+/.test(o)?o:null}};Sources.SourceMapNamesResolver._scopeResolvedForTest=function(){};Sources.SourceMapNamesResolver._allVariablesInCallFrame=function(e){const t=e[Sources.SourceMapNamesResolver._cachedMapSymbol];if(t)return Promise.resolve(t);const i=[];const o=e.scopeChain();for(let e=0;e<o.length;++e)i.push(Sources.SourceMapNamesResolver._resolveScope(o[e]));return Promise.all(i).then(s);function s(t){const i=new Map;for(const e of t){for(const t of e.keys()){const o=e.get(t);if(!i.has(o))i.set(o,t)}}e[Sources.SourceMapNamesResolver._cachedMapSymbol]=i;return i}};Sources.SourceMapNamesResolver.resolveExpression=function(e,t,i,o,s,n){if(!i.contentType().isFromSourceMap())return Promise.resolve("");return Sources.SourceMapNamesResolver._allVariablesInCallFrame(e).then(t=>r(e.debuggerModel,t));function r(e,r){if(r.has(t))return Promise.resolve(r.get(t)||"");return Sources.SourceMapNamesResolver._resolveExpression(e,i,o,s,n)}};Sources.SourceMapNamesResolver._resolveExpression=function(e,t,i,o,s){const n=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(t,i,o);const r=n.find(t=>t.debuggerModel===e);if(!r)return Promise.resolve("");const a=r.script();if(!a)return Promise.resolve("");const c=Bindings.debuggerWorkspaceBinding.sourceMapForScript(a);if(!c)return Promise.resolve("");return a.requestContent().then(l);function l(e){if(!e)return Promise.resolve("");const n=new TextUtils.Text(e);const r=c.reverseMapTextRange(t.url(),new TextUtils.TextRange(i,o,i,s));const a=n.extract(r);if(!a)return Promise.resolve("");return Formatter.formatterWorkerPool().evaluatableJavaScriptSubstring(a)}};Sources.SourceMapNamesResolver.resolveThisObject=function(e){if(!e)return Promise.resolve(null);if(!e.scopeChain().length)return Promise.resolve(e.thisObject());return Sources.SourceMapNamesResolver._resolveScope(e.scopeChain()[0]).then(t);function t(t){const o=t.inverse().get("this");if(!o||o.size!==1)return Promise.resolve(e.thisObject());const s=o.valuesArray()[0];return e.evaluate({expression:s,objectGroup:"backtrace",includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:true}).then(i)}function i(t){return!t.exceptionDetails&&t.object?t.object:e.thisObject()}};Sources.SourceMapNamesResolver.resolveScopeInObject=function(e){const t=e.startLocation();const i=e.endLocation();if(e.type()===Protocol.Debugger.ScopeType.Global||!t||!i||!t.script()||!t.script().sourceMapURL||t.script()!==i.script())return e.object();return new Sources.SourceMapNamesResolver.RemoteObject(e)};Sources.SourceMapNamesResolver.RemoteObject=class extends SDK.RemoteObject{constructor(e){super();this._scope=e;this._object=e.object()}customPreview(){return this._object.customPreview()}get objectId(){return this._object.objectId}get type(){return this._object.type}get subtype(){return this._object.subtype}get value(){return this._object.value}get description(){return this._object.description}get hasChildren(){return this._object.hasChildren}get preview(){return this._object.preview}arrayLength(){return this._object.arrayLength()}getOwnProperties(e){return this._object.getOwnProperties(e)}async getAllProperties(e,t){const i=await this._object.getAllProperties(e,t);const o=await Sources.SourceMapNamesResolver._resolveScope(this._scope);const s=i.properties;const n=i.internalProperties;const r=[];if(s){for(let e=0;e<s.length;++e){const t=s[e];const i=o.get(t.name)||s[e].name;r.push(new SDK.RemoteObjectProperty(i,t.value,t.enumerable,t.writable,t.isOwn,t.wasThrown,t.symbol,t.synthetic))}}return{properties:r,internalProperties:n}}async setPropertyValue(e,t){const i=await Sources.SourceMapNamesResolver._resolveScope(this._scope);let o;if(typeof e==="string")o=e;else o=e.value;let s=o;for(const e of i.keys()){if(i.get(e)===o){s=e;break}}return this._object.setPropertyValue(s,t)}async deleteProperty(e){return this._object.deleteProperty(e)}callFunction(e,t){return this._object.callFunction(e,t)}callFunctionJSON(e,t){return this._object.callFunctionJSON(e,t)}release(){this._object.release()}debuggerModel(){return this._object.debuggerModel()}runtimeModel(){return this._object.runtimeModel()}isNode(){return this._object.isNode()}};Sources.JavaScriptBreakpointsSidebarPane=class extends UI.ThrottledWidget{constructor(){super(true);this.registerRequiredCSS("sources/javaScriptBreakpointsSidebarPane.css");this._breakpointManager=Bindings.breakpointManager;this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this.update,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this.update,this);Common.moduleSetting("breakpointsActive").addChangeListener(this.update,this);this._listElement=null;this.update()}doUpdate(){const e=this._breakpointManager.allBreakpointLocations().filter(e=>e.uiLocation.uiSourceCode.project().type()!==Workspace.projectTypes.Debugger);if(!e.length){this._listElement=null;this.contentElement.removeChildren();const e=this.contentElement.createChild("div","gray-info-message");e.textContent=Common.UIString("No breakpoints");this.contentElement.appendChild(e);this._didUpdateForTest();return Promise.resolve()}if(!this._listElement){this.contentElement.removeChildren();this._listElement=this.contentElement.createChild("div");this.contentElement.appendChild(this._listElement)}e.sort((e,t)=>e.uiLocation.compareTo(t.uiLocation));const t=new Multimap;const i=new Multimap;for(const o of e){const e=o.uiLocation;const s=`${e.uiSourceCode.url()}:${e.lineNumber}:${e.columnNumber}`;i.set(s,o);const n=`${e.uiSourceCode.url()}:${e.lineNumber}`;t.set(n,s)}const o=UI.context.flavor(SDK.DebuggerPausedDetails);const s=o&&o.callFrames.length?Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(o.callFrames[0].location()):null;let n=false;let r=this._listElement.firstChild;const a=[];for(const e of i.keysArray()){if(!r){r=this._listElement.createChild("div","breakpoint-entry");r.addEventListener("contextmenu",this._breakpointContextMenu.bind(this),true);r.addEventListener("click",this._revealLocation.bind(this),false);const e=UI.CheckboxLabel.create("");e.addEventListener("click",this._breakpointCheckboxClicked.bind(this),false);r.appendChild(e);r[Sources.JavaScriptBreakpointsSidebarPane._checkboxLabelSymbol]=e;const t=r.createChild("div","source-text monospace");r[Sources.JavaScriptBreakpointsSidebarPane._snippetElementSymbol]=t}const o=Array.from(i.get(e));const c=o[0].uiLocation;const l=!!s&&o.some(e=>e.uiLocation.id()===s.id());const d=o.some(e=>e.breakpoint.enabled());const u=o.some(e=>!e.breakpoint.enabled());const h=t.get(`${c.uiSourceCode.url()}:${c.lineNumber}`).size>1;a.push(this._resetEntry(r,c,l,d,u,h));r[Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol]=o;if(l)n=true;r=r.nextSibling}while(r){const e=r.nextSibling;r.remove();r=e}if(n)UI.viewManager.showView("sources.jsBreakpoints");this._listElement.classList.toggle("breakpoints-list-deactivated",!Common.moduleSetting("breakpointsActive").get());return Promise.all(a).then(()=>this._didUpdateForTest())}async _resetEntry(e,t,i,o,s,n){e[Sources.JavaScriptBreakpointsSidebarPane._locationSymbol]=t;e.classList.toggle("breakpoint-hit",i);const r=e[Sources.JavaScriptBreakpointsSidebarPane._checkboxLabelSymbol];r.textElement.textContent=t.linkText()+(n?":"+(t.columnNumber+1):"");r.checkboxElement.checked=o;r.checkboxElement.indeterminate=o&&s;const a=e[Sources.JavaScriptBreakpointsSidebarPane._snippetElementSymbol];const c=await t.uiSourceCode.requestContent();const l=t.lineNumber;const d=new TextUtils.Text(c||"");if(l<d.lineCount()){const e=d.lineAt(l);const i=200;a.textContent=e.substring(n?t.columnNumber:0).trimEnd(i)}}_breakpointLocations(e){const t=e.target.enclosingNodeOrSelfWithClass("breakpoint-entry");if(!t)return[];return t[Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol]||[]}_breakpointCheckboxClicked(e){const t=this._breakpointLocations(e).map(e=>e.breakpoint);const i=e.target.checkboxElement.checked;for(const e of t)e.setEnabled(i);e.consume()}_revealLocation(e){const t=this._breakpointLocations(e).map(e=>e.uiLocation);let i=null;for(const e of t){if(!i||e.columnNumber<i.columnNumber)i=e}if(i)Common.Revealer.reveal(i)}_breakpointContextMenu(e){const t=this._breakpointLocations(e).map(e=>e.breakpoint);const i=new UI.ContextMenu(e);const o=t.length>1?Common.UIString("Remove all breakpoints in line"):Common.UIString("Remove breakpoint");i.defaultSection().appendItem(o,()=>t.map(e=>e.remove(false)));const s=Common.moduleSetting("breakpointsActive").get();const n=s?Common.UIString("Deactivate breakpoints"):Common.UIString("Activate breakpoints");i.defaultSection().appendItem(n,()=>Common.moduleSetting("breakpointsActive").set(!s));if(t.some(e=>!e.enabled())){const e=Common.UIString("Enable all breakpoints");i.defaultSection().appendItem(e,this._toggleAllBreakpoints.bind(this,true))}if(t.some(e=>e.enabled())){const e=Common.UIString("Disable all breakpoints");i.defaultSection().appendItem(e,this._toggleAllBreakpoints.bind(this,false))}const r=Common.UIString("Remove all breakpoints");i.defaultSection().appendItem(r,this._removeAllBreakpoints.bind(this));const a=Common.UIString("Remove other breakpoints");i.defaultSection().appendItem(a,this._removeOtherBreakpoints.bind(this,new Set(t)));i.show()}_toggleAllBreakpoints(e){for(const t of this._breakpointManager.allBreakpointLocations())t.breakpoint.setEnabled(e)}_removeAllBreakpoints(){for(const e of this._breakpointManager.allBreakpointLocations())e.breakpoint.remove(false)}_removeOtherBreakpoints(e){for(const t of this._breakpointManager.allBreakpointLocations()){if(!e.has(t.breakpoint))t.breakpoint.remove(false)}}flavorChanged(e){this.update()}_didUpdateForTest(){}};Sources.JavaScriptBreakpointsSidebarPane._locationSymbol=Symbol("location");Sources.JavaScriptBreakpointsSidebarPane._checkboxLabelSymbol=Symbol("checkbox-label");Sources.JavaScriptBreakpointsSidebarPane._snippetElementSymbol=Symbol("snippet-element");Sources.JavaScriptBreakpointsSidebarPane._breakpointLocationsSymbol=Symbol("locations");Sources.UISourceCodeFrame=class extends SourceFrame.SourceFrame{constructor(e){super(t);this._uiSourceCode=e;if(Runtime.experiments.isEnabled("sourceDiff"))this._diff=new SourceFrame.SourceCodeDiff(this.textEditor);this._muteSourceCodeEvents=false;this._isSettingContent=false;this._persistenceBinding=Persistence.persistence.binding(e);this._rowMessageBuckets=new Map;this._typeDecorationsPending=new Set;this._uiSourceCodeEventListeners=[];this._messageAndDecorationListeners=[];this._boundOnBindingChanged=this._onBindingChanged.bind(this);this.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorBlurred,()=>UI.context.setFlavor(Sources.UISourceCodeFrame,null));this.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorFocused,()=>UI.context.setFlavor(Sources.UISourceCodeFrame,this));Common.settings.moduleSetting("persistenceNetworkOverridesEnabled").addChangeListener(this._onNetworkPersistenceChanged,this);this._errorPopoverHelper=new UI.PopoverHelper(this.element,this._getErrorPopoverContent.bind(this));this._errorPopoverHelper.setHasPadding(true);this._errorPopoverHelper.setTimeout(100,100);this._plugins=[];this._initializeUISourceCode();function t(){if(e.isDirty())return Promise.resolve(e.workingCopy());return e.requestContent()}}_installMessageAndDecorationListeners(){if(this._persistenceBinding){const e=this._persistenceBinding.network;const t=this._persistenceBinding.fileSystem;this._messageAndDecorationListeners=[e.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),e.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this),e.addEventListener(Workspace.UISourceCode.Events.LineDecorationAdded,this._onLineDecorationAdded,this),e.addEventListener(Workspace.UISourceCode.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this),t.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),t.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this)]}else{this._messageAndDecorationListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageAdded,this._onMessageAdded,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.MessageRemoved,this._onMessageRemoved,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationAdded,this._onLineDecorationAdded,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this)]}}uiSourceCode(){return this._uiSourceCode}setUISourceCode(e){this._unloadUISourceCode();this._uiSourceCode=e;if(e.contentLoaded()){if(e.workingCopy()!==this.textEditor.text())this._innerSetContent(e.workingCopy())}else{e.requestContent().then(()=>{if(this._uiSourceCode!==e)return;if(e.workingCopy()!==this.textEditor.text())this._innerSetContent(e.workingCopy())})}this._initializeUISourceCode()}_unloadUISourceCode(){this._disposePlugins();for(const e of this._allMessages())this._removeMessageFromSource(e);Common.EventTarget.removeEventListeners(this._messageAndDecorationListeners);Common.EventTarget.removeEventListeners(this._uiSourceCodeEventListeners);this._uiSourceCode.removeWorkingCopyGetter();Persistence.persistence.unsubscribeFromBindingEvent(this._uiSourceCode,this._boundOnBindingChanged)}_initializeUISourceCode(){this._uiSourceCodeEventListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._onWorkingCopyChanged,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._onWorkingCopyCommitted,this),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged,this._refreshHighlighterType,this)];Persistence.persistence.subscribeForBindingEvent(this._uiSourceCode,this._boundOnBindingChanged);for(const e of this._allMessages())this._addMessageToSource(e);this._installMessageAndDecorationListeners();this._updateStyle();this._decorateAllTypes();this._refreshHighlighterType();if(Runtime.experiments.isEnabled("sourcesPrettyPrint")){const e=new Set(["text/html","text/css","text/javascript"]);this.setCanPrettyPrint(e.has(this.highlighterType()),true)}this._ensurePluginsLoaded()}wasShown(){super.wasShown();setImmediate(this._updateBucketDecorations.bind(this));this.setEditable(this._canEditSource());for(const e of this._plugins)e.wasShown()}willHide(){for(const e of this._plugins)e.willHide();super.willHide();UI.context.setFlavor(Sources.UISourceCodeFrame,null);this._uiSourceCode.removeWorkingCopyGetter()}_refreshHighlighterType(){const e=Persistence.persistence.binding(this._uiSourceCode);const t=e?e.network.mimeType():this._uiSourceCode.mimeType();if(this.highlighterType()===t)return;this._disposePlugins();this.setHighlighterType(t);this._ensurePluginsLoaded()}_canEditSource(){if(Persistence.persistence.binding(this._uiSourceCode))return true;if(this._uiSourceCode.project().canSetFileContent())return true;if(this._uiSourceCode.project().isServiceProject())return false;if(this._uiSourceCode.project().type()===Workspace.projectTypes.Network&&Persistence.networkPersistenceManager.active())return true;if(this.pretty&&this._uiSourceCode.contentType().hasScripts())return false;return this._uiSourceCode.contentType()!==Common.resourceTypes.Document}_onNetworkPersistenceChanged(){this.setEditable(this._canEditSource())}commitEditing(){if(!this._uiSourceCode.isDirty())return;this._muteSourceCodeEvents=true;this._uiSourceCode.commitWorkingCopy();this._muteSourceCodeEvents=false}setContent(e){this._disposePlugins();this._rowMessageBuckets.clear();super.setContent(e);for(const e of this._allMessages())this._addMessageToSource(e);this._decorateAllTypes();this._ensurePluginsLoaded()}_allMessages(){if(this._persistenceBinding){const e=this._persistenceBinding.network.messages();e.addAll(this._persistenceBinding.fileSystem.messages());return e}return this._uiSourceCode.messages()}onTextChanged(e,t){const i=this.pretty;super.onTextChanged(e,t);this._errorPopoverHelper.hidePopover();if(this._isSettingContent)return;Sources.SourcesPanel.instance().updateLastModificationTime();this._muteSourceCodeEvents=true;if(this.isClean())this._uiSourceCode.resetWorkingCopy();else this._uiSourceCode.setWorkingCopyGetter(this.textEditor.text.bind(this.textEditor));this._muteSourceCodeEvents=false;if(i!==this.pretty){this._updateStyle();this._disposePlugins();this._ensurePluginsLoaded()}}_onWorkingCopyChanged(e){if(this._muteSourceCodeEvents)return;this._innerSetContent(this._uiSourceCode.workingCopy())}_onWorkingCopyCommitted(e){if(!this._muteSourceCodeEvents)this._innerSetContent(this._uiSourceCode.workingCopy());this.contentCommitted();this._updateStyle()}_ensurePluginsLoaded(){if(!this.loaded||this._plugins.length)return;const e=Persistence.persistence.binding(this._uiSourceCode);const t=e?e.network:this._uiSourceCode;if(Sources.DebuggerPlugin.accepts(t))this._plugins.push(new Sources.DebuggerPlugin(this.textEditor,t,this.transformer()));if(Sources.CSSPlugin.accepts(t))this._plugins.push(new Sources.CSSPlugin(this.textEditor));if(!this.pretty&&Sources.JavaScriptCompilerPlugin.accepts(t))this._plugins.push(new Sources.JavaScriptCompilerPlugin(this.textEditor,t));if(Sources.SnippetsPlugin.accepts(t))this._plugins.push(new Sources.SnippetsPlugin(this.textEditor,t));if(Sources.ScriptOriginPlugin.accepts(t))this._plugins.push(new Sources.ScriptOriginPlugin(this.textEditor,t));if(!this.pretty&&Runtime.experiments.isEnabled("sourceDiff")&&Sources.GutterDiffPlugin.accepts(t))this._plugins.push(new Sources.GutterDiffPlugin(this.textEditor,t));this.dispatchEventToListeners(Sources.UISourceCodeFrame.Events.ToolbarItemsChanged);for(const e of this._plugins)e.wasShown()}_disposePlugins(){this.textEditor.operation(()=>{for(const e of this._plugins)e.dispose()});this._plugins=[]}_onBindingChanged(){const e=Persistence.persistence.binding(this._uiSourceCode);if(e===this._persistenceBinding)return;this._unloadUISourceCode();this._persistenceBinding=e;this._initializeUISourceCode()}_updateStyle(){this.setEditable(this._canEditSource())}_innerSetContent(e){this._isSettingContent=true;const t=this.textEditor.text();if(this._diff)this._diff.highlightModifiedLines(t,e);if(t!==e)this.setContent(e);this._isSettingContent=false}async populateTextAreaContextMenu(e,t,i){await super.populateTextAreaContextMenu(e,t,i);e.appendApplicableItems(this._uiSourceCode);const o=this.transformer().editorToRawLocation(t,i);e.appendApplicableItems(new Workspace.UILocation(this._uiSourceCode,o[0],o[1]));e.appendApplicableItems(this);for(const o of this._plugins)await o.populateTextAreaContextMenu(e,t,i)}dispose(){this._errorPopoverHelper.dispose();this._unloadUISourceCode();this.textEditor.dispose();this.detach();Common.settings.moduleSetting("persistenceNetworkOverridesEnabled").removeChangeListener(this._onNetworkPersistenceChanged,this)}_onMessageAdded(e){const t=e.data;this._addMessageToSource(t)}_addMessageToSource(e){if(!this.loaded)return;const t=this.transformer().rawToEditorLocation(e.lineNumber(),e.columnNumber());let i=t[0];if(i>=this.textEditor.linesCount)i=this.textEditor.linesCount-1;if(i<0)i=0;let o=this._rowMessageBuckets.get(i);if(!o){o=new Sources.UISourceCodeFrame.RowMessageBucket(this,this.textEditor,i);this._rowMessageBuckets.set(i,o)}o.addMessage(e)}_onMessageRemoved(e){const t=e.data;this._removeMessageFromSource(t)}_removeMessageFromSource(e){if(!this.loaded)return;const t=this.transformer().rawToEditorLocation(e.lineNumber(),e.columnNumber());let i=t[0];if(i>=this.textEditor.linesCount)i=this.textEditor.linesCount-1;if(i<0)i=0;const o=this._rowMessageBuckets.get(i);if(!o)return;o.removeMessage(e);if(!o.uniqueMessagesCount()){o.detachFromEditor();this._rowMessageBuckets.delete(i)}}_getErrorPopoverContent(e){const t=e.target.enclosingNodeOrSelfWithClass("text-editor-line-decoration-icon")||e.target.enclosingNodeOrSelfWithClass("text-editor-line-decoration-wave");if(!t)return null;const i=t.enclosingNodeOrSelfWithClass("text-editor-line-decoration-icon")?t.boxInWindow():new AnchorBox(e.clientX,e.clientY,1,1);return{box:i,show:e=>{const i=t.enclosingNodeOrSelfWithClass("text-editor-line-decoration")._messageBucket;const o=i.messagesDescription();e.contentElement.appendChild(o);return Promise.resolve(true)}}}_updateBucketDecorations(){for(const e of this._rowMessageBuckets.values())e._updateDecoration()}_onLineDecorationAdded(e){const t=e.data;this._decorateTypeThrottled(t.type())}_onLineDecorationRemoved(e){const t=e.data;this._decorateTypeThrottled(t.type())}async _decorateTypeThrottled(e){if(this._typeDecorationsPending.has(e))return;this._typeDecorationsPending.add(e);const t=await self.runtime.extensions(SourceFrame.LineDecorator).find(t=>t.descriptor()["decoratorType"]===e).instance();this._typeDecorationsPending.delete(e);this.textEditor.codeMirror().operation(()=>{t.decorate(this._persistenceBinding?this._persistenceBinding.network:this.uiSourceCode(),this.textEditor,e)})}_decorateAllTypes(){if(!this.loaded)return;for(const e of self.runtime.extensions(SourceFrame.LineDecorator)){const t=e.descriptor()["decoratorType"];if(this._uiSourceCode.decorationsForType(t))this._decorateTypeThrottled(t)}}syncToolbarItems(){const e=super.syncToolbarItems();const t=[];for(const i of this._plugins){e.pushAll(i.leftToolbarItems());t.pushAll(i.rightToolbarItems())}if(!t.length)return e;return[...e,new UI.ToolbarSeparator(true),...t]}async populateLineGutterContextMenu(e,t){await super.populateLineGutterContextMenu(e,t);for(const i of this._plugins)await i.populateLineGutterContextMenu(e,t)}};Sources.UISourceCodeFrame._iconClassPerLevel={};Sources.UISourceCodeFrame._iconClassPerLevel[Workspace.UISourceCode.Message.Level.Error]="smallicon-error";Sources.UISourceCodeFrame._iconClassPerLevel[Workspace.UISourceCode.Message.Level.Warning]="smallicon-warning";Sources.UISourceCodeFrame._bubbleTypePerLevel={};Sources.UISourceCodeFrame._bubbleTypePerLevel[Workspace.UISourceCode.Message.Level.Error]="error";Sources.UISourceCodeFrame._bubbleTypePerLevel[Workspace.UISourceCode.Message.Level.Warning]="warning";Sources.UISourceCodeFrame._lineClassPerLevel={};Sources.UISourceCodeFrame._lineClassPerLevel[Workspace.UISourceCode.Message.Level.Error]="text-editor-line-with-error";Sources.UISourceCodeFrame._lineClassPerLevel[Workspace.UISourceCode.Message.Level.Warning]="text-editor-line-with-warning";Sources.UISourceCodeFrame.RowMessage=class{constructor(e){this._message=e;this._repeatCount=1;this.element=createElementWithClass("div","text-editor-row-message");this._icon=this.element.createChild("label","","dt-icon-label");this._icon.type=Sources.UISourceCodeFrame._iconClassPerLevel[e.level()];this._repeatCountElement=this.element.createChild("span","text-editor-row-message-repeat-count hidden","dt-small-bubble");this._repeatCountElement.type=Sources.UISourceCodeFrame._bubbleTypePerLevel[e.level()];const t=this.element.createChild("div");const i=this._message.text().split("\n");for(let e=0;e<i.length;++e){const o=t.createChild("div");o.textContent=i[e]}}message(){return this._message}repeatCount(){return this._repeatCount}setRepeatCount(e){if(this._repeatCount===e)return;this._repeatCount=e;this._updateMessageRepeatCount()}_updateMessageRepeatCount(){this._repeatCountElement.textContent=this._repeatCount;const e=this._repeatCount>1;this._repeatCountElement.classList.toggle("hidden",!e);this._icon.classList.toggle("hidden",e)}};Sources.UISourceCodeFrame.RowMessageBucket=class{constructor(e,t,i){this._sourceFrame=e;this.textEditor=t;this._lineHandle=t.textEditorPositionHandle(i,0);this._decoration=createElementWithClass("div","text-editor-line-decoration");this._decoration._messageBucket=this;this._wave=this._decoration.createChild("div","text-editor-line-decoration-wave");this._icon=this._wave.createChild("span","text-editor-line-decoration-icon","dt-icon-label");this._decorationStartColumn=null;this._messagesDescriptionElement=createElementWithClass("div","text-editor-messages-description-container");this._messages=[];this._level=null}_updateWavePosition(e,t){e=Math.min(e,this.textEditor.linesCount-1);const i=this.textEditor.line(e);t=Math.min(t,i.length);const o=TextUtils.TextUtils.lineIndent(i).length;const s=Math.max(t-1,o);if(this._decorationStartColumn===s)return;if(this._decorationStartColumn!==null)this.textEditor.removeDecoration(this._decoration,e);this.textEditor.addDecoration(this._decoration,e,s);this._decorationStartColumn=s}messagesDescription(){this._messagesDescriptionElement.removeChildren();UI.appendStyle(this._messagesDescriptionElement,"source_frame/messagesPopover.css");for(let e=0;e<this._messages.length;++e)this._messagesDescriptionElement.appendChild(this._messages[e].element);return this._messagesDescriptionElement}detachFromEditor(){const e=this._lineHandle.resolve();if(!e)return;const t=e.lineNumber;if(this._level){this.textEditor.toggleLineClass(t,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],false)}if(this._decorationStartColumn!==null){this.textEditor.removeDecoration(this._decoration,t);this._decorationStartColumn=null}}uniqueMessagesCount(){return this._messages.length}addMessage(e){for(let t=0;t<this._messages.length;++t){const i=this._messages[t];if(i.message().isEqual(e)){i.setRepeatCount(i.repeatCount()+1);return}}const t=new Sources.UISourceCodeFrame.RowMessage(e);this._messages.push(t);this._updateDecoration()}removeMessage(e){for(let t=0;t<this._messages.length;++t){const i=this._messages[t];if(!i.message().isEqual(e))continue;i.setRepeatCount(i.repeatCount()-1);if(!i.repeatCount())this._messages.splice(t,1);this._updateDecoration();return}}_updateDecoration(){if(!this._sourceFrame.isShowing())return;if(!this._messages.length)return;const e=this._lineHandle.resolve();if(!e)return;const t=e.lineNumber;let i=Number.MAX_VALUE;let o=null;for(let e=0;e<this._messages.length;++e){const s=this._messages[e].message();const n=this._sourceFrame.transformer().rawToEditorLocation(t,s.columnNumber());i=Math.min(i,n[1]);if(!o||Workspace.UISourceCode.Message.messageLevelComparator(o,s)<0)o=s}this._updateWavePosition(t,i);if(this._level===o.level())return;if(this._level){this.textEditor.toggleLineClass(t,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],false);this._icon.type=""}this._level=o.level();if(!this._level)return;this.textEditor.toggleLineClass(t,Sources.UISourceCodeFrame._lineClassPerLevel[this._level],true);this._icon.type=Sources.UISourceCodeFrame._iconClassPerLevel[this._level]}};Workspace.UISourceCode.Message._messageLevelPriority={Warning:3,Error:4};Workspace.UISourceCode.Message.messageLevelComparator=function(e,t){return Workspace.UISourceCode.Message._messageLevelPriority[e.level()]-Workspace.UISourceCode.Message._messageLevelPriority[t.level()]};Sources.UISourceCodeFrame.Plugin=class{static accepts(e){return false}wasShown(){}willHide(){}rightToolbarItems(){return[]}leftToolbarItems(){return[]}populateLineGutterContextMenu(e,t){return Promise.resolve()}populateTextAreaContextMenu(e,t,i){return Promise.resolve()}dispose(){}};Sources.UISourceCodeFrame.Events={ToolbarItemsChanged:Symbol("ToolbarItemsChanged")};Sources.DebuggerPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e,t,i){super();this._textEditor=e;this._uiSourceCode=t;this._transformer=i;this._executionLocation=null;this._controlDown=false;this._asyncStepInHoveredLine=0;this._asyncStepInHovered=false;this._clearValueWidgetsTimer=null;this._sourceMapInfobar=null;this._controlTimeout=null;this._scriptsPanel=Sources.SourcesPanel.instance();this._breakpointManager=Bindings.breakpointManager;if(t.project().type()===Workspace.projectTypes.Debugger)this._textEditor.element.classList.add("source-frame-debugger-script");this._popoverHelper=new UI.PopoverHelper(this._scriptsPanel.element,this._getPopoverRequest.bind(this));this._popoverHelper.setDisableOnClick(true);this._popoverHelper.setTimeout(250,250);this._popoverHelper.setHasPadding(true);this._boundPopoverHelperHide=this._popoverHelper.hidePopover.bind(this._popoverHelper);this._scriptsPanel.element.addEventListener("scroll",this._boundPopoverHelperHide,true);this._boundKeyDown=this._onKeyDown.bind(this);this._textEditor.element.addEventListener("keydown",this._boundKeyDown,true);this._boundKeyUp=this._onKeyUp.bind(this);this._textEditor.element.addEventListener("keyup",this._boundKeyUp,true);this._boundMouseMove=this._onMouseMove.bind(this);this._textEditor.element.addEventListener("mousemove",this._boundMouseMove,false);this._boundMouseDown=this._onMouseDown.bind(this);this._textEditor.element.addEventListener("mousedown",this._boundMouseDown,true);this._boundBlur=this._onBlur.bind(this);this._textEditor.element.addEventListener("focusout",this._boundBlur,false);this._boundWheel=(e=>{if(this._executionLocation&&UI.KeyboardShortcut.eventHasCtrlOrMeta(e))e.preventDefault()});this._textEditor.element.addEventListener("wheel",this._boundWheel,true);this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.GutterClick,this._handleGutterClick,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this._breakpointAdded,this);this._breakpointManager.addEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this._breakpointRemoved,this);this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._workingCopyChanged,this);this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);this._breakpointDecorations=new Set;this._decorationByBreakpoint=new Map;this._possibleBreakpointsRequested=new Set;this._scriptFileForDebuggerModel=new Map;Common.moduleSetting("skipStackFramesPattern").addChangeListener(this._showBlackboxInfobarIfNeeded,this);Common.moduleSetting("skipContentScripts").addChangeListener(this._showBlackboxInfobarIfNeeded,this);this._valueWidgets=new Map;this._continueToLocationDecorations=null;UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);this._liveLocationPool=new Bindings.LiveLocationPool;this._callFrameChanged();this._updateScriptFiles();if(this._uiSourceCode.isDirty()){this._muted=true;this._mutedFromStart=true}else{this._muted=false;this._mutedFromStart=false;this._initializeBreakpoints()}this._blackboxInfobar=null;this._showBlackboxInfobarIfNeeded();const o=this._scriptFileForDebuggerModel.valuesArray();for(let e=0;e<o.length;++e)o[e].checkMapping();this._hasLineWithoutMapping=false;this._updateLinesWithoutMappingHighlight();if(!Runtime.experiments.isEnabled("sourcesPrettyPrint")){this._prettyPrintInfobar=null;this._detectMinified()}}static accepts(e){return e.contentType().hasScripts()}_showBlackboxInfobarIfNeeded(){const e=this._uiSourceCode;if(!e.contentType().hasScripts())return;const t=e.project().type();if(!Bindings.blackboxManager.isBlackboxedUISourceCode(e)){this._hideBlackboxInfobar();return}if(this._blackboxInfobar)this._blackboxInfobar.dispose();const i=new UI.Infobar(UI.Infobar.Type.Warning,Common.UIString("This script is blackboxed in debugger"));this._blackboxInfobar=i;i.createDetailsRowMessage(Common.UIString("Debugger will skip stepping through this script, and will not stop on exceptions"));const o=this._scriptFileForDebuggerModel.size?this._scriptFileForDebuggerModel.valuesArray()[0]:null;if(o&&o.hasSourceMapURL())i.createDetailsRowMessage(Common.UIString("Source map found, but ignored for blackboxed file."));i.createDetailsRowMessage();i.createDetailsRowMessage(Common.UIString("Possible ways to cancel this behavior are:"));i.createDetailsRowMessage(" - ").createTextChild(Common.UIString('Go to "%s" tab in settings',Common.UIString("Blackboxing")));const s=i.createDetailsRowMessage(" - ").createChild("span","link");s.textContent=Common.UIString("Unblackbox this script");s.addEventListener("click",n,false);function n(){Bindings.blackboxManager.unblackboxUISourceCode(e);if(t===Workspace.projectTypes.ContentScripts)Bindings.blackboxManager.unblackboxContentScripts()}this._textEditor.attachInfobar(this._blackboxInfobar)}_hideBlackboxInfobar(){if(!this._blackboxInfobar)return;this._blackboxInfobar.dispose();this._blackboxInfobar=null}wasShown(){if(this._executionLocation){setImmediate(()=>{this._generateValuesInSource()})}}willHide(){this._popoverHelper.hidePopover()}populateLineGutterContextMenu(e,t){function i(i,o){const s=new Workspace.UILocation(this._uiSourceCode,t,0);this._scriptsPanel.appendUILocationItems(e,s);const n=this._lineBreakpointDecorations(t).map(e=>e.breakpoint).filter(e=>!!e);if(!n.length){e.debugSection().appendItem(Common.UIString("Add breakpoint"),this._createNewBreakpoint.bind(this,t,"",true));e.debugSection().appendItem(Common.UIString("Add conditional breakpoint"),this._editBreakpointCondition.bind(this,t,null,null));e.debugSection().appendItem(ls`Add logpoint\u2026`,this._editBreakpointCondition.bind(this,t,null,null,true));e.debugSection().appendItem(Common.UIString("Never pause here"),this._createNewBreakpoint.bind(this,t,"false",true))}else{const i=n.length===1;const o=i?Common.UIString("Remove breakpoint"):Common.UIString("Remove all breakpoints in line");e.debugSection().appendItem(o,()=>n.map(e=>e.remove()));if(i){e.debugSection().appendItem(Common.UIString("Edit breakpoint"),this._editBreakpointCondition.bind(this,t,n[0],null))}const s=n.some(e=>e.enabled());if(s){const t=i?Common.UIString("Disable breakpoint"):Common.UIString("Disable all breakpoints in line");e.debugSection().appendItem(t,()=>n.map(e=>e.setEnabled(false)))}const r=n.some(e=>!e.enabled());if(r){const t=i?Common.UIString("Enable breakpoint"):Common.UIString("Enabled all breakpoints in line");e.debugSection().appendItem(t,()=>n.map(e=>e.setEnabled(true)))}}i()}return new Promise(i.bind(this))}populateTextAreaContextMenu(e,t,i){function o(e){Sources.AddSourceMapURLDialog.show(s.bind(null,e))}function s(e,t){if(!t)return;e.addSourceMapURL(t)}function n(){if(this._uiSourceCode.project().type()===Workspace.projectTypes.Network&&Common.moduleSetting("jsSourceMapsEnabled").get()&&!Bindings.blackboxManager.isBlackboxedUISourceCode(this._uiSourceCode)){if(this._scriptFileForDebuggerModel.size){const t=this._scriptFileForDebuggerModel.valuesArray()[0];const i=Common.UIString("Add source map");e.debugSection().appendItem(i,o.bind(null,t))}}}return super.populateTextAreaContextMenu(e,t,i).then(n.bind(this))}_workingCopyChanged(){if(this._scriptFileForDebuggerModel.size)return;if(this._uiSourceCode.isDirty())this._muteBreakpointsWhileEditing();else this._restoreBreakpointsAfterEditing()}_workingCopyCommitted(e){this._scriptsPanel.updateLastModificationTime();if(!this._scriptFileForDebuggerModel.size)this._restoreBreakpointsAfterEditing()}_didMergeToVM(){this._restoreBreakpointsIfConsistentScripts()}_didDivergeFromVM(){this._muteBreakpointsWhileEditing()}_muteBreakpointsWhileEditing(){if(this._muted)return;for(const e of this._breakpointDecorations)this._updateBreakpointDecoration(e);this._muted=true}_restoreBreakpointsIfConsistentScripts(){const e=this._scriptFileForDebuggerModel.valuesArray();for(let t=0;t<e.length;++t){if(e[t].hasDivergedFromVM()||e[t].isMergingToVM())return}this._restoreBreakpointsAfterEditing()}_restoreBreakpointsAfterEditing(){this._muted=false;if(this._mutedFromStart){this._mutedFromStart=false;this._initializeBreakpoints();return}const e=Array.from(this._breakpointDecorations);this._breakpointDecorations.clear();this._textEditor.operation(()=>e.map(e=>e.hide()));for(const t of e){if(!t.breakpoint)continue;const e=t.enabled;t.breakpoint.remove();const i=t.handle.resolve();if(i)this._setBreakpoint(i.lineNumber,i.columnNumber,t.condition,e)}}_isIdentifier(e){return e.startsWith("js-variable")||e.startsWith("js-property")||e==="js-def"}_getPopoverRequest(e){if(UI.KeyboardShortcut.eventHasCtrlOrMeta(e))return null;const t=UI.context.flavor(SDK.Target);const i=t?t.model(SDK.DebuggerModel):null;if(!i||!i.isPaused())return null;const o=this._textEditor.coordinatesToCursorPosition(e.x,e.y);if(!o)return null;const s=o.startLine;const n=o.startColumn;const r=this._textEditor.selection().normalize();let a;let c;let l;let d;if(r&&!r.isEmpty()){if(r.startLine!==r.endLine||r.startLine!==s||n<r.startColumn||n>r.endColumn)return null;const e=this._textEditor.cursorPositionToCoordinates(r.startLine,r.startColumn);const t=this._textEditor.cursorPositionToCoordinates(r.endLine,r.endColumn);a=new AnchorBox(e.x,e.y,t.x-e.x,e.height);c=r.startLine;l=r.startColumn;d=r.endColumn-1}else{const e=this._textEditor.tokenAtTextPosition(o.startLine,o.startColumn);if(!e||!e.type)return null;c=o.startLine;const t=this._textEditor.line(c);const i=t.substring(e.startColumn,e.endColumn);const s=this._isIdentifier(e.type);if(!s&&(e.type!=="js-keyword"||i!=="this"))return null;const n=this._textEditor.cursorPositionToCoordinates(c,e.startColumn);const r=this._textEditor.cursorPositionToCoordinates(c,e.endColumn-1);a=new AnchorBox(n.x,n.y,r.x-n.x,n.height);l=e.startColumn;d=e.endColumn-1;while(l>1&&t.charAt(l-1)==="."){const e=this._textEditor.tokenAtTextPosition(c,l-2);if(!e||!e.type)return null;if(e.type==="js-meta")break;l=e.startColumn}}let u;let h;return{box:a,show:async e=>{const t=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!t)return false;const o=this._textEditor.line(c).substring(l,d+1);const s=await Sources.SourceMapNamesResolver.resolveExpression(t,o,this._uiSourceCode,c,l,d);const n=await t.evaluate({expression:s||o,objectGroup:"popover",includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:false});if(!n.object)return false;u=await ObjectUI.ObjectPopoverHelper.buildObjectPopover(n.object,e);const r=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!u||t!==r){i.runtimeModel().releaseObjectGroup("popover");if(u)u.dispose();return false}const a=new TextUtils.TextRange(c,l,c,d);h=this._textEditor.highlightRange(a,"source-frame-eval-expression");return true},hide:()=>{u.dispose();i.runtimeModel().releaseObjectGroup("popover");this._textEditor.removeHighlight(h)}}}_onKeyDown(e){this._clearControlDown();if(e.key==="Escape"){if(this._popoverHelper.isPopoverVisible()){this._popoverHelper.hidePopover();e.consume()}return}if(UI.shortcutRegistry.eventMatchesAction(e,"debugger.toggle-breakpoint")){const t=this._textEditor.selection();if(!t)return;this._toggleBreakpoint(t.startLine,false);e.consume(true);return}if(UI.shortcutRegistry.eventMatchesAction(e,"debugger.toggle-breakpoint-enabled")){const t=this._textEditor.selection();if(!t)return;this._toggleBreakpoint(t.startLine,true);e.consume(true);return}if(UI.shortcutRegistry.eventMatchesAction(e,"debugger.breakpoint-input-window")){const t=this._textEditor.selection();if(!t)return;const i=this._lineBreakpointDecorations(t.startLine).map(e=>e.breakpoint).filter(e=>!!e);let o;if(i.length)o=i[0];const s=o?o.condition().includes(Sources.BreakpointEditDialog.LogpointPrefix):false;this._editBreakpointCondition(t.startLine,o,null,s);e.consume(true);return}if(UI.KeyboardShortcut.eventHasCtrlOrMeta(e)&&this._executionLocation){this._controlDown=true;if(e.key===(Host.isMac()?"Meta":"Control")){this._controlTimeout=setTimeout(()=>{if(this._executionLocation&&this._controlDown)this._showContinueToLocations()},150)}}}_onMouseMove(e){if(this._executionLocation&&this._controlDown&&UI.KeyboardShortcut.eventHasCtrlOrMeta(e)){if(!this._continueToLocationDecorations)this._showContinueToLocations()}if(this._continueToLocationDecorations){const t=this._textEditor.coordinatesToCursorPosition(e.x,e.y);const i=!!e.target.enclosingNodeOrSelfWithClass("source-frame-async-step-in");this._setAsyncStepInHoveredLine(t?t.startLine:null,i)}}_setAsyncStepInHoveredLine(e,t){if(this._asyncStepInHoveredLine===e&&this._asyncStepInHovered===t)return;if(this._asyncStepInHovered&&this._asyncStepInHoveredLine)this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,"source-frame-async-step-in-hovered",false);this._asyncStepInHoveredLine=e;this._asyncStepInHovered=t;if(this._asyncStepInHovered&&this._asyncStepInHoveredLine)this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,"source-frame-async-step-in-hovered",true)}_onMouseDown(e){if(!this._executionLocation||!UI.KeyboardShortcut.eventHasCtrlOrMeta(e))return;if(!this._continueToLocationDecorations)return;e.consume();const t=this._textEditor.coordinatesToCursorPosition(e.x,e.y);if(!t)return;for(const e of this._continueToLocationDecorations.keys()){const i=e.find();if(i.from.line!==t.startLine||i.to.line!==t.startLine)continue;if(i.from.ch<=t.startColumn&&t.startColumn<=i.to.ch){this._continueToLocationDecorations.get(e)();break}}}_onBlur(e){if(this._textEditor.element.isAncestor(e.target))return;this._clearControlDown()}_onKeyUp(e){this._clearControlDown()}_clearControlDown(){this._controlDown=false;this._clearContinueToLocations();clearTimeout(this._controlTimeout)}async _editBreakpointCondition(e,t,i,o){const s=t?t.condition():"";const n=createElement("div");const r=new Sources.BreakpointEditDialog(e,s,!!o,o=>{r.detach();this._textEditor.removeDecoration(n,e);if(!o.committed)return;if(t)t.setCondition(o.condition);else if(i)this._setBreakpoint(i.lineNumber,i.columnNumber,o.condition,true);else this._createNewBreakpoint(e,o.condition,true)});this._textEditor.addDecoration(n,e);r.show(n)}_executionLineChanged(e){this._clearExecutionLine();const t=e.uiLocation();if(!t||t.uiSourceCode!==this._uiSourceCode){this._executionLocation=null;return}this._executionLocation=t;const i=this._transformer.rawToEditorLocation(t.lineNumber,t.columnNumber);this._textEditor.setExecutionLocation(i[0],i[1]);if(this._textEditor.isShowing()){setImmediate(()=>{if(this._controlDown)this._showContinueToLocations();else this._generateValuesInSource()})}}_generateValuesInSource(){if(!Common.moduleSetting("inlineVariableValues").get())return;const e=UI.context.flavor(SDK.ExecutionContext);if(!e)return;const t=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!t)return;const i=t.localScope();const o=t.functionLocation();if(i&&o){Sources.SourceMapNamesResolver.resolveScopeInObject(i).getAllProperties(false,false).then(this._prepareScopeVariables.bind(this,t))}}_showContinueToLocations(){this._popoverHelper.hidePopover();const e=UI.context.flavor(SDK.ExecutionContext);if(!e)return;const t=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!t)return;const i=t.functionLocation()||t.location();const o=t.debuggerModel;o.getPossibleBreakpoints(i,null,true).then(e=>this._textEditor.operation(s.bind(this,e)));function s(e){this._clearContinueToLocationsNoRestore();this._textEditor.hideExecutionLineBackground();this._clearValueWidgets();this._continueToLocationDecorations=new Map;e=e.reverse();let t=-1;for(const i of e){const e=this._transformer.rawToEditorLocation(i.lineNumber,i.columnNumber);let o=this._textEditor.tokenAtTextPosition(e[0],e[1]);if(!o)continue;const s=this._textEditor.line(e[0]);let n=s.substring(o.startColumn,o.endColumn);if(!o.type&&n==="."){o=this._textEditor.tokenAtTextPosition(e[0],o.endColumn+1);n=s.substring(o.startColumn,o.endColumn)}if(!o.type)continue;const r=o.type==="js-keyword"&&(n==="this"||n==="return"||n==="new"||n==="continue"||n==="break");if(!r&&!this._isIdentifier(o.type))continue;if(t===e[0]&&i.type!==Protocol.Debugger.BreakLocationType.Call)continue;let a=new TextUtils.TextRange(e[0],o.startColumn,e[0],o.endColumn-1);let c=this._textEditor.highlightRange(a,"source-frame-continue-to-location");this._continueToLocationDecorations.set(c,i.continueToLocation.bind(i));if(i.type===Protocol.Debugger.BreakLocationType.Call)t=e[0];let l=s[o.startColumn-1]==="."&&n==="then"||n==="setTimeout"||n==="setInterval"||n==="postMessage";if(n==="new"){o=this._textEditor.tokenAtTextPosition(e[0],o.endColumn+1);n=s.substring(o.startColumn,o.endColumn);l=n==="Worker"}const d=this._executionLocation&&i.lineNumber===this._executionLocation.lineNumber&&i.columnNumber===this._executionLocation.columnNumber;if(i.type===Protocol.Debugger.BreakLocationType.Call&&l){const t=this._findAsyncStepInRange(this._textEditor,e[0],s,o.endColumn);if(t){a=new TextUtils.TextRange(e[0],t.from,e[0],t.to-1);c=this._textEditor.highlightRange(a,"source-frame-async-step-in");this._continueToLocationDecorations.set(c,this._asyncStepIn.bind(this,i,!!d))}}}this._continueToLocationRenderedForTest()}}_continueToLocationRenderedForTest(){}_findAsyncStepInRange(e,t,i,o){let s;let n;let r=o;let a=i.length;let c=i.indexOf("(",o);const l=c;if(c===-1)return null;c++;h();if(c>=i.length)return null;u();if(!s)return null;r=s.startColumn;if(s.type==="js-keyword"&&n==="async"){h();if(c>=i.length)return{from:r,to:a};u();if(!s)return{from:r,to:a}}if(s.type==="js-keyword"&&n==="function")return{from:r,to:a};if(s.type==="js-string")return{from:l,to:a};if(s.type&&this._isIdentifier(s.type))return{from:r,to:a};if(n!=="(")return null;const d=i.indexOf(")",c);if(d===-1||i.substring(c,d).indexOf("(")!==-1)return{from:r,to:a};return{from:r,to:d+1};function u(){s=e.tokenAtTextPosition(t,c);if(s){c=s.endColumn;a=s.endColumn;n=i.substring(s.startColumn,s.endColumn)}}function h(){while(c<i.length){if(i[c]===" "){c++;continue}const o=e.tokenAtTextPosition(t,c);if(o.type==="js-comment"){c=o.endColumn;continue}break}}}_asyncStepIn(e,t){if(!t)e.continueToLocation(i);else i();function i(){e.debuggerModel.scheduleStepIntoAsync()}}_prepareScopeVariables(e,t){const i=t.properties;this._clearValueWidgets();if(!i||!i.length||i.length>500||!this._textEditor.isShowing())return;const o=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(e.functionLocation());const s=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(e.location());if(!o||!s||o.uiSourceCode!==this._uiSourceCode||s.uiSourceCode!==this._uiSourceCode)return;const n=this._transformer.rawToEditorLocation(o.lineNumber,o.columnNumber);const r=this._transformer.rawToEditorLocation(s.lineNumber,s.columnNumber);const a=n[0];const c=n[1];const l=r[0];if(a>=l||l-a>500||a<0||l>=this._textEditor.linesCount)return;const d=new Map;for(const e of i)d.set(e.name,e.value);const u=new Map;let h=false;const p=(new TextEditor.CodeMirrorUtils.TokenizerFactory).createTokenizer("text/javascript");p(this._textEditor.line(a).substring(c),m.bind(this,a));for(let e=a+1;e<l;++e)p(this._textEditor.line(e),m.bind(this,e));function m(e,t,i,o,s){if(!h&&i&&this._isIdentifier(i)&&d.get(t)){let i=u.get(e);if(!i){i=new Set;u.set(e,i)}i.add(t)}h=t==="."}this._textEditor.operation(this._renderDecorations.bind(this,d,u,a,l))}_renderDecorations(e,t,i,o){const s=new ObjectUI.RemoteObjectPreviewFormatter;for(let n=i;n<o;++n){const i=t.get(n);const o=this._valueWidgets.get(n);if(!i){if(o){this._valueWidgets.delete(n);this._textEditor.removeDecoration(o,n)}continue}const r=createElementWithClass("div","text-editor-value-decoration");const a=this._textEditor.cursorPositionToCoordinates(n,0);const c=this._textEditor.cursorPositionToCoordinates(n,this._textEditor.line(n).length);const l=4;const d=c.x-a.x+l;r.style.left=d+"px";r.__nameToToken=new Map;let u=0;for(const o of i){if(u>10)break;if(t.get(n-1)&&t.get(n-1).has(o))continue;if(u)r.createTextChild(", ");const i=r.createChild("span");r.__nameToToken.set(o,i);i.createTextChild(o+" = ");const a=e.get(o);const c=a.preview?a.preview.properties.length:0;const l=a.preview&&a.preview.entries?a.preview.entries.length:0;if(a.preview&&c+l<10){s.appendObjectPreview(i,a.preview,false)}else{i.appendChild(ObjectUI.ObjectPropertiesSection.createValueElement(a,false,false))}++u}let h=true;if(o){h=false;for(const e of r.__nameToToken.keys()){const t=o.__nameToToken.get(e)?o.__nameToToken.get(e).textContent:"";const i=r.__nameToToken.get(e)?r.__nameToToken.get(e).textContent:"";if(i!==t){h=true;UI.runCSSAnimationOnce(r.__nameToToken.get(e),"source-frame-value-update-highlight")}}if(h){this._valueWidgets.delete(n);this._textEditor.removeDecoration(o,n)}}if(h){this._valueWidgets.set(n,r);this._textEditor.addDecoration(r,n)}}}_clearExecutionLine(){this._textEditor.operation(()=>{if(this._executionLocation)this._textEditor.clearExecutionLine();this._executionLocation=null;if(this._clearValueWidgetsTimer){clearTimeout(this._clearValueWidgetsTimer);this._clearValueWidgetsTimer=null}this._clearValueWidgetsTimer=setTimeout(this._clearValueWidgets.bind(this),1e3);this._clearContinueToLocationsNoRestore()})}_clearValueWidgets(){clearTimeout(this._clearValueWidgetsTimer);this._clearValueWidgetsTimer=null;this._textEditor.operation(()=>{for(const e of this._valueWidgets.keys())this._textEditor.removeDecoration(this._valueWidgets.get(e),e);this._valueWidgets.clear()})}_clearContinueToLocationsNoRestore(){if(!this._continueToLocationDecorations)return;this._textEditor.operation(()=>{for(const e of this._continueToLocationDecorations.keys())this._textEditor.removeHighlight(e);this._continueToLocationDecorations=null;this._setAsyncStepInHoveredLine(null,false)})}_clearContinueToLocations(){if(!this._continueToLocationDecorations)return;this._textEditor.operation(()=>{this._textEditor.showExecutionLineBackground();this._generateValuesInSource();this._clearContinueToLocationsNoRestore()})}_lineBreakpointDecorations(e){return Array.from(this._breakpointDecorations).filter(t=>(t.handle.resolve()||{}).lineNumber===e)}_breakpointDecoration(e,t){for(const i of this._breakpointDecorations){const o=i.handle.resolve();if(!o)continue;if(o.lineNumber===e&&o.columnNumber===t)return i}return null}_updateBreakpointDecoration(e){if(!this._scheduledBreakpointDecorationUpdates){this._scheduledBreakpointDecorationUpdates=new Set;setImmediate(()=>this._textEditor.operation(t.bind(this)))}this._scheduledBreakpointDecorationUpdates.add(e);function t(){if(!this._scheduledBreakpointDecorationUpdates)return;const e=new Set;for(const t of this._scheduledBreakpointDecorationUpdates){const i=t.handle.resolve();if(!i)continue;e.add(i.lineNumber)}this._scheduledBreakpointDecorationUpdates=null;let t=false;for(const s of e){const e=this._lineBreakpointDecorations(s);i.call(this,s,e);if(this._possibleBreakpointsRequested.has(s)){t=true;continue}o.call(this,s,e)}if(!t)this._breakpointDecorationsUpdatedForTest()}function i(e,t){this._textEditor.toggleLineClass(e,"cm-breakpoint",false);this._textEditor.toggleLineClass(e,"cm-breakpoint-disabled",false);this._textEditor.toggleLineClass(e,"cm-breakpoint-conditional",false);if(t.length){t.sort(Sources.DebuggerPlugin.BreakpointDecoration.mostSpecificFirst);this._textEditor.toggleLineClass(e,"cm-breakpoint",true);this._textEditor.toggleLineClass(e,"cm-breakpoint-disabled",!t[0].enabled||this._muted);this._textEditor.toggleLineClass(e,"cm-breakpoint-conditional",!!t[0].condition)}}function o(e,t){const i=new Set(t.map(e=>e.bookmark).filter(e=>!!e));const o=this._textEditor.line(e).length;const s=this._textEditor.bookmarks(new TextUtils.TextRange(e,0,e,o),Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol);for(const e of s){if(!i.has(e))e.clear()}if(!t.length)return;if(t.length>1){for(const e of t){e.update();if(!this._muted)e.show();else e.hide()}}else{t[0].update();t[0].hide()}}}_breakpointDecorationsUpdatedForTest(){}_inlineBreakpointClick(e,t){t.consume(true);if(e.breakpoint){if(t.shiftKey)e.breakpoint.setEnabled(!e.breakpoint.enabled());else e.breakpoint.remove()}else{const t=e.handle.resolve();if(!t)return;const i=this._transformer.editorToRawLocation(t.lineNumber,t.columnNumber);this._setBreakpoint(i[0],i[1],e.condition,true)}}_inlineBreakpointContextMenu(e,t){t.consume(true);const i=e.handle.resolve();if(!i)return;const o=this._transformer.editorToRawLocation(i[0],i[1]);const s=new UI.ContextMenu(t);if(e.breakpoint){s.debugSection().appendItem(Common.UIString("Edit breakpoint"),this._editBreakpointCondition.bind(this,i.lineNumber,e.breakpoint,null))}else{s.debugSection().appendItem(Common.UIString("Add conditional breakpoint"),this._editBreakpointCondition.bind(this,i.lineNumber,null,i));s.debugSection().appendItem(ls`Add logpoint\u2026`,this._editBreakpointCondition.bind(this,i.lineNumber,null,i,true));s.debugSection().appendItem(Common.UIString("Never pause here"),this._setBreakpoint.bind(this,o[0],o[1],"false",true))}s.show()}_shouldIgnoreExternalBreakpointEvents(e){const t=e.data.uiLocation;if(t.uiSourceCode!==this._uiSourceCode)return true;if(this._muted)return true;const i=this._scriptFileForDebuggerModel.valuesArray();for(let e=0;e<i.length;++e){if(i[e].isDivergingFromVM()||i[e].isMergingToVM())return true}return false}_breakpointAdded(e){if(this._shouldIgnoreExternalBreakpointEvents(e))return;const t=e.data.uiLocation;const i=e.data.breakpoint;this._addBreakpoint(t,i)}_addBreakpoint(e,t){const i=this._transformer.rawToEditorLocation(e.lineNumber,e.columnNumber);const o=this._lineBreakpointDecorations(e.lineNumber);let s=this._breakpointDecoration(i[0],i[1]);if(s){s.breakpoint=t;s.condition=t.condition();s.enabled=t.enabled()}else{const e=this._textEditor.textEditorPositionHandle(i[0],i[1]);s=new Sources.DebuggerPlugin.BreakpointDecoration(this._textEditor,e,t.condition(),t.enabled(),t);s.element.addEventListener("click",this._inlineBreakpointClick.bind(this,s),true);s.element.addEventListener("contextmenu",this._inlineBreakpointContextMenu.bind(this,s),true);this._breakpointDecorations.add(s)}this._decorationByBreakpoint.set(t,s);this._updateBreakpointDecoration(s);if(t.enabled()&&!o.length){this._possibleBreakpointsRequested.add(i[0]);const e=this._transformer.editorToRawLocation(i[0],0);const t=this._transformer.editorToRawLocation(i[0]+1,0);this._breakpointManager.possibleBreakpoints(this._uiSourceCode,new TextUtils.TextRange(e[0],e[1],t[0],t[1])).then(n.bind(this,i[0]))}function n(e,t){this._possibleBreakpointsRequested.delete(e);const i=this._lineBreakpointDecorations(e);for(const e of i)this._updateBreakpointDecoration(e);if(!i.some(e=>!!e.breakpoint))return;const o=new Set;for(const e of i){const t=e.handle.resolve();if(!t)continue;o.add(t.columnNumber)}for(const e of t){const t=this._transformer.rawToEditorLocation(e.lineNumber,e.columnNumber);if(o.has(t[1]))continue;const i=this._textEditor.textEditorPositionHandle(t[0],t[1]);const s=new Sources.DebuggerPlugin.BreakpointDecoration(this._textEditor,i,"",false,null);s.element.addEventListener("click",this._inlineBreakpointClick.bind(this,s),true);s.element.addEventListener("contextmenu",this._inlineBreakpointContextMenu.bind(this,s),true);this._breakpointDecorations.add(s);this._updateBreakpointDecoration(s)}}}_breakpointRemoved(e){if(this._shouldIgnoreExternalBreakpointEvents(e))return;const t=e.data.uiLocation;const i=e.data.breakpoint;const o=this._decorationByBreakpoint.get(i);if(!o)return;this._decorationByBreakpoint.delete(i);const s=this._transformer.rawToEditorLocation(t.lineNumber,t.columnNumber);o.breakpoint=null;o.enabled=false;const n=this._lineBreakpointDecorations(s[0]);if(!n.some(e=>!!e.breakpoint)){for(const e of n){this._breakpointDecorations.delete(e);this._updateBreakpointDecoration(e)}}else{this._updateBreakpointDecoration(o)}}_initializeBreakpoints(){const e=this._breakpointManager.breakpointLocationsForUISourceCode(this._uiSourceCode);for(const t of e)this._addBreakpoint(t.uiLocation,t.breakpoint)}_updateLinesWithoutMappingHighlight(){const e=!!Bindings.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);if(!e)return;const t=this._textEditor.linesCount;for(let e=0;e<t;++e){const t=Bindings.CompilerScriptMapping.uiLineHasMapping(this._uiSourceCode,e);if(!t)this._hasLineWithoutMapping=true;if(this._hasLineWithoutMapping)this._textEditor.toggleLineClass(e,"cm-line-without-source-mapping",!t)}}_updateScriptFiles(){for(const e of SDK.targetManager.models(SDK.DebuggerModel)){const t=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,e);if(t)this._updateScriptFile(e)}}_updateScriptFile(e){const t=this._scriptFileForDebuggerModel.get(e);const i=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,e);this._scriptFileForDebuggerModel.delete(e);if(t){t.removeEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);t.removeEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);if(this._muted&&!this._uiSourceCode.isDirty())this._restoreBreakpointsIfConsistentScripts()}if(!i)return;this._scriptFileForDebuggerModel.set(e,i);i.addEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);i.addEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);i.checkMapping();if(i.hasSourceMapURL())this._showSourceMapInfobar()}_showSourceMapInfobar(){if(this._sourceMapInfobar)return;this._sourceMapInfobar=UI.Infobar.create(UI.Infobar.Type.Info,Common.UIString("Source Map detected."),Common.settings.createSetting("sourceMapInfobarDisabled",false));if(!this._sourceMapInfobar)return;this._sourceMapInfobar.createDetailsRowMessage(Common.UIString("Associated files should be added to the file tree. You can debug these resolved source files as regular JavaScript files."));this._sourceMapInfobar.createDetailsRowMessage(Common.UIString("Associated files are available via file tree or %s.",UI.shortcutRegistry.shortcutTitleForAction("quickOpen.show")));this._sourceMapInfobar.setCloseCallback(()=>this._sourceMapInfobar=null);this._textEditor.attachInfobar(this._sourceMapInfobar)}_detectMinified(){const e=this._uiSourceCode.content();if(!e||!TextUtils.isMinified(e))return;this._prettyPrintInfobar=UI.Infobar.create(UI.Infobar.Type.Info,Common.UIString("Pretty-print this minified file?"),Common.settings.createSetting("prettyPrintInfobarDisabled",false));if(!this._prettyPrintInfobar)return;this._prettyPrintInfobar.setCloseCallback(()=>this._prettyPrintInfobar=null);const t=new UI.Toolbar("");const i=new UI.ToolbarButton("","largeicon-pretty-print");t.appendToolbarItem(i);t.element.style.display="inline-block";t.element.style.verticalAlign="middle";t.element.style.marginBottom="3px";t.element.style.pointerEvents="none";const o=this._prettyPrintInfobar.createDetailsRowMessage();o.appendChild(UI.formatLocalized("You can click the %s button on the bottom status bar, and continue debugging with the new formatted source.",[t.element]));this._textEditor.attachInfobar(this._prettyPrintInfobar)}_handleGutterClick(e){if(this._muted)return;const t=e.data;const i=t.lineNumber;const o=t.event;if(o.button!==0||o.altKey||o.ctrlKey||o.metaKey)return;this._toggleBreakpoint(i,o.shiftKey);o.consume(true)}_toggleBreakpoint(e,t){const i=this._lineBreakpointDecorations(e);if(!i.length){this._createNewBreakpoint(e,"",true);return}const o=this._textEditor.hasLineClass(e,"cm-breakpoint-disabled");const s=i.map(e=>e.breakpoint).filter(e=>!!e);for(const e of s){if(t)e.setEnabled(o);else e.remove()}}async _createNewBreakpoint(e,t,i){Host.userMetrics.actionTaken(Host.UserMetrics.Action.ScriptsBreakpointSet);if(e<this._textEditor.linesCount){const o=Math.min(this._textEditor.line(e).length,1024);const s=this._transformer.editorToRawLocation(e,0);const n=this._transformer.editorToRawLocation(e,o);const r=await this._breakpointManager.possibleBreakpoints(this._uiSourceCode,new TextUtils.TextRange(s[0],s[1],n[0],n[1]));if(r&&r.length){this._setBreakpoint(r[0].lineNumber,r[0].columnNumber,t,i);return}}const o=this._transformer.editorToRawLocation(e,0);await this._setBreakpoint(o[0],o[1],t,i)}toggleBreakpointOnCurrentLine(e){if(this._muted)return;const t=this._textEditor.selection();if(!t)return;this._toggleBreakpoint(t.startLine,e)}_setBreakpoint(e,t,i,o){if(!Bindings.CompilerScriptMapping.uiLineHasMapping(this._uiSourceCode,e))return;Common.moduleSetting("breakpointsActive").set(true);this._breakpointManager.setBreakpoint(this._uiSourceCode,e,t,i,o);this._breakpointWasSetForTest(e,t,i,o)}_breakpointWasSetForTest(e,t,i,o){}_callFrameChanged(){this._liveLocationPool.disposeAll();const e=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!e){this._clearExecutionLine();return}Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(e.location(),this._executionLineChanged.bind(this),this._liveLocationPool)}dispose(){for(const e of this._breakpointDecorations)e.dispose();this._breakpointDecorations.clear();if(this._scheduledBreakpointDecorationUpdates){for(const e of this._scheduledBreakpointDecorationUpdates)e.dispose();this._scheduledBreakpointDecorationUpdates.clear()}this._hideBlackboxInfobar();if(this._sourceMapInfobar)this._sourceMapInfobar.dispose();if(this._prettyPrintInfobar)this._prettyPrintInfobar.dispose();this._scriptsPanel.element.removeEventListener("scroll",this._boundPopoverHelperHide,true);for(const e of this._scriptFileForDebuggerModel.values()){e.removeEventListener(Bindings.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this);e.removeEventListener(Bindings.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this)}this._scriptFileForDebuggerModel.clear();this._textEditor.element.removeEventListener("keydown",this._boundKeyDown,true);this._textEditor.element.removeEventListener("keyup",this._boundKeyUp,true);this._textEditor.element.removeEventListener("mousemove",this._boundMouseMove,false);this._textEditor.element.removeEventListener("mousedown",this._boundMouseDown,true);this._textEditor.element.removeEventListener("focusout",this._boundBlur,false);this._textEditor.element.removeEventListener("wheel",this._boundWheel,true);this._textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.GutterClick,this._handleGutterClick,this);this._popoverHelper.hidePopover();this._popoverHelper.dispose();this._breakpointManager.removeEventListener(Bindings.BreakpointManager.Events.BreakpointAdded,this._breakpointAdded,this);this._breakpointManager.removeEventListener(Bindings.BreakpointManager.Events.BreakpointRemoved,this._breakpointRemoved,this);this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._workingCopyChanged,this);this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);Common.moduleSetting("skipStackFramesPattern").removeChangeListener(this._showBlackboxInfobarIfNeeded,this);Common.moduleSetting("skipContentScripts").removeChangeListener(this._showBlackboxInfobarIfNeeded,this);super.dispose();this._clearExecutionLine();UI.context.removeFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);this._liveLocationPool.disposeAll()}};Sources.DebuggerPlugin.BreakpointDecoration=class{constructor(e,t,i,o,s){this._textEditor=e;this.handle=t;this.condition=i;this.enabled=o;this.breakpoint=s;this.element=UI.Icon.create("smallicon-inline-breakpoint");this.element.classList.toggle("cm-inline-breakpoint",true);this.bookmark=null}static mostSpecificFirst(e,t){if(e.enabled!==t.enabled)return e.enabled?-1:1;if(!!e.condition!==!!t.condition)return!!e.condition?-1:1;return 0}update(){if(!this.condition)this.element.setIconType("smallicon-inline-breakpoint");else this.element.setIconType("smallicon-inline-breakpoint-conditional");this.element.classList.toggle("cm-inline-disabled",!this.enabled)}show(){if(this.bookmark)return;const e=this.handle.resolve();if(!e)return;this.bookmark=this._textEditor.addBookmark(e.lineNumber,e.columnNumber,this.element,Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol);this.bookmark[Sources.DebuggerPlugin.BreakpointDecoration._elementSymbolForTest]=this.element}hide(){if(!this.bookmark)return;this.bookmark.clear();this.bookmark=null}dispose(){const e=this.handle.resolve();if(e){this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint",false);this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-disabled",false);this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-conditional",false)}this.hide()}};Sources.DebuggerPlugin.BreakpointDecoration.bookmarkSymbol=Symbol("bookmark");Sources.DebuggerPlugin.BreakpointDecoration._elementSymbolForTest=Symbol("element");Sources.DebuggerPlugin.continueToLocationDecorationSymbol=Symbol("bookmark");Sources.CSSPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e){super();this._textEditor=e;this._swatchPopoverHelper=new InlineEditor.SwatchPopoverHelper;this._muteSwatchProcessing=false;this._hadSwatchChange=false;this._bezierEditor=null;this._editedSwatchTextRange=null;this._spectrum=null;this._currentSwatch=null;this._textEditor.configureAutocomplete({suggestionsCallback:this._cssSuggestions.bind(this),isWordChar:this._isWordChar.bind(this)});this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._textEditorScrolled,this);this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,this._onTextChanged,this);this._updateSwatches(0,this._textEditor.linesCount-1);this._shortcuts={};this._registerShortcuts();this._boundHandleKeyDown=this._handleKeyDown.bind(this);this._textEditor.element.addEventListener("keydown",this._boundHandleKeyDown,false)}static accepts(e){return e.contentType().isStyleSheet()}_registerShortcuts(){const e=UI.ShortcutsScreen.SourcesPanelShortcuts;for(const t of e.IncreaseCSSUnitByOne)this._shortcuts[t.key]=this._handleUnitModification.bind(this,1);for(const t of e.DecreaseCSSUnitByOne)this._shortcuts[t.key]=this._handleUnitModification.bind(this,-1);for(const t of e.IncreaseCSSUnitByTen)this._shortcuts[t.key]=this._handleUnitModification.bind(this,10);for(const t of e.DecreaseCSSUnitByTen)this._shortcuts[t.key]=this._handleUnitModification.bind(this,-10)}_handleKeyDown(e){const t=UI.KeyboardShortcut.makeKeyFromEvent(e);const i=this._shortcuts[t];if(i&&i())e.consume(true)}_textEditorScrolled(){if(this._swatchPopoverHelper.isShowing())this._swatchPopoverHelper.hide(true)}_modifyUnit(e,t){const i=parseInt(e,10);if(isNaN(i))return null;const o=e.substring(i.toString().length);return String.sprintf("%d%s",i+t,o)}_handleUnitModification(e){const t=this._textEditor.selection().normalize();let i=this._textEditor.tokenAtTextPosition(t.startLine,t.startColumn);if(!i){if(t.startColumn>0)i=this._textEditor.tokenAtTextPosition(t.startLine,t.startColumn-1);if(!i)return false}if(i.type!=="css-number")return false;const o=new TextUtils.TextRange(t.startLine,i.startColumn,t.startLine,i.endColumn);const s=this._textEditor.text(o);const n=this._modifyUnit(s,e);if(!n)return false;this._textEditor.editRange(o,n);t.startColumn=i.startColumn;t.endColumn=t.startColumn+n.length;this._textEditor.setSelection(t);return true}_updateSwatches(e,t){const i=[];const o=[];const s=[SDK.CSSMetadata.VariableRegex,SDK.CSSMetadata.URLRegex,UI.Geometry.CubicBezier.Regex,Common.Color.Regex];const n=new Map;n.set(Common.Color.Regex,this._createColorSwatch.bind(this));n.set(UI.Geometry.CubicBezier.Regex,this._createBezierSwatch.bind(this));for(let r=e;r<=t;r++){const e=this._textEditor.line(r).substring(0,Sources.CSSPlugin.maxSwatchProcessingLength);const t=TextUtils.TextUtils.splitStringByRegexes(e,s);for(let a=0;a<t.length;a++){const c=t[a];if(c.regexIndex===-1||!n.has(s[c.regexIndex]))continue;const l=/[\s:;,(){}]/;const d=c.position-1;const u=c.position+c.value.length;if(d>=0&&!l.test(e.charAt(d))||u<e.length&&!l.test(e.charAt(u)))continue;const h=n.get(s[c.regexIndex])(c.value);if(!h)continue;i.push(h);o.push(TextUtils.TextRange.createFromLocation(r,c.position))}}this._textEditor.operation(r.bind(this));function r(){const s=new TextUtils.TextRange(e,0,t,this._textEditor.line(t).length);this._textEditor.bookmarks(s,Sources.CSSPlugin.SwatchBookmark).forEach(e=>e.clear());for(let e=0;e<i.length;e++){const t=i[e];const s=o[e];const n=this._textEditor.addBookmark(s.startLine,s.startColumn,t,Sources.CSSPlugin.SwatchBookmark);t[Sources.CSSPlugin.SwatchBookmark]=n}}}_createColorSwatch(e){const t=Common.Color.parse(e);if(!t)return null;const i=InlineEditor.ColorSwatch.create();i.setColor(t);i.iconElement().title=Common.UIString("Open color picker.");i.iconElement().addEventListener("click",this._swatchIconClicked.bind(this,i),false);i.hideText(true);return i}_createBezierSwatch(e){if(!UI.Geometry.CubicBezier.parse(e))return null;const t=InlineEditor.BezierSwatch.create();t.setBezierText(e);t.iconElement().title=Common.UIString("Open cubic bezier editor.");t.iconElement().addEventListener("click",this._swatchIconClicked.bind(this,t),false);t.hideText(true);return t}_swatchIconClicked(e,t){t.consume(true);this._hadSwatchChange=false;this._muteSwatchProcessing=true;const i=e[Sources.CSSPlugin.SwatchBookmark].position();this._textEditor.setSelection(i);this._editedSwatchTextRange=i.clone();this._editedSwatchTextRange.endColumn+=e.textContent.length;this._currentSwatch=e;if(e instanceof InlineEditor.ColorSwatch)this._showSpectrum(e);else if(e instanceof InlineEditor.BezierSwatch)this._showBezierEditor(e)}_showSpectrum(e){if(!this._spectrum){this._spectrum=new ColorPicker.Spectrum;this._spectrum.addEventListener(ColorPicker.Spectrum.Events.SizeChanged,this._spectrumResized,this);this._spectrum.addEventListener(ColorPicker.Spectrum.Events.ColorChanged,this._spectrumChanged,this)}this._spectrum.setColor(e.color(),e.format());this._swatchPopoverHelper.show(this._spectrum,e.iconElement(),this._swatchPopoverHidden.bind(this))}_spectrumResized(e){this._swatchPopoverHelper.reposition()}_spectrumChanged(e){const t=e.data;const i=Common.Color.parse(t);if(!i)return;this._currentSwatch.setColor(i);this._changeSwatchText(t)}_showBezierEditor(e){if(!this._bezierEditor){this._bezierEditor=new InlineEditor.BezierEditor;this._bezierEditor.addEventListener(InlineEditor.BezierEditor.Events.BezierChanged,this._bezierChanged,this)}let t=UI.Geometry.CubicBezier.parse(e.bezierText());if(!t){t=UI.Geometry.CubicBezier.parse("linear")}this._bezierEditor.setBezier(t);this._swatchPopoverHelper.show(this._bezierEditor,e.iconElement(),this._swatchPopoverHidden.bind(this))}_bezierChanged(e){const t=e.data;this._currentSwatch.setBezierText(t);this._changeSwatchText(t)}_changeSwatchText(e){this._hadSwatchChange=true;this._textEditor.editRange(this._editedSwatchTextRange,e,"*swatch-text-changed");this._editedSwatchTextRange.endColumn=this._editedSwatchTextRange.startColumn+e.length}_swatchPopoverHidden(e){this._muteSwatchProcessing=false;if(!e&&this._hadSwatchChange)this._textEditor.undo()}_onTextChanged(e){if(!this._muteSwatchProcessing)this._updateSwatches(e.data.newRange.startLine,e.data.newRange.endLine)}_isWordChar(e){return TextUtils.TextUtils.isWordChar(e)||e==="."||e==="-"||e==="$"}_cssSuggestions(e,t){const i=this._textEditor.text(e);if(i.startsWith("$"))return null;const o=this._backtrackPropertyToken(e.startLine,e.startColumn-1);if(!o)return null;const s=this._textEditor.line(e.startLine);const n=s.substring(o.startColumn,o.endColumn);const r=SDK.cssMetadata().propertyValues(n);return Promise.resolve(r.filter(e=>e.startsWith(i)).map(e=>({text:e})))}_backtrackPropertyToken(e,t){const i=10;let o=t;const s=this._textEditor.line(e);let n=false;for(let t=0;t<i&&o>=0;++t){const t=this._textEditor.tokenAtTextPosition(e,o);if(!t)return null;if(t.type==="css-property")return n?t:null;if(t.type&&!(t.type.indexOf("whitespace")!==-1||t.type.startsWith("css-comment")))return null;if(!t.type&&s.substring(t.startColumn,t.endColumn)===":"){if(!n)n=true;else return null}o=t.startColumn-1}return null}dispose(){if(this._swatchPopoverHelper.isShowing())this._swatchPopoverHelper.hide(true);this._textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._textEditorScrolled,this);this._textEditor.removeEventListener(UI.TextEditor.Events.TextChanged,this._onTextChanged,this);this._textEditor.bookmarks(this._textEditor.fullRange(),Sources.CSSPlugin.SwatchBookmark).forEach(e=>e.clear());this._textEditor.element.removeEventListener("keydown",this._boundHandleKeyDown,false)}};Sources.CSSPlugin.maxSwatchProcessingLength=300;Sources.CSSPlugin.SwatchBookmark=Symbol("swatch");Sources.GutterDiffPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e,t){super();this._textEditor=e;this._uiSourceCode=t;this._decorations=[];this._textEditor.installGutter(Sources.GutterDiffPlugin.DiffGutterType,true);this._workspaceDiff=WorkspaceDiff.workspaceDiff();this._workspaceDiff.subscribeToDiffChange(this._uiSourceCode,this._update,this);this._update()}static accepts(e){return e.project().type()===Workspace.projectTypes.Network}_updateDecorations(e,t){this._textEditor.operation(i);function i(){for(const t of e)t.remove();for(const e of t)e.install()}}_update(){if(this._uiSourceCode)this._workspaceDiff.requestDiff(this._uiSourceCode).then(this._innerUpdate.bind(this));else this._innerUpdate(null)}_innerUpdate(e){if(!e){this._updateDecorations(this._decorations,[]);this._decorations=[];return}const t=new Map;for(let e=0;e<this._decorations.length;++e){const i=this._decorations[e];const o=i.lineNumber();if(o===-1)continue;t.set(o,i)}const i=SourceFrame.SourceCodeDiff.computeDiff(e);const o=new Map;for(let e=0;e<i.length;++e){const t=i[e];for(let e=t.from;e<t.to;++e)o.set(e,{lineNumber:e,type:t.type})}const s=t.diff(o,(e,t)=>e.type===t.type);const n=s.added.map(e=>new Sources.GutterDiffPlugin.GutterDecoration(this._textEditor,e.lineNumber,e.type));this._decorations=s.equal.concat(n);this._updateDecorations(s.removed,n);this._decorationsSetForTest(o)}_decorationsSetForTest(e){}async populateLineGutterContextMenu(e,t){Sources.GutterDiffPlugin._appendRevealDiffContextMenu(e,this._uiSourceCode)}async populateTextAreaContextMenu(e,t,i){Sources.GutterDiffPlugin._appendRevealDiffContextMenu(e,this._uiSourceCode)}static _appendRevealDiffContextMenu(e,t){if(!WorkspaceDiff.workspaceDiff().isUISourceCodeModified(t))return;e.revealSection().appendItem(ls`Local Modifications...`,()=>{Common.Revealer.reveal(new WorkspaceDiff.DiffUILocation(t))})}dispose(){for(const e of this._decorations)e.remove();WorkspaceDiff.workspaceDiff().unsubscribeFromDiffChange(this._uiSourceCode,this._update,this)}};Sources.GutterDiffPlugin.GutterDecoration=class{constructor(e,t,i){this._textEditor=e;this._position=this._textEditor.textEditorPositionHandle(t,0);this._className="";if(i===SourceFrame.SourceCodeDiff.EditType.Insert)this._className="diff-entry-insert";else if(i===SourceFrame.SourceCodeDiff.EditType.Delete)this._className="diff-entry-delete";else if(i===SourceFrame.SourceCodeDiff.EditType.Modify)this._className="diff-entry-modify";this.type=i}lineNumber(){const e=this._position.resolve();if(!e)return-1;return e.lineNumber}install(){const e=this._position.resolve();if(!e)return;const t=createElementWithClass("div","diff-marker");t.textContent="";this._textEditor.setGutterDecoration(e.lineNumber,Sources.GutterDiffPlugin.DiffGutterType,t);this._textEditor.toggleLineClass(e.lineNumber,this._className,true)}remove(){const e=this._position.resolve();if(!e)return;this._textEditor.setGutterDecoration(e.lineNumber,Sources.GutterDiffPlugin.DiffGutterType,null);this._textEditor.toggleLineClass(e.lineNumber,this._className,false)}};Sources.GutterDiffPlugin.DiffGutterType="CodeMirror-gutter-diff";Sources.GutterDiffPlugin.ContextMenuProvider=class{appendApplicableItems(e,t,i){let o=i;const s=Persistence.persistence.binding(o);if(s)o=s.network;Sources.GutterDiffPlugin._appendRevealDiffContextMenu(t,o)}};Sources.SearchSourcesView=class extends Search.SearchView{constructor(){super("sources")}static async openSearch(e,t){const i=UI.viewManager.view("sources.search-sources-tab");const o=await UI.viewManager.resolveLocation("drawer-view");o.appendView(i);await UI.viewManager.revealView(i);const s=await i.widget();s.toggle(e,!!t);return s}createScope(){return new Sources.SourcesSearchScope}};Sources.SearchSourcesView.ActionDelegate=class{handleAction(e,t){this._showSearch();return true}_showSearch(){const e=UI.inspectorView.element.window().getSelection();let t="";if(e.rangeCount)t=e.toString().replace(/\r?\n.*/,"");return Sources.SearchSourcesView.openSearch(t)}};Sources.NavigatorView=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS("sources/navigatorView.css");this._placeholder=null;this._scriptsTree=new UI.TreeOutlineInShadow;this._scriptsTree.registerRequiredCSS("sources/navigatorTree.css");this._scriptsTree.setComparator(Sources.NavigatorView._treeElementsCompare);this.contentElement.appendChild(this._scriptsTree.element);this.setDefaultFocusedElement(this._scriptsTree.element);this._uiSourceCodeNodes=new Multimap;this._subfolderNodes=new Map;this._rootNode=new Sources.NavigatorRootTreeNode(this);this._rootNode.populate();this._frameNodes=new Map;this.contentElement.addEventListener("contextmenu",this.handleContextMenu.bind(this),false);UI.shortcutRegistry.addShortcutListener(this.contentElement,"sources.rename",this._renameShortcut.bind(this),true);this._navigatorGroupByFolderSetting=Common.moduleSetting("navigatorGroupByFolder");this._navigatorGroupByFolderSetting.addChangeListener(this._groupingChanged.bind(this));this._initGrouping();Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingCreated,this._onBindingChanged,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingRemoved,this._onBindingChanged,this);SDK.targetManager.addEventListener(SDK.TargetManager.Events.NameChanged,this._targetNameChanged,this);SDK.targetManager.observeTargets(this);this._resetWorkspace(Workspace.workspace);this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this));Bindings.networkProjectManager.addEventListener(Bindings.NetworkProjectManager.Events.FrameAttributionAdded,this._frameAttributionAdded,this);Bindings.networkProjectManager.addEventListener(Bindings.NetworkProjectManager.Events.FrameAttributionRemoved,this._frameAttributionRemoved,this)}static _treeElementOrder(e){if(e._boostOrder)return 0;if(!Sources.NavigatorView._typeOrders){const e={};const t=Sources.NavigatorView.Types;e[t.Root]=1;e[t.Domain]=10;e[t.FileSystemFolder]=1;e[t.NetworkFolder]=1;e[t.SourceMapFolder]=2;e[t.File]=10;e[t.Frame]=70;e[t.Worker]=90;e[t.FileSystem]=100;Sources.NavigatorView._typeOrders=e}let t=Sources.NavigatorView._typeOrders[e._nodeType];if(e._uiSourceCode){const i=e._uiSourceCode.contentType();if(i.isDocument())t+=3;else if(i.isScript())t+=5;else if(i.isStyleSheet())t+=10;else t+=15}return t}static appendSearchItem(e,t){function i(){Sources.SearchSourcesView.openSearch(`file:${t.trim()}`)}let o=Common.UIString("Search in folder");if(!t||!t.trim()){t="*";o=Common.UIString("Search in all files")}e.viewSection().appendItem(o,i)}static _treeElementsCompare(e,t){const i=Sources.NavigatorView._treeElementOrder(e);const o=Sources.NavigatorView._treeElementOrder(t);if(i>o)return 1;if(i<o)return-1;return e.titleAsText().compareTo(t.titleAsText())}setPlaceholder(e){console.assert(!this._placeholder,"A placeholder widget was already set");this._placeholder=e;e.show(this.contentElement,this.contentElement.firstChild);t.call(this);this._scriptsTree.addEventListener(UI.TreeOutline.Events.ElementAttached,t.bind(this));this._scriptsTree.addEventListener(UI.TreeOutline.Events.ElementsDetached,t.bind(this));function t(){const t=this._scriptsTree.firstChild();if(t)e.hideWidget();else e.showWidget();this._scriptsTree.element.classList.toggle("hidden",!t)}}_onBindingChanged(e){const t=e.data;const i=this._uiSourceCodeNodes.get(t.network);for(const e of i)e.updateTitle();const o=this._uiSourceCodeNodes.get(t.fileSystem);for(const e of o)e.updateTitle();const s=Persistence.FileSystemWorkspaceBinding.relativePath(t.fileSystem);let n="";for(let e=0;e<s.length-1;++e){n+=s[e];const i=this._folderNodeId(t.fileSystem.project(),null,null,t.fileSystem.origin(),n);const o=this._subfolderNodes.get(i);if(o)o.updateTitle();n+="/"}const r=this._rootNode.child(t.fileSystem.project().id());if(r)r.updateTitle()}focus(){this._scriptsTree.focus()}_resetWorkspace(e){this._workspace=e;this._workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);this._workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this);this._workspace.addEventListener(Workspace.Workspace.Events.ProjectAdded,e=>{const t=e.data;this._projectAdded(t);if(t.type()===Workspace.projectTypes.FileSystem)this._computeUniqueFileSystemProjectNames()});this._workspace.addEventListener(Workspace.Workspace.Events.ProjectRemoved,e=>{const t=e.data;this._removeProject(t);if(t.type()===Workspace.projectTypes.FileSystem)this._computeUniqueFileSystemProjectNames()});this._workspace.projects().forEach(this._projectAdded.bind(this));this._computeUniqueFileSystemProjectNames()}workspace(){return this._workspace}acceptProject(e){return!e.isServiceProject()}_frameAttributionAdded(e){const t=e.data.uiSourceCode;if(!this._acceptsUISourceCode(t))return;const i=e.data.frame;this._addUISourceCodeNode(t,i)}_frameAttributionRemoved(e){const t=e.data.uiSourceCode;if(!this._acceptsUISourceCode(t))return;const i=e.data.frame;const o=Array.from(this._uiSourceCodeNodes.get(t)).find(e=>e.frame()===i);this._removeUISourceCodeNode(o)}_acceptsUISourceCode(e){return this.acceptProject(e.project())}_addUISourceCode(e){if(!this._acceptsUISourceCode(e))return;const t=Bindings.NetworkProject.framesForUISourceCode(e);if(t.length){for(const i of t)this._addUISourceCodeNode(e,i)}else{this._addUISourceCodeNode(e,null)}this.uiSourceCodeAdded(e)}_addUISourceCodeNode(e,t){const i=e.contentType().isFromSourceMap();let o;if(e.project().type()===Workspace.projectTypes.FileSystem)o=Persistence.FileSystemWorkspaceBinding.relativePath(e).slice(0,-1);else o=Common.ParsedURL.extractPath(e.url()).split("/").slice(1,-1);const s=e.project();const n=Bindings.NetworkProject.targetForUISourceCode(e);const r=this._folderNode(e,s,n,t,e.origin(),o,i);const a=new Sources.NavigatorUISourceCodeTreeNode(this,e,t);r.appendChild(a);this._uiSourceCodeNodes.set(e,a)}uiSourceCodeAdded(e){}_uiSourceCodeAdded(e){const t=e.data;this._addUISourceCode(t)}_uiSourceCodeRemoved(e){const t=e.data;this._removeUISourceCode(t)}tryAddProject(e){this._projectAdded(e);e.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_projectAdded(e){if(!this.acceptProject(e)||e.type()!==Workspace.projectTypes.FileSystem||Snippets.isSnippetsProject(e)||this._rootNode.child(e.id()))return;this._rootNode.appendChild(new Sources.NavigatorGroupTreeNode(this,e,e.id(),Sources.NavigatorView.Types.FileSystem,e.displayName()))}_computeUniqueFileSystemProjectNames(){const e=this._workspace.projectsForType(Workspace.projectTypes.FileSystem);if(!e.length)return;const t=new Persistence.PathEncoder;const i=e.map(e=>{const i=e;return t.encode(i.fileSystemPath()).reverse()});const o=new Common.Trie;for(const e of i)o.add(e);for(let s=0;s<e.length;++s){const n=i[s];const r=e[s];o.remove(n);const a=o.longestPrefix(n,false);o.add(n);const c=t.decode(n.substring(0,a.length+1).reverse());const l=this._rootNode.child(r.id());if(l)l.setTitle(c)}}_removeProject(e){const t=e.uiSourceCodes();for(let e=0;e<t.length;++e)this._removeUISourceCode(t[e]);if(e.type()!==Workspace.projectTypes.FileSystem)return;const i=this._rootNode.child(e.id());if(!i)return;this._rootNode.removeChild(i)}_folderNodeId(e,t,i,o,s){const n=t?t.id():"";const r=e.type()===Workspace.projectTypes.FileSystem?e.id():"";const a=this._groupByFrame&&i?i.id:"";return n+":"+r+":"+a+":"+o+":"+s}_folderNode(e,t,i,o,s,n,r){if(Snippets.isSnippetsUISourceCode(e))return this._rootNode;if(i&&!this._groupByFolder&&!r)return this._domainNode(e,t,i,o,s);const a=n.join("/");const c=this._folderNodeId(t,i,o,s,a);let l=this._subfolderNodes.get(c);if(l)return l;if(!n.length){if(i)return this._domainNode(e,t,i,o,s);return this._rootNode.child(t.id())}const d=this._folderNode(e,t,i,o,s,n.slice(0,-1),r);let u=r?Sources.NavigatorView.Types.SourceMapFolder:Sources.NavigatorView.Types.NetworkFolder;if(t.type()===Workspace.projectTypes.FileSystem)u=Sources.NavigatorView.Types.FileSystemFolder;const h=n[n.length-1];l=new Sources.NavigatorFolderTreeNode(this,t,c,u,a,h);this._subfolderNodes.set(c,l);d.appendChild(l);return l}_domainNode(e,t,i,o,s){const n=this._frameNode(t,i,o);if(!this._groupByDomain)return n;let r=n.child(s);if(r)return r;r=new Sources.NavigatorGroupTreeNode(this,t,s,Sources.NavigatorView.Types.Domain,this._computeProjectDisplayName(i,s));if(o&&s===Common.ParsedURL.extractOrigin(o.url))r.treeNode()._boostOrder=true;n.appendChild(r);return r}_frameNode(e,t,i){if(!this._groupByFrame||!i)return this._targetNode(e,t);let o=this._frameNodes.get(i);if(o)return o;o=new Sources.NavigatorGroupTreeNode(this,e,t.id()+":"+i.id,Sources.NavigatorView.Types.Frame,i.displayName());o.setHoverCallback(n);this._frameNodes.set(i,o);const s=i.parentFrame||i.crossTargetParentFrame();this._frameNode(e,s?s.resourceTreeModel().target():t,s).appendChild(o);if(!s){o.treeNode()._boostOrder=true;o.treeNode().expand()}function n(e){if(e){const e=t.model(SDK.OverlayModel);if(e)e.highlightFrame(i.id)}else{SDK.OverlayModel.hideDOMNodeHighlight()}}return o}_targetNode(e,t){if(t===SDK.targetManager.mainTarget())return this._rootNode;let i=this._rootNode.child("target:"+t.id());if(!i){i=new Sources.NavigatorGroupTreeNode(this,e,"target:"+t.id(),t.type()===SDK.Target.Type.Frame?Sources.NavigatorView.Types.Frame:Sources.NavigatorView.Types.Worker,t.name());this._rootNode.appendChild(i)}return i}_computeProjectDisplayName(e,t){const i=e.model(SDK.RuntimeModel);const o=i?i.executionContexts():[];for(const e of o){if(e.name&&e.origin&&t.startsWith(e.origin))return e.name}if(!t)return Common.UIString("(no domain)");const s=new Common.ParsedURL(t);const n=s.isValid?s.host+(s.port?":"+s.port:""):"";return n||t}revealUISourceCode(e,t){const i=this._uiSourceCodeNodes.get(e);const o=i.firstValue();if(!o)return null;if(this._scriptsTree.selectedTreeElement)this._scriptsTree.selectedTreeElement.deselect();this._lastSelectedUISourceCode=e;o.reveal(t);return o}_sourceSelected(e,t){this._lastSelectedUISourceCode=e;Common.Revealer.reveal(e,!t)}_removeUISourceCode(e){const t=this._uiSourceCodeNodes.get(e);for(const e of t)this._removeUISourceCodeNode(e)}_removeUISourceCodeNode(e){const t=e.uiSourceCode();this._uiSourceCodeNodes.delete(t,e);const i=t.project();const o=Bindings.NetworkProject.targetForUISourceCode(t);const s=e.frame();let n=e.parent;n.removeChild(e);e=n;while(e){n=e.parent;if(!n||!e.isEmpty())break;if(n===this._rootNode&&i.type()===Workspace.projectTypes.FileSystem)break;if(!(e instanceof Sources.NavigatorGroupTreeNode||e instanceof Sources.NavigatorFolderTreeNode))break;if(e._type===Sources.NavigatorView.Types.Frame){this._discardFrame(s);break}const r=this._folderNodeId(i,o,s,t.origin(),e._folderPath);this._subfolderNodes.delete(r);n.removeChild(e);e=n}}reset(){for(const e of this._uiSourceCodeNodes.valuesArray())e.dispose();this._scriptsTree.removeChildren();this._uiSourceCodeNodes.clear();this._subfolderNodes.clear();this._frameNodes.clear();this._rootNode.reset()}handleContextMenu(e){}_renameShortcut(){const e=this._scriptsTree.selectedTreeElement&&this._scriptsTree.selectedTreeElement._node;if(!e||!e._uiSourceCode||!e._uiSourceCode.canRename())return false;this.rename(e,false);return true}_handleContextMenuCreate(e,t,i){if(i){const e=Persistence.FileSystemWorkspaceBinding.relativePath(i);e.pop();t=e.join("/")}this.create(e,t,i)}_handleContextMenuRename(e){this.rename(e,false)}_handleContextMenuExclude(e,t){const i=window.confirm(Common.UIString("Are you sure you want to exclude this folder?"));if(i){UI.startBatchUpdate();e.excludeFolder(Persistence.FileSystemWorkspaceBinding.completeURL(e,t));UI.endBatchUpdate()}}_handleContextMenuDelete(e){const t=window.confirm(Common.UIString("Are you sure you want to delete this file?"));if(t)e.project().deleteFile(e)}handleFileContextMenu(e,t){const i=t.uiSourceCode();const o=new UI.ContextMenu(e);o.appendApplicableItems(i);const s=i.project();if(s.type()===Workspace.projectTypes.FileSystem){o.editSection().appendItem(Common.UIString("Rename"),this._handleContextMenuRename.bind(this,t));o.editSection().appendItem(Common.UIString("Make a copy"),this._handleContextMenuCreate.bind(this,s,"",i));o.editSection().appendItem(Common.UIString("Delete"),this._handleContextMenuDelete.bind(this,i))}o.show()}handleFolderContextMenu(e,t){const i=t._folderPath||"";const o=t._project;const s=new UI.ContextMenu(e);Sources.NavigatorView.appendSearchItem(s,i);const n=Common.ParsedURL.urlToPlatformPath(Persistence.FileSystemWorkspaceBinding.completeURL(o,i),Host.isWin());s.revealSection().appendItem(Common.UIString("Open folder"),()=>InspectorFrontendHost.showItemInFolder(n));if(o.canCreateFile()){s.defaultSection().appendItem(Common.UIString("New file"),this._handleContextMenuCreate.bind(this,o,i))}if(o.canExcludeFolder(i)){s.defaultSection().appendItem(Common.UIString("Exclude folder"),this._handleContextMenuExclude.bind(this,o,i))}function r(){const e=window.confirm(Common.UIString("Are you sure you want to remove this folder?"));if(e)o.remove()}if(o.type()===Workspace.projectTypes.FileSystem){s.defaultSection().appendAction("sources.add-folder-to-workspace",undefined,true);if(t instanceof Sources.NavigatorGroupTreeNode)s.defaultSection().appendItem(Common.UIString("Remove folder from workspace"),r)}s.show()}rename(e,t){const i=e.uiSourceCode();e.rename(o.bind(this));function o(o){if(!t)return;if(!o)i.remove();else if(e._treeElement.listItemElement.hasFocus())this._sourceSelected(i,true)}}async create(e,t,i){let o="";if(i)o=await i.requestContent()||"";const s=await e.createFile(t,null,o);if(!s)return;this._sourceSelected(s,false);const n=this.revealUISourceCode(s,true);if(n)this.rename(n,true)}_groupingChanged(){this.reset();this._initGrouping();this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_initGrouping(){this._groupByFrame=true;this._groupByDomain=this._navigatorGroupByFolderSetting.get();this._groupByFolder=this._groupByDomain}_resetForTest(){this.reset();this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_discardFrame(e){const t=this._frameNodes.get(e);if(!t)return;if(t.parent)t.parent.removeChild(t);this._frameNodes.delete(e);for(const t of e.childFrames)this._discardFrame(t)}targetAdded(e){}targetRemoved(e){const t=this._rootNode.child("target:"+e.id());if(t)this._rootNode.removeChild(t)}_targetNameChanged(e){const t=e.data;const i=this._rootNode.child("target:"+t.id());if(i)i.setTitle(t.name())}};Sources.NavigatorView.Types={Domain:"domain",File:"file",FileSystem:"fs",FileSystemFolder:"fs-folder",Frame:"frame",NetworkFolder:"nw-folder",Root:"root",SourceMapFolder:"sm-folder",Worker:"worker"};Sources.NavigatorFolderTreeElement=class extends UI.TreeElement{constructor(e,t,i,o){super("",true);this.listItemElement.classList.add("navigator-"+t+"-tree-item","navigator-folder-tree-item");this._nodeType=t;this.title=i;this.tooltip=i;this._navigatorView=e;this._hoverCallback=o;let s="largeicon-navigator-folder";if(t===Sources.NavigatorView.Types.Domain)s="largeicon-navigator-domain";else if(t===Sources.NavigatorView.Types.Frame)s="largeicon-navigator-frame";else if(t===Sources.NavigatorView.Types.Worker)s="largeicon-navigator-worker";this.setLeadingIcons([UI.Icon.create(s,"icon")])}async onpopulate(){this._node.populate()}onattach(){this.collapse();this._node.onattach();this.listItemElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),false);this.listItemElement.addEventListener("mousemove",this._mouseMove.bind(this),false);this.listItemElement.addEventListener("mouseleave",this._mouseLeave.bind(this),false)}setNode(e){this._node=e;const t=[];while(e&&!e.isRoot()){t.push(e._title);e=e.parent}t.reverse();this.tooltip=t.join("/")}_handleContextMenuEvent(e){if(!this._node)return;this.select();this._navigatorView.handleFolderContextMenu(e,this._node)}_mouseMove(e){if(this._hovered||!this._hoverCallback)return;this._hovered=true;this._hoverCallback(true)}_mouseLeave(e){if(!this._hoverCallback)return;this._hovered=false;this._hoverCallback(false)}};Sources.NavigatorSourceTreeElement=class extends UI.TreeElement{constructor(e,t,i,o){super("",false);this._nodeType=Sources.NavigatorView.Types.File;this._node=o;this.title=i;this.listItemElement.classList.add("navigator-"+t.contentType().name()+"-tree-item","navigator-file-tree-item");this.tooltip=t.url();this._navigatorView=e;this._uiSourceCode=t;this.updateIcon()}updateIcon(){const e=Persistence.persistence.binding(this._uiSourceCode);if(e){const t=createElementWithClass("span","icon-stack");let i="largeicon-navigator-file-sync";if(Snippets.isSnippetsUISourceCode(e.fileSystem))i="largeicon-navigator-snippet";const o=UI.Icon.create(i,"icon");const s=UI.Icon.create("badge-navigator-file-sync","icon-badge");if(Persistence.networkPersistenceManager.project()===e.fileSystem.project())s.style.filter="hue-rotate(160deg)";t.appendChild(o);t.appendChild(s);t.title=Persistence.PersistenceUtils.tooltipForUISourceCode(this._uiSourceCode);this.setLeadingIcons([t])}else{let e="largeicon-navigator-file";if(Snippets.isSnippetsUISourceCode(this._uiSourceCode))e="largeicon-navigator-snippet";const t=UI.Icon.create(e,"icon");this.setLeadingIcons([t])}}get uiSourceCode(){return this._uiSourceCode}onattach(){this.listItemElement.draggable=true;this.listItemElement.addEventListener("click",this._onclick.bind(this),false);this.listItemElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),false);this.listItemElement.addEventListener("dragstart",this._ondragstart.bind(this),false)}_shouldRenameOnMouseDown(){if(!this._uiSourceCode.canRename())return false;const e=this===this.treeOutline.selectedTreeElement;return e&&this.treeOutline.element.hasFocus()&&!UI.isBeingEdited(this.treeOutline.element)}selectOnMouseDown(e){if(e.which!==1||!this._shouldRenameOnMouseDown()){super.selectOnMouseDown(e);return}setTimeout(t.bind(this),300);function t(){if(this._shouldRenameOnMouseDown())this._navigatorView.rename(this._node,false)}}_ondragstart(e){e.dataTransfer.setData("text/plain",this._uiSourceCode.url());e.dataTransfer.effectAllowed="copy"}onspace(){this._navigatorView._sourceSelected(this.uiSourceCode,true);return true}_onclick(e){this._navigatorView._sourceSelected(this.uiSourceCode,false)}ondblclick(e){const t=e.button===1;this._navigatorView._sourceSelected(this.uiSourceCode,!t);return false}onenter(){this._navigatorView._sourceSelected(this.uiSourceCode,true);return true}ondelete(){return true}_handleContextMenuEvent(e){this.select();this._navigatorView.handleFileContextMenu(e,this._node)}};Sources.NavigatorTreeNode=class{constructor(e,t){this.id=e;this._type=t;this._children=new Map}treeNode(){throw"Not implemented"}dispose(){}isRoot(){return false}hasChildren(){return true}onattach(){}setTitle(e){throw"Not implemented"}populate(){if(this.isPopulated())return;if(this.parent)this.parent.populate();this._populated=true;this.wasPopulated()}wasPopulated(){const e=this.children();for(let t=0;t<e.length;++t)this.treeNode().appendChild(e[t].treeNode())}didAddChild(e){if(this.isPopulated())this.treeNode().appendChild(e.treeNode())}willRemoveChild(e){if(this.isPopulated())this.treeNode().removeChild(e.treeNode())}isPopulated(){return this._populated}isEmpty(){return!this._children.size}children(){return this._children.valuesArray()}child(e){return this._children.get(e)||null}appendChild(e){this._children.set(e.id,e);e.parent=this;this.didAddChild(e)}removeChild(e){this.willRemoveChild(e);this._children.remove(e.id);delete e.parent;e.dispose()}reset(){this._children.clear()}};Sources.NavigatorRootTreeNode=class extends Sources.NavigatorTreeNode{constructor(e){super("",Sources.NavigatorView.Types.Root);this._navigatorView=e}isRoot(){return true}treeNode(){return this._navigatorView._scriptsTree.rootElement()}};Sources.NavigatorUISourceCodeTreeNode=class extends Sources.NavigatorTreeNode{constructor(e,t,i){super(t.project().id()+":"+t.url(),Sources.NavigatorView.Types.File);this._navigatorView=e;this._uiSourceCode=t;this._treeElement=null;this._eventListeners=[];this._frame=i}frame(){return this._frame}uiSourceCode(){return this._uiSourceCode}treeNode(){if(this._treeElement)return this._treeElement;this._treeElement=new Sources.NavigatorSourceTreeElement(this._navigatorView,this._uiSourceCode,"",this);this.updateTitle();const e=this.updateTitle.bind(this,undefined);this._eventListeners=[this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.TitleChanged,e),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,e),this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,e)];return this._treeElement}updateTitle(e){if(!this._treeElement)return;let t=this._uiSourceCode.displayName();if(!e&&this._uiSourceCode.isDirty())t="*"+t;this._treeElement.title=t;this._treeElement.updateIcon();let i=this._uiSourceCode.url();if(this._uiSourceCode.contentType().isFromSourceMap())i=Common.UIString("%s (from source map)",this._uiSourceCode.displayName());this._treeElement.tooltip=i}hasChildren(){return false}dispose(){Common.EventTarget.removeEventListeners(this._eventListeners)}reveal(e){this.parent.populate();this.parent.treeNode().expand();this._treeElement.reveal(true);if(e)this._treeElement.select(true)}rename(e){if(!this._treeElement)return;this._treeElement.listItemElement.focus();const t=this._treeElement.treeOutline.element;UI.markBeingEdited(t,true);function i(e,t,i){if(t!==i){this._treeElement.title=t;this._uiSourceCode.rename(t).then(o.bind(this));return}s.call(this,true)}function o(i){if(!i){UI.markBeingEdited(t,false);this.updateTitle();this.rename(e);return}s.call(this,true)}function s(i){UI.markBeingEdited(t,false);this.updateTitle();if(e)e(i)}this.updateTitle(true);this._treeElement.startEditingTitle(new UI.InplaceEditor.Config(i.bind(this),s.bind(this,false)))}};Sources.NavigatorFolderTreeNode=class extends Sources.NavigatorTreeNode{constructor(e,t,i,o,s,n){super(i,o);this._navigatorView=e;this._project=t;this._folderPath=s;this._title=n}treeNode(){if(this._treeElement)return this._treeElement;this._treeElement=this._createTreeElement(this._title,this);this.updateTitle();return this._treeElement}updateTitle(){if(!this._treeElement||this._project.type()!==Workspace.projectTypes.FileSystem)return;const e=Persistence.FileSystemWorkspaceBinding.fileSystemPath(this._project.id())+"/"+this._folderPath;const t=Persistence.persistence.filePathHasBindings(e);this._treeElement.listItemElement.classList.toggle("has-mapped-files",t)}_createTreeElement(e,t){if(this._project.type()!==Workspace.projectTypes.FileSystem){try{e=decodeURI(e)}catch(e){}}const i=new Sources.NavigatorFolderTreeElement(this._navigatorView,this._type,e);i.setNode(t);return i}wasPopulated(){if(!this._treeElement||this._treeElement._node!==this)return;this._addChildrenRecursive()}_addChildrenRecursive(){const e=this.children();for(let t=0;t<e.length;++t){const i=e[t];this.didAddChild(i);if(i instanceof Sources.NavigatorFolderTreeNode)i._addChildrenRecursive()}}_shouldMerge(e){return this._type!==Sources.NavigatorView.Types.Domain&&e instanceof Sources.NavigatorFolderTreeNode}didAddChild(e){function t(e){return e._title}if(!this._treeElement)return;let i=this.children();if(i.length===1&&this._shouldMerge(e)){e._isMerged=true;this._treeElement.title=this._treeElement.title+"/"+e._title;e._treeElement=this._treeElement;this._treeElement.setNode(e);return}let o;if(i.length===2)o=i[0]!==e?i[0]:i[1];if(o&&o._isMerged){delete o._isMerged;const e=[];e.push(this);let s=this;while(s._isMerged){s=s.parent;e.push(s)}e.reverse();const n=e.map(t).join("/");const r=[];s=o;do{r.push(s);i=s.children();s=i.length===1?i[0]:null}while(s&&s._isMerged);if(!this.isPopulated()){this._treeElement.title=n;this._treeElement.setNode(this);for(let e=0;e<r.length;++e){delete r[e]._treeElement;delete r[e]._isMerged}return}const a=this._treeElement;const c=this._createTreeElement(n,this);for(let t=0;t<e.length;++t)e[t]._treeElement=c;a.parent.appendChild(c);a.setNode(r[r.length-1]);a.title=r.map(t).join("/");a.parent.removeChild(a);this._treeElement.appendChild(a);if(a.expanded)c.expand()}if(this.isPopulated())this._treeElement.appendChild(e.treeNode())}willRemoveChild(e){if(e._isMerged||!this.isPopulated())return;this._treeElement.removeChild(e._treeElement)}};Sources.NavigatorGroupTreeNode=class extends Sources.NavigatorTreeNode{constructor(e,t,i,o,s){super(i,o);this._project=t;this._navigatorView=e;this._title=s;this.populate()}setHoverCallback(e){this._hoverCallback=e}treeNode(){if(this._treeElement)return this._treeElement;this._treeElement=new Sources.NavigatorFolderTreeElement(this._navigatorView,this._type,this._title,this._hoverCallback);this._treeElement.setNode(this);return this._treeElement}onattach(){this.updateTitle()}updateTitle(){if(!this._treeElement||this._project.type()!==Workspace.projectTypes.FileSystem)return;const e=Persistence.FileSystemWorkspaceBinding.fileSystemPath(this._project.id());const t=this._treeElement.listItemElement.classList.contains("has-mapped-files");const i=Persistence.persistence.filePathHasBindings(e);if(t===i)return;this._treeElement.listItemElement.classList.toggle("has-mapped-files",i);if(this._treeElement.childrenListElement.hasFocus())return;if(i)this._treeElement.expand();else this._treeElement.collapse()}setTitle(e){this._title=e;if(this._treeElement)this._treeElement.title=this._title}};Sources.ScopeChainSidebarPane=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS("sources/scopeChainSidebarPane.css");this._expandController=new ObjectUI.ObjectPropertiesSectionExpandController;this._linkifier=new Components.Linkifier;this._update()}flavorChanged(e){this._update()}_update(){const e=UI.context.flavor(SDK.DebuggerModel.CallFrame);const t=UI.context.flavor(SDK.DebuggerPausedDetails);this._linkifier.reset();Sources.SourceMapNamesResolver.resolveThisObject(e).then(this._innerUpdate.bind(this,t,e))}_innerUpdate(e,t,i){this.contentElement.removeChildren();if(!e||!t){const e=createElement("div");e.className="gray-info-message";e.textContent=Common.UIString("Not paused");this.contentElement.appendChild(e);return}let o=false;const s=t.scopeChain();for(let n=0;n<s.length;++n){const r=s[n];let a=r.typeName();let c=null;const l=[];switch(r.type()){case Protocol.Debugger.ScopeType.Local:o=true;c=Common.UIString("No variables");if(i)l.push(new SDK.RemoteObjectProperty("this",i));if(n===0){const i=e.exception();if(i){l.push(new SDK.RemoteObjectProperty(Common.UIString("Exception"),i,undefined,undefined,undefined,undefined,undefined,true))}const o=t.returnValue();if(o){l.push(new SDK.RemoteObjectProperty(Common.UIString("Return value"),o,undefined,undefined,undefined,undefined,undefined,true,t.setReturnValue.bind(t)))}}break;case Protocol.Debugger.ScopeType.Closure:const s=r.name();if(s)a=Common.UIString("Closure (%s)",UI.beautifyFunctionName(s));else a=Common.UIString("Closure");c=Common.UIString("No variables");break}let d=r.description();if(!a||a===d)d=undefined;const u=createElementWithClass("div","scope-chain-sidebar-pane-section-header");u.createChild("div","scope-chain-sidebar-pane-section-subtitle").textContent=d;u.createChild("div","scope-chain-sidebar-pane-section-title").textContent=a;const h=new ObjectUI.ObjectPropertiesSection(Sources.SourceMapNamesResolver.resolveScopeInObject(r),u,this._linkifier,c,true,l);this._expandController.watchSection(a+(d?":"+d:""),h);if(r.type()===Protocol.Debugger.ScopeType.Global)h.objectTreeElement().collapse();else if(!o||r.type()===Protocol.Debugger.ScopeType.Local)h.objectTreeElement().expand();h.element.classList.add("scope-chain-sidebar-pane-section");this.contentElement.appendChild(h.element)}this._sidebarPaneUpdatedForTest()}_sidebarPaneUpdatedForTest(){}};Sources.ScopeChainSidebarPane._pathSymbol=Symbol("path");Sources.NetworkNavigatorView=class extends Sources.NavigatorView{constructor(){super();SDK.targetManager.addEventListener(SDK.TargetManager.Events.InspectedURLChanged,this._inspectedURLChanged,this);Host.userMetrics.panelLoaded("sources","DevTools.Launch.Sources")}acceptProject(e){return e.type()===Workspace.projectTypes.Network}_inspectedURLChanged(e){const t=SDK.targetManager.mainTarget();if(e.data!==t)return;const i=t&&t.inspectedURL();if(!i)return;for(const e of this.workspace().uiSourceCodes()){if(this.acceptProject(e.project())&&e.url()===i)this.revealUISourceCode(e,true)}}uiSourceCodeAdded(e){const t=SDK.targetManager.mainTarget();const i=t&&t.inspectedURL();if(!i)return;if(e.url()===i)this.revealUISourceCode(e,true)}};Sources.FilesNavigatorView=class extends Sources.NavigatorView{constructor(){super();const e=new UI.EmptyWidget("");this.setPlaceholder(e);e.appendParagraph().appendChild(UI.html`
      <div>${ls`Sync changes in DevTools with the local filesystem`}</div><br />
      ${UI.XLink.create("https://developers.google.com/web/tools/chrome-devtools/workspaces/",ls`Learn more`)}
    `);const t=new UI.Toolbar("navigator-toolbar");t.appendItemsAtLocation("files-navigator-toolbar").then(()=>{if(!t.empty())this.contentElement.insertBefore(t.element,this.contentElement.firstChild)})}acceptProject(e){return e.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(e)!=="overrides"&&!Snippets.isSnippetsProject(e)}handleContextMenu(e){const t=new UI.ContextMenu(e);t.defaultSection().appendAction("sources.add-folder-to-workspace",undefined,true);t.show()}};Sources.OverridesNavigatorView=class extends Sources.NavigatorView{constructor(){super();const e=new UI.EmptyWidget("");this.setPlaceholder(e);e.appendParagraph().appendChild(UI.html`
      <div>${ls`Override page assets with files from a local folder`}</div><br />
      ${UI.XLink.create("https://developers.google.com/web/updates/2018/01/devtools#overrides",ls`Learn more`)}
    `);this._toolbar=new UI.Toolbar("navigator-toolbar");this.contentElement.insertBefore(this._toolbar.element,this.contentElement.firstChild);Persistence.networkPersistenceManager.addEventListener(Persistence.NetworkPersistenceManager.Events.ProjectChanged,this._updateProjectAndUI,this);this.workspace().addEventListener(Workspace.Workspace.Events.ProjectAdded,this._onProjectAddOrRemoved,this);this.workspace().addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._onProjectAddOrRemoved,this);this._updateProjectAndUI()}_onProjectAddOrRemoved(e){const t=e.data;if(t&&t.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(t)!=="overrides")return;this._updateUI()}_updateProjectAndUI(){this.reset();const e=Persistence.networkPersistenceManager.project();if(e)this.tryAddProject(e);this._updateUI()}_updateUI(){this._toolbar.removeToolbarItems();const e=Persistence.networkPersistenceManager.project();if(e){const t=new UI.ToolbarSettingCheckbox(Common.settings.moduleSetting("persistenceNetworkOverridesEnabled"));this._toolbar.appendToolbarItem(t);this._toolbar.appendToolbarItem(new UI.ToolbarSeparator(true));const i=new UI.ToolbarButton(Common.UIString("Clear configuration"),"largeicon-clear");i.addEventListener(UI.ToolbarButton.Events.Click,()=>{e.remove()});this._toolbar.appendToolbarItem(i);return}const t=Common.UIString("Select folder for overrides");const i=new UI.ToolbarButton(t,"largeicon-add",t);i.addEventListener(UI.ToolbarButton.Events.Click,this._setupNewWorkspace,this);this._toolbar.appendToolbarItem(i)}async _setupNewWorkspace(){const e=await Persistence.isolatedFileSystemManager.addFileSystem("overrides");if(!e)return;Common.settings.moduleSetting("persistenceNetworkOverridesEnabled").set(true)}acceptProject(e){return e===Persistence.networkPersistenceManager.project()}};Sources.ContentScriptsNavigatorView=class extends Sources.NavigatorView{constructor(){super();const e=new UI.EmptyWidget("");this.setPlaceholder(e);e.appendParagraph().appendChild(UI.html`
      <div>${ls`Content scripts served by extensions appear here`}</div><br />
      ${UI.XLink.create("https://developer.chrome.com/extensions/content_scripts",ls`Learn more`)}
    `)}acceptProject(e){return e.type()===Workspace.projectTypes.ContentScripts}};Sources.SnippetsNavigatorView=class extends Sources.NavigatorView{constructor(){super();const e=new UI.EmptyWidget("");this.setPlaceholder(e);e.appendParagraph().appendChild(UI.html`
      <div>${ls`Create and save code snippets for later reuse`}</div><br />
      ${UI.XLink.create("https://developers.google.com/web/tools/chrome-devtools/javascript/snippets",ls`Learn more`)}
    `);const t=new UI.Toolbar("navigator-toolbar");const i=new UI.ToolbarButton("","largeicon-add",Common.UIString("New snippet"));i.addEventListener(UI.ToolbarButton.Events.Click,()=>this.create(Snippets.project,""));t.appendToolbarItem(i);this.contentElement.insertBefore(t.element,this.contentElement.firstChild)}acceptProject(e){return Snippets.isSnippetsProject(e)}handleContextMenu(e){const t=new UI.ContextMenu(e);t.headerSection().appendItem(Common.UIString("New"),()=>this.create(Snippets.project,""));t.show()}handleFileContextMenu(e,t){const i=t.uiSourceCode();const o=new UI.ContextMenu(e);o.headerSection().appendItem(Common.UIString("Run"),()=>Snippets.evaluateScriptSnippet(i));o.editSection().appendItem(Common.UIString("Rename"),()=>this.rename(t,false));o.editSection().appendItem(Common.UIString("Remove"),()=>i.project().deleteFile(i));o.saveSection().appendItem(Common.UIString("Save as..."),this._handleSaveAs.bind(this,i));o.show()}async _handleSaveAs(e){e.commitWorkingCopy();const t=await e.requestContent();Workspace.fileManager.save(e.url(),t,true);Workspace.fileManager.close(e.url())}};Sources.ActionDelegate=class{handleAction(e,t){switch(t){case"sources.create-snippet":Snippets.project.createFile("",null,"").then(e=>Common.Revealer.reveal(e));return true;case"sources.add-folder-to-workspace":Persistence.isolatedFileSystemManager.addFileSystem();return true}return false}};Sources.OutlineQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._items=[];this._active=false}attach(){this._items=[];this._active=false;const e=this._currentUISourceCode();if(e){this._active=Formatter.formatterWorkerPool().outlineForMimetype(e.workingCopy(),e.contentType().canonicalMimeType(),this._didBuildOutlineChunk.bind(this))}}_didBuildOutlineChunk(e,t){this._items.push(...t);this.refresh()}itemCount(){return this._items.length}itemKeyAt(e){const t=this._items[e];return t.title+(t.subtitle?t.subtitle:"")}itemScoreAt(e,t){const i=this._items[e];const o=t.split("(")[0];if(o.toLowerCase()===i.title.toLowerCase())return 1/(1+i.line);return-i.line-1}renderItem(e,t,i,o){const s=this._items[e];i.textContent=s.title+(s.subtitle?s.subtitle:"");QuickOpen.FilteredListWidget.highlightRanges(i,t);o.textContent=":"+(s.line+1)}selectItem(e,t){if(e===null)return;const i=this._currentUISourceCode();if(!i)return;const o=this._items[e].line;if(!isNaN(o)&&o>=0)Common.Revealer.reveal(i.uiLocation(o,this._items[e].column))}_currentUISourceCode(){const e=UI.context.flavor(Sources.SourcesView);if(!e)return null;return e.currentUISourceCode()}notFoundText(){if(!this._currentUISourceCode())return Common.UIString("No file selected.");if(!this._active)return Common.UIString("Open a JavaScript or CSS file to see symbols");return Common.UIString("No results found")}};Sources.TabbedEditorContainerDelegate=function(){};Sources.TabbedEditorContainerDelegate.prototype={viewForFile(e){},recycleUISourceCodeFrame(e,t){}};Sources.TabbedEditorContainer=class extends Common.Object{constructor(e,t,i){super();this._delegate=e;this._tabbedPane=new UI.TabbedPane;this._tabbedPane.setPlaceholderElement(i);this._tabbedPane.setTabDelegate(new Sources.EditorContainerTabDelegate(this));this._tabbedPane.setCloseableTabs(true);this._tabbedPane.setAllowTabReorder(true,true);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabClosed,this._tabClosed,this);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabSelected,this._tabSelected,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingCreated,this._onBindingCreated,this);Persistence.persistence.addEventListener(Persistence.Persistence.Events.BindingRemoved,this._onBindingRemoved,this);this._tabIds=new Map;this._files={};this._previouslyViewedFilesSetting=t;this._history=Sources.TabbedEditorContainer.History.fromObject(this._previouslyViewedFilesSetting.get())}_onBindingCreated(e){const t=e.data;this._updateFileTitle(t.fileSystem);const i=this._tabIds.get(t.network);let o=this._tabIds.get(t.fileSystem);const s=this._currentFile===t.network;const n=this._history.selectionRange(t.network.url());const r=this._history.scrollLineNumber(t.network.url());this._history.remove(t.network.url());if(!i)return;if(!o){const e=this._tabbedPane.tabView(i);const s=this._tabbedPane.tabIndex(i);if(e instanceof Sources.UISourceCodeFrame){this._delegate.recycleUISourceCodeFrame(e,t.fileSystem);o=this._appendFileTab(t.fileSystem,false,s,e)}else{o=this._appendFileTab(t.fileSystem,false,s);const e=this._tabbedPane.tabView(o);this._restoreEditorProperties(e,n,r)}}this._closeTabs([i],true);if(s)this._tabbedPane.selectTab(o,false);this._updateHistory()}_onBindingRemoved(e){const t=e.data;this._updateFileTitle(t.fileSystem)}get view(){return this._tabbedPane}get visibleView(){return this._tabbedPane.visibleView}fileViews(){return this._tabbedPane.tabViews()}leftToolbar(){return this._tabbedPane.leftToolbar()}rightToolbar(){return this._tabbedPane.rightToolbar()}show(e){this._tabbedPane.show(e)}showFile(e){this._innerShowFile(e,true)}closeFile(e){const t=this._tabIds.get(e);if(!t)return;this._closeTabs([t])}closeAllFiles(){this._closeTabs(this._tabbedPane.tabIds())}historyUISourceCodes(){const e={};for(const t in this._files){const i=this._files[t];e[i.url()]=i}const t=[];const i=this._history._urls();for(let o=0;o<i.length;++o){const s=e[i[o]];if(s)t.push(s)}return t}_addViewListeners(){if(!this._currentView||!this._currentView.textEditor)return;this._currentView.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._scrollChanged,this);this._currentView.textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._selectionChanged,this)}_removeViewListeners(){if(!this._currentView||!this._currentView.textEditor)return;this._currentView.textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.ScrollChanged,this._scrollChanged,this);this._currentView.textEditor.removeEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._selectionChanged,this)}_scrollChanged(e){if(this._scrollTimer)clearTimeout(this._scrollTimer);const t=e.data;this._scrollTimer=setTimeout(i.bind(this),100);this._history.updateScrollLineNumber(this._currentFile.url(),t);function i(){this._history.save(this._previouslyViewedFilesSetting)}}_selectionChanged(e){const t=e.data;this._history.updateSelectionRange(this._currentFile.url(),t);this._history.save(this._previouslyViewedFilesSetting);Extensions.extensionServer.sourceSelectionChanged(this._currentFile.url(),t)}_innerShowFile(e,t){const i=Persistence.persistence.binding(e);e=i?i.fileSystem:e;if(this._currentFile===e)return;this._removeViewListeners();this._currentFile=e;const o=this._tabIds.get(e)||this._appendFileTab(e,t);this._tabbedPane.selectTab(o,t);if(t)this._editorSelectedByUserAction();const s=this._currentView;this._currentView=this.visibleView;this._addViewListeners();const n={currentFile:this._currentFile,currentView:this._currentView,previousView:s,userGesture:t};this.dispatchEventToListeners(Sources.TabbedEditorContainer.Events.EditorSelected,n)}_titleForFile(e){const t=30;let i=e.displayName(true).trimMiddle(t);if(e.isDirty())i+="*";return i}_maybeCloseTab(e,t){const i=this._files[e];const o=i.isDirty()&&i.project().canSetFileContent();if(!o||confirm(Common.UIString("Are you sure you want to close unsaved file: %s?",i.name()))){i.resetWorkingCopy();if(t)this._tabbedPane.selectTab(t,true);this._tabbedPane.closeTab(e,true);return true}return false}_closeTabs(e,t){const i=[];const o=[];for(let s=0;s<e.length;++s){const n=e[s];const r=this._files[n];if(!t&&r.isDirty())i.push(n);else o.push(n)}if(i.length)this._tabbedPane.selectTab(i[0],true);this._tabbedPane.closeTabs(o,true);for(let e=0;e<i.length;++e){const t=e+1<i.length?i[e+1]:null;if(!this._maybeCloseTab(i[e],t))break}}_onContextMenu(e,t){const i=this._files[e];if(i)t.appendApplicableItems(i)}addUISourceCode(e){const t=Persistence.persistence.binding(e);e=t?t.fileSystem:e;if(this._currentFile===e)return;const i=e.url();const o=this._history.index(i);if(o===-1)return;if(!this._tabIds.has(e))this._appendFileTab(e,false);if(!o){this._innerShowFile(e,false);return}if(!this._currentFile)return;const s=Snippets.isSnippetsUISourceCode(this._currentFile);const n=Snippets.isSnippetsUISourceCode(e);if(this._history.index(this._currentFile.url())&&s&&!n)this._innerShowFile(e,false)}removeUISourceCode(e){this.removeUISourceCodes([e])}removeUISourceCodes(e){const t=[];for(let i=0;i<e.length;++i){const o=e[i];const s=this._tabIds.get(o);if(s)t.push(s)}this._tabbedPane.closeTabs(t)}_editorClosedByUserAction(e){this._history.remove(e.url());this._updateHistory()}_editorSelectedByUserAction(){this._updateHistory()}_updateHistory(){const e=this._tabbedPane.lastOpenedTabIds(Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount);function t(e){return this._files[e].url()}this._history.update(e.map(t.bind(this)));this._history.save(this._previouslyViewedFilesSetting)}_tooltipForFile(e){e=Persistence.persistence.network(e)||e;return e.url()}_appendFileTab(e,t,i,o){const s=o||this._delegate.viewForFile(e);const n=this._titleForFile(e);const r=this._tooltipForFile(e);const a=this._generateTabId();this._tabIds.set(e,a);this._files[a]=e;if(!o){const t=this._history.selectionRange(e.url());const i=this._history.scrollLineNumber(e.url());this._restoreEditorProperties(s,t,i)}this._tabbedPane.appendTab(a,n,s,r,t,undefined,i);this._updateFileTitle(e);this._addUISourceCodeListeners(e);return a}_restoreEditorProperties(e,t,i){const o=e instanceof SourceFrame.SourceFrame?e:null;if(!o)return;if(t)o.setSelection(t);if(typeof i==="number")o.scrollToLine(i)}_tabClosed(e){const t=e.data.tabId;const i=e.data.isUserGesture;const o=this._files[t];if(this._currentFile===o){this._removeViewListeners();delete this._currentView;delete this._currentFile}this._tabIds.remove(o);delete this._files[t];this._removeUISourceCodeListeners(o);this.dispatchEventToListeners(Sources.TabbedEditorContainer.Events.EditorClosed,o);if(i)this._editorClosedByUserAction(o)}_tabSelected(e){const t=e.data.tabId;const i=e.data.isUserGesture;const o=this._files[t];this._innerShowFile(o,i)}_addUISourceCodeListeners(e){e.addEventListener(Workspace.UISourceCode.Events.TitleChanged,this._uiSourceCodeTitleChanged,this);e.addEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this);e.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this)}_removeUISourceCodeListeners(e){e.removeEventListener(Workspace.UISourceCode.Events.TitleChanged,this._uiSourceCodeTitleChanged,this);e.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this);e.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this)}_updateFileTitle(e){const t=this._tabIds.get(e);if(t){const i=this._titleForFile(e);this._tabbedPane.changeTabTitle(t,i);let o=null;if(Persistence.persistence.hasUnsavedCommittedChanges(e)){o=UI.Icon.create("smallicon-warning");o.title=Common.UIString("Changes to this file were not saved to file system.")}else{o=Persistence.PersistenceUtils.iconForUISourceCode(e)}this._tabbedPane.setTabIcon(t,o)}}_uiSourceCodeTitleChanged(e){const t=e.data;this._updateFileTitle(t);this._updateHistory()}_uiSourceCodeWorkingCopyChanged(e){const t=e.data;this._updateFileTitle(t)}_uiSourceCodeWorkingCopyCommitted(e){const t=e.data.uiSourceCode;this._updateFileTitle(t)}_generateTabId(){return"tab_"+Sources.TabbedEditorContainer._tabId++}currentFile(){return this._currentFile||null}};Sources.TabbedEditorContainer.Events={EditorSelected:Symbol("EditorSelected"),EditorClosed:Symbol("EditorClosed")};Sources.TabbedEditorContainer._tabId=0;Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount=30;Sources.TabbedEditorContainer.HistoryItem=class{constructor(e,t,i){this.url=e;this._isSerializable=e.length<Sources.TabbedEditorContainer.HistoryItem.serializableUrlLengthLimit;this.selectionRange=t;this.scrollLineNumber=i}static fromObject(e){const t=e.selectionRange?TextUtils.TextRange.fromObject(e.selectionRange):undefined;return new Sources.TabbedEditorContainer.HistoryItem(e.url,t,e.scrollLineNumber)}serializeToObject(){if(!this._isSerializable)return null;const e={};e.url=this.url;e.selectionRange=this.selectionRange;e.scrollLineNumber=this.scrollLineNumber;return e}};Sources.TabbedEditorContainer.HistoryItem.serializableUrlLengthLimit=4096;Sources.TabbedEditorContainer.History=class{constructor(e){this._items=e;this._rebuildItemIndex()}static fromObject(e){const t=[];for(let i=0;i<e.length;++i)t.push(Sources.TabbedEditorContainer.HistoryItem.fromObject(e[i]));return new Sources.TabbedEditorContainer.History(t)}index(e){return this._itemsIndex.has(e)?this._itemsIndex.get(e):-1}_rebuildItemIndex(){this._itemsIndex=new Map;for(let e=0;e<this._items.length;++e){console.assert(!this._itemsIndex.has(this._items[e].url));this._itemsIndex.set(this._items[e].url,e)}}selectionRange(e){const t=this.index(e);return t!==-1?this._items[t].selectionRange:undefined}updateSelectionRange(e,t){if(!t)return;const i=this.index(e);if(i===-1)return;this._items[i].selectionRange=t}scrollLineNumber(e){const t=this.index(e);return t!==-1?this._items[t].scrollLineNumber:undefined}updateScrollLineNumber(e,t){const i=this.index(e);if(i===-1)return;this._items[i].scrollLineNumber=t}update(e){for(let t=e.length-1;t>=0;--t){const i=this.index(e[t]);let o;if(i!==-1){o=this._items[i];this._items.splice(i,1)}else{o=new Sources.TabbedEditorContainer.HistoryItem(e[t])}this._items.unshift(o);this._rebuildItemIndex()}}remove(e){const t=this.index(e);if(t!==-1){this._items.splice(t,1);this._rebuildItemIndex()}}save(e){e.set(this._serializeToObject())}_serializeToObject(){const e=[];for(let t=0;t<this._items.length;++t){const i=this._items[t].serializeToObject();if(i)e.push(i);if(e.length===Sources.TabbedEditorContainer.maximalPreviouslyViewedFilesCount)break}return e}_urls(){const e=[];for(let t=0;t<this._items.length;++t)e.push(this._items[t].url);return e}};Sources.EditorContainerTabDelegate=class{constructor(e){this._editorContainer=e}closeTabs(e,t){this._editorContainer._closeTabs(t)}onContextMenu(e,t){this._editorContainer._onContextMenu(e,t)}};Sources.WatchExpressionsSidebarPane=class extends UI.ThrottledWidget{constructor(){super(true);this.registerRequiredCSS("object_ui/objectValue.css");this.registerRequiredCSS("sources/watchExpressionsSidebarPane.css");this._watchExpressions=[];this._watchExpressionsSetting=Common.settings.createLocalSetting("watchExpressions",[]);this._addButton=new UI.ToolbarButton(Common.UIString("Add expression"),"largeicon-add");this._addButton.addEventListener(UI.ToolbarButton.Events.Click,this._addButtonClicked.bind(this));this._refreshButton=new UI.ToolbarButton(Common.UIString("Refresh"),"largeicon-refresh");this._refreshButton.addEventListener(UI.ToolbarButton.Events.Click,this.update,this);this.contentElement.classList.add("watch-expressions");this.contentElement.addEventListener("contextmenu",this._contextMenu.bind(this),false);this._expandController=new ObjectUI.ObjectPropertiesSectionExpandController;UI.context.addFlavorChangeListener(SDK.ExecutionContext,this.update,this);UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this.update,this);this._linkifier=new Components.Linkifier;this.update()}toolbarItems(){return[this._addButton,this._refreshButton]}hasExpressions(){return!!this._watchExpressionsSetting.get().length}_saveExpressions(){const e=[];for(let t=0;t<this._watchExpressions.length;t++){if(this._watchExpressions[t].expression())e.push(this._watchExpressions[t].expression())}this._watchExpressionsSetting.set(e)}async _addButtonClicked(){await UI.viewManager.showView("sources.watch");this._createWatchExpression(null).startEditing()}doUpdate(){this._linkifier.reset();this.contentElement.removeChildren();this._watchExpressions=[];this._emptyElement=this.contentElement.createChild("div","gray-info-message");this._emptyElement.textContent=Common.UIString("No watch expressions");const e=this._watchExpressionsSetting.get();for(let t=0;t<e.length;++t){const i=e[t];if(!i)continue;this._createWatchExpression(i)}return Promise.resolve()}_createWatchExpression(e){this._emptyElement.classList.add("hidden");const t=new Sources.WatchExpression(e,this._expandController,this._linkifier);t.addEventListener(Sources.WatchExpression.Events.ExpressionUpdated,this._watchExpressionUpdated,this);this.contentElement.appendChild(t.element());this._watchExpressions.push(t);return t}_watchExpressionUpdated(e){const t=e.data;if(!t.expression()){this._watchExpressions.remove(t);this.contentElement.removeChild(t.element());this._emptyElement.classList.toggle("hidden",!!this._watchExpressions.length)}this._saveExpressions()}_contextMenu(e){const t=new UI.ContextMenu(e);this._populateContextMenu(t,e);t.show()}_populateContextMenu(e,t){let i=false;for(const e of this._watchExpressions)i|=e.isEditing();if(!i)e.debugSection().appendItem(Common.UIString("Add watch expression"),this._addButtonClicked.bind(this));if(this._watchExpressions.length>1){e.debugSection().appendItem(Common.UIString("Delete all watch expressions"),this._deleteAllButtonClicked.bind(this))}const o=t.deepElementFromPoint();if(!o)return;for(const i of this._watchExpressions){if(i.element().isSelfOrAncestor(o))i._populateContextMenu(e,t)}}_deleteAllButtonClicked(){this._watchExpressions=[];this._saveExpressions();this.update()}_focusAndAddExpressionToWatch(e){UI.viewManager.showView("sources.watch");this.doUpdate();this._addExpressionToWatch(e)}_addExpressionToWatch(e){this._createWatchExpression(e);this._saveExpressions()}handleAction(e,t){const i=UI.context.flavor(Sources.UISourceCodeFrame);if(!i)return false;const o=i.textEditor.text(i.textEditor.selection());this._focusAndAddExpressionToWatch(o);return true}_addPropertyPathToWatch(e){this._addExpressionToWatch(e.path())}appendApplicableItems(e,t,i){if(i instanceof ObjectUI.ObjectPropertyTreeElement&&!i.property.synthetic){t.debugSection().appendItem(ls`Add property path to watch`,this._addPropertyPathToWatch.bind(this,i))}const o=UI.context.flavor(Sources.UISourceCodeFrame);if(!o||o.textEditor.selection().isEmpty())return;t.debugSection().appendAction("sources.add-to-watch")}};Sources.WatchExpression=class extends Common.Object{constructor(e,t,i){super();this._expression=e;this._expandController=t;this._element=createElementWithClass("div","watch-expression monospace");this._editing=false;this._linkifier=i;this._createWatchExpression();this.update()}element(){return this._element}expression(){return this._expression}update(){const e=UI.context.flavor(SDK.ExecutionContext);if(e&&this._expression){e.evaluate({expression:this._expression,objectGroup:Sources.WatchExpression._watchObjectGroupId,includeCommandLineAPI:false,silent:true,returnByValue:false,generatePreview:false},false,false).then(e=>this._createWatchExpression(e.object,e.exceptionDetails))}}startEditing(){this._editing=true;this._element.removeChild(this._objectPresentationElement);const e=this._element.createChild("div");e.textContent=this._nameElement.textContent;this._textPrompt=new ObjectUI.ObjectPropertyPrompt;this._textPrompt.renderAsBlock();const t=this._textPrompt.attachAndStartEditing(e,this._finishEditing.bind(this));t.classList.add("watch-expression-text-prompt-proxy");t.addEventListener("keydown",this._promptKeyDown.bind(this),false);this._element.getComponentSelection().selectAllChildren(e)}isEditing(){return!!this._editing}_finishEditing(e,t){if(e)e.consume(t);this._editing=false;this._textPrompt.detach();const i=t?this._expression:this._textPrompt.text();delete this._textPrompt;this._element.removeChildren();this._element.appendChild(this._objectPresentationElement);this._updateExpression(i)}_dblClickOnWatchExpression(e){e.consume();if(!this.isEditing())this.startEditing()}_updateExpression(e){if(this._expression)this._expandController.stopWatchSectionsWithId(this._expression);this._expression=e;this.update();this.dispatchEventToListeners(Sources.WatchExpression.Events.ExpressionUpdated,this)}_deleteWatchExpression(e){e.consume(true);this._updateExpression(null)}_createWatchExpression(e,t){this._result=e||null;const i=createElementWithClass("div","watch-expression-header");const o=UI.Icon.create("smallicon-cross","watch-expression-delete-button");o.title=ls`Delete watch expression`;o.addEventListener("click",this._deleteWatchExpression.bind(this),false);i.appendChild(o);const s=i.createChild("div","watch-expression-title");this._nameElement=ObjectUI.ObjectPropertiesSection.createNameElement(this._expression);if(!!t||!e){this._valueElement=createElementWithClass("span","watch-expression-error value");s.classList.add("dimmed");this._valueElement.textContent=Common.UIString("<not available>")}else{this._valueElement=ObjectUI.ObjectPropertiesSection.createValueElementWithCustomSupport(e,!!t,false,s,this._linkifier)}const n=createElementWithClass("span","watch-expressions-separator");n.textContent=": ";s.appendChildren(this._nameElement,n,this._valueElement);this._element.removeChildren();this._objectPropertiesSection=null;if(!t&&e&&e.hasChildren&&!e.customPreview()){i.classList.add("watch-expression-object-header");this._objectPropertiesSection=new ObjectUI.ObjectPropertiesSection(e,i,this._linkifier);this._objectPresentationElement=this._objectPropertiesSection.element;this._objectPresentationElement.classList.add("watch-expression-object");this._expandController.watchSection(this._expression,this._objectPropertiesSection);const t=this._objectPropertiesSection.objectTreeElement();t.toggleOnClick=false;t.listItemElement.addEventListener("click",this._onSectionClick.bind(this),false);t.listItemElement.addEventListener("dblclick",this._dblClickOnWatchExpression.bind(this))}else{this._objectPresentationElement=i;this._objectPresentationElement.addEventListener("dblclick",this._dblClickOnWatchExpression.bind(this))}this._element.appendChild(this._objectPresentationElement)}_onSectionClick(e){e.consume(true);if(e.detail===1){this._preventClickTimeout=setTimeout(t.bind(this),333)}else{clearTimeout(this._preventClickTimeout);delete this._preventClickTimeout}function t(){if(!this._objectPropertiesSection)return;const e=this._objectPropertiesSection.objectTreeElement();if(e.expanded)e.collapse();else e.expand()}}_promptKeyDown(e){if(isEnterKey(e)||isEscKey(e))this._finishEditing(e,isEscKey(e))}_populateContextMenu(e,t){if(!this.isEditing()){e.editSection().appendItem(Common.UIString("Delete watch expression"),this._updateExpression.bind(this,null))}if(!this.isEditing()&&this._result&&(this._result.type==="number"||this._result.type==="string"))e.clipboardSection().appendItem(Common.UIString("Copy value"),this._copyValueButtonClicked.bind(this));const i=t.deepElementFromPoint();if(i&&this._valueElement.isSelfOrAncestor(i))e.appendApplicableItems(this._result)}_copyValueButtonClicked(){InspectorFrontendHost.copyText(this._valueElement.textContent)}};Sources.WatchExpression._watchObjectGroupId="watch-group";Sources.WatchExpression.Events={ExpressionUpdated:Symbol("ExpressionUpdated")};Sources.ThreadsSidebarPane=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS("sources/threadsSidebarPane.css");this._items=new UI.ListModel;this._list=new UI.ListControl(this._items,this,UI.ListMode.NonViewport);this.contentElement.appendChild(this._list.element);UI.context.addFlavorChangeListener(SDK.Target,this._targetFlavorChanged,this);SDK.targetManager.observeModels(SDK.DebuggerModel,this)}static shouldBeShown(){return SDK.targetManager.models(SDK.DebuggerModel).length>=2}createElementForItem(e){const t=createElementWithClass("div","thread-item");const i=t.createChild("div","thread-item-title");const o=t.createChild("div","thread-item-paused-state");t.appendChild(UI.Icon.create("smallicon-thick-right-arrow","selected-thread-icon"));function s(){const t=e.runtimeModel().defaultExecutionContext();i.textContent=t&&t.label()?t.label():e.target().name()}function n(){o.textContent=e.isPaused()?ls`paused`:""}function r(t){const i=t.data;if(i===e.target())s()}e.addEventListener(SDK.DebuggerModel.Events.DebuggerPaused,n);e.addEventListener(SDK.DebuggerModel.Events.DebuggerResumed,n);e.runtimeModel().addEventListener(SDK.RuntimeModel.Events.ExecutionContextChanged,s);SDK.targetManager.addEventListener(SDK.TargetManager.Events.NameChanged,r);n();s();return t}heightForItem(e){console.assert(false);return 0}isItemSelectable(e){return true}selectedItemChanged(e,t,i,o){if(i)i.classList.remove("selected");if(o)o.classList.add("selected");if(t)UI.context.setFlavor(SDK.Target,t.target())}modelAdded(e){this._items.insert(this._items.length,e);const t=UI.context.flavor(SDK.Target);if(t===e.target())this._list.selectItem(e)}modelRemoved(e){this._items.remove(this._items.indexOf(e))}_targetFlavorChanged(e){const t=e.data;const i=t.model(SDK.DebuggerModel);if(i)this._list.selectItem(i)}};Sources.ScriptFormatterEditorAction=class{constructor(){this._pathsToFormatOnLoad=new Set}_editorSelected(e){const t=e.data;this._updateButton(t);if(this._isFormatableScript(t)&&this._pathsToFormatOnLoad.has(t.url())&&!Sources.sourceFormatter.hasFormatted(t))this._showFormatted(t)}_editorClosed(e){const t=e.data.uiSourceCode;const i=e.data.wasSelected;if(i)this._updateButton(null);const o=Sources.sourceFormatter.discardFormattedUISourceCode(t);if(o)this._pathsToFormatOnLoad.delete(o.url())}_updateButton(e){this._button.element.classList.toggle("hidden",!this._isFormatableScript(e))}button(e){if(this._button)return this._button;this._sourcesView=e;this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorClosed,this._editorClosed.bind(this));this._button=new UI.ToolbarButton(Common.UIString("Pretty print"),"largeicon-pretty-print");this._button.addEventListener(UI.ToolbarButton.Events.Click,this._toggleFormatScriptSource,this);this._updateButton(e.currentUISourceCode());return this._button}_isFormatableScript(e){if(!e)return false;if(e.project().canSetFileContent())return false;if(e.project().type()===Workspace.projectTypes.Formatter)return false;if(Persistence.persistence.binding(e))return false;return e.contentType().hasScripts()}_toggleFormatScriptSource(e){const t=this._sourcesView.currentUISourceCode();if(!this._isFormatableScript(t))return;this._pathsToFormatOnLoad.add(t.url());this._showFormatted(t)}async _showFormatted(e){const t=await Sources.sourceFormatter.format(e);if(e!==this._sourcesView.currentUISourceCode())return;const i=this._sourcesView.viewForFile(e);let o=[0,0];if(i){const e=i.selection();o=t.mapping.originalToFormatted(e.startLine,e.startColumn)}this._sourcesView.showSourceLocation(t.formattedSourceCode,o[0],o[1])}};Sources.InplaceFormatterEditorAction=class{_editorSelected(e){const t=e.data;this._updateButton(t)}_editorClosed(e){const t=e.data.wasSelected;if(t)this._updateButton(null)}_updateButton(e){this._button.element.classList.toggle("hidden",!this._isFormattable(e))}button(e){if(this._button)return this._button;this._sourcesView=e;this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorClosed,this._editorClosed.bind(this));this._button=new UI.ToolbarButton(Common.UIString("Format"),"largeicon-pretty-print");this._button.addEventListener(UI.ToolbarButton.Events.Click,this._formatSourceInPlace,this);this._updateButton(e.currentUISourceCode());return this._button}_isFormattable(e){if(!e)return false;if(e.project().canSetFileContent())return true;if(Persistence.persistence.binding(e))return true;return e.contentType().isStyleSheet()}_formatSourceInPlace(e){const t=this._sourcesView.currentUISourceCode();if(!this._isFormattable(t))return;if(t.isDirty())i.call(this,t.workingCopy());else t.requestContent().then(i.bind(this));function i(e){const i=t.mimeType();Formatter.Formatter.format(t.contentType(),i,e||"",o.bind(this))}function o(e,i){if(t.workingCopy()===e)return;const o=this._sourcesView.viewForFile(t);let s=[0,0];if(o){const e=o.selection();s=i.originalToFormatted(e.startLine,e.startColumn)}t.setWorkingCopy(e);this._sourcesView.showSourceLocation(t,s[0],s[1])}}};Sources.SourceFormatData=class{constructor(e,t,i){this.originalSourceCode=e;this.formattedSourceCode=t;this.mapping=i}originalPath(){return this.originalSourceCode.project().id()+":"+this.originalSourceCode.url()}static _for(e){return e[Sources.SourceFormatData._formatDataSymbol]}};Sources.SourceFormatData._formatDataSymbol=Symbol("formatData");Sources.SourceFormatter=class{constructor(){this._projectId="formatter:";this._project=new Bindings.ContentProviderBasedProject(Workspace.workspace,this._projectId,Workspace.projectTypes.Formatter,"formatter",true);this._formattedSourceCodes=new Map;this._scriptMapping=new Sources.SourceFormatter.ScriptMapping;this._styleMapping=new Sources.SourceFormatter.StyleMapping;Workspace.workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._onUISourceCodeRemoved,this)}_onUISourceCodeRemoved(e){const t=e.data;const i=this._formattedSourceCodes.get(t);if(i&&i.formatData)this._discardFormatData(i.formatData);this._formattedSourceCodes.remove(t)}discardFormattedUISourceCode(e){const t=Sources.SourceFormatData._for(e);if(!t)return null;this._discardFormatData(t);this._formattedSourceCodes.remove(t.originalSourceCode);return t.originalSourceCode}_discardFormatData(e){delete e.formattedSourceCode[Sources.SourceFormatData._formatDataSymbol];this._scriptMapping._setSourceMappingEnabled(e,false);this._styleMapping._setSourceMappingEnabled(e,false);this._project.removeFile(e.formattedSourceCode.url())}hasFormatted(e){return this._formattedSourceCodes.has(e)}async format(e){const t=this._formattedSourceCodes.get(e);if(t)return t.promise;let i;const o=new Promise(e=>{i=e});this._formattedSourceCodes.set(e,{promise:o,formatData:null});const s=await e.requestContent();Formatter.Formatter.format(e.contentType(),e.mimeType(),s||"",n.bind(this));return o;function n(t,s){const n=this._formattedSourceCodes.get(e);if(!n||n.promise!==o)return;let r;let a=0;let c="";do{r=`${e.url()}:formatted${c}`;c=`:${a++}`}while(this._project.uiSourceCodeForURL(r));const l=Common.StaticContentProvider.fromString(r,e.contentType(),t);const d=this._project.addContentProvider(r,l,e.mimeType());const u=new Sources.SourceFormatData(e,d,s);d[Sources.SourceFormatData._formatDataSymbol]=u;this._scriptMapping._setSourceMappingEnabled(u,true);this._styleMapping._setSourceMappingEnabled(u,true);n.formatData=u;for(const t of e.allDecorations()){const e=t.range();const i=s.originalToFormatted(e.startLine,e.startColumn);const o=s.originalToFormatted(e.endLine,e.endColumn);d.addDecoration(new TextUtils.TextRange(i[0],i[1],o[0],o[1]),t.type(),t.data())}i(u)}}};Sources.SourceFormatter.ScriptMapping=class{constructor(){Bindings.debuggerWorkspaceBinding.addSourceMapping(this)}rawLocationToUILocation(e){const t=e.script();const i=t&&Sources.SourceFormatData._for(t);if(!i)return null;const o=e.lineNumber;const s=e.columnNumber||0;const n=i.mapping.originalToFormatted(o,s);return i.formattedSourceCode.uiLocation(n[0],n[1])}uiLocationToRawLocations(e,t,i){const o=Sources.SourceFormatData._for(e);if(!o)return[];const s=o.mapping.formattedToOriginal(t,i);const n=this._scriptsForUISourceCode(o.originalSourceCode);if(!n.length)return[];return n.map(e=>e.debuggerModel.createRawLocation(e,s[0],s[1]))}_setSourceMappingEnabled(e,t){const i=this._scriptsForUISourceCode(e.originalSourceCode);if(!i.length)return;if(t){for(const t of i)t[Sources.SourceFormatData._formatDataSymbol]=e}else{for(const e of i)delete e[Sources.SourceFormatData._formatDataSymbol]}for(const e of i)Bindings.debuggerWorkspaceBinding.updateLocations(e)}_scriptsForUISourceCode(e){if(e.contentType()===Common.resourceTypes.Document){const t=Bindings.NetworkProject.targetForUISourceCode(e);const i=t&&t.model(SDK.DebuggerModel);if(i){const t=i.scriptsForSourceURL(e.url()).filter(e=>e.isInlineScript()&&!e.hasSourceURL);return t}}if(e.contentType().isScript()){const t=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(e,0,0);return t.map(e=>e.script())}return[]}};Sources.SourceFormatter.StyleMapping=class{constructor(){Bindings.cssWorkspaceBinding.addSourceMapping(this);this._headersSymbol=Symbol("Sources.SourceFormatter.StyleMapping._headersSymbol")}rawLocationToUILocation(e){const t=e.header();const i=t&&Sources.SourceFormatData._for(t);if(!i)return null;const o=i.mapping.originalToFormatted(e.lineNumber,e.columnNumber||0);return i.formattedSourceCode.uiLocation(o[0],o[1])}uiLocationToRawLocations(e){const t=Sources.SourceFormatData._for(e.uiSourceCode);if(!t)return[];const i=t.mapping.formattedToOriginal(e.lineNumber,e.columnNumber);const o=t.originalSourceCode[this._headersSymbol];return o.map(e=>new SDK.CSSLocation(e,i[0],i[1]))}_setSourceMappingEnabled(e,t){const i=e.originalSourceCode;const o=Bindings.cssWorkspaceBinding.uiLocationToRawLocations(i.uiLocation(0,0));const s=o.map(e=>e.header()).filter(e=>!!e);if(!s.length)return;if(t){i[this._headersSymbol]=s;s.forEach(t=>t[Sources.SourceFormatData._formatDataSymbol]=e)}else{i[this._headersSymbol]=null;s.forEach(e=>delete e[Sources.SourceFormatData._formatDataSymbol])}s.forEach(e=>Bindings.cssWorkspaceBinding.updateLocations(e))}};Sources.sourceFormatter=new Sources.SourceFormatter;Sources.OpenFileQuickOpen=class extends Sources.FilteredUISourceCodeListProvider{attach(){this.setDefaultScores(Sources.SourcesView.defaultUISourceCodeScores());super.attach()}uiSourceCodeSelected(e,t,i){Host.userMetrics.actionTaken(Host.UserMetrics.Action.SelectFileFromFilePicker);if(!e)return;if(typeof t==="number")Common.Revealer.reveal(e.uiLocation(t,i));else Common.Revealer.reveal(e)}filterProject(e){return!e.isServiceProject()}renderAsTwoRows(){return true}};Sources.SourcesView=class extends UI.VBox{constructor(){super();this.registerRequiredCSS("sources/sourcesView.css");this.element.id="sources-panel-sources-view";this.setMinimumAndPreferredSizes(88,52,150,100);const e=Workspace.workspace;this._searchableView=new UI.SearchableView(this,"sourcesViewSearchConfig");this._searchableView.setMinimalSearchQuerySize(0);this._searchableView.show(this.element);this._sourceViewByUISourceCode=new Map;this._editorContainer=new Sources.TabbedEditorContainer(this,Common.settings.createLocalSetting("previouslyViewedFiles",[]),this._placeholderElement());this._editorContainer.show(this._searchableView.element);this._editorContainer.addEventListener(Sources.TabbedEditorContainer.Events.EditorSelected,this._editorSelected,this);this._editorContainer.addEventListener(Sources.TabbedEditorContainer.Events.EditorClosed,this._editorClosed,this);this._historyManager=new Sources.EditingLocationHistoryManager(this,this.currentSourceFrame.bind(this));this._toolbarContainerElement=this.element.createChild("div","sources-toolbar");if(!Runtime.experiments.isEnabled("sourcesPrettyPrint")){this._toolbarEditorActions=new UI.Toolbar("",this._toolbarContainerElement);self.runtime.allInstances(Sources.SourcesView.EditorAction).then(t.bind(this))}function t(e){for(let t=0;t<e.length;++t)this._toolbarEditorActions.appendToolbarItem(e[t].button(this))}this._scriptViewToolbar=new UI.Toolbar("",this._toolbarContainerElement);this._scriptViewToolbar.element.style.flex="auto";this._bottomToolbar=new UI.Toolbar("",this._toolbarContainerElement);this._toolbarChangedListener=null;UI.startBatchUpdate();e.uiSourceCodes().forEach(this._addUISourceCode.bind(this));UI.endBatchUpdate();e.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this);e.addEventListener(Workspace.Workspace.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this);e.addEventListener(Workspace.Workspace.Events.ProjectRemoved,this._projectRemoved.bind(this),this);function i(e){if(e.returnValue)return;let t=[];const i=Workspace.workspace.projectsForType(Workspace.projectTypes.FileSystem);for(let e=0;e<i.length;++e){t=t.concat(i[e].uiSourceCodes().filter(e=>e.isDirty()))}if(!t.length)return;e.returnValue=Common.UIString("DevTools have unsaved changes that will be permanently lost.");UI.viewManager.showView("sources");for(let e=0;e<t.length;++e)Common.Revealer.reveal(t[e])}if(!window.opener)window.addEventListener("beforeunload",i,true);this._shortcuts={};this.element.addEventListener("keydown",this._handleKeyDown.bind(this),false)}_placeholderElement(){const e=[{actionId:"quickOpen.show",description:Common.UIString("Open file")},{actionId:"commandMenu.show",description:Common.UIString("Run command")}];const t=createElementWithClass("span","tabbed-pane-placeholder");for(const i of e){const e=UI.shortcutRegistry.shortcutTitleForAction(i.actionId);const o=t.createChild("div","tabbed-pane-placeholder-row");o.createChild("div","tabbed-pane-placeholder-key").textContent=e;o.createChild("div","tabbed-pane-placeholder-value").textContent=i.description}t.createChild("div").textContent=Common.UIString("Drop in a folder to add to workspace");t.appendChild(UI.XLink.create("https://developers.google.com/web/tools/chrome-devtools/sources?utm_source=devtools&utm_campaign=2018Q1","Learn more"));return t}static defaultUISourceCodeScores(){const e=new Map;const t=UI.context.flavor(Sources.SourcesView);if(t){const i=t._editorContainer.historyUISourceCodes();for(let t=1;t<i.length;++t)e.set(i[t],i.length-t)}return e}leftToolbar(){return this._editorContainer.leftToolbar()}rightToolbar(){return this._editorContainer.rightToolbar()}bottomToolbar(){return this._bottomToolbar}_registerShortcuts(e,t){for(let i=0;i<e.length;++i)this._shortcuts[e[i].key]=t}_handleKeyDown(e){const t=UI.KeyboardShortcut.makeKeyFromEvent(e);const i=this._shortcuts[t];if(i&&i())e.consume(true)}wasShown(){super.wasShown();UI.context.setFlavor(Sources.SourcesView,this)}willHide(){UI.context.setFlavor(Sources.SourcesView,null);super.willHide()}toolbarContainerElement(){return this._toolbarContainerElement}searchableView(){return this._searchableView}visibleView(){return this._editorContainer.visibleView}currentSourceFrame(){const e=this.visibleView();if(!(e instanceof Sources.UISourceCodeFrame))return null;return e}currentUISourceCode(){return this._editorContainer.currentFile()}_onCloseEditorTab(){const e=this._editorContainer.currentFile();if(!e)return false;this._editorContainer.closeFile(e);return true}_onJumpToPreviousLocation(){this._historyManager.rollback()}_onJumpToNextLocation(){this._historyManager.rollover()}_uiSourceCodeAdded(e){const t=e.data;this._addUISourceCode(t)}_addUISourceCode(e){if(e.project().isServiceProject())return;if(e.project().type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(e.project())==="overrides")return;this._editorContainer.addUISourceCode(e)}_uiSourceCodeRemoved(e){const t=e.data;this._removeUISourceCodes([t])}_removeUISourceCodes(e){this._editorContainer.removeUISourceCodes(e);for(let t=0;t<e.length;++t){this._removeSourceFrame(e[t]);this._historyManager.removeHistoryForSourceCode(e[t])}}_projectRemoved(e){const t=e.data;const i=t.uiSourceCodes();this._removeUISourceCodes(i)}_updateScriptViewToolbarItems(){this._scriptViewToolbar.removeToolbarItems();const e=this.visibleView();if(e instanceof UI.SimpleView){for(const t of e.syncToolbarItems())this._scriptViewToolbar.appendToolbarItem(t)}}showSourceLocation(e,t,i,o,s){this._historyManager.updateCurrentState();this._editorContainer.showFile(e);const n=this.currentSourceFrame();if(n&&typeof t==="number")n.revealPosition(t,i,!s);this._historyManager.pushNewState();if(!o)this.visibleView().focus()}_createSourceView(e){let t;let i;const o=e.contentType();if(o===Common.resourceTypes.Image)i=new SourceFrame.ImageView(e.mimeType(),e);else if(o===Common.resourceTypes.Font)i=new SourceFrame.FontView(e.mimeType(),e);else t=new Sources.UISourceCodeFrame(e);if(t)this._historyManager.trackSourceFrameCursorJumps(t);const s=t||i;this._sourceViewByUISourceCode.set(e,s);return s}_getOrCreateSourceView(e){return this._sourceViewByUISourceCode.get(e)||this._createSourceView(e)}recycleUISourceCodeFrame(e,t){this._sourceViewByUISourceCode.delete(e.uiSourceCode());e.setUISourceCode(t);this._sourceViewByUISourceCode.set(t,e)}viewForFile(e){return this._getOrCreateSourceView(e)}_removeSourceFrame(e){const t=this._sourceViewByUISourceCode.get(e);this._sourceViewByUISourceCode.remove(e);if(t&&t instanceof Sources.UISourceCodeFrame)t.dispose()}_editorClosed(e){const t=e.data;this._historyManager.removeHistoryForSourceCode(t);let i=false;if(!this._editorContainer.currentFile())i=true;this._removeToolbarChangedListener();this._updateScriptViewToolbarItems();this._searchableView.resetSearch();const o={};o.uiSourceCode=t;o.wasSelected=i;this.dispatchEventToListeners(Sources.SourcesView.Events.EditorClosed,o)}_editorSelected(e){const t=e.data.previousView instanceof Sources.UISourceCodeFrame?e.data.previousView:null;if(t)t.setSearchableView(null);const i=e.data.currentView instanceof Sources.UISourceCodeFrame?e.data.currentView:null;if(i)i.setSearchableView(this._searchableView);this._searchableView.setReplaceable(!!i&&i.canEditSource());this._searchableView.refreshSearch();this._updateToolbarChangedListener();this._updateScriptViewToolbarItems();this.dispatchEventToListeners(Sources.SourcesView.Events.EditorSelected,this._editorContainer.currentFile())}_removeToolbarChangedListener(){if(this._toolbarChangedListener)Common.EventTarget.removeEventListeners([this._toolbarChangedListener]);this._toolbarChangedListener=null}_updateToolbarChangedListener(){this._removeToolbarChangedListener();const e=this.currentSourceFrame();if(!e)return;this._toolbarChangedListener=e.addEventListener(Sources.UISourceCodeFrame.Events.ToolbarItemsChanged,this._updateScriptViewToolbarItems,this)}searchCanceled(){if(this._searchView)this._searchView.searchCanceled();delete this._searchView;delete this._searchConfig}performSearch(e,t,i){const o=this.currentSourceFrame();if(!o)return;this._searchView=o;this._searchConfig=e;this._searchView.performSearch(this._searchConfig,t,i)}jumpToNextSearchResult(){if(!this._searchView)return;if(this._searchView!==this.currentSourceFrame()){this.performSearch(this._searchConfig,true);return}this._searchView.jumpToNextSearchResult()}jumpToPreviousSearchResult(){if(!this._searchView)return;if(this._searchView!==this.currentSourceFrame()){this.performSearch(this._searchConfig,true);if(this._searchView)this._searchView.jumpToLastSearchResult();return}this._searchView.jumpToPreviousSearchResult()}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}replaceSelectionWith(e,t){const i=this.currentSourceFrame();if(!i){console.assert(i);return}i.replaceSelectionWith(e,t)}replaceAllWith(e,t){const i=this.currentSourceFrame();if(!i){console.assert(i);return}i.replaceAllWith(e,t)}_showOutlineQuickOpen(){QuickOpen.QuickOpen.show("@")}_showGoToLineQuickOpen(){if(this._editorContainer.currentFile())QuickOpen.QuickOpen.show(":")}_save(){this._saveSourceFrame(this.currentSourceFrame())}_saveAll(){const e=this._editorContainer.fileViews();e.forEach(this._saveSourceFrame.bind(this))}_saveSourceFrame(e){if(!(e instanceof Sources.UISourceCodeFrame))return;const t=e;t.commitEditing()}toggleBreakpointsActiveState(e){this._editorContainer.view.element.classList.toggle("breakpoints-deactivated",!e)}};Sources.SourcesView.Events={EditorClosed:Symbol("EditorClosed"),EditorSelected:Symbol("EditorSelected")};Sources.SourcesView.EditorAction=function(){};Sources.SourcesView.EditorAction.prototype={button(e){}};Sources.SourcesView.SwitchFileActionDelegate=class{static _nextFile(e){function t(e){const t=e.lastIndexOf(".");const i=e.substr(0,t!==-1?t:e.length);return i.toLowerCase()}const i=e.project().uiSourceCodes();const o=[];const s=e.parentURL();const n=e.name();const r=t(n);for(let e=0;e<i.length;++e){const n=i[e];if(s!==n.parentURL())continue;if(t(n.name())===r)o.push(n.name())}o.sort(String.naturalOrderComparator);const a=mod(o.indexOf(n)+1,o.length);const c=(s?s+"/":"")+o[a];const l=e.project().uiSourceCodeForURL(c);return l!==e?l:null}handleAction(e,t){const i=UI.context.flavor(Sources.SourcesView);const o=i.currentUISourceCode();if(!o)return false;const s=Sources.SourcesView.SwitchFileActionDelegate._nextFile(o);if(!s)return false;i.showSourceLocation(s);return true}};Sources.SourcesView.ActionDelegate=class{handleAction(e,t){const i=UI.context.flavor(Sources.SourcesView);if(!i)return false;switch(t){case"sources.close-all":i._editorContainer.closeAllFiles();return true;case"sources.jump-to-previous-location":i._onJumpToPreviousLocation();return true;case"sources.jump-to-next-location":i._onJumpToNextLocation();return true;case"sources.close-editor-tab":return i._onCloseEditorTab();case"sources.go-to-line":i._showGoToLineQuickOpen();return true;case"sources.go-to-member":i._showOutlineQuickOpen();return true;case"sources.save":i._save();return true;case"sources.save-all":i._saveAll();return true}return false}};Sources.SourcesSearchScope=class{constructor(){this._searchId=0;this._searchResultCandidates=[];this._searchResultCallback=null;this._searchFinishedCallback=null;this._searchConfig=null}static _filesComparator(e,t){if(e.isDirty()&&!t.isDirty())return-1;if(!e.isDirty()&&t.isDirty())return 1;const i=e.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(e);const o=t.project().type()===Workspace.projectTypes.FileSystem&&!Persistence.persistence.binding(t);if(i!==o)return i?1:-1;const s=e.url();const n=t.url();if(s&&!n)return-1;if(!s&&n)return 1;return String.naturalOrderComparator(e.fullDisplayName(),t.fullDisplayName())}performIndexing(e){this.stopSearch();const t=this._projects();const i=new Common.CompositeProgress(e);for(let e=0;e<t.length;++e){const o=t[e];const s=i.createSubProgress(o.uiSourceCodes().length);o.indexContent(s)}}_projects(){const e=Common.moduleSetting("searchInAnonymousAndContentScripts").get();return Workspace.workspace.projects().filter(t=>{if(t.type()===Workspace.projectTypes.Service)return false;if(!e&&t.isServiceProject())return false;if(!e&&t.type()===Workspace.projectTypes.ContentScripts)return false;return true})}performSearch(e,t,i,o){this.stopSearch();this._searchResultCandidates=[];this._searchResultCallback=i;this._searchFinishedCallback=o;this._searchConfig=e;const s=[];const n=new Common.CompositeProgress(t);const r=n.createSubProgress();const a=new Common.CompositeProgress(n.createSubProgress());for(const t of this._projects()){const i=t.uiSourceCodes().length;const o=a.createSubProgress(i);const n=this._projectFilesMatchingFileQuery(t,e);const r=t.findFilesMatchingSearchRequest(e,n,o).then(this._processMatchingFilesForProject.bind(this,this._searchId,t,e,n));s.push(r)}Promise.all(s).then(this._processMatchingFiles.bind(this,this._searchId,r,this._searchFinishedCallback.bind(this,true)))}_projectFilesMatchingFileQuery(e,t,i){const o=[];const s=e.uiSourceCodes();for(let e=0;e<s.length;++e){const n=s[e];if(!n.contentType().isTextType())continue;const r=Persistence.persistence.binding(n);if(r&&r.network===n)continue;if(i&&!n.isDirty())continue;if(t.filePathMatchesFileQuery(n.fullDisplayName()))o.push(n.url())}o.sort(String.naturalOrderComparator);return o}_processMatchingFilesForProject(e,t,i,o,s){if(e!==this._searchId){this._searchFinishedCallback(false);return}s.sort(String.naturalOrderComparator);s=s.intersectOrdered(o,String.naturalOrderComparator);const n=this._projectFilesMatchingFileQuery(t,i,true);s=s.mergeOrdered(n,String.naturalOrderComparator);const r=[];for(const e of s){const i=t.uiSourceCodeForURL(e);if(!i)continue;const o=Bindings.DefaultScriptMapping.scriptForUISourceCode(i);if(o&&!o.isAnonymousScript())continue;r.push(i)}r.sort(Sources.SourcesSearchScope._filesComparator);this._searchResultCandidates=this._searchResultCandidates.mergeOrdered(r,Sources.SourcesSearchScope._filesComparator)}_processMatchingFiles(e,t,i){if(e!==this._searchId){this._searchFinishedCallback(false);return}const o=this._searchResultCandidates;if(!o.length){t.done();i();return}t.setTotalWork(o.length);let s=0;const n=20;let r=0;for(let e=0;e<n&&e<o.length;++e)c.call(this);function a(e){if(e.isDirty())l.call(this,e,e.workingCopy());else e.requestContent().then(l.bind(this,e))}function c(){if(s>=o.length){if(!r){t.done();i();return}return}++r;const e=o[s++];setTimeout(a.bind(this,e),0)}function l(e,i){function o(e,t){return e.lineNumber-t.lineNumber}t.worked(1);let s=[];const n=this._searchConfig.queries();if(i!==null){for(let e=0;e<n.length;++e){const t=Common.ContentProvider.performSearchInContent(i,n[e],!this._searchConfig.ignoreCase(),this._searchConfig.isRegex());s=s.mergeOrdered(t,o)}}if(s){const t=new Sources.FileBasedSearchResult(e,s);this._searchResultCallback(t)}--r;c.call(this)}}stopSearch(){++this._searchId}};Sources.FileBasedSearchResult=class{constructor(e,t){this._uiSourceCode=e;this._searchMatches=t}label(){return this._uiSourceCode.displayName()}description(){return this._uiSourceCode.fullDisplayName()}matchesCount(){return this._searchMatches.length}matchLineContent(e){return this._searchMatches[e].lineContent}matchRevealable(e){const t=this._searchMatches[e];return this._uiSourceCode.uiLocation(t.lineNumber,t.columnNumber)}matchLabel(e){return this._searchMatches[e].lineNumber+1}};Sources.SourcesPanel=class extends UI.Panel{constructor(){super("sources");Sources.SourcesPanel._instance=this;this.registerRequiredCSS("sources/sourcesPanel.css");new UI.DropTarget(this.element,[UI.DropTarget.Type.Folder],Common.UIString("Drop workspace folder here"),this._handleDrop.bind(this));this._workspace=Workspace.workspace;this._togglePauseAction=UI.actionRegistry.action("debugger.toggle-pause");this._stepOverAction=UI.actionRegistry.action("debugger.step-over");this._stepIntoAction=UI.actionRegistry.action("debugger.step-into");this._stepOutAction=UI.actionRegistry.action("debugger.step-out");this._stepAction=UI.actionRegistry.action("debugger.step");this._toggleBreakpointsActiveAction=UI.actionRegistry.action("debugger.toggle-breakpoints-active");this._debugToolbar=this._createDebugToolbar();this._debugToolbarDrawer=this._createDebugToolbarDrawer();this._debuggerPausedMessage=new Sources.DebuggerPausedMessage;const e=225;this._splitWidget=new UI.SplitWidget(true,true,"sourcesPanelSplitViewState",e);this._splitWidget.enableShowModeSaving();this._splitWidget.show(this.element);const t=225;this.editorView=new UI.SplitWidget(true,false,"sourcesPanelNavigatorSplitViewState",t);this.editorView.enableShowModeSaving();this.editorView.element.tabIndex=0;this._splitWidget.setMainWidget(this.editorView);this._navigatorTabbedLocation=UI.viewManager.createTabbedLocation(this._revealNavigatorSidebar.bind(this),"navigator-view",true);const i=this._navigatorTabbedLocation.tabbedPane();i.setMinimumSize(100,25);i.element.classList.add("navigator-tabbed-pane");const o=new UI.ToolbarMenuButton(this._populateNavigatorMenu.bind(this),true);o.setTitle(Common.UIString("More options"));i.rightToolbar().appendToolbarItem(o);if(UI.viewManager.hasViewsForLocation("run-view-sidebar")){const e=new UI.SplitWidget(false,true,"sourcePanelNavigatorSidebarSplitViewState");e.setMainWidget(i);const t=UI.viewManager.createTabbedLocation(this._revealNavigatorSidebar.bind(this),"run-view-sidebar").tabbedPane();e.setSidebarWidget(t);e.installResizer(t.headerElement());this.editorView.setSidebarWidget(e)}else{this.editorView.setSidebarWidget(i)}this._sourcesView=new Sources.SourcesView;this._sourcesView.addEventListener(Sources.SourcesView.Events.EditorSelected,this._editorSelected.bind(this));this._toggleNavigatorSidebarButton=this.editorView.createShowHideSidebarButton("navigator");this._toggleDebuggerSidebarButton=this._splitWidget.createShowHideSidebarButton("debugger");this.editorView.setMainWidget(this._sourcesView);this._threadsSidebarPane=null;this._watchSidebarPane=UI.viewManager.view("sources.watch");this._callstackPane=self.runtime.sharedInstance(Sources.CallStackSidebarPane);Common.moduleSetting("sidebarPosition").addChangeListener(this._updateSidebarPosition.bind(this));this._updateSidebarPosition();this._updateDebuggerButtonsAndStatus();this._pauseOnExceptionEnabledChanged();Common.moduleSetting("pauseOnExceptionEnabled").addChangeListener(this._pauseOnExceptionEnabledChanged,this);this._liveLocationPool=new Bindings.LiveLocationPool;this._setTarget(UI.context.flavor(SDK.Target));Common.moduleSetting("breakpointsActive").addChangeListener(this._breakpointsActiveStateChanged,this);UI.context.addFlavorChangeListener(SDK.Target,this._onCurrentTargetChanged,this);UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameChanged,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerWasEnabled,this._debuggerWasEnabled,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerPaused,this._debuggerPaused,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.DebuggerResumed,e=>this._debuggerResumed(e.data));SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.GlobalObjectCleared,e=>this._debuggerResumed(e.data));Extensions.extensionServer.addEventListener(Extensions.ExtensionServer.Events.SidebarPaneAdded,this._extensionSidebarPaneAdded,this);SDK.targetManager.observeTargets(this)}static instance(){if(Sources.SourcesPanel._instance)return Sources.SourcesPanel._instance;return self.runtime.sharedInstance(Sources.SourcesPanel)}static updateResizerAndSidebarButtons(e){e._sourcesView.leftToolbar().removeToolbarItems();e._sourcesView.rightToolbar().removeToolbarItems();e._sourcesView.bottomToolbar().removeToolbarItems();const t=Sources.SourcesPanel.WrapperView.isShowing()&&!UI.inspectorView.isDrawerMinimized();if(e._splitWidget.isVertical()||t)e._splitWidget.uninstallResizer(e._sourcesView.toolbarContainerElement());else e._splitWidget.installResizer(e._sourcesView.toolbarContainerElement());if(!t){e._sourcesView.leftToolbar().appendToolbarItem(e._toggleNavigatorSidebarButton);if(e._splitWidget.isVertical())e._sourcesView.rightToolbar().appendToolbarItem(e._toggleDebuggerSidebarButton);else e._sourcesView.bottomToolbar().appendToolbarItem(e._toggleDebuggerSidebarButton)}}targetAdded(e){this._showThreadsIfNeeded()}targetRemoved(e){}_showThreadsIfNeeded(){if(Sources.ThreadsSidebarPane.shouldBeShown()&&!this._threadsSidebarPane){this._threadsSidebarPane=UI.viewManager.view("sources.threads");if(this._sidebarPaneStack&&this._threadsSidebarPane){this._sidebarPaneStack.showView(this._threadsSidebarPane,this._splitWidget.isVertical()?this._watchSidebarPane:this._callstackPane)}}}_setTarget(e){if(!e)return;const t=e.model(SDK.DebuggerModel);if(!t)return;if(t.isPaused()){this._showDebuggerPausedDetails(t.debuggerPausedDetails())}else{this._paused=false;this._clearInterface();this._toggleDebuggerSidebarButton.setEnabled(true)}}_onCurrentTargetChanged(e){const t=e.data;this._setTarget(t)}paused(){return this._paused}wasShown(){UI.context.setFlavor(Sources.SourcesPanel,this);super.wasShown();const e=Sources.SourcesPanel.WrapperView._instance;if(e&&e.isShowing()){UI.inspectorView.setDrawerMinimized(true);Sources.SourcesPanel.updateResizerAndSidebarButtons(this)}this.editorView.setMainWidget(this._sourcesView)}willHide(){super.willHide();UI.context.setFlavor(Sources.SourcesPanel,null);if(Sources.SourcesPanel.WrapperView.isShowing()){Sources.SourcesPanel.WrapperView._instance._showViewInWrapper();UI.inspectorView.setDrawerMinimized(false);Sources.SourcesPanel.updateResizerAndSidebarButtons(this)}}resolveLocation(e){if(e==="sources.sidebar-top"||e==="sources.sidebar-bottom"||e==="sources.sidebar-tabs")return this._sidebarPaneStack;else return this._navigatorTabbedLocation}_ensureSourcesViewVisible(){if(Sources.SourcesPanel.WrapperView.isShowing())return true;if(!UI.inspectorView.canSelectPanel("sources"))return false;UI.viewManager.showView("sources");return true}onResize(){if(Common.moduleSetting("sidebarPosition").get()==="auto")this.element.window().requestAnimationFrame(this._updateSidebarPosition.bind(this))}searchableView(){return this._sourcesView.searchableView()}_debuggerPaused(e){const t=e.data;const i=t.debuggerPausedDetails();if(!this._paused)this._setAsCurrentPanel();if(UI.context.flavor(SDK.Target)===t.target())this._showDebuggerPausedDetails(i);else if(!this._paused)UI.context.setFlavor(SDK.Target,t.target())}_showDebuggerPausedDetails(e){this._paused=true;this._updateDebuggerButtonsAndStatus();UI.context.setFlavor(SDK.DebuggerPausedDetails,e);this._toggleDebuggerSidebarButton.setEnabled(false);this._revealDebuggerSidebar();window.focus();InspectorFrontendHost.bringToFront()}_debuggerResumed(e){const t=e.target();if(UI.context.flavor(SDK.Target)!==t)return;this._paused=false;this._clearInterface();this._toggleDebuggerSidebarButton.setEnabled(true);this._switchToPausedTargetTimeout=setTimeout(this._switchToPausedTarget.bind(this,e),500)}_debuggerWasEnabled(e){const t=e.data;if(UI.context.flavor(SDK.Target)!==t.target())return;this._updateDebuggerButtonsAndStatus()}get visibleView(){return this._sourcesView.visibleView()}showUISourceCode(e,t,i,o){if(o){const e=Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing();if(!this.isShowing()&&!e)return}else{this._showEditor()}this._sourcesView.showSourceLocation(e,t,i,o)}_showEditor(){if(Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing())return;this._setAsCurrentPanel()}showUILocation(e,t){this.showUISourceCode(e.uiSourceCode,e.lineNumber,e.columnNumber,t)}_revealInNavigator(e,t){const i=self.runtime.extensions(Sources.NavigatorView);Promise.all(i.map(e=>e.instance())).then(o.bind(this));function o(o){for(let s=0;s<o.length;++s){const n=o[s];const r=i[s].descriptor()["viewId"];if(n.acceptProject(e.project())){n.revealUISourceCode(e,true);if(t)this._navigatorTabbedLocation.tabbedPane().selectTab(r);else UI.viewManager.showView(r)}}}}_populateNavigatorMenu(e){const t=Common.moduleSetting("navigatorGroupByFolder");e.appendItemsAtLocation("navigatorMenu");e.viewSection().appendCheckboxItem(Common.UIString("Group by folder"),()=>t.set(!t.get()),t.get())}setIgnoreExecutionLineEvents(e){this._ignoreExecutionLineEvents=e}updateLastModificationTime(){this._lastModificationTime=window.performance.now()}_executionLineChanged(e){const t=e.uiLocation();if(!t)return;if(window.performance.now()-this._lastModificationTime<Sources.SourcesPanel._lastModificationTimeout)return;this._sourcesView.showSourceLocation(t.uiSourceCode,t.lineNumber,t.columnNumber,undefined,true)}_lastModificationTimeoutPassedForTest(){Sources.SourcesPanel._lastModificationTimeout=Number.MIN_VALUE}_updateLastModificationTimeForTest(){Sources.SourcesPanel._lastModificationTimeout=Number.MAX_VALUE}_callFrameChanged(){const e=UI.context.flavor(SDK.DebuggerModel.CallFrame);if(!e)return;if(this._executionLineLocation)this._executionLineLocation.dispose();this._executionLineLocation=Bindings.debuggerWorkspaceBinding.createCallFrameLiveLocation(e.location(),this._executionLineChanged.bind(this),this._liveLocationPool)}_pauseOnExceptionEnabledChanged(){const e=Common.moduleSetting("pauseOnExceptionEnabled").get();this._pauseOnExceptionButton.setToggled(e);this._pauseOnExceptionButton.setTitle(e?ls`Don't pause on exceptions`:ls`Pause on exceptions`);this._debugToolbarDrawer.classList.toggle("expanded",e)}async _updateDebuggerButtonsAndStatus(){const e=UI.context.flavor(SDK.Target);const t=e?e.model(SDK.DebuggerModel):null;if(!t){this._togglePauseAction.setEnabled(false);this._stepOverAction.setEnabled(false);this._stepIntoAction.setEnabled(false);this._stepOutAction.setEnabled(false);this._stepAction.setEnabled(false)}else if(this._paused){this._togglePauseAction.setToggled(true);this._togglePauseAction.setEnabled(true);this._stepOverAction.setEnabled(true);this._stepIntoAction.setEnabled(true);this._stepOutAction.setEnabled(true);this._stepAction.setEnabled(true)}else{this._togglePauseAction.setToggled(false);this._togglePauseAction.setEnabled(!t.isPausing());this._stepOverAction.setEnabled(false);this._stepIntoAction.setEnabled(false);this._stepOutAction.setEnabled(false);this._stepAction.setEnabled(false)}const i=t?t.debuggerPausedDetails():null;await this._debuggerPausedMessage.render(i,Bindings.debuggerWorkspaceBinding,Bindings.breakpointManager);if(i)this._updateDebuggerButtonsAndStatusForTest()}_updateDebuggerButtonsAndStatusForTest(){}_clearInterface(){this._updateDebuggerButtonsAndStatus();UI.context.setFlavor(SDK.DebuggerPausedDetails,null);if(this._switchToPausedTargetTimeout)clearTimeout(this._switchToPausedTargetTimeout);this._liveLocationPool.disposeAll()}_switchToPausedTarget(e){delete this._switchToPausedTargetTimeout;if(this._paused)return;if(e.isPaused())return;const t=SDK.targetManager.models(SDK.DebuggerModel);for(let e=0;e<t.length;++e){if(t[e].isPaused()){UI.context.setFlavor(SDK.Target,t[e].target());break}}}_togglePauseOnExceptions(){Common.moduleSetting("pauseOnExceptionEnabled").set(!this._pauseOnExceptionButton.toggled())}_runSnippet(){const e=this._sourcesView.currentUISourceCode();if(!e)return;Snippets.evaluateScriptSnippet(e)}_editorSelected(e){const t=e.data;if(this.editorView.mainWidget()&&Common.moduleSetting("autoRevealInNavigator").get())this._revealInNavigator(t,true)}_togglePause(){const e=UI.context.flavor(SDK.Target);if(!e)return true;const t=e.model(SDK.DebuggerModel);if(!t)return true;if(this._paused){this._paused=false;t.resume()}else{t.pause()}this._clearInterface();return true}_prepareToResume(){if(!this._paused)return null;this._paused=false;this._clearInterface();const e=UI.context.flavor(SDK.Target);return e?e.model(SDK.DebuggerModel):null}_longResume(e){const t=this._prepareToResume();if(!t)return;t.skipAllPausesUntilReloadOrTimeout(500);t.resume()}_terminateExecution(e){const t=this._prepareToResume();if(!t)return;t.runtimeModel().terminateExecution();t.resume()}_stepOver(){const e=this._prepareToResume();if(!e)return true;e.stepOver();return true}_stepInto(){const e=this._prepareToResume();if(!e)return true;e.stepInto();return true}_stepIntoAsync(){const e=this._prepareToResume();if(!e)return true;e.scheduleStepIntoAsync();return true}_stepOut(){const e=this._prepareToResume();if(!e)return true;e.stepOut();return true}_continueToLocation(e){const t=UI.context.flavor(SDK.ExecutionContext);if(!t)return;const i=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(e.uiSourceCode,e.lineNumber,0);const o=i.find(e=>e.debuggerModel===t.debuggerModel);if(!o)return;if(!this._prepareToResume())return;o.continueToLocation()}_toggleBreakpointsActive(){Common.moduleSetting("breakpointsActive").set(!Common.moduleSetting("breakpointsActive").get())}_breakpointsActiveStateChanged(){const e=Common.moduleSetting("breakpointsActive").get();this._toggleBreakpointsActiveAction.setToggled(!e);this._sourcesView.toggleBreakpointsActiveState(e)}_createDebugToolbar(){const e=new UI.Toolbar("scripts-debug-toolbar");const t=new UI.ToolbarButton(Common.UIString("Resume with all pauses blocked for 500 ms"),"largeicon-play");t.addEventListener(UI.ToolbarButton.Events.Click,this._longResume,this);const i=new UI.ToolbarButton(ls`Terminate current JavaScript call`,"largeicon-terminate-execution");i.addEventListener(UI.ToolbarButton.Events.Click,this._terminateExecution,this);e.appendToolbarItem(UI.Toolbar.createActionButton(this._togglePauseAction,[i,t],[]));e.appendToolbarItem(UI.Toolbar.createActionButton(this._stepOverAction));e.appendToolbarItem(UI.Toolbar.createActionButton(this._stepIntoAction));e.appendToolbarItem(UI.Toolbar.createActionButton(this._stepOutAction));e.appendToolbarItem(UI.Toolbar.createActionButton(this._stepAction));e.appendSeparator();e.appendToolbarItem(UI.Toolbar.createActionButton(this._toggleBreakpointsActiveAction));this._pauseOnExceptionButton=new UI.ToolbarToggle("","largeicon-pause-on-exceptions");this._pauseOnExceptionButton.addEventListener(UI.ToolbarButton.Events.Click,this._togglePauseOnExceptions,this);e.appendToolbarItem(this._pauseOnExceptionButton);return e}_createDebugToolbarDrawer(){const e=createElementWithClass("div","scripts-debug-toolbar-drawer");const t=Common.UIString("Pause on caught exceptions");const i=Common.moduleSetting("pauseOnCaughtException");e.appendChild(UI.SettingsUI.createSettingCheckbox(t,i,true));return e}appendApplicableItems(e,t,i){this._appendUISourceCodeItems(e,t,i);this._appendUISourceCodeFrameItems(e,t,i);this.appendUILocationItems(t,i);this._appendRemoteObjectItems(t,i);this._appendNetworkRequestItems(t,i)}_appendUISourceCodeItems(e,t,i){if(!(i instanceof Workspace.UISourceCode))return;const o=i;if(!o.project().isServiceProject()&&!e.target.isSelfOrDescendant(this._navigatorTabbedLocation.widget().element)){t.revealSection().appendItem(Common.UIString("Reveal in sidebar"),this._handleContextMenuReveal.bind(this,o))}}_appendUISourceCodeFrameItems(e,t,i){if(!(i instanceof Sources.UISourceCodeFrame))return;if(i.uiSourceCode().contentType().isFromSourceMap()||i.textEditor.selection().isEmpty())return;t.debugSection().appendAction("debugger.evaluate-selection")}appendUILocationItems(e,t){if(!(t instanceof Workspace.UILocation))return;const i=t;const o=i.uiSourceCode;const s=o.contentType();if(s.hasScripts()){const t=UI.context.flavor(SDK.Target);const s=t?t.model(SDK.DebuggerModel):null;if(s&&s.isPaused()){e.debugSection().appendItem(Common.UIString("Continue to here"),this._continueToLocation.bind(this,i))}this._callstackPane.appendBlackboxURLContextMenuItems(e,o)}}_handleContextMenuReveal(e){this.editorView.showBoth();this._revealInNavigator(e)}_appendRemoteObjectItems(e,t){if(!(t instanceof SDK.RemoteObject))return;const i=t;const o=UI.context.flavor(SDK.ExecutionContext);e.debugSection().appendItem(ls`Store as global variable`,()=>SDK.consoleModel.saveToTempVariable(o,i));if(i.type==="function"){e.debugSection().appendItem(ls`Show function definition`,this._showFunctionDefinition.bind(this,i))}}_appendNetworkRequestItems(e,t){if(!(t instanceof SDK.NetworkRequest))return;const i=t;const o=this._workspace.uiSourceCodeForURL(i.url());if(!o)return;const s=Common.UIString("Open in Sources panel");e.revealSection().appendItem(s,this.showUILocation.bind(this,o.uiLocation(0,0)))}_showFunctionDefinition(e){e.debuggerModel().functionDetailsPromise(e).then(this._didGetFunctionDetails.bind(this))}_didGetFunctionDetails(e){if(!e||!e.location)return;const t=e.location;if(!t)return;const i=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(t);if(i)this.showUILocation(i)}_revealNavigatorSidebar(){this._setAsCurrentPanel();this.editorView.showBoth(true)}_revealDebuggerSidebar(){this._setAsCurrentPanel();this._splitWidget.showBoth(true)}_updateSidebarPosition(){let e;const t=Common.moduleSetting("sidebarPosition").get();if(t==="right")e=false;else if(t==="bottom")e=true;else e=UI.inspectorView.element.offsetWidth<680;if(this.sidebarPaneView&&e===!this._splitWidget.isVertical())return;if(this.sidebarPaneView&&this.sidebarPaneView.shouldHideOnDetach())return;if(this.sidebarPaneView)this.sidebarPaneView.detach();this._splitWidget.setVertical(!e);this._splitWidget.element.classList.toggle("sources-split-view-vertical",e);Sources.SourcesPanel.updateResizerAndSidebarButtons(this);const i=new UI.VBox;i.element.appendChild(this._debugToolbarDrawer);i.setMinimumAndPreferredSizes(25,25,Sources.SourcesPanel.minToolbarWidth,100);this._sidebarPaneStack=UI.viewManager.createStackLocation(this._revealDebuggerSidebar.bind(this));this._sidebarPaneStack.widget().element.classList.add("overflow-auto");this._sidebarPaneStack.widget().show(i.element);this._sidebarPaneStack.widget().element.appendChild(this._debuggerPausedMessage.element());this._sidebarPaneStack.appendApplicableItems("sources.sidebar-top");i.element.appendChild(this._debugToolbar.element);if(this._threadsSidebarPane)this._sidebarPaneStack.showView(this._threadsSidebarPane);if(!e)this._sidebarPaneStack.appendView(this._watchSidebarPane);this._sidebarPaneStack.showView(this._callstackPane);const o=UI.viewManager.view("sources.jsBreakpoints");const s=UI.viewManager.view("sources.scopeChain");if(this._tabbedLocationHeader){this._splitWidget.uninstallResizer(this._tabbedLocationHeader);this._tabbedLocationHeader=null}if(!e){this._sidebarPaneStack.showView(s);this._sidebarPaneStack.showView(o);this._extensionSidebarPanesContainer=this._sidebarPaneStack;this.sidebarPaneView=i;this._splitWidget.uninstallResizer(this._debugToolbar.gripElementForResize())}else{const e=new UI.SplitWidget(true,true,"sourcesPanelDebuggerSidebarSplitViewState",.5);e.setMainWidget(i);this._sidebarPaneStack.showView(o);const t=UI.viewManager.createTabbedLocation(this._revealDebuggerSidebar.bind(this));e.setSidebarWidget(t.tabbedPane());this._tabbedLocationHeader=t.tabbedPane().headerElement();this._splitWidget.installResizer(this._tabbedLocationHeader);this._splitWidget.installResizer(this._debugToolbar.gripElementForResize());t.appendView(s);t.appendView(this._watchSidebarPane);t.appendApplicableItems("sources.sidebar-tabs");this._extensionSidebarPanesContainer=t;this.sidebarPaneView=e}this._sidebarPaneStack.appendApplicableItems("sources.sidebar-bottom");const n=Extensions.extensionServer.sidebarPanes();for(let e=0;e<n.length;++e)this._addExtensionSidebarPane(n[e]);this._splitWidget.setSidebarWidget(this.sidebarPaneView)}_setAsCurrentPanel(){return UI.viewManager.showView("sources")}_extensionSidebarPaneAdded(e){const t=e.data;this._addExtensionSidebarPane(t)}_addExtensionSidebarPane(e){if(e.panelName()===this.name)this._extensionSidebarPanesContainer.appendView(e)}sourcesView(){return this._sourcesView}_handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0].webkitGetAsEntry();if(!i.isDirectory)return;InspectorFrontendHost.upgradeDraggedFileSystemPermissions(i.filesystem)}};Sources.SourcesPanel._lastModificationTimeout=200;Sources.SourcesPanel.minToolbarWidth=215;Sources.SourcesPanel.UILocationRevealer=class{reveal(e,t){if(!(e instanceof Workspace.UILocation))return Promise.reject(new Error("Internal error: not a ui location"));Sources.SourcesPanel.instance().showUILocation(e,t);return Promise.resolve()}};Sources.SourcesPanel.DebuggerLocationRevealer=class{reveal(e,t){if(!(e instanceof SDK.DebuggerModel.Location))return Promise.reject(new Error("Internal error: not a debugger location"));const i=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(e);if(!i)return Promise.resolve();Sources.SourcesPanel.instance().showUILocation(i,t);return Promise.resolve()}};Sources.SourcesPanel.UISourceCodeRevealer=class{reveal(e,t){if(!(e instanceof Workspace.UISourceCode))return Promise.reject(new Error("Internal error: not a ui source code"));Sources.SourcesPanel.instance().showUISourceCode(e,undefined,undefined,t);return Promise.resolve()}};Sources.SourcesPanel.DebuggerPausedDetailsRevealer=class{reveal(e){return Sources.SourcesPanel.instance()._setAsCurrentPanel()}};Sources.SourcesPanel.RevealingActionDelegate=class{handleAction(e,t){const i=Sources.SourcesPanel.instance();if(!i._ensureSourcesViewVisible())return false;switch(t){case"debugger.toggle-pause":i._togglePause();return true}return false}};Sources.SourcesPanel.DebuggingActionDelegate=class{handleAction(e,t){const i=Sources.SourcesPanel.instance();switch(t){case"debugger.step-over":i._stepOver();return true;case"debugger.step-into":i._stepIntoAsync();return true;case"debugger.step":i._stepInto();return true;case"debugger.step-out":i._stepOut();return true;case"debugger.run-snippet":i._runSnippet();return true;case"debugger.toggle-breakpoints-active":i._toggleBreakpointsActive();return true;case"debugger.evaluate-selection":const e=UI.context.flavor(Sources.UISourceCodeFrame);if(e){let t=e.textEditor.text(e.textEditor.selection());const i=UI.context.flavor(SDK.ExecutionContext);if(i){const e=SDK.consoleModel.addCommandMessage(i,t);t=ObjectUI.JavaScriptREPL.wrapObjectLiteral(t);SDK.consoleModel.evaluateCommandInConsole(i,e,t,true,false)}}return true}return false}};Sources.SourcesPanel.WrapperView=class extends UI.VBox{constructor(){super();this.element.classList.add("sources-view-wrapper");Sources.SourcesPanel.WrapperView._instance=this;this._view=Sources.SourcesPanel.instance()._sourcesView}static isShowing(){return!!Sources.SourcesPanel.WrapperView._instance&&Sources.SourcesPanel.WrapperView._instance.isShowing()}wasShown(){if(!Sources.SourcesPanel.instance().isShowing())this._showViewInWrapper();else UI.inspectorView.setDrawerMinimized(true);Sources.SourcesPanel.updateResizerAndSidebarButtons(Sources.SourcesPanel.instance())}willHide(){UI.inspectorView.setDrawerMinimized(false);setImmediate(()=>Sources.SourcesPanel.updateResizerAndSidebarButtons(Sources.SourcesPanel.instance()))}_showViewInWrapper(){this._view.show(this.element)}};Sources.JavaScriptCompilerPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e,t){super();this._textEditor=e;this._uiSourceCode=t;this._compiling=false;this._recompileScheduled=false;this._timeout=null;this._message=null;this._disposed=false;this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,this._scheduleCompile,this);if(this._uiSourceCode.hasCommits()||this._uiSourceCode.isDirty())this._scheduleCompile()}static accepts(e){if(e.extension()==="js")return true;if(Snippets.isSnippetsUISourceCode(e))return true;for(const t of SDK.targetManager.models(SDK.DebuggerModel)){if(Bindings.debuggerWorkspaceBinding.scriptFile(e,t))return true}return false}_scheduleCompile(){if(this._compiling){this._recompileScheduled=true;return}if(this._timeout)clearTimeout(this._timeout);this._timeout=setTimeout(this._compile.bind(this),Sources.JavaScriptCompilerPlugin.CompileDelay)}_findRuntimeModel(){const e=SDK.targetManager.models(SDK.DebuggerModel);for(let t=0;t<e.length;++t){const i=Bindings.debuggerWorkspaceBinding.scriptFile(this._uiSourceCode,e[t]);if(i)return e[t].runtimeModel()}return SDK.targetManager.mainTarget()?SDK.targetManager.mainTarget().model(SDK.RuntimeModel):null}async _compile(){const e=this._findRuntimeModel();if(!e)return;const t=UI.context.flavor(SDK.ExecutionContext);if(!t)return;const i=this._textEditor.text();if(i.length>1024*100)return;this._compiling=true;const o=await e.compileScript(i,"",false,t.id);this._compiling=false;if(this._recompileScheduled){this._recompileScheduled=false;this._scheduleCompile();return}if(this._message)this._uiSourceCode.removeMessage(this._message);if(this._disposed||!o||!o.exceptionDetails)return;const s=o.exceptionDetails;const n=SDK.RuntimeModel.simpleTextFromException(s);this._message=this._uiSourceCode.addLineMessage(Workspace.UISourceCode.Message.Level.Error,n,s.lineNumber,s.columnNumber);this._compilationFinishedForTest()}_compilationFinishedForTest(){}dispose(){this._textEditor.removeEventListener(UI.TextEditor.Events.TextChanged,this._scheduleCompile,this);if(this._message)this._uiSourceCode.removeMessage(this._message);this._disposed=true;if(this._timeout)clearTimeout(this._timeout)}};Sources.JavaScriptCompilerPlugin.CompileDelay=1e3;Sources.SnippetsPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e,t){super();this._textEditor=e;this._uiSourceCode=t}static accepts(e){return Snippets.isSnippetsUISourceCode(e)}rightToolbarItems(){const e=UI.Toolbar.createActionButtonForId("debugger.run-snippet");e.setText(Host.isMac()?Common.UIString("+Enter"):Common.UIString("Ctrl+Enter"));return[e]}};Sources.ScriptOriginPlugin=class extends Sources.UISourceCodeFrame.Plugin{constructor(e,t){super();this._textEditor=e;this._uiSourceCode=t}static accepts(e){return e.contentType().hasScripts()||!!Sources.ScriptOriginPlugin._script(e)}rightToolbarItems(){const e=Bindings.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);if(e){const t=UI.formatLocalized("(source mapped from %s)",[Components.Linkifier.linkifyURL(e)]);return[new UI.ToolbarItem(t)]}const t=Sources.ScriptOriginPlugin._script(this._uiSourceCode);if(!t||!t.originStackTrace)return[];const i=Sources.ScriptOriginPlugin._linkifier.linkifyStackTraceTopFrame(t.debuggerModel.target(),t.originStackTrace);return[new UI.ToolbarItem(i)]}static _script(e){const t=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(e,0,0);for(const e of t){const t=e.script();if(t.originStackTrace)return t}return null}};Sources.ScriptOriginPlugin._linkifier=new Components.Linkifier;Runtime.cachedResources["sources/breakpointEditDialog.css"]="/*\n * Copyright 2018 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n  z-index: 30;\n  padding: 4px;\n  background-color: #e6e6e6;\n  border-radius: 7px;\n  border: 2px solid #bababa;\n  width: 90%;\n  pointer-events: auto;\n}\n\n:host(.sources-edit-breakpoint-dialog) {\n  border: none;\n  border-radius: 0;\n  z-index: 30;\n  background-color: var(--toolbar-bg-color);\n  width: 555px;\n  pointer-events: auto;\n  margin: 2px 0 2px -1px;\n  padding: 0 10px 10px 5px;\n  border: 1px solid var(--divider-color);\n}\n\n:host-context(.sources-edit-breakpoint-dialog) .condition-editor {\n  background-color: #fff;\n  margin-left: 3px;\n}\n\n:host-context(.sources-edit-breakpoint-dialog) .source-frame-breakpoint-toolbar {\n  font-family: sans-serif;\n  font-size: 12px;\n}\n";Runtime.cachedResources["sources/callStackSidebarPane.css"]='/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.blackboxed-message {\n    text-align: center;\n    font-style: italic;\n    padding: 4px;\n    color: #888;\n    background-color: #FFFFC2;\n}\n\n.blackboxed-message > .link {\n    margin-left: 5px;\n}\n\n.show-more-message {\n    text-align: center;\n    font-style: italic;\n    padding: 4px;\n    border-top: 1px solid #d8d8d8;\n}\n\n.show-more-message > .link {\n    margin-left: 5px;\n}\n\n.call-frame-item {\n    padding: 3px 8px 3px 20px;\n    position: relative;\n    min-height: 18px;\n    line-height: 15px;\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.call-frame-title-text {\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.call-frame-item:not(.async-header) {\n    border-top: 1px solid #efefef;\n}\n\n.call-frame-item:not(.async-header):hover {\n    background-color: #eee;\n}\n\n.async-header + .call-frame-item {\n    border-top: 0;\n}\n\n.call-frame-item-title,\n.call-frame-location {\n    display: flex;\n    white-space: nowrap;\n}\n\n.call-frame-location {\n    color: #888;\n    margin-left: auto;\n    padding: 0 10px 0 10px;\n}\n\n.async-header::before {\n    content: " ";\n    width: 100%;\n    border-top: 1px solid #d8d8d8;\n    margin-top: 8px;\n    position: absolute;\n    z-index: -1;\n    left: 0;\n}\n\n.async-header .call-frame-item-title {\n    font-weight: bold;\n    color: #999;\n    background-color: white;\n    margin-left: -5px;\n    padding: 0 5px;\n}\n\n.blackboxed-call-frame {\n    opacity: 0.6;\n    font-style: italic;\n}\n\n.selected-call-frame-icon {\n    display: none;\n    position: absolute;\n    top: 5px;\n    left: 4px;\n}\n\n.call-frame-item.selected .selected-call-frame-icon {\n    display: block;\n}\n\n:host-context(.-theme-with-dark-background) .blackboxed-message {\n    background-color: hsl(46, 98%, 22%);\n    color: #aaa;\n}\n\n:host-context(.-theme-with-dark-background) .blackboxed-message > .link {\n    color: hsl(0, 0%, 67%);\n}\n';Runtime.cachedResources["sources/debuggerPausedMessage.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.paused-status {\n    padding: 6px;\n    border-bottom: 1px solid transparent;\n    border-top: 1px solid rgb(189, 189, 189);\n    background-color: hsl(50, 100%, 95%);\n    color: rgb(107, 97, 48);\n}\n\n.-theme-with-dark-background .paused-status {\n    background-color: hsl(46, 98%, 22%);\n    color: #ccc;\n}\n\n.paused-status.error-reason {\n    background-color: hsl(0, 100%, 97%);\n    color: #6b3b3b;\n}\n\n.status-main {\n    font-weight: bold;\n    padding-left: 15px;\n    position: relative;\n}\n\n.status-sub:not(:empty) {\n    padding-left: 15px;\n    padding-top: 5px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.paused-status.error-reason .status-sub {\n    color: red;\n    line-height: 11px;\n    max-height: 27px;\n    -webkit-user-select: text;\n}\n\n.status-icon {\n    -webkit-filter: hue-rotate(190deg);\n    position: absolute;\n    left: 0;\n    top: calc(50% - 5px);\n}\n\n.paused-status.error-reason .status-icon {\n    -webkit-filter: none;\n}\n";Runtime.cachedResources["sources/javaScriptBreakpointsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.breakpoint-entry {\n    padding: 3px 8px 3px 8px;\n    min-height: 18px;\n    line-height: 15px;\n    border-top: 1px solid #efefef;\n}\n\n.breakpoint-entry [is=dt-checkbox] {\n    max-width: 100%;\n    white-space: nowrap;\n}\n\n:not(.breakpoints-list-deactivated) > .breakpoint-entry:hover {\n    background-color: #eee;\n}\n\n.breakpoint-entry > .source-text {\n    cursor: pointer;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n    margin-left: 22px;\n}\n\n.breakpoints-list-deactivated {\n    background-color: #eee;\n    opacity: 0.3;\n}\n\n.breakpoint-hit {\n    background-color: rgb(255, 255, 194);\n}\n\n:host-context(.-theme-with-dark-background) .breakpoint-hit {\n    background-color: hsl(46, 98%, 22%);\n    color: #ccc;\n}\n";Runtime.cachedResources["sources/navigatorTree.css"]='/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.icon, .icon-badge {\n    margin: -3px -5px -3px -5px;\n}\n\n.icon-stack {\n    position: relative;\n    display: inline-flex;\n}\n\n.icon-stack > [is=ui-icon]:not(:first-child) {\n    position: absolute;\n    left: 0;\n    top: 0;\n}\n\n.navigator-file-tree-item .icon {\n    background: linear-gradient(45deg, hsl(0, 0%, 50%), hsl(0, 0%, 70%));\n}\n\n.navigator-fs-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection),\n.navigator-fs-folder-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection) {\n    filter: grayscale(50%);\n    opacity: 0.5;\n}\n\n.tree-outline li {\n    min-height: 20px;\n}\n\n.tree-outline li:hover:not(.selected) .selection {\n    display: block;\n    background-color: rgba(56, 121, 217, 0.1);\n}\n\n.navigator-folder-tree-item .icon {\n    background-color: #555;\n}\n\n.navigator-sm-folder-tree-item .icon,\n.navigator-fs-tree-item .icon,\n.navigator-fs-folder-tree-item .icon {\n    background: linear-gradient(45deg, hsl(28, 75%, 50%), hsl(28, 75%, 70%));\n}\n\n.navigator-nw-folder-tree-item .icon {\n    background: linear-gradient(45deg, hsl(210, 82%, 65%), hsl(210, 82%, 80%));\n}\n\n.navigator-sm-script-tree-item .icon,\n.navigator-script-tree-item .icon,\n.navigator-snippet-tree-item .icon {\n    background: linear-gradient(45deg, hsl(48, 70%, 50%), hsl(48, 70%, 70%));\n}\n\n.navigator-sm-stylesheet-tree-item .icon,\n.navigator-stylesheet-tree-item .icon {\n    background: linear-gradient(45deg, hsl(256, 50%, 50%), hsl(256, 50%, 70%));\n}\n\n.navigator-image-tree-item .icon,\n.navigator-font-tree-item .icon {\n    background: linear-gradient(45deg, hsl(109, 33%, 50%), hsl(109, 33%, 70%));\n}\n\n.navigator-sm-folder-tree-item .tree-element-title,\n.navigator-sm-script-tree-item .tree-element-title,\n.navigator-sm-stylesheet-tree-item .tree-element-title {\n    font-style: italic;\n}\n\n:host{\n    overflow-y: auto;\n}\n';Runtime.cachedResources["sources/navigatorView.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.navigator-toolbar {\n    border-bottom: 1px solid #ccc;\n    padding-left: 8px;\n}\n";Runtime.cachedResources["sources/scopeChainSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.scope-chain-sidebar-pane-section-header {\n    flex: auto;\n}\n\n.scope-chain-sidebar-pane-section-subtitle {\n    float: right;\n    margin-left: 5px;\n    max-width: 55%;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.scope-chain-sidebar-pane-section-title {\n    font-weight: normal;\n    word-wrap: break-word;\n    white-space: normal;\n}\n\n.scope-chain-sidebar-pane-section {\n    padding: 2px 4px;\n    flex: none;\n}\n";Runtime.cachedResources["sources/sourcesPanel.css"]='/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.scripts-debug-toolbar {\n    position: absolute;\n    top: 0;\n    width: 100%;\n    background-color: var(--toolbar-bg-color);\n    border-bottom: 1px solid #ccc;\n    overflow: hidden;\n}\n\n.scripts-debug-toolbar-drawer {\n    flex: 0 0 52px;\n    -webkit-transition: margin-top 0.1s ease-in-out;\n    margin-top: -26px;\n    padding-top: 25px;\n    background-color: white;\n    overflow: hidden;\n    white-space: nowrap;\n}\n\n.scripts-debug-toolbar-drawer.expanded {\n    margin-top: 0;\n}\n\n.scripts-debug-toolbar-drawer > [is=dt-checkbox] {\n    display: flex;\n    padding-left: 3px;\n    height: 28px;\n}\n\n.cursor-auto {\n    cursor: auto;\n}\n\n.navigator-tabbed-pane {\n    background-color: var(--toolbar-bg-color);\n}\n';Runtime.cachedResources["sources/sourcesView.css"]='/*\n * Copyright (C) 2013 Google Inc. All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are\n * met:\n *\n *     * Redistributions of source code must retain the above copyright\n * notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above\n * copyright notice, this list of conditions and the following disclaimer\n * in the documentation and/or other materials provided with the\n * distribution.\n *     * Neither the name of Google Inc. nor the names of its\n * contributors may be used to endorse or promote products derived from\n * this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#sources-panel-sources-view {\n    flex: auto;\n    position: relative;\n}\n\n#sources-panel-sources-view .sources-toolbar {\n    display: flex;\n    flex: 0 0 27px;\n    background-color: var(--toolbar-bg-color);\n    border-top: var(--divider-border);\n    overflow: hidden;\n    z-index: 0;\n}\n\n.sources-toolbar .toolbar {\n    cursor: default;\n}\n\n.source-frame-debugger-script {\n    background-color: rgba(255, 255, 194, 0.5);\n}\n\n.-theme-with-dark-background .source-frame-debugger-script {\n    background-color: #444;\n}\n\n@-webkit-keyframes source-frame-value-update-highlight-animation {\n    from {\n        background-color: inherit;\n        color: inherit;\n    }\n    10% {\n        background-color: rgb(158, 54, 153);\n        color: white;\n    }\n    to {\n        background-color: inherit;\n        color: inherit;\n    }\n}\n\n.source-frame-value-update-highlight {\n    -webkit-animation: source-frame-value-update-highlight-animation 0.8s 1 cubic-bezier(0, 0, 0.2, 1);\n    border-radius: 2px;\n}\n\n.diff-entry-insert .diff-marker {\n    border-left: 4px solid hsla(144, 55%, 37%, 1);\n}\n\n.diff-entry-insert .CodeMirror-gutter-background {\n    background-color: hsla(144,55%,49%,.2);\n}\n\n.diff-entry-modify .diff-marker {\n    border-left: 4px solid #9C27B0;\n}\n\n.diff-entry-modify .CodeMirror-gutter-background {\n    background-color: rgba(186,104,200,0.2);\n}\n\n.diff-entry-delete .diff-marker {\n    width: 0;\n    height: 0;\n    border-top: 6px solid transparent;\n    border-bottom: 6px solid transparent;\n    border-left: 6px solid #D32F2F;\n    position: relative;\n    top: 6px;\n    cursor: pointer;\n    left: 0px;\n}\n\n.diff-entry-delete .CodeMirror-gutter-background {\n    border-bottom: 2px solid #D32F2F;\n}\n\n.CodeMirror-gutter-diff {\n    width: 4px;\n}\n\n.highlight-line-modification {\n    animation: source-line-modification-background-fadeout 0.4s 0s;\n    animation-timing-function: cubic-bezier(0, 0, 0.2, 1);\n}\n\n.highlight-line-modification span {\n    animation: source-line-modification-foreground-fadeout 0.4s 0s;\n    animation-timing-function: cubic-bezier(0, 0, 0.2, 1);\n}\n\n@keyframes source-line-modification-background-fadeout {\n    from { background-color: rgba(158, 54, 153, 0.5); }\n    50% { background-color: rgba(158, 54, 153, 0.5); }\n    90% { background-color: rgba(158, 54, 153, 0); }\n    to { background-color: transparent; }\n}\n\n@keyframes source-line-modification-foreground-fadeout {\n    from { color: white; }\n    50% { color: white; }\n    90% { color: initial; }\n    to { color: initial; }\n}\n';Runtime.cachedResources["sources/threadsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.thread-item {\n    padding: 3px 8px 3px 20px;\n    position: relative;\n    min-height: 18px;\n    line-height: 15px;\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.thread-item + .thread-item {\n    border-top: 1px solid #efefef;\n}\n\n.thread-item:hover {\n    background-color: #eee;\n}\n\n.thread-item-title,\n.thread-item-paused-state {\n    text-overflow: ellipsis;\n    overflow: hidden;\n    white-space: nowrap;\n}\n\n.thread-item-paused-state {\n    color: #888;\n    margin-left: auto;\n    padding: 0 10px 0 10px;\n}\n\n.selected-thread-icon {\n    display: none;\n    position: absolute;\n    top: 5px;\n    left: 4px;\n}\n\n.thread-item.selected .selected-thread-icon {\n    display: block;\n}\n\n";Runtime.cachedResources["sources/watchExpressionsSidebarPane.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.watch-expression-delete-button {\n    position: absolute;\n    top: 5px;\n    right: 6px;\n    cursor: pointer;\n    opacity: 0;\n    min-width: 20px;\n}\n\n.watch-expression-header:hover .watch-expression-delete-button {\n    opacity: 0.5;\n}\n\n.watch-expression-header:hover .watch-expression-delete-button:hover {\n    opacity: 1;\n}\n\n.watch-expressions {\n    overflow-x: hidden;\n    min-height: 26px;\n}\n\n.watch-expressions .dimmed {\n    opacity: 0.6;\n}\n\n.watch-expression-title {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    line-height: 20px;\n    margin-left: 16px;\n}\n\n.watch-expression-object-header .watch-expression-title {\n    margin-left: 1px;\n}\n\n.watch-expression {\n    position: relative;\n    flex: none;\n    min-height: 20px;\n}\n\n.watch-expressions .name {\n    color: rgb(136, 19, 145);\n    flex: none;\n    white-space: nowrap;\n    text-overflow: ellipsis ;\n    overflow: hidden;\n}\n\n.watch-expression-error {\n    color: red;\n}\n\n:host-context(.-theme-with-dark-background) .watch-expression-error {\n    color: hsl(0, 100%, 65%);\n}\n\n.watch-expressions-separator {\n    flex: none;\n}\n\n.watch-expressions .value {\n    white-space: nowrap;\n    display: inline;\n}\n\n.watch-expression .text-prompt {\n    text-overflow: clip;\n    overflow: hidden;\n    white-space: nowrap;\n    padding-left: 4px;\n    min-height: 18px;\n    line-height: 18px;\n    -webkit-user-select: text;\n}\n\n.watch-expression-text-prompt-proxy {\n    margin: 2px 12px;\n    padding-bottom: 3px;\n}\n\n.watch-expression-header {\n    flex: auto;\n}\n\n.watch-expression-object-header {\n    margin-left: -16px;\n    padding-left: 15px;\n}\n\n.watch-expression-header:hover {\n    background-color: #F0F0F0;\n    padding-right: 28px;\n}\n\n.watch-expression-object {\n    padding-left: 5px;\n}\n";Runtime.cachedResources["sources/dialog.css"]='/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    padding: 10px;\n}\n\n.widget {\n    align-items: center;\n}\n\nlabel {\n    white-space: nowrap;\n}\n\ninput[type=text] {\n    font-size: inherit;\n    height: 24px;\n    padding-left: 2px;\n    margin: 0 5px;\n}\n\ninput[type="search"]:focus,\ninput[type="text"]:focus {\n    outline: none;\n}\n\nbutton {\n    background-image: linear-gradient(hsl(0, 0%, 93%), hsl(0, 0%, 93%) 38%, hsl(0, 0%, 87%));\n    border: 1px solid hsla(0, 0%, 0%, 0.25);\n    border-radius: 2px;\n    box-shadow: 0 1px 0 hsla(0, 0%, 0%, 0.08), inset 0 1px 2px hsla(0, 100%, 100%, 0.75);\n    color: hsl(0, 0%, 27%);\n    font-size: 12px;\n    margin: 0 6px 0 6px;\n    text-shadow: 0 1px 0 hsl(0, 0%, 94%);\n    min-height: 2em;\n    padding-left: 10px;\n    padding-right: 10px;\n}\n\nbutton:active {\n    background-color: rgb(215, 215, 215);\n    background-image: linear-gradient(to bottom, rgb(194, 194, 194), rgb(239, 239, 239));\n}\n';