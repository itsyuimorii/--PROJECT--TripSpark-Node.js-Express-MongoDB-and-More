self["Search"]=self["Search"]||{};Search.SearchView=class extends UI.VBox{constructor(e){super(true);this.setMinimumSize(0,40);this.registerRequiredCSS("search/searchView.css");this._focusOnShow=false;this._isIndexing=false;this._searchId=1;this._searchMatchesCount=0;this._searchResultsCount=0;this._nonEmptySearchResultsCount=0;this._searchingView=null;this._notFoundView=null;this._searchConfig=null;this._pendingSearchConfig=null;this._searchResultsPane=null;this._progressIndicator=null;this._visiblePane=null;this.contentElement.classList.add("search-view");this._searchPanelElement=this.contentElement.createChild("div","search-drawer-header");this._searchPanelElement.addEventListener("keydown",this._onKeyDown.bind(this),false);this._searchResultsElement=this.contentElement.createChild("div");this._searchResultsElement.className="search-results";const t=createElement("div");t.style.flex="auto";t.style.justifyContent="start";t.style.maxWidth="300px";this._search=UI.HistoryInput.create();t.appendChild(this._search);this._search.placeholder=Common.UIString("Search");this._search.setAttribute("type","text");this._search.setAttribute("results","0");this._search.setAttribute("size",42);const s=new UI.ToolbarItem(t);const n=new UI.Toolbar("search-toolbar",this._searchPanelElement);this._matchCaseButton=Search.SearchView._appendToolbarToggle(n,"Aa",Common.UIString("Match Case"));this._regexButton=Search.SearchView._appendToolbarToggle(n,".*",Common.UIString("Use Regular Expression"));n.appendToolbarItem(s);const i=new UI.ToolbarButton(Common.UIString("Refresh"),"largeicon-refresh");const r=new UI.ToolbarButton(Common.UIString("Clear"),"largeicon-clear");n.appendToolbarItem(i);n.appendToolbarItem(r);i.addEventListener(UI.ToolbarButton.Events.Click,this._onAction.bind(this));r.addEventListener(UI.ToolbarButton.Events.Click,()=>{this._resetSearch();this._onSearchInputClear()});const h=this.contentElement.createChild("div","search-toolbar-summary");this._searchMessageElement=h.createChild("div","search-message");this._searchProgressPlaceholderElement=h.createChild("div","flex-centered");this._searchResultsMessageElement=h.createChild("div","search-message");this._advancedSearchConfig=Common.settings.createLocalSetting(e+"SearchConfig",new Search.SearchConfig("",true,false).toPlainObject());this._load();this._searchScope=null}static _appendToolbarToggle(e,t,s){const n=new UI.ToolbarToggle(s);n.setText(t);n.addEventListener(UI.ToolbarButton.Events.Click,()=>n.setToggled(!n.toggled()));e.appendToolbarItem(n);return n}_buildSearchConfig(){return new Search.SearchConfig(this._search.value,!this._matchCaseButton.toggled(),this._regexButton.toggled())}async toggle(e,t){if(e)this._search.value=e;if(this.isShowing())this.focus();else this._focusOnShow=true;this._initScope();if(t)this._onAction();else this._startIndexing()}createScope(){throw new Error("Not implemented")}_initScope(){this._searchScope=this.createScope()}wasShown(){if(this._focusOnShow){this.focus();this._focusOnShow=false}}_onIndexingFinished(){const e=!this._progressIndicator.isCanceled();this._progressIndicator.done();this._progressIndicator=null;this._isIndexing=false;this._indexingFinished(e);if(!e)this._pendingSearchConfig=null;if(!this._pendingSearchConfig)return;const t=this._pendingSearchConfig;this._pendingSearchConfig=null;this._innerStartSearch(t)}_startIndexing(){this._isIndexing=true;if(this._progressIndicator)this._progressIndicator.done();this._progressIndicator=new UI.ProgressIndicator;this._searchMessageElement.textContent=Common.UIString("Indexing…");this._progressIndicator.show(this._searchProgressPlaceholderElement);this._searchScope.performIndexing(new Common.ProgressProxy(this._progressIndicator,this._onIndexingFinished.bind(this)))}_onSearchInputClear(){this._search.value="";this.focus()}_onSearchResult(e,t){if(e!==this._searchId||!this._progressIndicator)return;if(this._progressIndicator&&this._progressIndicator.isCanceled()){this._onIndexingFinished();return}this._addSearchResult(t);if(!t.matchesCount())return;if(!this._searchResultsPane){this._searchResultsPane=new Search.SearchResultsPane(this._searchConfig);this._showPane(this._searchResultsPane)}this._searchResultsPane.addSearchResult(t)}_onSearchFinished(e,t){if(e!==this._searchId||!this._progressIndicator)return;if(!this._searchResultsPane)this._nothingFound();this._searchFinished(t);this._searchConfig=null}async _startSearch(e){this._resetSearch();++this._searchId;this._initScope();if(!this._isIndexing)this._startIndexing();this._pendingSearchConfig=e}_innerStartSearch(e){this._searchConfig=e;if(this._progressIndicator)this._progressIndicator.done();this._progressIndicator=new UI.ProgressIndicator;this._searchStarted(this._progressIndicator);this._searchScope.performSearch(e,this._progressIndicator,this._onSearchResult.bind(this,this._searchId),this._onSearchFinished.bind(this,this._searchId))}_resetSearch(){this._stopSearch();this._showPane(null);this._searchResultsPane=null}_stopSearch(){if(this._progressIndicator&&!this._isIndexing)this._progressIndicator.cancel();if(this._searchScope)this._searchScope.stopSearch();this._searchConfig=null}_searchStarted(e){this._resetCounters();if(!this._searchingView)this._searchingView=new UI.EmptyWidget(Common.UIString("Searching…"));this._showPane(this._searchingView);this._searchMessageElement.textContent=Common.UIString("Searching…");e.show(this._searchProgressPlaceholderElement);this._updateSearchResultsMessage()}_indexingFinished(e){this._searchMessageElement.textContent=e?"":Common.UIString("Indexing interrupted.")}_updateSearchResultsMessage(){if(this._searchMatchesCount&&this._searchResultsCount){if(this._searchMatchesCount===1&&this._nonEmptySearchResultsCount===1){this._searchResultsMessageElement.textContent=Common.UIString("Found 1 matching line in 1 file.")}else if(this._searchMatchesCount>1&&this._nonEmptySearchResultsCount===1){this._searchResultsMessageElement.textContent=Common.UIString("Found %d matching lines in 1 file.",this._searchMatchesCount)}else{this._searchResultsMessageElement.textContent=Common.UIString("Found %d matching lines in %d files.",this._searchMatchesCount,this._nonEmptySearchResultsCount)}}else{this._searchResultsMessageElement.textContent=""}}_showPane(e){if(this._visiblePane)this._visiblePane.detach();if(e)e.show(this._searchResultsElement);this._visiblePane=e}_resetCounters(){this._searchMatchesCount=0;this._searchResultsCount=0;this._nonEmptySearchResultsCount=0}_nothingFound(){if(!this._notFoundView)this._notFoundView=new UI.EmptyWidget(Common.UIString("No matches found."));this._showPane(this._notFoundView);this._searchResultsMessageElement.textContent=Common.UIString("No matches found.")}_addSearchResult(e){const t=e.matchesCount();this._searchMatchesCount+=t;this._searchResultsCount++;if(t)this._nonEmptySearchResultsCount++;this._updateSearchResultsMessage()}_searchFinished(e){this._searchMessageElement.textContent=e?Common.UIString("Search finished."):Common.UIString("Search interrupted.")}focus(){this._search.focus();this._search.select()}willHide(){this._stopSearch()}_onKeyDown(e){switch(e.keyCode){case UI.KeyboardShortcut.Keys.Enter.code:this._onAction();break}}_save(){this._advancedSearchConfig.set(this._buildSearchConfig().toPlainObject())}_load(){const e=Search.SearchConfig.fromPlainObject(this._advancedSearchConfig.get());this._search.value=e.query();this._matchCaseButton.setToggled(!e.ignoreCase());this._regexButton.setToggled(e.isRegex())}_onAction(){const e=this._buildSearchConfig();if(!e.query()||!e.query().length)return;this._save();this._startSearch(e)}};Search.SearchConfig=class{constructor(e,t,s){this._query=e;this._ignoreCase=t;this._isRegex=s;this._parse()}static fromPlainObject(e){return new Search.SearchConfig(e.query,e.ignoreCase,e.isRegex)}query(){return this._query}ignoreCase(){return this._ignoreCase}isRegex(){return this._isRegex}toPlainObject(){return{query:this.query(),ignoreCase:this.ignoreCase(),isRegex:this.isRegex()}}_parse(){const e=/"([^\\"]|\\.)+"/;const t=/(\s*(?!-?f(ile)?:)[^\\ ]|\\.)+/;const s=t.source+"(\\s+"+t.source+")*";const n=["(\\s*"+Search.SearchConfig.FilePatternRegex.source+"\\s*)","("+e.source+")","("+s+")"].join("|");const i=new RegExp(n,"g");const r=this._query.match(i)||[];this._fileQueries=[];this._queries=[];for(let e=0;e<r.length;++e){const t=r[e];if(!t)continue;const s=this._parseFileQuery(t);if(s){this._fileQueries.push(s);this._fileRegexQueries=this._fileRegexQueries||[];this._fileRegexQueries.push({regex:new RegExp(s.text,this.ignoreCase?"i":""),isNegative:s.isNegative});continue}if(this._isRegex){this._queries.push(t);continue}if(t.startsWith('"')){if(!t.endsWith('"'))continue;this._queries.push(this._parseQuotedQuery(t));continue}this._queries.push(this._parseUnquotedQuery(t))}}filePathMatchesFileQuery(e){if(!this._fileRegexQueries)return true;for(let t=0;t<this._fileRegexQueries.length;++t){if(!!e.match(this._fileRegexQueries[t].regex)===this._fileRegexQueries[t].isNegative)return false}return true}queries(){return this._queries}_parseUnquotedQuery(e){return e.replace(/\\(.)/g,"$1")}_parseQuotedQuery(e){return e.substring(1,e.length-1).replace(/\\(.)/g,"$1")}_parseFileQuery(e){const t=e.match(Search.SearchConfig.FilePatternRegex);if(!t)return null;const s=!!t[1];e=t[3];let n="";for(let t=0;t<e.length;++t){const s=e[t];if(s==="*"){n+=".*"}else if(s==="\\"){++t;const s=e[t];if(s===" ")n+=" "}else{if(String.regexSpecialCharacters().indexOf(e.charAt(t))!==-1)n+="\\";n+=e.charAt(t)}}return new Search.SearchConfig.QueryTerm(n,s)}};Search.SearchConfig.FilePatternRegex=/(-)?f(ile)?:((?:[^\\ ]|\\.)+)/;Search.SearchConfig.RegexQuery;Search.SearchConfig.QueryTerm=class{constructor(e,t){this.text=e;this.isNegative=t}};Search.SearchResult=function(){};Search.SearchResult.prototype={label(){},description(){},matchesCount(){},matchLabel(e){},matchLineContent(e){},matchRevealable(e){}};Search.SearchScope=function(){};Search.SearchScope.prototype={performSearch(e,t,s,n){},performIndexing(e){},stopSearch(){}};Search.SearchResultsPane=class extends UI.VBox{constructor(e){super(true);this._searchConfig=e;this._searchResults=[];this._treeOutline=new UI.TreeOutlineInShadow;this._treeOutline.hideOverflow();this._treeOutline.registerRequiredCSS("search/searchResultsPane.css");this.contentElement.appendChild(this._treeOutline.element);this._matchesExpandedCount=0}addSearchResult(e){this._searchResults.push(e);this._addTreeElement(e)}_addTreeElement(e){const t=new Search.SearchResultsPane.SearchResultsTreeElement(this._searchConfig,e);this._treeOutline.appendChild(t);if(this._matchesExpandedCount<Search.SearchResultsPane._matchesExpandedByDefault)t.expand();this._matchesExpandedCount+=e.matchesCount()}};Search.SearchResultsPane._matchesExpandedByDefault=20;Search.SearchResultsPane._matchesShownAtOnce=20;Search.SearchResultsPane.SearchResultsTreeElement=class extends UI.TreeElement{constructor(e,t){super("",true);this._searchConfig=e;this._searchResult=t;this._initialized=false;this.toggleOnClick=true;this.selectable=false}onexpand(){if(this._initialized)return;this._updateMatchesUI();this._initialized=true}_updateMatchesUI(){this.removeChildren();const e=Math.min(this._searchResult.matchesCount(),Search.SearchResultsPane._matchesShownAtOnce);if(e<this._searchResult.matchesCount()){this._appendSearchMatches(0,e-1);this._appendShowMoreMatchesElement(e-1)}else{this._appendSearchMatches(0,e)}}onattach(){this._updateSearchMatches()}_updateSearchMatches(){this.listItemElement.classList.add("search-result");const e=s(this._searchResult.label(),"search-result-file-name");e.appendChild(s("—","search-result-dash"));e.appendChild(s(this._searchResult.description(),"search-result-qualifier"));this.tooltip=this._searchResult.description();this.listItemElement.appendChild(e);const t=createElement("span");t.className="search-result-matches-count";t.textContent=`${this._searchResult.matchesCount()}`;this.listItemElement.appendChild(t);if(this.expanded)this._updateMatchesUI();function s(e,t){const s=createElement("span");s.className=t;s.textContent=e;return s}}_appendSearchMatches(e,t){const s=this._searchResult;const n=this._searchConfig.queries();const i=[];for(let e=0;e<n.length;++e)i.push(createSearchRegex(n[e],!this._searchConfig.ignoreCase(),this._searchConfig.isRegex()));for(let n=e;n<t;++n){const e=s.matchLineContent(n).trim();let t=[];for(let s=0;s<i.length;++s)t=t.concat(this._regexMatchRanges(e,i[s]));const r=Components.Linkifier.linkifyRevealable(s.matchRevealable(n),"");r.classList.add("search-match-link");const h=createElement("span");h.classList.add("search-match-line-number");h.textContent=s.matchLabel(n);r.appendChild(h);const a=this._createContentSpan(e,t);r.appendChild(a);const o=new UI.TreeElement;o.selectable=false;this.appendChild(o);o.listItemElement.className="search-match";o.listItemElement.appendChild(r);o.tooltip=e}}_appendShowMoreMatchesElement(e){const t=this._searchResult.matchesCount()-e;const s=Common.UIString("Show %d more",t);const n=new UI.TreeElement(s);this.appendChild(n);n.listItemElement.classList.add("show-more-matches");n.onselect=this._showMoreMatchesElementSelected.bind(this,n,e)}_createContentSpan(e,t){let s=0;if(t.length>0&&t[0].offset>20)s=15;e=e.substring(s,1e3+s);if(s){t=t.map(e=>new TextUtils.SourceRange(e.offset-s+1,e.length));e="…"+e}const n=createElement("span");n.className="search-match-content";n.textContent=e;UI.highlightRangesWithStyleClass(n,t,"highlighted-match");return n}_regexMatchRanges(e,t){t.lastIndex=0;let s;const n=[];while(t.lastIndex<e.length&&(s=t.exec(e)))n.push(new TextUtils.SourceRange(s.index,s[0].length));return n}_showMoreMatchesElementSelected(e,t){this.removeChild(e);this._appendSearchMatches(t,this._searchResult.matchesCount());return false}};Runtime.cachedResources["search/searchResultsPane.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n}\n\n.tree-outline {\n    padding: 0;\n}\n\n.tree-outline ol {\n    padding: 0;\n}\n\n.tree-outline li {\n    height: 16px;\n}\n\nli.search-result {\n    cursor: pointer;\n    font-size: 12px;\n    margin-top: 8px;\n    padding: 2px 0 2px 4px;\n    word-wrap: normal;\n    white-space: pre;\n}\n\nli.search-result:hover {\n    background-color: rgba(121, 121, 121, 0.1);\n}\n\nli.search-result .search-result-file-name {\n    color: #222;\n    flex: 1 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\nli.search-result .search-result-matches-count {\n    color: #888;\n    margin: 0 8px;\n}\n\nli.search-result.expanded .search-result-matches-count {\n    display: none;\n}\n\nli.show-more-matches {\n    color: #222;\n    cursor: pointer;\n    margin: 8px 0 0 -4px;\n}\n\nli.show-more-matches:hover {\n    text-decoration: underline;\n}\n\nli.search-match {\n    margin: 2px 0;\n    word-wrap: normal;\n    white-space: pre;\n}\n\nli.search-match::before {\n    display: none;\n}\n\nli.search-match .search-match-line-number {\n    color: rgb(128, 128, 128);\n    text-align: right;\n    vertical-align: top;\n    word-break: normal;\n    padding: 2px 4px 2px 6px;\n    margin-right: 5px;\n}\n\nli.search-match:hover {\n    background-color: rgba(56, 121, 217, 0.1);\n}\n\nli.search-match .highlighted-match {\n    background-color: #F1EA00;\n}\n\n:host-context(.-theme-with-dark-background) li.search-match .highlighted-match {\n    background-color: hsl(133, 100%, 30%) !important;\n}\n\n.tree-outline .devtools-link {\n    text-decoration: none;\n    display: block;\n    flex: auto;\n}\n\nli.search-match .search-match-content {\n    color: #000;\n}\n\nol.children.expanded {\n    padding-bottom: 4px;\n}\n\n.search-match-link {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-left: 9px;\n}\n\n.search-result-qualifier {\n    color: #AAA;\n}\n\n.search-result-dash {\n    color: #AAA;\n    margin: 0 4px;\n}\n";Runtime.cachedResources["search/searchView.css"]="/*\n * Copyright 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.search-drawer-header {\n    align-items: center;\n    flex-shrink: 0;\n    overflow: hidden;\n}\n\n.search-toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.search-toolbar-summary {\n    background-color: #eee;\n    border-top: 1px solid #ccc;\n    padding-left: 5px;\n    flex: 0 0 19px;\n    display: flex;\n    padding-right: 5px;\n}\n\n.search-toolbar-summary .search-message {\n    padding-top: 2px;\n    padding-left: 1ex;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n}\n\n.search-view .search-results {\n    overflow-y: auto;\n    display: flex;\n    flex: auto;\n}\n\n.search-view .search-results > div {\n    flex: auto;\n}\n";