self["Coverage"]=self["Coverage"]||{};Coverage.RangeUseCount;Coverage.CoverageSegment;Coverage.CoverageType={CSS:1<<0,JavaScript:1<<1,JavaScriptCoarse:1<<2};Coverage.CoverageModel=class extends SDK.SDKModel{constructor(e){super(e);this._cpuProfilerModel=e.model(SDK.CPUProfilerModel);this._cssModel=e.model(SDK.CSSModel);this._debuggerModel=e.model(SDK.DebuggerModel);this._coverageByURL=new Map;this._coverageByContentProvider=new Map;this._bestEffortCoveragePromise=null}start(){if(this._cssModel){this._clearCSS();this._cssModel.startCoverage()}if(this._cpuProfilerModel){this._bestEffortCoveragePromise=this._cpuProfilerModel.bestEffortCoverage();this._cpuProfilerModel.startPreciseCoverage()}return!!(this._cssModel||this._cpuProfilerModel)}stop(){const e=this.poll();if(this._cpuProfilerModel)this._cpuProfilerModel.stopPreciseCoverage();if(this._cssModel)this._cssModel.stopCoverage();return e}reset(){this._coverageByURL=new Map;this._coverageByContentProvider=new Map}async poll(){const e=await Promise.all([this._takeCSSCoverage(),this._takeJSCoverage()]);return e[0].concat(e[1])}entries(){return Array.from(this._coverageByURL.values())}usageForRange(e,t,o){const r=this._coverageByContentProvider.get(e);return r&&r.usageForRange(t,o)}_clearCSS(){for(const e of this._coverageByContentProvider.values()){if(e.type()!==Coverage.CoverageType.CSS)continue;const t=e.contentProvider();this._coverageByContentProvider.delete(t);const o=`${t.startLine}:${t.startColumn}`;const r=this._coverageByURL.get(e.url());if(!r||!r._coverageInfoByLocation.delete(o))continue;r._size-=e._size;r._usedSize-=e._usedSize;if(!r._coverageInfoByLocation.size)this._coverageByURL.delete(e.url())}}async _takeJSCoverage(){if(!this._cpuProfilerModel)return[];let e=await this._cpuProfilerModel.takePreciseCoverage();if(this._bestEffortCoveragePromise){const t=await this._bestEffortCoveragePromise;this._bestEffortCoveragePromise=null;e=t.concat(e)}return this._processJSCoverage(e)}_processJSCoverage(e){const t=[];for(const o of e){const e=this._debuggerModel.scriptForId(o.scriptId);if(!e)continue;const r=[];let n=Coverage.CoverageType.JavaScript;for(const e of o.functions){if(e.isBlockCoverage===false&&!(e.ranges.length===1&&!e.ranges[0].count))n|=Coverage.CoverageType.JavaScriptCoarse;for(const t of e.ranges)r.push(t)}const i=this._addCoverage(e,e.contentLength,e.lineOffset,e.columnOffset,r,n);if(i)t.push(i)}return t}async _takeCSSCoverage(){if(!this._cssModel)return[];const e=await this._cssModel.takeCoverageDelta();return this._processCSSCoverage(e)}_processCSSCoverage(e){const t=[];const o=new Map;for(const t of e){const e=this._cssModel.styleSheetHeaderForId(t.styleSheetId);if(!e)continue;let r=o.get(e);if(!r){r=[];o.set(e,r)}r.push({startOffset:t.startOffset,endOffset:t.endOffset,count:Number(t.used)})}for(const e of o){const o=e[0];const r=e[1];const n=this._addCoverage(o,o.contentLength,o.startLine,o.startColumn,r,Coverage.CoverageType.CSS);if(n)t.push(n)}return t}static _convertToDisjointSegments(e){e.sort((e,t)=>e.startOffset-t.startOffset);const t=[];const o=[];for(const t of e){let e=o.peekLast();while(e&&e.endOffset<=t.startOffset){r(e.endOffset,e.count);o.pop();e=o.peekLast()}r(t.startOffset,e?e.count:undefined);o.push(t)}while(o.length){const e=o.pop();r(e.endOffset,e.count)}function r(e,o){const r=t.peekLast();if(r){if(r.end===e)return;if(r.count===o){r.end=e;return}}t.push({end:e,count:o})}return t}_addCoverage(e,t,o,r,n,i){const s=e.contentURL();if(!s)return null;let a=this._coverageByURL.get(s);if(!a){a=new Coverage.URLCoverageInfo(s);this._coverageByURL.set(s,a)}const c=a._ensureEntry(e,t,o,r,i);this._coverageByContentProvider.set(e,c);const l=Coverage.CoverageModel._convertToDisjointSegments(n);if(l.length&&l.peekLast().end<t)l.push({end:t});const d=c._usedSize;c.mergeCoverage(l);if(c._usedSize===d)return null;a._usedSize+=c._usedSize-d;return c}async exportReport(e){const t=[];for(const e of this._coverageByURL.values()){const o=e.url();if(o.startsWith("extensions::")||o.startsWith("chrome-extension://"))continue;let r=false;for(const t of e._coverageInfoByLocation.values()){if(t._lineOffset||t._columnOffset){r=!!o;break}}let n=null;if(r){const e=SDK.ResourceTreeModel.resourceForURL(o);n=e?new TextUtils.Text(await e.requestContent()):null}if(n){const r={url:o,ranges:[],text:n.value()};for(const t of e._coverageInfoByLocation.values()){const e=n?n.offsetFromPosition(t._lineOffset,t._columnOffset):0;let o=0;for(const n of t._segments){if(n.count)r.ranges.push({start:o+e,end:n.end+e});else o=n.end}}t.push(r);continue}for(const r of e._coverageInfoByLocation.values()){const e={url:o,ranges:[],text:await r.contentProvider().requestContent()};let n=0;for(const t of r._segments){if(t.count)e.ranges.push({start:n,end:t.end});else n=t.end}t.push(e)}}await e.write(JSON.stringify(t,undefined,2));e.close()}};Coverage.URLCoverageInfo=class{constructor(e){this._url=e;this._coverageInfoByLocation=new Map;this._size=0;this._usedSize=0;this._type;this._isContentScript=false}url(){return this._url}type(){return this._type}size(){return this._size}usedSize(){return this._usedSize}unusedSize(){return this._size-this._usedSize}isContentScript(){return this._isContentScript}_ensureEntry(e,t,o,r,n){const i=`${o}:${r}`;let s=this._coverageInfoByLocation.get(i);if(n&Coverage.CoverageType.JavaScript&&!this._coverageInfoByLocation.size)this._isContentScript=e.isContentScript();this._type|=n;if(s){s._coverageType|=n;return s}if(n&Coverage.CoverageType.JavaScript&&!this._coverageInfoByLocation.size)this._isContentScript=e.isContentScript();s=new Coverage.CoverageInfo(e,t,o,r,n);this._coverageInfoByLocation.set(i,s);this._size+=t;return s}};Coverage.CoverageInfo=class{constructor(e,t,o,r,n){this._contentProvider=e;this._size=t;this._usedSize=0;this._lineOffset=o;this._columnOffset=r;this._coverageType=n;this._segments=[]}contentProvider(){return this._contentProvider}url(){return this._contentProvider.contentURL()}type(){return this._coverageType}mergeCoverage(e){this._segments=Coverage.CoverageInfo._mergeCoverage(this._segments,e);this._updateStats()}usageForRange(e,t){let o=this._segments.upperBound(e,(e,t)=>e-t.end);for(;o<this._segments.length&&this._segments[o].end<t;++o){if(this._segments[o].count)return true}return o<this._segments.length&&!!this._segments[o].count}static _mergeCoverage(e,t){const o=[];let r=0;let n=0;while(r<e.length&&n<t.length){const i=e[r];const s=t[n];const a=typeof i.count==="number"||typeof s.count==="number"?(i.count||0)+(s.count||0):undefined;const c=Math.min(i.end,s.end);const l=o.peekLast();if(!l||l.count!==a)o.push({end:c,count:a});else l.end=c;if(i.end<=s.end)r++;if(i.end>=s.end)n++}for(;r<e.length;r++)o.push(e[r]);for(;n<t.length;n++)o.push(t[n]);return o}_updateStats(){this._usedSize=0;let e=0;for(const t of this._segments){if(t.count)this._usedSize+=t.end-e;e=t.end}}};Coverage.CoverageListView=class extends UI.VBox{constructor(e){super(true);this._nodeForCoverageInfo=new Map;this._filterCallback=e;this._highlightRegExp=null;this.registerRequiredCSS("coverage/coverageListView.css");const t=[{id:"url",title:Common.UIString("URL"),width:"250px",fixedWidth:false,sortable:true},{id:"type",title:Common.UIString("Type"),width:"45px",fixedWidth:true,sortable:true},{id:"size",title:Common.UIString("Total Bytes"),width:"60px",fixedWidth:true,sortable:true,align:DataGrid.DataGrid.Align.Right},{id:"unusedSize",title:Common.UIString("Unused Bytes"),width:"100px",fixedWidth:true,sortable:true,align:DataGrid.DataGrid.Align.Right,sort:DataGrid.DataGrid.Order.Descending},{id:"bars",title:"",width:"250px",fixedWidth:false,sortable:true}];this._dataGrid=new DataGrid.SortableDataGrid(t);this._dataGrid.setResizeMethod(DataGrid.DataGrid.ResizeMethod.Last);this._dataGrid.element.classList.add("flex-auto");this._dataGrid.element.addEventListener("keydown",this._onKeyDown.bind(this),false);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.OpenedNode,this._onOpenedNode,this);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SortingChanged,this._sortingChanged,this);const o=this._dataGrid.asWidget();o.show(this.contentElement)}update(e){let t=false;const o=e.reduce((e,t)=>Math.max(e,t.size()),0);const r=this._dataGrid.rootNode();for(const n of e){let e=this._nodeForCoverageInfo.get(n);if(e){if(this._filterCallback(e._coverageInfo))t=e._refreshIfNeeded(o)||t;continue}e=new Coverage.CoverageListView.GridNode(n,o);this._nodeForCoverageInfo.set(n,e);if(this._filterCallback(e._coverageInfo)){r.appendChild(e);t=true}}if(t)this._sortingChanged()}reset(){this._nodeForCoverageInfo.clear();this._dataGrid.rootNode().removeChildren()}updateFilterAndHighlight(e){this._highlightRegExp=e;let t=false;for(const e of this._nodeForCoverageInfo.values()){const o=this._filterCallback(e._coverageInfo);const r=!!e.parent;if(o)e._setHighlight(this._highlightRegExp);if(o===r)continue;t=true;if(!o)e.remove();else this._dataGrid.rootNode().appendChild(e)}if(t)this._sortingChanged()}_onOpenedNode(){this._revealSourceForSelectedNode()}_onKeyDown(e){if(!isEnterKey(e))return;e.consume(true);this._revealSourceForSelectedNode()}async _revealSourceForSelectedNode(){const e=this._dataGrid.selectedNode;if(!e)return;const t=e._coverageInfo;let o=Workspace.workspace.uiSourceCodeForURL(t.url());if(!o)return;const r=await o.requestContent();if(TextUtils.isMinified(r)){const e=await Sources.sourceFormatter.format(o);o=e.formattedSourceCode}if(this._dataGrid.selectedNode!==e)return;Common.Revealer.reveal(o)}_sortingChanged(){const e=this._dataGrid.sortColumnId();if(!e)return;let t;switch(e){case"url":t=o;break;case"type":t=n;break;case"size":t=r.bind(null,"size");break;case"bars":case"unusedSize":t=r.bind(null,"unusedSize");break;default:console.assert(false,"Unknown sort field: "+e);return}this._dataGrid.sortNodes(t,!this._dataGrid.isSortOrderAscending());function o(e,t){const o=e;const r=t;return o._url.localeCompare(r._url)}function r(e,t,r){const n=t;const i=r;return n._coverageInfo[e]()-i._coverageInfo[e]()||o(t,r)}function n(e,t){const r=e;const n=t;const i=Coverage.CoverageListView._typeToString(r._coverageInfo.type());const s=Coverage.CoverageListView._typeToString(n._coverageInfo.type());return i.localeCompare(s)||o(e,t)}}static _typeToString(e){const t=[];if(e&Coverage.CoverageType.CSS)t.push(Common.UIString("CSS"));if(e&Coverage.CoverageType.JavaScriptCoarse)t.push(Common.UIString("JS (coarse)"));else if(e&Coverage.CoverageType.JavaScript)t.push(Common.UIString("JS"));return t.join("+")}};Coverage.CoverageListView.GridNode=class extends DataGrid.SortableDataGridNode{constructor(e,t){super();this._coverageInfo=e;this._lastUsedSize;this._url=e.url();this._maxSize=t;this._highlightDOMChanges=[];this._highlightRegExp=null}_setHighlight(e){if(this._highlightRegExp===e)return;this._highlightRegExp=e;this.refresh()}_refreshIfNeeded(e){if(this._lastUsedSize===this._coverageInfo.usedSize()&&e===this._maxSize)return false;this._lastUsedSize=this._coverageInfo.usedSize();this._maxSize=e;this.refresh();return true}createCell(e){const t=this.createTD(e);switch(e){case"url":t.title=this._url;const o=t.createChild("div","url-outer");const r=o.createChild("div","url-prefix");const n=o.createChild("div","url-suffix");const i=/^(.*)(\/[^\/]*)$/.exec(this._url);r.textContent=i?i[1]:this._url;n.textContent=i?i[2]:"";if(this._highlightRegExp)this._highlight(o,this._url);break;case"type":t.textContent=Coverage.CoverageListView._typeToString(this._coverageInfo.type());if(this._coverageInfo.type()&Coverage.CoverageType.JavaScriptCoarse)t.title=Common.UIString("JS coverage is function-level only. Reload the page for block-level coverage.");break;case"size":t.textContent=Number.withThousandsSeparator(this._coverageInfo.size()||0);break;case"unusedSize":const s=this._coverageInfo.unusedSize()||0;const a=t.createChild("span");const c=t.createChild("span","percent-value");a.textContent=Number.withThousandsSeparator(s);c.textContent=Common.UIString("%.1f %%",s/this._coverageInfo.size()*100);break;case"bars":const l=t.createChild("div","bar-container");const d=l.createChild("div","bar bar-unused-size");d.style.width=(100*this._coverageInfo.unusedSize()/this._maxSize).toFixed(4)+"%";const h=l.createChild("div","bar bar-used-size");h.style.width=(100*this._coverageInfo.usedSize()/this._maxSize).toFixed(4)+"%"}return t}_highlight(e,t){const o=this._highlightRegExp.exec(t);if(!o||!o.length)return;const r=new TextUtils.SourceRange(o.index,o[0].length);UI.highlightRangesWithStyleClass(e,[r],"filter-highlight")}};Coverage.CoverageView=class extends UI.VBox{constructor(){super(true);this._model=null;this._pollTimer;this._decorationManager=null;this._resourceTreeModel=null;this.registerRequiredCSS("coverage/coverageView.css");const e=this.contentElement.createChild("div","coverage-toolbar-container");const t=new UI.Toolbar("coverage-toolbar",e);this._toggleRecordAction=UI.actionRegistry.action("coverage.toggle-recording");this._toggleRecordButton=UI.Toolbar.createActionButton(this._toggleRecordAction);t.appendToolbarItem(this._toggleRecordButton);const o=SDK.targetManager.mainTarget();if(o&&o.model(SDK.ResourceTreeModel)){const e=UI.actionRegistry.action("coverage.start-with-reload");this._startWithReloadButton=UI.Toolbar.createActionButton(e);t.appendToolbarItem(this._startWithReloadButton)}this._clearButton=new UI.ToolbarButton(Common.UIString("Clear all"),"largeicon-clear");this._clearButton.addEventListener(UI.ToolbarButton.Events.Click,this._clear.bind(this));t.appendToolbarItem(this._clearButton);t.appendSeparator();const r=new UI.ToolbarButton(Common.UIString("Export..."),"largeicon-download");r.addEventListener(UI.ToolbarButton.Events.Click,()=>this._exportReport());t.appendToolbarItem(r);this._textFilterRegExp=null;t.appendSeparator();this._filterInput=new UI.ToolbarInput(Common.UIString("URL filter"),.4,1);this._filterInput.setEnabled(false);this._filterInput.addEventListener(UI.ToolbarInput.Event.TextChanged,this._onFilterChanged,this);t.appendToolbarItem(this._filterInput);t.appendSeparator();this._showContentScriptsSetting=Common.settings.createSetting("showContentScripts",false);this._showContentScriptsSetting.addChangeListener(this._onFilterChanged,this);const n=new UI.ToolbarSettingCheckbox(this._showContentScriptsSetting,Common.UIString("Include extension content scripts"),Common.UIString("Content scripts"));t.appendToolbarItem(n);this._coverageResultsElement=this.contentElement.createChild("div","coverage-results");this._landingPage=this._buildLandingPage();this._listView=new Coverage.CoverageListView(this._isVisible.bind(this,false));this._statusToolbarElement=this.contentElement.createChild("div","coverage-toolbar-summary");this._statusMessageElement=this._statusToolbarElement.createChild("div","coverage-message");this._landingPage.show(this._coverageResultsElement)}_buildLandingPage(){const e=UI.createInlineButton(UI.Toolbar.createActionButton(this._toggleRecordAction));const t=new UI.VBox;let o;if(this._startWithReloadButton){const t=UI.createInlineButton(UI.Toolbar.createActionButtonForId("coverage.start-with-reload"));o=UI.formatLocalized("Click the record button %s to start capturing coverage.\nClick the reload button %s to reload and start capturing coverage.",[e,t])}else{o=UI.formatLocalized("Click the record button %s to start capturing coverage.",[e])}o.classList.add("message");t.contentElement.appendChild(o);t.element.classList.add("landing-page");return t}_clear(){this._model=null;this._reset()}_reset(){if(this._decorationManager){this._decorationManager.dispose();this._decorationManager=null}this._listView.reset();this._listView.detach();this._landingPage.show(this._coverageResultsElement);this._statusMessageElement.textContent="";this._filterInput.setEnabled(false)}_toggleRecording(){const e=!this._toggleRecordAction.toggled();if(e)this._startRecording(false);else this._stopRecording()}_startRecording(e){this._reset();const t=SDK.targetManager.mainTarget();if(!t)return;if(!this._model||e)this._model=new Coverage.CoverageModel(t);Host.userMetrics.actionTaken(Host.UserMetrics.Action.CoverageStarted);if(!this._model.start())return;this._resourceTreeModel=t.model(SDK.ResourceTreeModel);if(this._resourceTreeModel){this._resourceTreeModel.addEventListener(SDK.ResourceTreeModel.Events.MainFrameNavigated,this._onMainFrameNavigated,this)}this._decorationManager=new Coverage.CoverageDecorationManager(this._model);this._toggleRecordAction.setToggled(true);this._clearButton.setEnabled(false);if(this._startWithReloadButton)this._startWithReloadButton.setEnabled(false);this._filterInput.setEnabled(true);if(this._landingPage.isShowing())this._landingPage.detach();this._listView.show(this._coverageResultsElement);if(e&&this._resourceTreeModel)this._resourceTreeModel.reloadPage();else this._poll()}async _poll(){delete this._pollTimer;const e=await this._model.poll();this._updateViews(e);this._pollTimer=setTimeout(()=>this._poll(),700)}async _stopRecording(){if(this._pollTimer){clearTimeout(this._pollTimer);delete this._pollTimer}if(this._resourceTreeModel){this._resourceTreeModel.removeEventListener(SDK.ResourceTreeModel.Events.MainFrameNavigated,this._onMainFrameNavigated,this);this._resourceTreeModel=null}const e=await this._model.stop();this._updateViews(e);this._toggleRecordAction.setToggled(false);if(this._startWithReloadButton)this._startWithReloadButton.setEnabled(true);this._clearButton.setEnabled(true)}_onMainFrameNavigated(){this._model.reset();this._decorationManager.reset();this._listView.reset();this._poll()}async _updateViews(e){this._updateStats();this._listView.update(this._model.entries());this._decorationManager.update(e)}_updateStats(){let e=0;let t=0;for(const o of this._model.entries()){if(!this._isVisible(true,o))continue;e+=o.size();t+=o.unusedSize()}const o=e?Math.round(100*t/e):0;this._statusMessageElement.textContent=Common.UIString("%s of %s bytes are not used. (%d%%)",Number.bytesToString(t),Number.bytesToString(e),o)}_onFilterChanged(){if(!this._listView)return;const e=this._filterInput.value();this._textFilterRegExp=e?createPlainTextSearchRegex(e,"i"):null;this._listView.updateFilterAndHighlight(this._textFilterRegExp);this._updateStats()}_isVisible(e,t){const o=t.url();if(o.startsWith(Coverage.CoverageView._extensionBindingsURLPrefix))return false;if(t.isContentScript()&&!this._showContentScriptsSetting.get())return false;return e||!this._textFilterRegExp||this._textFilterRegExp.test(o)}async _exportReport(){const e=new Bindings.FileOutputStream;const t=`Coverage-${(new Date).toISO8601Compact()}.json`;const o=await e.open(t);if(!o)return;this._model.exportReport(e)}};Coverage.CoverageView._extensionBindingsURLPrefix="extensions::";Coverage.CoverageView.ActionDelegate=class{handleAction(e,t){const o="coverage";UI.viewManager.showView(o).then(()=>UI.viewManager.view(o).widget()).then(e=>this._innerHandleAction(e,t));return true}_innerHandleAction(e,t){switch(t){case"coverage.toggle-recording":e._toggleRecording();break;case"coverage.start-with-reload":e._startRecording(true);break;default:console.assert(false,`Unknown action: ${t}`)}}};Coverage.RawLocation;Coverage.CoverageDecorationManager=class{constructor(e){this._coverageModel=e;this._textByProvider=new Map;this._uiSourceCodeByContentProvider=new Multimap;this._documentUISouceCodeToStylesheets=new WeakMap;for(const e of Workspace.workspace.uiSourceCodes())e.addLineDecoration(0,Coverage.CoverageDecorationManager._decoratorType,this);Workspace.workspace.addEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._onUISourceCodeAdded,this)}reset(){for(const e of Workspace.workspace.uiSourceCodes())e.removeDecorationsForType(Coverage.CoverageDecorationManager._decoratorType)}dispose(){this.reset();Workspace.workspace.removeEventListener(Workspace.Workspace.Events.UISourceCodeAdded,this._onUISourceCodeAdded,this)}update(e){for(const t of e){for(const e of this._uiSourceCodeByContentProvider.get(t.contentProvider())){e.removeDecorationsForType(Coverage.CoverageDecorationManager._decoratorType);e.addLineDecoration(0,Coverage.CoverageDecorationManager._decoratorType,this)}}}async usageByLine(e){const t=[];const o=new TextUtils.Text(e.content()||"");await this._updateTexts(e,o);const r=o.lineEndings();for(let n=0;n<o.lineCount();++n){const o=r[n]-(n?r[n-1]:0)-1;if(!o){t.push(undefined);continue}const i=this._rawLocationsForSourceLocation(e,n,0);const s=this._rawLocationsForSourceLocation(e,n,o);let a=undefined;for(let e=0,t=0;e<i.length;++e){const o=i[e];while(t<s.length&&Coverage.CoverageDecorationManager._compareLocations(o,s[t])>=0)++t;if(t>=s.length||s[t].id!==o.id)continue;const r=s[t++];const n=this._textByProvider.get(r.contentProvider);if(!n)continue;const c=n.value();let l=Math.min(n.offsetFromPosition(o.line,o.column),c.length-1);let d=Math.min(n.offsetFromPosition(r.line,r.column),c.length-1);while(l<=d&&/\s/.test(c[l]))++l;while(l<=d&&/\s/.test(c[d]))--d;if(l<=d)a=this._coverageModel.usageForRange(r.contentProvider,l,d);if(a)break}t.push(a)}return t}_updateTexts(e,t){const o=[];for(let r=0;r<t.lineCount();++r){for(const t of this._rawLocationsForSourceLocation(e,r,0)){if(this._textByProvider.has(t.contentProvider))continue;this._textByProvider.set(t.contentProvider,null);this._uiSourceCodeByContentProvider.set(t.contentProvider,e);o.push(this._updateTextForProvider(t.contentProvider))}}return Promise.all(o)}async _updateTextForProvider(e){const t=await e.requestContent();this._textByProvider.set(e,new TextUtils.Text(t))}_rawLocationsForSourceLocation(e,t,o){const r=[];const n=e.contentType();if(n.hasScripts()){let s=Bindings.debuggerWorkspaceBinding.uiLocationToRawLocations(e,t,o);s=s.filter(e=>!!e.script());for(let e of s){const t=e.script();if(t.isInlineScript()&&n.isDocument()){if(i(t.lineOffset,t.columnOffset,e.lineNumber,e.columnNumber)>0||i(t.endLine,t.endColumn,e.lineNumber,e.columnNumber)<=0){e=null}else{e.lineNumber-=t.lineOffset;if(!e.lineNumber)e.columnNumber-=t.columnOffset}}if(e){r.push({id:`js:${e.scriptId}`,contentProvider:e.script(),line:e.lineNumber,column:e.columnNumber})}}}if(n.isStyleSheet()||n.isDocument()){const i=n.isDocument()?this._documentUILocationToCSSRawLocations(e,t,o):Bindings.cssWorkspaceBinding.uiLocationToRawLocations(new Workspace.UILocation(e,t,o));for(const e of i){const t=e.header();if(!t)continue;if(t.isInline&&n.isDocument()){e.lineNumber-=t.startLine;if(!e.lineNumber)e.columnNumber-=t.startColumn}r.push({id:`css:${e.styleSheetId}`,contentProvider:e.header(),line:e.lineNumber,column:e.columnNumber})}}r.sort(Coverage.CoverageDecorationManager._compareLocations);function i(e,t,o,r){return e-o||t-r}return r}_documentUILocationToCSSRawLocations(e,t,o){let r=this._documentUISouceCodeToStylesheets.get(e);if(!r){r=[];const t=this._coverageModel.target().model(SDK.CSSModel);if(!t)return[];for(const o of t.styleSheetIdsForURL(e.url())){const e=t.styleSheetHeaderForId(o);if(e)r.push(e)}r.sort(a);this._documentUISouceCodeToStylesheets.set(e,r)}const n=r.upperBound(undefined,(e,r)=>t-r.startLine||o-r.startColumn);if(!n)return[];const i=[];const s=r[n-1];for(let e=n-1;e>=0&&r[e].startLine===s.startLine&&r[e].startColumn===s.startColumn;--e)i.push(new SDK.CSSLocation(r[e],t,o));return i;function a(e,t){return e.startLine-t.startLine||e.startColumn-t.startColumn||e.id.localeCompare(t.id)}}static _compareLocations(e,t){return e.id.localeCompare(t.id)||e.line-t.line||e.column-t.column}_onUISourceCodeAdded(e){const t=e.data;t.addLineDecoration(0,Coverage.CoverageDecorationManager._decoratorType,this)}};Coverage.CoverageDecorationManager._decoratorType="coverage";Coverage.CoverageView.LineDecorator=class{decorate(e,t){const o=e.decorationsForType(Coverage.CoverageDecorationManager._decoratorType);if(!o||!o.size){t.uninstallGutter(Coverage.CoverageView.LineDecorator._gutterType);return}const r=o.values().next().value.data();r.usageByLine(e).then(e=>{t.operation(()=>this._innerDecorate(t,e))})}_innerDecorate(e,t){const o=Coverage.CoverageView.LineDecorator._gutterType;e.uninstallGutter(o);e.installGutter(o,false);for(let r=0;r<t.length;++r){if(typeof t[r]!=="boolean")continue;const n=t[r]?"text-editor-coverage-used-marker":"text-editor-coverage-unused-marker";e.setGutterDecoration(r,o,createElementWithClass("div",n))}}};Coverage.CoverageView.LineDecorator._gutterType="CodeMirror-gutter-coverage";Runtime.cachedResources["coverage/coverageListView.css"]=".data-grid {\n  border: none;\n}\n\n.data-grid td .url-outer {\n  width: 100%;\n  display: inline-flex;\n  justify-content: flex-start;\n}\n\n.data-grid td .url-outer .filter-highlight {\n  font-weight: bold;\n}\n\n.data-grid td .url-prefix {\n  overflow-x: hidden;\n  text-overflow: ellipsis;\n}\n\n.data-grid td .url-suffix {\n  flex: none;\n}\n\n.data-grid td .bar {\n  display: inline-block;\n  height: 8px;\n}\n\n.data-grid .selected td .bar {\n  border-top: 1px white solid;\n  border-bottom: 1px white solid;\n}\n\n.data-grid .selected td .bar:last-child {\n  border-right: 1px white solid;\n}\n\n.data-grid .selected td .bar:first-child {\n  border-left: 1px white solid;\n}\n\n.data-grid td .bar-container {\n}\n\n.data-grid td .bar-unused-size {\n  background-color: #E57373;\n}\n\n.data-grid td .bar-used-size {\n  background-color: #81C784;\n}\n\n.data-grid td .percent-value {\n  color: #888;\n  width: 45px;\n  display: inline-block;\n}\n\n.data-grid:focus tr.selected span.percent-value {\n  color: #eee;\n}\n";Runtime.cachedResources["coverage/coverageView.css"]="/*\n * Copyright (c) 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    overflow: hidden;\n}\n\n.coverage-toolbar-container {\n    display: flex;\n    border-bottom: 1px solid #ccc;\n    flex: 0 0 auto;\n}\n\n.coverage-toolbar {\n    display: inline-block;\n}\n\n.coverage-toolbar-summary {\n    background-color: #eee;\n    border-top: 1px solid #ccc;\n    padding-left: 5px;\n    flex: 0 0 19px;\n    display: flex;\n    padding-right: 5px;\n}\n\n.coverage-toolbar-summary .coverage-message {\n    padding-top: 2px;\n    padding-left: 1ex;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n}\n\n.coverage-results {\n    overflow-y: auto;\n    display: flex;\n    flex: auto;\n}\n\n.landing-page {\n    justify-content: center;\n    align-items:  center;\n    padding: 20px;\n}\n\n.landing-page .message {\n    white-space: pre-line;\n}\n";