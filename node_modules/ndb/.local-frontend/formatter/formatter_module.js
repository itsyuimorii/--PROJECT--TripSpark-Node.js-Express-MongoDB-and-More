self["Formatter"]=self["Formatter"]||{};Formatter.FormatterWorkerPool=class{constructor(){this._taskQueue=[];this._workerTasks=new Map}_createWorker(){const t=new Common.Worker("formatter_worker");t.onmessage=this._onWorkerMessage.bind(this,t);t.onerror=this._onWorkerError.bind(this,t);return t}_processNextTask(){if(!this._taskQueue.length)return;let t=this._workerTasks.keysArray().find(t=>!this._workerTasks.get(t));if(!t&&this._workerTasks.size<Formatter.FormatterWorkerPool.MaxWorkers)t=this._createWorker();if(!t)return;const r=this._taskQueue.shift();this._workerTasks.set(t,r);t.postMessage({method:r.method,params:r.params})}_onWorkerMessage(t,r){const e=this._workerTasks.get(t);if(e.isChunked&&r.data&&!r.data["isLastChunk"]){e.callback(r.data);return}this._workerTasks.set(t,null);this._processNextTask();e.callback(r.data?r.data:null)}_onWorkerError(t,r){console.error(r);const e=this._workerTasks.get(t);t.terminate();this._workerTasks.delete(t);const o=this._createWorker();this._workerTasks.set(o,null);this._processNextTask();e.callback(null)}_runChunkedTask(t,r,e){const o=new Formatter.FormatterWorkerPool.Task(t,r,n,true);this._taskQueue.push(o);this._processNextTask();function n(t){if(!t){e(true,null);return}const r=!!t["isLastChunk"];const o=t["chunk"];e(r,o)}}_runTask(t,r){let e;const o=new Promise(t=>e=t);const n=new Formatter.FormatterWorkerPool.Task(t,r,e,false);this._taskQueue.push(n);this._processNextTask();return o}parseJSONRelaxed(t){return this._runTask("parseJSONRelaxed",{content:t})}parseSCSS(t){return this._runTask("parseSCSS",{content:t}).then(t=>t||[])}format(t,r,e){const o={mimeType:t,content:r,indentString:e};return this._runTask("format",o)}javaScriptIdentifiers(t){return this._runTask("javaScriptIdentifiers",{content:t}).then(t=>t||[])}evaluatableJavaScriptSubstring(t){return this._runTask("evaluatableJavaScriptSubstring",{content:t}).then(t=>t||"")}preprocessTopLevelAwaitExpressions(t){return this._runTask("preprocessTopLevelAwaitExpressions",{content:t}).then(t=>t||"")}parseCSS(t,r){this._runChunkedTask("parseCSS",{content:t},e);function e(t,e){const o=e||[];r(t,o)}}javaScriptOutline(t,r){this._runChunkedTask("javaScriptOutline",{content:t},e);function e(t,e){const o=e||[];r(t,o)}}outlineForMimetype(t,r,e){switch(r){case"text/html":case"text/javascript":this.javaScriptOutline(t,o);return true;case"text/css":this.parseCSS(t,n);return true}return false;function o(t,r){e(t,r.map(t=>({line:t.line,column:t.column,title:t.name,subtitle:t.arguments})))}function n(t,r){e(t,r.map(t=>({line:t.lineNumber,column:t.columnNumber,title:t.selectorText||t.atRule})))}}findLastExpression(t){return this._runTask("findLastExpression",{content:t})}findLastFunctionCall(t){return this._runTask("findLastFunctionCall",{content:t})}argumentsList(t){return this._runTask("argumentsList",{content:t})}};Formatter.FormatterWorkerPool.MaxWorkers=2;Formatter.FormatterWorkerPool.Task=class{constructor(t,r,e,o){this.method=t;this.params=r;this.callback=e;this.isChunked=o}};Formatter.FormatterWorkerPool.FormatResult=class{constructor(){this.content;this.mapping}};Formatter.FormatterWorkerPool.FormatMapping;Formatter.FormatterWorkerPool.OutlineItem;Formatter.FormatterWorkerPool.JSOutlineItem=class{constructor(){this.name;this.arguments;this.line;this.column}};Formatter.FormatterWorkerPool.TextRange;Formatter.FormatterWorkerPool.CSSProperty=class{constructor(){this.name;this.nameRange;this.value;this.valueRange;this.range;this.disabled}};Formatter.FormatterWorkerPool.CSSStyleRule=class{constructor(){this.selectorText;this.styleRange;this.lineNumber;this.columnNumber;this.properties}};Formatter.FormatterWorkerPool.CSSAtRule;Formatter.FormatterWorkerPool.CSSRule;Formatter.FormatterWorkerPool.SCSSProperty=class{constructor(){this.range;this.name;this.value;this.disabled}};Formatter.FormatterWorkerPool.SCSSRule=class{constructor(){this.selectors;this.properties;this.styleRange}};Formatter.formatterWorkerPool=function(){if(!Formatter._formatterWorkerPool)Formatter._formatterWorkerPool=new Formatter.FormatterWorkerPool;return Formatter._formatterWorkerPool};Formatter.Formatter=function(){};Formatter.Formatter.format=function(t,r,e,o){if(t.isDocumentOrScriptOrStyleSheet())new Formatter.ScriptFormatter(r,e,o);else new Formatter.ScriptIdentityFormatter(r,e,o)};Formatter.Formatter.locationToPosition=function(t,r,e){const o=r?t[r-1]+1:0;return o+e};Formatter.Formatter.positionToLocation=function(t,r){const e=t.upperBound(r-1);let o;if(!e)o=r;else o=r-t[e-1]-1;return[e,o]};Formatter.ScriptFormatter=class{constructor(t,r,e){r=r.replace(/\r\n?|[\n\u2028\u2029]/g,"\n").replace(/^\uFEFF/,"");this._callback=e;this._originalContent=r;Formatter.formatterWorkerPool().format(t,r,Common.moduleSetting("textEditorIndent").get()).then(this._didFormatContent.bind(this))}_didFormatContent(t){const r=new Formatter.FormatterSourceMappingImpl(this._originalContent.computeLineEndings(),t.content.computeLineEndings(),t.mapping);this._callback(t.content,r)}};Formatter.ScriptIdentityFormatter=class{constructor(t,r,e){e(r,new Formatter.IdentityFormatterSourceMapping)}};Formatter.FormatterSourceMapping=function(){};Formatter.FormatterSourceMapping.prototype={originalToFormatted(t,r){},formattedToOriginal(t,r){}};Formatter.IdentityFormatterSourceMapping=class{originalToFormatted(t,r){return[t,r||0]}formattedToOriginal(t,r){return[t,r||0]}};Formatter.FormatterSourceMappingImpl=class{constructor(t,r,e){this._originalLineEndings=t;this._formattedLineEndings=r;this._mapping=e}originalToFormatted(t,r){const e=Formatter.Formatter.locationToPosition(this._originalLineEndings,t,r||0);const o=this._convertPosition(this._mapping.original,this._mapping.formatted,e||0);return Formatter.Formatter.positionToLocation(this._formattedLineEndings,o)}formattedToOriginal(t,r){const e=Formatter.Formatter.locationToPosition(this._formattedLineEndings,t,r||0);const o=this._convertPosition(this._mapping.formatted,this._mapping.original,e);return Formatter.Formatter.positionToLocation(this._originalLineEndings,o||0)}_convertPosition(t,r,e){const o=t.upperBound(e)-1;let n=r[o]+e-t[o];if(o<r.length-1&&n>r[o+1])n=r[o+1];return n}};