self["ProductRegistry"]=self["ProductRegistry"]||{};ProductRegistry.BadgePool=class{constructor(e){this._showTitles=false;this._badgeElements=new Map;if(!e){this._setting=Common.settings.moduleSetting("product_registry.badges-visible");this._setting.addChangeListener(this._settingUpdated.bind(this));if(this._setting.get())Host.userMetrics.actionTaken(Host.UserMetrics.Action.ShowedThirdPartyBadges)}}setShowTitles(e){this._showTitles=e}badgeForFrame(e){return this._badgeForFrameOrUrl(this._resolveUrl.bind(this,e))}badgeForURL(e){return this._badgeForFrameOrUrl(()=>Promise.resolve(e))}reset(){this._badgeElements.clear()}_badgeForFrameOrUrl(e){const t=createElementWithClass("span","hidden");const r=UI.createShadowRootWithCoreStyles(t,"product_registry/badge.css");const n=r.createChild("span");n.classList.toggle("hide-badge-title",!this._showTitles);n.addEventListener("mousedown",e=>e.consume());n.addEventListener("click",e=>{this._showPopup(n);e.consume()},false);this._badgeElements.set(n,e);this._renderBadge(n);return t}async _resolveUrl(e){const t=await ProductRegistry.instance();let r=new Common.ParsedURL(e.url);const n=t.entryForUrl(r);if(!n){e.findCreationCallFrame(e=>{if(!e.url)return false;r=new Common.ParsedURL(e.url);return!!t.entryForUrl(r)})}return r}async _renderBadge(e){if(e.children.length||!this._isVisible(e)){this._updateBadgeElementVisibility(e);return}const t=await this._badgeElements.get(e)();const r=await ProductRegistry.instance();const n=t&&r.nameForUrl(t);if(!n)return;const o=n.replace(/[a-z]*/g,"").split(" ");let s;if(o.length>1)s=o[0][0]+o[1][0];else s=n;const i=e.createChild("span","product-registry-badge monospace");i.setAttribute("data-initial",s.substring(0,2).toUpperCase());i.title=n;i.style.backgroundColor=ProductRegistry.BadgePool.colorForEntryName(n);e.createChild("span","product-registry-badge-title").textContent=n;this._updateBadgeElementVisibility(e)}_settingUpdated(){for(const e of this._badgeElements.keys())this._renderBadge(e)}_isVisible(e){return!this._setting||this._setting.get()}_updateBadgeElementVisibility(e){e.parentNodeOrShadowHost().parentNodeOrShadowHost().classList.toggle("hidden",!this._isVisible(e))}async _showPopup(e){if(!this._badgeElements.has(e))return;const t=await ProductRegistry.instance();const r=await this._badgeElements.get(e)();const n=t.nameForUrl(r);const o=createElement("div");const s=UI.createShadowRootWithCoreStyles(o,"product_registry/popup.css");const i=s.createChild("div","product-registry-popup");const a=i.createChild("div","product-registry-domain");a.textContent=r.domain();const d=i.createChild("div","product-registry-name");d.textContent=n;const c="https://docs.google.com/forms/d/e/1FAIpQLSchz2FdcQ-rRllzl8BbhWaTRRY-12BpPjW6Hr9e1-BpCA083w/viewform"+"?entry_1425918171="+encodeURIComponent((r.domain()+r.path).substr(0,100));i.appendChild(UI.XLink.create(c,"Report mismatch","product-registry-link"));const l=new UI.Dialog;l.setContentAnchorBox(e.boxInWindow());l.contentElement.appendChild(o);l.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);l.setAnchorBehavior(UI.GlassPane.AnchorBehavior.PreferTop);l.addCloseButton();l.show(e.ownerDocument)}static colorForEntryName(e){if(!ProductRegistry.BadgePool._colorGenerator){ProductRegistry.BadgePool._colorGenerator=new Common.Color.Generator({min:30,max:330},{min:50,max:80,count:3},80)}return ProductRegistry.BadgePool._colorGenerator.colorForID(e)}};ProductRegistry.instance=function(){const e=self.runtime.extension(ProductRegistry.Registry);if(e)return e.instance();return Promise.resolve(self.singleton(ProductRegistry.RegistryStub))};ProductRegistry.Registry=function(){};ProductRegistry.Registry.prototype={nameForUrl:function(e){},entryForUrl:function(e){},typeForUrl:function(e){}};ProductRegistry.RegistryStub=class{nameForUrl(e){return null}entryForUrl(e){return null}typeForUrl(e){return null}};ProductRegistry.Registry.ProductEntry;Runtime.cachedResources["product_registry/badge.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.product-registry-badge {\n  background-color: rgba(0, 0, 0, 0.2);\n  border-radius: 2px;\n  padding: 1px 2px;\n  white-space: pre;\n  cursor: pointer;\n}\n\n.product-registry-badge::before {\n  content: attr(data-initial);\n  color: #222;\n}\n\n.hide-badge-title .product-registry-badge-title {\n  display: none;\n}\n\n.product-registry-badge-title {\n  padding-left: 4px;\n}";Runtime.cachedResources["product_registry/popup.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.product-registry-popup {\n    background-color: white;\n    padding: 15px 45px 15px 15px;\n    border-radius: 4px;\n    white-space: nowrap;\n    box-shadow: 0px 1px 2px 0px gray;\n}\n\n.product-registry-domain {\n    font-weight: bold;\n}\n\n.product-registry-name {\n    padding: 10px 0;\n}\n\n.product-registry-link {\n    display: block;\n}\n\ndiv[is=dt-close-button] {\n  position: absolute;\n  top: 5px;\n  right: 5px;\n}\n";