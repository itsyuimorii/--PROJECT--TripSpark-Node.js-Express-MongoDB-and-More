self["Snippets"]=self["Snippets"]||{};Snippets.SnippetFileSystem=class extends Persistence.PlatformFileSystem{constructor(){super("snippet://","snippets");this._lastSnippetIdentifierSetting=Common.settings.createSetting("scriptSnippets_lastIdentifier",0);this._snippetsSetting=Common.settings.createSetting("scriptSnippets",[])}initialFilePaths(){const e=this._snippetsSetting.get();return e.map(e=>escape(e.name))}async createFile(e,t){const s=this._lastSnippetIdentifierSetting.get()+1;this._lastSnippetIdentifierSetting.set(s);const n=`Script snippet #${s}`;const i=this._snippetsSetting.get();i.push({name:n,content:""});this._snippetsSetting.set(i);return escape(n)}async deleteFile(e){const t=unescape(e.substring(1));const s=this._snippetsSetting.get();const n=s.filter(e=>e.name!==t);if(s.length!==n.length){this._snippetsSetting.set(n);return true}return false}requestFileContent(e,t){const s=unescape(e.substring(1));const n=this._snippetsSetting.get().find(e=>e.name===s);t(n?n.content:null,false)}async setFileContent(e,t,s){const n=unescape(e.substring(1));const i=this._snippetsSetting.get();const p=i.find(e=>e.name===n);if(p){p.content=t;this._snippetsSetting.set(i);return true}return false}renameFile(e,t,s){const n=unescape(e.substring(1));const i=this._snippetsSetting.get();const p=i.find(e=>e.name===n);t=t.trim();if(!p||t.length===0||i.find(e=>e.name===t)){s(false);return}p.name=t;this._snippetsSetting.set(i);s(true,t)}async searchInPath(e,t){const s=new RegExp(e.escapeForRegExp(),"i");const n=this._snippetsSetting.get().filter(e=>e.content.match(s));return n.map(e=>escape(e.name))}mimeFromPath(e){return"text/javascript"}contentType(e){return Common.resourceTypes.Script}tooltipForURL(e){return ls`Linked to ${unescape(e.substring(this.path().length))}`}supportsAutomapping(){return true}};Snippets.evaluateScriptSnippet=async function(e){if(!e.url().startsWith("snippet://"))return;const t=UI.context.flavor(SDK.ExecutionContext);if(!t)return;const s=t.runtimeModel;await e.requestContent();e.commitWorkingCopy();const n=e.workingCopy();Common.console.show();const i=e.url();const p=await t.evaluate({expression:`${n}\n//# sourceURL=${i}`,objectGroup:"console",silent:false,includeCommandLineAPI:true,returnByValue:false,generatePreview:true},false,true);if(p.exceptionDetails){SDK.consoleModel.addMessage(SDK.ConsoleMessage.fromException(s,p.exceptionDetails,undefined,undefined,i));return}if(!p.object)return;const r=t.debuggerModel.scriptsForSourceURL(i);const o=r[r.length-1].scriptId;SDK.consoleModel.addMessage(new SDK.ConsoleMessage(s,SDK.ConsoleMessage.MessageSource.JS,SDK.ConsoleMessage.MessageLevel.Info,"",SDK.ConsoleMessage.MessageType.Result,i,undefined,undefined,[p.object],undefined,undefined,t.id,o))};Snippets.isSnippetsUISourceCode=function(e){return e.url().startsWith("snippet://")};Snippets.isSnippetsProject=function(e){return e.type()===Workspace.projectTypes.FileSystem&&Persistence.FileSystemWorkspaceBinding.fileSystemType(e)==="snippets"};Persistence.isolatedFileSystemManager.addPlatformFileSystem("snippet://",new Snippets.SnippetFileSystem);Snippets.project=Workspace.workspace.projectsForType(Workspace.projectTypes.FileSystem).find(e=>Persistence.FileSystemWorkspaceBinding.fileSystemType(e)==="snippets");Snippets.SnippetsQuickOpen=class extends QuickOpen.FilteredListWidget.Provider{constructor(){super();this._snippets=[]}selectItem(e,t){if(e===null)return;Snippets.evaluateScriptSnippet(this._snippets[e])}notFoundText(e){return Common.UIString("No snippets found.")}attach(){this._snippets=Snippets.project.uiSourceCodes()}detach(){this._snippets=[]}itemCount(){return this._snippets.length}itemKeyAt(e){return this._snippets[e].name()}renderItem(e,t,s,n){s.textContent=unescape(this._snippets[e].name());s.classList.add("monospace");QuickOpen.FilteredListWidget.highlightRanges(s,t,true)}};