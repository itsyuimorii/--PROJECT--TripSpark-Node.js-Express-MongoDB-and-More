self["Console"]=self["Console"]||{};Console.ConsoleContextSelector=class{constructor(){this._items=new UI.ListModel;this._dropDown=new UI.SoftDropDown(this._items,this);this._dropDown.setRowHeight(36);this._toolbarItem=new UI.ToolbarItem(this._dropDown.element);this._toolbarItem.setEnabled(false);this._toolbarItem.setTitle(ls`JavaScript contexts`);this._items.addEventListener(UI.ListModel.Events.ItemsReplaced,()=>this._toolbarItem.setEnabled(!!this._items.length));this._badgePoolForExecutionContext=new Map;this._toolbarItem.element.classList.add("toolbar-has-dropdown");SDK.targetManager.addModelListener(SDK.RuntimeModel,SDK.RuntimeModel.Events.ExecutionContextCreated,this._onExecutionContextCreated,this);SDK.targetManager.addModelListener(SDK.RuntimeModel,SDK.RuntimeModel.Events.ExecutionContextChanged,this._onExecutionContextChanged,this);SDK.targetManager.addModelListener(SDK.RuntimeModel,SDK.RuntimeModel.Events.ExecutionContextDestroyed,this._onExecutionContextDestroyed,this);SDK.targetManager.addModelListener(SDK.ResourceTreeModel,SDK.ResourceTreeModel.Events.FrameNavigated,this._frameNavigated,this);UI.context.addFlavorChangeListener(SDK.ExecutionContext,this._executionContextChangedExternally,this);UI.context.addFlavorChangeListener(SDK.DebuggerModel.CallFrame,this._callFrameSelectedInUI,this);SDK.targetManager.observeModels(SDK.RuntimeModel,this);SDK.targetManager.addModelListener(SDK.DebuggerModel,SDK.DebuggerModel.Events.CallFrameSelected,this._callFrameSelectedInModel,this)}toolbarItem(){return this._toolbarItem}highlightedItemChanged(e,t,s,n){SDK.OverlayModel.hideDOMNodeHighlight();if(t&&t.frameId){const e=t.target().model(SDK.OverlayModel);if(e)e.highlightFrame(t.frameId)}if(s)s.classList.remove("highlighted");if(n)n.classList.add("highlighted")}titleFor(e){const t=e.target();let s=e.label()?t.decorateLabel(e.label()):"";if(e.frameId){const n=t.model(SDK.ResourceTreeModel);const o=n&&n.frameForId(e.frameId);if(o)s=s||o.displayName()}s=s||e.origin;return s}_depthFor(e){let t=e.target();let s=0;if(!e.isDefault)s++;if(e.frameId){const n=t.model(SDK.ResourceTreeModel);let o=n&&n.frameForId(e.frameId);while(o){o=o.parentFrame||o.crossTargetParentFrame();if(o){s++;t=o.resourceTreeModel().target()}}}let n=0;while(t.parentTarget()){if(t.parentTarget().type()===SDK.Target.Type.ServiceWorker){n=0;break}n++;t=t.parentTarget()}s+=n;return s}_badgeFor(e){if(!e.frameId||!e.isDefault)return null;const t=e.target().model(SDK.ResourceTreeModel);const s=t&&t.frameForId(e.frameId);if(!s)return null;const n=new ProductRegistry.BadgePool;this._badgePoolForExecutionContext.set(e,n);return n.badgeForFrame(s)}_disposeExecutionContextBadge(e){const t=this._badgePoolForExecutionContext.get(e);if(!t)return;t.reset();this._badgePoolForExecutionContext.delete(e)}_executionContextCreated(e){if(e.target().type()===SDK.Target.Type.ServiceWorker)return;this._items.insertWithComparator(e,e.runtimeModel.executionContextComparator());if(e===UI.context.flavor(SDK.ExecutionContext))this._dropDown.selectItem(e)}_onExecutionContextCreated(e){const t=e.data;this._executionContextCreated(t)}_onExecutionContextChanged(e){const t=e.data;if(this._items.indexOf(t)===-1)return;this._executionContextDestroyed(t);this._executionContextCreated(t)}_executionContextDestroyed(e){const t=this._items.indexOf(e);if(t===-1)return;this._disposeExecutionContextBadge(e);this._items.remove(t)}_onExecutionContextDestroyed(e){const t=e.data;this._executionContextDestroyed(t)}_executionContextChangedExternally(e){const t=e.data;this._dropDown.selectItem(t)}_isTopContext(e){if(!e||!e.isDefault)return false;const t=e.target().model(SDK.ResourceTreeModel);const s=e.frameId&&t&&t.frameForId(e.frameId);if(!s)return false;return s.isTopFrame()}_hasTopContext(){return this._items.some(e=>this._isTopContext(e))}modelAdded(e){e.executionContexts().forEach(this._executionContextCreated,this)}modelRemoved(e){for(let t=this._items.length-1;t>=0;t--){if(this._items.at(t).runtimeModel===e)this._executionContextDestroyed(this._items.at(t))}}createElementForItem(e){const t=createElementWithClass("div");const s=UI.createShadowRootWithCoreStyles(t,"console/consoleContextSelector.css");const n=s.createChild("div","title");n.createTextChild(this.titleFor(e).trimEnd(100));const o=s.createChild("div","subtitle");const i=this._badgeFor(e);if(i){i.classList.add("badge");o.appendChild(i)}o.createTextChild(this._subtitleFor(e));t.style.paddingLeft=8+this._depthFor(e)*15+"px";return t}_subtitleFor(e){const t=e.target();let s;if(e.frameId){const n=t.model(SDK.ResourceTreeModel);s=n&&n.frameForId(e.frameId)}if(e.origin.startsWith("chrome-extension://"))return Common.UIString("Extension");if(!s||!s.parentFrame||s.parentFrame.securityOrigin!==e.origin){const t=e.origin.asParsedURL();if(t)return t.domain()}if(s){const e=s.findCreationCallFrame(e=>!!e.url);if(e)return new Common.ParsedURL(e.url).domain();return Common.UIString("IFrame")}return""}isItemSelectable(e){const t=e.debuggerModel.selectedCallFrame();const s=t&&t.script.executionContext();return!s||e===s}itemSelected(e){this._toolbarItem.element.classList.toggle("warning",!this._isTopContext(e)&&this._hasTopContext());UI.context.setFlavor(SDK.ExecutionContext,e)}_callFrameSelectedInUI(){const e=UI.context.flavor(SDK.DebuggerModel.CallFrame);const t=e&&e.script.executionContext();if(t)UI.context.setFlavor(SDK.ExecutionContext,t)}_callFrameSelectedInModel(e){const t=e.data;for(const e of this._items){if(e.debuggerModel===t){this._disposeExecutionContextBadge(e);this._dropDown.refreshItem(e)}}}_frameNavigated(e){const t=e.data;const s=t.resourceTreeModel().target().model(SDK.RuntimeModel);if(!s)return;for(const e of s.executionContexts()){if(t.id===e.frameId){this._disposeExecutionContextBadge(e);this._dropDown.refreshItem(e)}}}};Console.ConsoleFilter=class{constructor(e,t,s,n){this.name=e;this.parsedFilters=t;this.executionContext=s;this.levelsMask=n||Console.ConsoleFilter.defaultLevelsFilterValue()}static allLevelsFilterValue(){const e={};for(const t of Object.values(SDK.ConsoleMessage.MessageLevel))e[t]=true;return e}static defaultLevelsFilterValue(){const e=Console.ConsoleFilter.allLevelsFilterValue();e[SDK.ConsoleMessage.MessageLevel.Verbose]=false;return e}static singleLevelMask(e){const t={};t[e]=true;return t}clone(){const e=this.parsedFilters.map(TextUtils.FilterParser.cloneFilter);const t=Object.assign({},this.levelsMask);return new Console.ConsoleFilter(this.name,e,this.executionContext,t)}shouldBeVisible(e){const t=e.consoleMessage();if(this.executionContext&&(this.executionContext.runtimeModel!==t.runtimeModel()||this.executionContext.id!==t.executionContextId))return false;if(t.type===SDK.ConsoleMessage.MessageType.Command||t.type===SDK.ConsoleMessage.MessageType.Result||t.isGroupMessage())return true;if(t.level&&!this.levelsMask[t.level])return false;for(const n of this.parsedFilters){if(!n.key){if(n.regex&&e.matchesFilterRegex(n.regex)===n.negative)return false;if(n.text&&e.matchesFilterText(n.text)===n.negative)return false}else{switch(n.key){case Console.ConsoleFilter.FilterType.Context:if(!s(n,t.context,false))return false;break;case Console.ConsoleFilter.FilterType.Source:const e=t.source?SDK.ConsoleMessage.MessageSourceDisplayName.get(t.source):t.source;if(!s(n,e,true))return false;break;case Console.ConsoleFilter.FilterType.Url:if(!s(n,t.url,false))return false;break}}}return true;function s(e,t,s){if(!e.text)return!!t===e.negative;if(!t)return!e.text===!e.negative;const n=e.text.toLowerCase();const o=t.toLowerCase();if(s&&o===n===e.negative)return false;if(!s&&o.includes(n)===e.negative)return false;return true}}};Console.ConsoleFilter.FilterType={Context:"context",Source:"source",Url:"url"};Console.ConsolePinPane=class extends UI.ThrottledWidget{constructor(){super(true,250);this.registerRequiredCSS("console/consolePinPane.css");this.registerRequiredCSS("object_ui/objectValue.css");this.contentElement.classList.add("console-pins","monospace");this.contentElement.addEventListener("contextmenu",this._contextMenuEventFired.bind(this),false);this._pins=new Set;this._pinsSetting=Common.settings.createLocalSetting("consolePins",[]);for(const e of this._pinsSetting.get())this.addPin(e)}willHide(){for(const e of this._pins)e.setHovered(false)}_savePins(){const e=Array.from(this._pins).map(e=>e.expression());this._pinsSetting.set(e)}_contextMenuEventFired(e){const t=new UI.ContextMenu(e);const s=e.deepElementFromPoint();if(s){const e=s.enclosingNodeOrSelfWithClass("console-pin");if(e){const s=e[Console.ConsolePin._PinSymbol];t.editSection().appendItem(ls`Edit expression`,s.focus.bind(s));t.editSection().appendItem(ls`Remove expression`,this._removePin.bind(this,s));s.appendToContextMenu(t)}}t.editSection().appendItem(ls`Remove all expressions`,this._removeAllPins.bind(this));t.show()}_removeAllPins(){for(const e of this._pins)this._removePin(e)}_removePin(e){e.element().remove();this._pins.delete(e);this._savePins()}addPin(e,t){const s=new Console.ConsolePin(e,this);this.contentElement.appendChild(s.element());this._pins.add(s);this._savePins();if(t)s.focus();this.update()}doUpdate(){if(!this._pins.size||!this.isShowing())return Promise.resolve();if(this.isShowing())this.update();const e=Array.from(this._pins,e=>e.updatePreview());return Promise.all(e).then(this._updatedForTest.bind(this))}_updatedForTest(){}};Console.ConsolePin=class extends Common.Object{constructor(e,t){super();const s=UI.Icon.create("smallicon-cross","console-delete-pin");s.addEventListener("click",()=>t._removePin(this));s.addEventListener("keydown",e=>{if(isEnterKey(e)||e.key===" ")t._removePin(this)});s.tabIndex=0;UI.ARIAUtils.setAccessibleName(s,ls`Remove expression`);UI.ARIAUtils.markAsButton(s);const n=UI.Fragment.build`
    <div class='console-pin'>
      ${s}
      <div class='console-pin-name' $='name'></div>
      <div class='console-pin-preview' $='preview'>${ls`not available`}</div>
    </div>`;this._pinElement=n.element();this._pinPreview=n.$("preview");const o=n.$("name");o.title=e;this._pinElement[Console.ConsolePin._PinSymbol]=this;this._lastResult=null;this._lastExecutionContext=null;this._editor=null;this._committedExpression=e;this._hovered=false;this._lastNode=null;this._pinPreview.addEventListener("mouseenter",this.setHovered.bind(this,true),false);this._pinPreview.addEventListener("mouseleave",this.setHovered.bind(this,false),false);this._pinPreview.addEventListener("click",e=>{if(this._lastNode){Common.Revealer.reveal(this._lastNode);e.consume()}},false);this._editorPromise=self.runtime.extension(UI.TextEditorFactory).instance().then(s=>{this._editor=s.createEditor({devtoolsAccessibleName:ls`Live expression editor`,lineNumbers:false,lineWrapping:true,mimeType:"javascript",autoHeight:true,placeholder:ls`Expression`});this._editor.configureAutocomplete(ObjectUI.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor));this._editor.widget().show(o);this._editor.widget().element.classList.add("console-pin-editor");this._editor.widget().element.tabIndex=-1;this._editor.setText(e);this._editor.widget().element.addEventListener("keydown",e=>{if(e.key==="Tab"&&!this._editor.text()){e.consume();return}if(e.keyCode===UI.KeyboardShortcut.Keys.Esc.code)this._editor.setText(this._committedExpression)},true);this._editor.widget().element.addEventListener("focusout",e=>{const s=this._editor.text();const n=s.trim();if(s.length!==n.length)this._editor.setText(n);this._committedExpression=n;t._savePins();this._editor.setSelection(TextUtils.TextRange.createFromLocation(Infinity,Infinity))})})}setHovered(e){if(this._hovered===e)return;this._hovered=e;if(!e&&this._lastNode)SDK.OverlayModel.hideDOMNodeHighlight()}expression(){return this._committedExpression}element(){return this._pinElement}async focus(){await this._editorPromise;this._editor.widget().focus();this._editor.setSelection(TextUtils.TextRange.createFromLocation(Infinity,Infinity))}appendToContextMenu(e){if(this._lastResult&&this._lastResult.object){e.appendApplicableItems(this._lastResult.object);this._lastResult=null}}async updatePreview(){if(!this._editor)return;const e=this._editor.textWithCurrentSuggestion().trim();const t=this._pinElement.hasFocus();const s=t&&e!==this._committedExpression;const n=s?250:undefined;const o=UI.context.flavor(SDK.ExecutionContext);const{preview:i,result:r}=await ObjectUI.JavaScriptREPL.evaluateAndBuildPreview(e,s,n,!t,"console");if(this._lastResult&&this._lastExecutionContext)this._lastExecutionContext.runtimeModel.releaseEvaluationResult(this._lastResult);this._lastResult=r||null;this._lastExecutionContext=o||null;const l=i.deepTextContent();if(!l||l!==this._pinPreview.deepTextContent()){this._pinPreview.removeChildren();if(r&&SDK.RuntimeModel.isSideEffectFailure(r)){const e=this._pinPreview.createChild("span","object-value-calculate-value-button");e.textContent=`(...)`;e.title=ls`Evaluate, allowing side effects`}else if(l){this._pinPreview.appendChild(i)}else if(!t){this._pinPreview.createTextChild(ls`not available`)}this._pinPreview.title=l}let a=null;if(r&&r.object&&r.object.type==="object"&&r.object.subtype==="node")a=r.object;if(this._hovered){if(a)SDK.OverlayModel.highlightObjectAsDOMNode(a);else if(this._lastNode)SDK.OverlayModel.hideDOMNodeHighlight()}this._lastNode=a||null;const h=r&&r.exceptionDetails&&!SDK.RuntimeModel.isSideEffectFailure(r);this._pinElement.classList.toggle("error-level",h)}};Console.ConsolePin._PinSymbol=Symbol("pinSymbol");Console.ConsoleSidebar=class extends UI.VBox{constructor(e){super(true);this.setMinimumSize(125,0);this._tree=new UI.TreeOutlineInShadow;this._tree.registerRequiredCSS("console/consoleSidebar.css");this._tree.addEventListener(UI.TreeOutline.Events.ElementSelected,this._selectionChanged.bind(this));this.contentElement.appendChild(this._tree.element);this._selectedTreeElement=null;this._treeElements=[];const t=Common.settings.createSetting("console.sidebarSelectedFilter",null);const s=SDK.ConsoleMessage.MessageLevel;const n=[{key:Console.ConsoleFilter.FilterType.Source,text:SDK.ConsoleMessage.MessageSource.ConsoleAPI,negative:false}];this._appendGroup(Console.ConsoleSidebar._groupSingularName.All,[],Console.ConsoleFilter.allLevelsFilterValue(),UI.Icon.create("mediumicon-list"),e,t);this._appendGroup(Console.ConsoleSidebar._groupSingularName.ConsoleAPI,n,Console.ConsoleFilter.allLevelsFilterValue(),UI.Icon.create("mediumicon-account-circle"),e,t);this._appendGroup(Console.ConsoleSidebar._groupSingularName.Error,[],Console.ConsoleFilter.singleLevelMask(s.Error),UI.Icon.create("mediumicon-error-circle"),e,t);this._appendGroup(Console.ConsoleSidebar._groupSingularName.Warning,[],Console.ConsoleFilter.singleLevelMask(s.Warning),UI.Icon.create("mediumicon-warning-triangle"),e,t);this._appendGroup(Console.ConsoleSidebar._groupSingularName.Info,[],Console.ConsoleFilter.singleLevelMask(s.Info),UI.Icon.create("mediumicon-info-circle"),e,t);this._appendGroup(Console.ConsoleSidebar._groupSingularName.Verbose,[],Console.ConsoleFilter.singleLevelMask(s.Verbose),UI.Icon.create("mediumicon-bug"),e,t);const o=t.get();const i=this._treeElements.find(e=>e.name()===o)||this._treeElements[0];i.select()}_appendGroup(e,t,s,n,o,i){const r=new Console.ConsoleFilter(e,t,null,s);const l=new Console.ConsoleSidebar.FilterTreeElement(r,n,o,i);this._tree.appendChild(l);this._treeElements.push(l)}clear(){for(const e of this._treeElements)e.clear()}onMessageAdded(e){for(const t of this._treeElements)t.onMessageAdded(e)}shouldBeVisible(e){if(!this._selectedTreeElement)return true;return this._selectedTreeElement._filter.shouldBeVisible(e)}_selectionChanged(e){this._selectedTreeElement=e.data;this.dispatchEventToListeners(Console.ConsoleSidebar.Events.FilterSelected)}};Console.ConsoleSidebar.Events={FilterSelected:Symbol("FilterSelected")};Console.ConsoleSidebar.URLGroupTreeElement=class extends UI.TreeElement{constructor(e,t){super(e.name);this._filter=e;this._countElement=this.listItemElement.createChild("span","count");const s=[UI.Icon.create("largeicon-navigator-file")];if(t)s.push(t);this.setLeadingIcons(s);this._messageCount=0}incrementAndUpdateCounter(){this._messageCount++;this._countElement.textContent=this._messageCount}};Console.ConsoleSidebar.FilterTreeElement=class extends UI.TreeElement{constructor(e,t,s,n){super(e.name);this._filter=e;this._badgePool=s;this._selectedFilterSetting=n;this._urlTreeElements=new Map;this.setLeadingIcons([t]);this._messageCount=0;this._updateCounter()}clear(){this._urlTreeElements.clear();this.removeChildren();this._messageCount=0;this._updateCounter()}name(){return this._filter.name}onselect(e){this._selectedFilterSetting.set(this._filter.name);return super.onselect(e)}_updateCounter(){const e=this._messageCount?this._messageCount:Common.UIString("No");const t=this._messageCount===1?this._filter.name:Console.ConsoleSidebar._groupPluralNameMap.get(this._filter.name);this.title=`${e} ${t}`;this.setExpandable(!!this.childCount())}onMessageAdded(e){const t=e.consoleMessage();const s=t.type!==SDK.ConsoleMessage.MessageType.Command&&t.type!==SDK.ConsoleMessage.MessageType.Result&&!t.isGroupMessage();if(!this._filter.shouldBeVisible(e)||!s)return;const n=this._childElement(t.url);n.incrementAndUpdateCounter();this._messageCount++;this._updateCounter()}_childElement(e){const t=e||null;let s=this._urlTreeElements.get(t);if(s)return s;const n=this._filter.clone();const o=t?t.asParsedURL():null;if(t)n.name=o?o.displayName:t;else n.name=Common.UIString("<other>");n.parsedFilters.push({key:Console.ConsoleFilter.FilterType.Url,text:t,negative:false});const i=o?this._badgePool.badgeForURL(o):null;s=new Console.ConsoleSidebar.URLGroupTreeElement(n,i);if(t)s.tooltip=t;this._urlTreeElements.set(t,s);this.appendChild(s);return s}};Console.ConsoleSidebar._groupSingularName={ConsoleAPI:Common.UIString("user message"),All:Common.UIString("message"),Error:Common.UIString("error"),Warning:Common.UIString("warning"),Info:Common.UIString("info"),Verbose:Common.UIString("verbose")};Console.ConsoleSidebar._groupPluralNameMap=new Map([[Console.ConsoleSidebar._groupSingularName.ConsoleAPI,Common.UIString("user messages")],[Console.ConsoleSidebar._groupSingularName.All,Common.UIString("messages")],[Console.ConsoleSidebar._groupSingularName.Error,Common.UIString("errors")],[Console.ConsoleSidebar._groupSingularName.Warning,Common.UIString("warnings")],[Console.ConsoleSidebar._groupSingularName.Info,Common.UIString("info")],[Console.ConsoleSidebar._groupSingularName.Verbose,Common.UIString("verbose")]]);Console.ConsoleViewport=class{constructor(e){this.element=createElement("div");this.element.style.overflow="auto";this._topGapElement=this.element.createChild("div");this._topGapElement.style.height="0px";this._topGapElement.style.color="transparent";this._contentElement=this.element.createChild("div");this._bottomGapElement=this.element.createChild("div");this._bottomGapElement.style.height="0px";this._bottomGapElement.style.color="transparent";this._topGapElement.textContent="\ufeff";this._bottomGapElement.textContent="\ufeff";UI.ARIAUtils.markAsHidden(this._topGapElement);UI.ARIAUtils.markAsHidden(this._bottomGapElement);this._provider=e;this.element.addEventListener("scroll",this._onScroll.bind(this),false);this.element.addEventListener("copy",this._onCopy.bind(this),false);this.element.addEventListener("dragstart",this._onDragStart.bind(this),false);this._contentElement.addEventListener("focusin",this._onFocusIn.bind(this),false);this._contentElement.addEventListener("focusout",this._onFocusOut.bind(this),false);this._contentElement.addEventListener("keydown",this._onKeyDown.bind(this),false);this._virtualSelectedIndex=-1;this._contentElement.tabIndex=-1;this._firstActiveIndex=-1;this._lastActiveIndex=-1;this._renderedItems=[];this._anchorSelection=null;this._headSelection=null;this._itemCount=0;this._cumulativeHeights=new Int32Array(0);this._muteCopyHandler=false;this._observer=new MutationObserver(this.refresh.bind(this));this._observerConfig={childList:true,subtree:true}}stickToBottom(){return this._stickToBottom}setStickToBottom(e){this._stickToBottom=e;if(this._stickToBottom)this._observer.observe(this._contentElement,this._observerConfig);else this._observer.disconnect()}hasVirtualSelection(){return this._virtualSelectedIndex!==-1}copyWithStyles(){this._muteCopyHandler=true;this.element.ownerDocument.execCommand("copy");this._muteCopyHandler=false}_onCopy(e){if(this._muteCopyHandler)return;const t=this._selectedText();if(!t)return;e.preventDefault();e.clipboardData.setData("text/plain",t)}_onFocusIn(e){const t=this._renderedItems.findIndex(t=>t.element().isSelfOrAncestor(e.target));if(t!==-1)this._virtualSelectedIndex=this._firstActiveIndex+t;let s=false;if(this._virtualSelectedIndex===-1&&this._isOutsideViewport(e.relatedTarget)&&e.target===this._contentElement&&this._itemCount){s=true;this._virtualSelectedIndex=this._itemCount-1;this.refresh();this.scrollItemIntoView(this._virtualSelectedIndex)}this._updateFocusedItem(s)}_onFocusOut(e){if(this._isOutsideViewport(e.relatedTarget))this._virtualSelectedIndex=-1;this._updateFocusedItem()}_isOutsideViewport(e){return!!e&&!e.isSelfOrDescendant(this._contentElement)}_onDragStart(e){const t=this._selectedText();if(!t)return false;e.dataTransfer.clearData();e.dataTransfer.setData("text/plain",t);e.dataTransfer.effectAllowed="copy";return true}_onKeyDown(e){if(UI.isEditing()||!this._itemCount||e.shiftKey)return;let t=false;switch(e.key){case"ArrowUp":if(this._virtualSelectedIndex>0){t=true;this._virtualSelectedIndex--}else{return}break;case"ArrowDown":if(this._virtualSelectedIndex<this._itemCount-1)this._virtualSelectedIndex++;else return;break;case"Home":this._virtualSelectedIndex=0;break;case"End":this._virtualSelectedIndex=this._itemCount-1;break;default:return}e.consume(true);this.scrollItemIntoView(this._virtualSelectedIndex);this._updateFocusedItem(t)}_updateFocusedItem(e){const t=this.renderedElementAt(this._virtualSelectedIndex);const s=this._lastSelectedElement!==t;const n=this._contentElement===this.element.ownerDocument.deepActiveElement();if(this._lastSelectedElement&&s)this._lastSelectedElement.classList.remove("console-selected");if(t&&(e||s||n)&&this.element.hasFocus()){t.classList.add("console-selected");if(e){this.setStickToBottom(false);this._renderedItems[this._virtualSelectedIndex-this._firstActiveIndex].focusLastChildOrSelf()}else if(!t.hasFocus()){o(t)}}if(this._itemCount&&!this._contentElement.hasFocus())this._contentElement.tabIndex=0;else this._contentElement.tabIndex=-1;this._lastSelectedElement=t;function o(e){e.focus({preventScroll:true})}}contentElement(){return this._contentElement}invalidate(){delete this._cachedProviderElements;this._itemCount=this._provider.itemCount();if(this._virtualSelectedIndex>this._itemCount-1)this._virtualSelectedIndex=this._itemCount-1;this._rebuildCumulativeHeights();this.refresh()}_providerElement(e){if(!this._cachedProviderElements)this._cachedProviderElements=new Array(this._itemCount);let t=this._cachedProviderElements[e];if(!t){t=this._provider.itemElement(e);this._cachedProviderElements[e]=t}return t}_rebuildCumulativeHeights(){const e=this._firstActiveIndex;const t=this._lastActiveIndex;let s=0;this._cumulativeHeights=new Int32Array(this._itemCount);for(let n=0;n<this._itemCount;++n){if(e<=n&&n-e<this._renderedItems.length&&n<=t)s+=this._renderedItems[n-e].element().offsetHeight;else s+=this._provider.fastHeight(n);this._cumulativeHeights[n]=s}}_rebuildCumulativeHeightsIfNeeded(){let e=0;let t=0;for(let s=0;s<this._renderedItems.length;++s){const n=this._cachedItemHeight(this._firstActiveIndex+s);const o=this._renderedItems[s].element().offsetHeight;if(Math.abs(n-o)>1){this._rebuildCumulativeHeights();return}t+=o;e+=n;if(Math.abs(e-t)>1){this._rebuildCumulativeHeights();return}}}_cachedItemHeight(e){return e===0?this._cumulativeHeights[0]:this._cumulativeHeights[e]-this._cumulativeHeights[e-1]}_isSelectionBackwards(e){if(!e||!e.rangeCount)return false;const t=document.createRange();t.setStart(e.anchorNode,e.anchorOffset);t.setEnd(e.focusNode,e.focusOffset);return t.collapsed}_createSelectionModel(e,t,s){return{item:e,node:t,offset:s}}_updateSelectionModel(e){const t=e&&e.rangeCount?e.getRangeAt(0):null;if(!t||e.isCollapsed||!this.element.hasSelection()){this._headSelection=null;this._anchorSelection=null;return false}let s=Number.MAX_VALUE;let n=-1;let o=false;for(let e=0;e<this._renderedItems.length;++e){if(t.intersectsNode(this._renderedItems[e].element())){const t=e+this._firstActiveIndex;s=Math.min(s,t);n=Math.max(n,t);o=true}}if(o){s=this._createSelectionModel(s,t.startContainer,t.startOffset);n=this._createSelectionModel(n,t.endContainer,t.endOffset)}const i=t.intersectsNode(this._topGapElement)&&this._topGapElement._active;const r=t.intersectsNode(this._bottomGapElement)&&this._bottomGapElement._active;if(!i&&!r&&!o){this._headSelection=null;this._anchorSelection=null;return false}if(!this._anchorSelection||!this._headSelection){this._anchorSelection=this._createSelectionModel(0,this.element,0);this._headSelection=this._createSelectionModel(this._itemCount-1,this.element,this.element.children.length);this._selectionIsBackward=false}const l=this._isSelectionBackwards(e);const a=this._selectionIsBackward?this._headSelection:this._anchorSelection;const h=this._selectionIsBackward?this._anchorSelection:this._headSelection;if(i&&r&&o){s=s.item<a.item?s:a;n=n.item>h.item?n:h}else if(!o){s=a;n=h}else if(i){s=l?this._headSelection:this._anchorSelection}else if(r){n=l?this._anchorSelection:this._headSelection}if(l){this._anchorSelection=n;this._headSelection=s}else{this._anchorSelection=s;this._headSelection=n}this._selectionIsBackward=l;return true}_restoreSelection(e){let t=null;let s;if(this._firstActiveIndex<=this._anchorSelection.item&&this._anchorSelection.item<=this._lastActiveIndex){t=this._anchorSelection.node;s=this._anchorSelection.offset}else{if(this._anchorSelection.item<this._firstActiveIndex)t=this._topGapElement;else if(this._anchorSelection.item>this._lastActiveIndex)t=this._bottomGapElement;s=this._selectionIsBackward?1:0}let n=null;let o;if(this._firstActiveIndex<=this._headSelection.item&&this._headSelection.item<=this._lastActiveIndex){n=this._headSelection.node;o=this._headSelection.offset}else{if(this._headSelection.item<this._firstActiveIndex)n=this._topGapElement;else if(this._headSelection.item>this._lastActiveIndex)n=this._bottomGapElement;o=this._selectionIsBackward?0:1}e.setBaseAndExtent(t,s,n,o)}refresh(){this._observer.disconnect();this._innerRefresh();if(this._stickToBottom)this._observer.observe(this._contentElement,this._observerConfig)}_innerRefresh(){if(!this._visibleHeight())return;if(!this._itemCount){for(let e=0;e<this._renderedItems.length;++e)this._renderedItems[e].willHide();this._renderedItems=[];this._contentElement.removeChildren();this._topGapElement.style.height="0px";this._bottomGapElement.style.height="0px";this._firstActiveIndex=-1;this._lastActiveIndex=-1;this._updateFocusedItem();return}const e=this.element.getComponentSelection();const t=this._updateSelectionModel(e);const s=this.element.scrollTop;const n=this._visibleHeight();const o=n*2;this._rebuildCumulativeHeightsIfNeeded();if(this._stickToBottom){this._firstActiveIndex=Math.max(this._itemCount-Math.ceil(o/this._provider.minimumRowHeight()),0);this._lastActiveIndex=this._itemCount-1}else{this._firstActiveIndex=Math.max(this._cumulativeHeights.lowerBound(s+1-(o-n)/2),0);this._lastActiveIndex=this._firstActiveIndex+Math.ceil(o/this._provider.minimumRowHeight())-1;this._lastActiveIndex=Math.min(this._lastActiveIndex,this._itemCount-1)}const i=this._cumulativeHeights[this._firstActiveIndex-1]||0;const r=this._cumulativeHeights[this._cumulativeHeights.length-1]-this._cumulativeHeights[this._lastActiveIndex];function l(){this._topGapElement.style.height=i+"px";this._bottomGapElement.style.height=r+"px";this._topGapElement._active=!!i;this._bottomGapElement._active=!!r;this._contentElement.style.setProperty("height","10000000px")}this._partialViewportUpdate(l.bind(this));this._contentElement.style.removeProperty("height");if(t)this._restoreSelection(e);if(this._stickToBottom)this.element.scrollTop=1e7}_partialViewportUpdate(e){const t=new Set;for(let e=this._firstActiveIndex;e<=this._lastActiveIndex;++e)t.add(this._providerElement(e));const s=this._renderedItems.filter(e=>!t.has(e));for(let e=0;e<s.length;++e)s[e].willHide();e();let n=false;for(let e=0;e<s.length;++e){n=n||s[e].element().hasFocus();s[e].element().remove()}const o=[];let i=this._contentElement.firstChild;for(const e of t){const t=e.element();if(t!==i){const s=!t.parentElement;if(s)o.push(e);this._contentElement.insertBefore(t,i)}else{i=i.nextSibling}}for(let e=0;e<o.length;++e)o[e].wasShown();this._renderedItems=Array.from(t);if(n)this._contentElement.focus();this._updateFocusedItem()}_selectedText(){this._updateSelectionModel(this.element.getComponentSelection());if(!this._headSelection||!this._anchorSelection)return null;let e=null;let t=null;if(this._selectionIsBackward){e=this._headSelection;t=this._anchorSelection}else{e=this._anchorSelection;t=this._headSelection}const s=[];for(let n=e.item;n<=t.item;++n){const e=this._providerElement(n).element();const t=e.childTextNodes().map(Components.Linkifier.untruncatedNodeText).join("");s.push(t)}const n=this._providerElement(t.item).element();if(t.node&&t.node.isSelfOrDescendant(n)){const e=this._textOffsetInNode(n,t.node,t.offset);s[s.length-1]=s.peekLast().substring(0,e)}const o=this._providerElement(e.item).element();if(e.node&&e.node.isSelfOrDescendant(o)){const t=this._textOffsetInNode(o,e.node,e.offset);s[0]=s[0].substring(t)}return s.join("\n")}_textOffsetInNode(e,t,s){if(t.nodeType!==Node.TEXT_NODE){if(s<t.childNodes.length){t=t.childNodes.item(s);s=0}else{s=t.textContent.length}}let n=0;let o=e;while((o=o.traverseNextNode(e))&&o!==t){if(o.nodeType!==Node.TEXT_NODE||o.parentElement.nodeName==="STYLE"||o.parentElement.nodeName==="SCRIPT")continue;n+=Components.Linkifier.untruncatedNodeText(o).length}const i=Components.Linkifier.untruncatedNodeText(t).length;if(s>0&&i!==t.textContent.length)s=i;return n+s}_onScroll(e){this.refresh()}firstVisibleIndex(){if(!this._cumulativeHeights.length)return-1;this._rebuildCumulativeHeightsIfNeeded();return this._cumulativeHeights.lowerBound(this.element.scrollTop+1)}lastVisibleIndex(){if(!this._cumulativeHeights.length)return-1;this._rebuildCumulativeHeightsIfNeeded();const e=this.element.scrollTop+this.element.clientHeight;const t=this._itemCount-1;return this._cumulativeHeights.lowerBound(e,undefined,undefined,t)}renderedElementAt(e){if(e===-1||e<this._firstActiveIndex||e>this._lastActiveIndex)return null;return this._renderedItems[e-this._firstActiveIndex].element()}scrollItemIntoView(e,t){const s=this.firstVisibleIndex();const n=this.lastVisibleIndex();if(e>s&&e<n)return;if(e===n&&this._cumulativeHeights[e]<=this.element.scrollTop+this._visibleHeight())return;if(t)this.forceScrollItemToBeLast(e);else if(e<=s)this.forceScrollItemToBeFirst(e);else if(e>=n)this.forceScrollItemToBeLast(e)}forceScrollItemToBeFirst(e){console.assert(e>=0&&e<this._itemCount,"Cannot scroll item at invalid index");this.setStickToBottom(false);this._rebuildCumulativeHeightsIfNeeded();this.element.scrollTop=e>0?this._cumulativeHeights[e-1]:0;if(this.element.isScrolledToBottom())this.setStickToBottom(true);this.refresh();this.renderedElementAt(e).scrollIntoView(true)}forceScrollItemToBeLast(e){console.assert(e>=0&&e<this._itemCount,"Cannot scroll item at invalid index");this.setStickToBottom(false);this._rebuildCumulativeHeightsIfNeeded();this.element.scrollTop=this._cumulativeHeights[e]-this._visibleHeight();if(this.element.isScrolledToBottom())this.setStickToBottom(true);this.refresh();this.renderedElementAt(e).scrollIntoView(false)}_visibleHeight(){return this.element.offsetHeight}};Console.ConsoleViewportProvider=function(){};Console.ConsoleViewportProvider.prototype={fastHeight(e){return 0},itemCount(){return 0},minimumRowHeight(){return 0},itemElement(e){return null}};Console.ConsoleViewportElement=function(){};Console.ConsoleViewportElement.prototype={willHide(){},wasShown(){},element(){}};Console.ConsoleViewMessage=class{constructor(e,t,s,n,o){this._message=e;this._linkifier=t;this._badgePool=s;this._repeatCount=1;this._closeGroupDecorationCount=0;this._nestingLevel=n;this._selectableChildren=[];this._messageResized=o;this._dataGrid=null;this._previewFormatter=new ObjectUI.RemoteObjectPreviewFormatter;this._searchRegex=null;this._messageLevelIcon=null;this._traceExpanded=false;this._expandTrace=null}element(){return this.toMessageElement()}wasShown(){if(this._dataGrid)this._dataGrid.updateWidths();this._isVisible=true}onResize(){if(!this._isVisible)return;if(this._dataGrid)this._dataGrid.onResize()}willHide(){this._isVisible=false;this._cachedHeight=this.element().offsetHeight}fastHeight(){if(this._cachedHeight)return this._cachedHeight;const e=19;if(this._message.type===SDK.ConsoleMessage.MessageType.Table){const t=this._message.parameters[0];if(t&&t.preview)return e*t.preview.properties.length}return e}consoleMessage(){return this._message}_buildTableMessage(){const e=createElementWithClass("span","source-code");this._anchorElement=this._buildMessageAnchor();if(this._anchorElement)e.appendChild(this._anchorElement);const t=this._buildMessageBadge();if(t)e.appendChild(t);let s=this._message.parameters&&this._message.parameters.length?this._message.parameters[0]:null;if(s)s=this._parameterToRemoteObject(s);if(!s||!s.preview)return this._buildMessage();const n=Symbol("rawValueColumn");const o=[];const i=s.preview;const r=[];for(let e=0;e<i.properties.length;++e){const t=i.properties[e];let l;if(t.valuePreview)l=t.valuePreview.properties;else if(t.value)l=[{name:n,type:t.type,value:t.value}];else continue;const a={};const h=20;for(let e=0;e<l.length;++e){const n=l[e];let i=o.indexOf(n.name)!==-1;if(!i){if(o.length===h)continue;i=true;o.push(n.name)}if(i){const e=this._renderPropertyPreviewOrAccessor(s,[t,n]);e.classList.add("console-message-nowrap-below");a[n.name]=e}}r.push([t.name,a])}const l=[];for(let e=0;e<r.length;++e){const t=r[e][0];const s=r[e][1];l.push(t);for(let e=0;e<o.length;++e)l.push(s[o[e]])}o.unshift(Common.UIString("(index)"));const a=o.map(e=>e===n?Common.UIString("Value"):e);if(l.length){this._dataGrid=DataGrid.SortableDataGrid.create(a,l);this._dataGrid.setStriped(true);const t=createElementWithClass("span","console-message-text");const n=t.createChild("div","console-message-formatted-table");const o=n.createChild("span");n.appendChild(this._formatParameter(s,true,false));o.appendChild(this._dataGrid.element);e.appendChild(t);this._dataGrid.renderInline()}return e}_buildMessage(){let e;let t=this._message.messageText;if(this._message.source===SDK.ConsoleMessage.MessageSource.ConsoleAPI){switch(this._message.type){case SDK.ConsoleMessage.MessageType.Trace:e=this._format(this._message.parameters||["console.trace"]);break;case SDK.ConsoleMessage.MessageType.Clear:e=createElementWithClass("span","console-info");if(Common.moduleSetting("preserveConsoleLog").get())e.textContent=Common.UIString("console.clear() was prevented due to 'Preserve log'");else e.textContent=Common.UIString("Console was cleared");e.title=ls`Clear all messages with ${UI.shortcutRegistry.shortcutTitleForAction("console.clear")}`;break;case SDK.ConsoleMessage.MessageType.Dir:{const t=this._message.parameters?this._message.parameters[0]:undefined;const s=["%O",t];e=this._format(s);break}case SDK.ConsoleMessage.MessageType.Profile:case SDK.ConsoleMessage.MessageType.ProfileEnd:e=this._format([t]);break;case SDK.ConsoleMessage.MessageType.Assert:this._messagePrefix=ls`Assertion failed: `;default:{if(this._message.parameters&&this._message.parameters.length===1&&this._message.parameters[0].type==="string")e=this._tryFormatAsError(this._message.parameters[0].value);const s=this._message.parameters||[t];e=e||this._format(s)}}}else{if(this._message.source===SDK.ConsoleMessage.MessageSource.Network){e=this._formatAsNetworkRequest()||this._format([t])}else{const s=this._message.parameters&&t===this._message.parameters[0];if(this._message.source===SDK.ConsoleMessage.MessageSource.Violation)t=Common.UIString("[Violation] %s",t);else if(this._message.source===SDK.ConsoleMessage.MessageSource.Intervention)t=Common.UIString("[Intervention] %s",t);else if(this._message.source===SDK.ConsoleMessage.MessageSource.Deprecation)t=Common.UIString("[Deprecation] %s",t);const n=this._message.parameters||[t];if(s)n[0]=t;e=this._format(n)}}e.classList.add("console-message-text");const s=createElementWithClass("span","source-code");this._anchorElement=this._buildMessageAnchor();if(this._anchorElement)s.appendChild(this._anchorElement);const n=this._buildMessageBadge();if(n)s.appendChild(n);s.appendChild(e);return s}_formatAsNetworkRequest(){const e=SDK.NetworkLog.requestForConsoleMessage(this._message);if(!e)return null;const t=createElement("span");if(this._message.level===SDK.ConsoleMessage.MessageLevel.Error){t.createTextChild(e.requestMethod+" ");const s=Components.Linkifier.linkifyRevealable(e,e.url(),e.url());s.tabIndex=-1;this._selectableChildren.push({element:s,forceSelect:()=>s.focus()});t.appendChild(s);if(e.failed)t.createTextChildren(" ",e.localizedFailDescription);if(e.statusCode!==0)t.createTextChildren(" ",String(e.statusCode));if(e.statusText)t.createTextChildren(" (",e.statusText,")")}else{const s=this._message.messageText;const n=this._linkifyWithCustomLinkifier(s,(t,s,n,o)=>{let i;if(s===e.url()){i=Components.Linkifier.linkifyRevealable(e,s,e.url())}else{i=Components.Linkifier.linkifyURL(s,{text:t,lineNumber:n,columnNumber:o})}i.tabIndex=-1;this._selectableChildren.push({element:i,forceSelect:()=>i.focus()});return i});t.appendChild(n)}return t}_buildMessageAnchor(){let e=null;if(this._message.scriptId){e=this._linkifyScriptId(this._message.scriptId,this._message.url||"",this._message.line,this._message.column)}else if(this._message.stackTrace&&this._message.stackTrace.callFrames.length){e=this._linkifyStackTraceTopFrame(this._message.stackTrace)}else if(this._message.url&&this._message.url!=="undefined"){e=this._linkifyLocation(this._message.url,this._message.line,this._message.column)}if(e){const t=createElementWithClass("span","console-message-anchor");t.appendChild(e);t.createTextChild(" ");return t}return null}_buildMessageBadge(){const e=this._badgeElement();if(!e)return null;e.classList.add("console-message-badge");return e}_badgeElement(){if(this._message._url)return this._badgePool.badgeForURL(new Common.ParsedURL(this._message._url));if(this._message.stackTrace){let e=this._message.stackTrace;while(e){for(const e of this._message.stackTrace.callFrames){if(e.url)return this._badgePool.badgeForURL(new Common.ParsedURL(e.url))}e=e.parent}}if(!this._message.executionContextId)return null;const e=this._message.runtimeModel();if(!e)return null;const t=e.executionContext(this._message.executionContextId);if(!t||!t.frameId)return null;const s=t.target().model(SDK.ResourceTreeModel);if(!s)return null;const n=s.frameForId(t.frameId);if(!n||!n.parentFrame)return null;return this._badgePool.badgeForFrame(n)}_buildMessageWithStackTrace(){const e=createElementWithClass("div","console-message-stack-trace-toggle");const t=e.createChild("div","console-message-stack-trace-wrapper");const s=this._buildMessage();const n=UI.Icon.create("smallicon-triangle-right","console-message-expand-icon");const o=t.createChild("div");o.appendChild(n);o.tabIndex=-1;o.appendChild(s);const i=t.createChild("div");const r=Components.JSPresentationUtils.buildStackTracePreviewContents(this._message.runtimeModel().target(),this._linkifier,this._message.stackTrace);i.appendChild(r.element);for(const e of r.links){e.tabIndex=-1;this._selectableChildren.push({element:e,forceSelect:()=>e.focus()})}i.classList.add("hidden");this._expandTrace=(e=>{n.setIconType(e?"smallicon-triangle-down":"smallicon-triangle-right");i.classList.toggle("hidden",!e);this._traceExpanded=e});function l(e){if(UI.isEditing()||t.hasSelection())return;this._expandTrace(i.classList.contains("hidden"));e.consume()}o.addEventListener("click",l.bind(this),false);if(this._message.type===SDK.ConsoleMessage.MessageType.Trace)this._expandTrace(true);e._expandStackTraceForTest=this._expandTrace.bind(this,true);return e}_linkifyLocation(e,t,s){if(!this._message.runtimeModel())return null;return this._linkifier.linkifyScriptLocation(this._message.runtimeModel().target(),null,e,t,s)}_linkifyStackTraceTopFrame(e){if(!this._message.runtimeModel())return null;return this._linkifier.linkifyStackTraceTopFrame(this._message.runtimeModel().target(),e)}_linkifyScriptId(e,t,s,n){if(!this._message.runtimeModel())return null;return this._linkifier.linkifyScriptLocation(this._message.runtimeModel().target(),e,t,s,n)}_parameterToRemoteObject(e){if(e instanceof SDK.RemoteObject)return e;const t=this._message.runtimeModel();if(!t)return SDK.RemoteObject.fromLocalObject(e);if(typeof e==="object")return t.createRemoteObject(e);return t.createRemoteObjectFromPrimitiveValue(e)}_format(e){const t=createElement("span");if(this._messagePrefix)t.createChild("span").textContent=this._messagePrefix;if(!e.length)return t;let s=[];for(let t=0;t<e.length;++t)s[t]=this._parameterToRemoteObject(e[t]);const n=SDK.RemoteObject.type(s[0])==="string"&&(this._message.type!==SDK.ConsoleMessage.MessageType.Result||this._message.level===SDK.ConsoleMessage.MessageLevel.Error);if(n){const e=this._formatWithSubstitutionString(s[0].description,s.slice(1),t);s=e.unusedSubstitutions;if(s.length)t.createTextChild(" ")}for(let e=0;e<s.length;++e){if(n&&s[e].type==="string")t.appendChild(this._linkifyStringAsFragment(s[e].description));else t.appendChild(this._formatParameter(s[e],false,true));if(e<s.length-1)t.createTextChild(" ")}return t}_formatParameter(e,t,s){if(e.customPreview())return new ObjectUI.CustomPreviewComponent(e).element;const n=t?"object":e.subtype||e.type;let o;switch(n){case"error":o=this._formatParameterAsError(e);break;case"function":o=this._formatParameterAsFunction(e,s);break;case"array":case"arraybuffer":case"blob":case"dataview":case"generator":case"iterator":case"map":case"object":case"promise":case"proxy":case"set":case"typedarray":case"weakmap":case"weakset":o=this._formatParameterAsObject(e,s);break;case"node":o=e.isNode()?this._formatParameterAsNode(e):this._formatParameterAsObject(e,false);break;case"string":o=this._formatParameterAsString(e);break;case"boolean":case"date":case"null":case"number":case"regexp":case"symbol":case"undefined":case"bigint":o=this._formatParameterAsValue(e);break;default:o=this._formatParameterAsValue(e);console.error("Tried to format remote object of unknown type.")}o.classList.add("object-value-"+n);o.classList.add("source-code");return o}_formatParameterAsValue(e){const t=createElement("span");const s=e.description||"";if(s.length>Console.ConsoleViewMessage._MaxTokenizableStringLength)t.appendChild(UI.createExpandableText(s,Console.ConsoleViewMessage._LongStringVisibleLength));else t.createTextChild(s);if(e.objectId)t.addEventListener("contextmenu",this._contextMenuEventFired.bind(this,e),false);return t}_formatParameterAsObject(e,t){const s=createElementWithClass("span","console-object");if(t&&e.preview){s.classList.add("console-object-preview");this._previewFormatter.appendObjectPreview(s,e.preview,false)}else if(e.type==="function"){const t=s.createChild("span");ObjectUI.ObjectPropertiesSection.formatObjectAsFunction(e,t,false);s.classList.add("object-value-function")}else{s.createTextChild(e.description||"")}if(!e.hasChildren||e.customPreview())return s;const n=s.createChild("span","object-state-note info-note");if(this._message.type===SDK.ConsoleMessage.MessageType.QueryObjectResult)n.title=ls`This value will not be collected until console is cleared.`;else n.title=ls`Value below was evaluated just now.`;const o=new ObjectUI.ObjectPropertiesSection(e,s,this._linkifier);o.element.classList.add("console-view-object-properties-section");o.enableContextMenu();o.setShowSelectionOnKeyboardFocus(true,true);this._selectableChildren.push(o);o.addEventListener(UI.TreeOutline.Events.ElementAttached,this._messageResized);o.addEventListener(UI.TreeOutline.Events.ElementExpanded,this._messageResized);o.addEventListener(UI.TreeOutline.Events.ElementCollapsed,this._messageResized);return o.element}_formatParameterAsFunction(e,t){const s=createElement("span");SDK.RemoteFunction.objectAsFunction(e).targetFunction().then(n.bind(this));return s;function n(n){const o=createElement("span");const i=ObjectUI.ObjectPropertiesSection.formatObjectAsFunction(n,o,true,t);s.appendChild(o);if(n!==e){const e=s.createChild("span","object-info-state-note");e.title=Common.UIString("Function was resolved from bound function.")}s.addEventListener("contextmenu",this._contextMenuEventFired.bind(this,n),false);i.then(()=>this._formattedParameterAsFunctionForTest())}}_formattedParameterAsFunctionForTest(){}_contextMenuEventFired(e,t){const s=new UI.ContextMenu(t);s.appendApplicableItems(e);s.show()}_renderPropertyPreviewOrAccessor(e,t){const s=t.peekLast();if(s.type==="accessor")return this._formatAsAccessorProperty(e,t.map(e=>e.name),false);return this._previewFormatter.renderPropertyPreview(s.type,s.subtype,s.value)}_formatParameterAsNode(e){const t=createElement("span");const s=e.runtimeModel().target().model(SDK.DOMModel);if(!s)return t;s.pushObjectAsNodeToFrontend(e).then(async s=>{if(!s){t.appendChild(this._formatParameterAsObject(e,false));return}const n=await UI.Renderer.render(s);if(n){if(n.tree){this._selectableChildren.push(n.tree);n.tree.addEventListener(UI.TreeOutline.Events.ElementAttached,this._messageResized);n.tree.addEventListener(UI.TreeOutline.Events.ElementExpanded,this._messageResized);n.tree.addEventListener(UI.TreeOutline.Events.ElementCollapsed,this._messageResized)}t.appendChild(n.node)}else{t.appendChild(this._formatParameterAsObject(e,false))}this._formattedParameterAsNodeForTest()});return t}_formattedParameterAsNodeForTest(){}_formatParameterAsString(e){const t=createElement("span");t.appendChild(this._linkifyStringAsFragment(e.description||""));const s=createElement("span");s.createChild("span","object-value-string-quote").textContent='"';s.appendChild(t);s.createChild("span","object-value-string-quote").textContent='"';return s}_formatParameterAsError(e){const t=createElement("span");const s=this._tryFormatAsError(e.description||"");t.appendChild(s?s:this._linkifyStringAsFragment(e.description||""));return t}_formatAsArrayEntry(e){return this._previewFormatter.renderPropertyPreview(e.type,e.subtype,e.description)}_formatAsAccessorProperty(e,t,s){const n=ObjectUI.ObjectPropertyTreeElement.createRemoteObjectAccessorPropertySpan(e,t,o.bind(this));function o(e){const t=e.wasThrown;const o=e.object;if(!o)return;n.removeChildren();if(t){const e=n.createChild("span");e.textContent=Common.UIString("<exception>");e.title=o.description}else if(s){n.appendChild(this._formatAsArrayEntry(o))}else{const e=100;const t=o.type;const s=o.subtype;let i="";if(t!=="function"&&o.description){if(t==="string"||s==="regexp")i=o.description.trimMiddle(e);else i=o.description.trimEnd(e)}n.appendChild(this._previewFormatter.renderPropertyPreview(t,s,i))}}return n}_formatWithSubstitutionString(e,t,s){const n={};function o(e,t,s){return this._formatParameter(s,e,t)}function i(e){return e.description}function r(e){if(typeof e.value!=="number")return"NaN";return e.value}function l(e){if(e.type==="bigint")return e.description;if(typeof e.value!=="number")return"NaN";return Math.floor(e.value)}function a(e){return e instanceof Node?e:""}let h=null;function c(e){h={};const t=createElement("span");t.setAttribute("style",e.description);for(let e=0;e<t.style.length;e++){const s=t.style[e];if(d(s))h[s]=t.style[s]}}function d(e){const t=["background","border","color","font","line","margin","padding","text","-webkit-background","-webkit-border","-webkit-font","-webkit-margin","-webkit-padding","-webkit-text"];for(let s=0;s<t.length;s++){if(e.startsWith(t[s]))return true}return false}n.o=o.bind(this,false,true);n.s=i;n.f=r;n.i=l;n.d=l;n.c=c;n.O=o.bind(this,true,false);n._=a;function m(e,t){if(t instanceof Node){e.appendChild(t);return e}if(typeof t==="undefined")return e;if(!h){e.appendChild(this._linkifyStringAsFragment(String(t)));return e}const s=String(t).split("\n");for(let t=0;t<s.length;t++){const n=s[t];const o=this._linkifyStringAsFragment(n);const i=createElement("span");i.style.setProperty("contain","paint");i.style.setProperty("display","inline-block");i.style.setProperty("max-width","100%");i.appendChild(o);u(i);for(const e of i.children){if(e.classList.contains("devtools-link"))this._applyForcedVisibleStyle(e)}e.appendChild(i);if(t<s.length-1)e.appendChild(createElement("br"))}return e}function u(e){for(const t in h)e.style[t]=h[t]}return String.format(e,t,n,s,m.bind(this))}_applyForcedVisibleStyle(e){e.style.setProperty("-webkit-text-stroke","0","important");e.style.setProperty("text-decoration","underline","important");const t=UI.themeSupport.patchColorText("rgb(33%, 33%, 33%)",UI.ThemeSupport.ColorUsage.Foreground);e.style.setProperty("color",t,"important");let s="hsl(0, 0%, 100%)";if(this._message.level===SDK.ConsoleMessage.MessageLevel.Error)s="hsl(0, 100%, 97%)";else if(this._message.level===SDK.ConsoleMessage.MessageLevel.Warning||this._shouldRenderAsWarning())s="hsl(50, 100%, 95%)";const n=UI.themeSupport.patchColorText(s,UI.ThemeSupport.ColorUsage.Background);e.style.setProperty("background-color",n,"important")}matchesFilterRegex(e){e.lastIndex=0;const t=this.contentElement();const s=this._anchorElement?this._anchorElement.deepTextContent():"";return s&&e.test(s.trim())||e.test(t.deepTextContent().slice(s.length))}matchesFilterText(e){const t=this.contentElement().deepTextContent();return t.toLowerCase().includes(e.toLowerCase())}updateTimestamp(){if(!this._contentElement)return;if(Common.moduleSetting("consoleTimestampsEnabled").get()){if(!this._timestampElement)this._timestampElement=createElementWithClass("span","console-timestamp");this._timestampElement.textContent=UI.formatTimestamp(this._message.timestamp,false)+" ";this._timestampElement.title=UI.formatTimestamp(this._message.timestamp,true);this._contentElement.insertBefore(this._timestampElement,this._contentElement.firstChild)}else if(this._timestampElement){this._timestampElement.remove();delete this._timestampElement}}nestingLevel(){return this._nestingLevel}setInSimilarGroup(e,t){this._inSimilarGroup=e;this._lastInSimilarGroup=e&&!!t;if(this._similarGroupMarker&&!e){this._similarGroupMarker.remove();this._similarGroupMarker=null}else if(this._element&&!this._similarGroupMarker&&e){this._similarGroupMarker=createElementWithClass("div","nesting-level-marker");this._element.insertBefore(this._similarGroupMarker,this._element.firstChild);this._similarGroupMarker.classList.toggle("group-closed",this._lastInSimilarGroup)}}isLastInSimilarGroup(){return this._inSimilarGroup&&this._lastInSimilarGroup}resetCloseGroupDecorationCount(){if(!this._closeGroupDecorationCount)return;this._closeGroupDecorationCount=0;this._updateCloseGroupDecorations()}incrementCloseGroupDecorationCount(){++this._closeGroupDecorationCount;this._updateCloseGroupDecorations()}_updateCloseGroupDecorations(){if(!this._nestingLevelMarkers)return;for(let e=0,t=this._nestingLevelMarkers.length;e<t;++e){const s=this._nestingLevelMarkers[e];s.classList.toggle("group-closed",t-e<=this._closeGroupDecorationCount)}}_focusedChildIndex(){if(!this._selectableChildren.length)return-1;return this._selectableChildren.findIndex(e=>e.element.hasFocus())}_onKeyDown(e){if(UI.isEditing()||!this._element.hasFocus()||this._element.hasSelection())return;if(this.maybeHandleOnKeyDown(e))e.consume(true)}maybeHandleOnKeyDown(e){const t=this._focusedChildIndex();const s=t===-1;if(this._expandTrace&&s){if(e.key==="ArrowLeft"&&this._traceExpanded||e.key==="ArrowRight"&&!this._traceExpanded){this._expandTrace(!this._traceExpanded);return true}}if(!this._selectableChildren.length)return false;if(e.key==="ArrowLeft"){this._element.focus();return true}if(e.key==="ArrowRight"){if(s&&this._selectNearestVisibleChild(0))return true}if(e.key==="ArrowUp"){const e=this._nearestVisibleChild(0);if(this._selectableChildren[t]===e&&e){this._element.focus();return true}else if(this._selectNearestVisibleChild(t-1,true)){return true}}if(e.key==="ArrowDown"){if(s&&this._selectNearestVisibleChild(0))return true;if(!s&&this._selectNearestVisibleChild(t+1))return true}return false}_selectNearestVisibleChild(e,t){const s=this._nearestVisibleChild(e,t);if(s){s.forceSelect();return true}return false}_nearestVisibleChild(e,t){const s=this._selectableChildren.length;if(e<0||e>=s)return null;const n=t?-1:1;let o=e;while(!this._selectableChildren[o].element.offsetParent){o+=n;if(o<0||o>=s)return null}return this._selectableChildren[o]}focusLastChildOrSelf(){if(this._element&&!this._selectNearestVisibleChild(this._selectableChildren.length-1,true))this._element.focus()}contentElement(){if(this._contentElement)return this._contentElement;const e=createElementWithClass("div","console-message");if(this._messageLevelIcon)e.appendChild(this._messageLevelIcon);this._contentElement=e;let t;const s=!!this._message.stackTrace&&(this._message.source===SDK.ConsoleMessage.MessageSource.Network||this._message.source===SDK.ConsoleMessage.MessageSource.Violation||this._message.level===SDK.ConsoleMessage.MessageLevel.Error||this._message.level===SDK.ConsoleMessage.MessageLevel.Warning||this._message.type===SDK.ConsoleMessage.MessageType.Trace);if(this._message.runtimeModel()&&s)t=this._buildMessageWithStackTrace();else if(this._message.type===SDK.ConsoleMessage.MessageType.Table)t=this._buildTableMessage();else t=this._buildMessage();e.appendChild(t);this.updateTimestamp();return this._contentElement}toMessageElement(){if(this._element)return this._element;this._element=createElement("div");this._element.tabIndex=-1;this._element.addEventListener("keydown",this._onKeyDown.bind(this));this.updateMessageElement();return this._element}updateMessageElement(){if(!this._element)return;this._element.className="console-message-wrapper";this._element.removeChildren();if(this._message.isGroupStartMessage())this._element.classList.add("console-group-title");if(this._message.source===SDK.ConsoleMessage.MessageSource.ConsoleAPI)this._element.classList.add("console-from-api");if(this._inSimilarGroup){this._similarGroupMarker=this._element.createChild("div","nesting-level-marker");this._similarGroupMarker.classList.toggle("group-closed",this._lastInSimilarGroup)}this._nestingLevelMarkers=[];for(let e=0;e<this._nestingLevel;++e)this._nestingLevelMarkers.push(this._element.createChild("div","nesting-level-marker"));this._updateCloseGroupDecorations();this._element.message=this;switch(this._message.level){case SDK.ConsoleMessage.MessageLevel.Verbose:this._element.classList.add("console-verbose-level");break;case SDK.ConsoleMessage.MessageLevel.Info:this._element.classList.add("console-info-level");if(this._message.type===SDK.ConsoleMessage.MessageType.System)this._element.classList.add("console-system-type");break;case SDK.ConsoleMessage.MessageLevel.Warning:this._element.classList.add("console-warning-level");break;case SDK.ConsoleMessage.MessageLevel.Error:this._element.classList.add("console-error-level");break}this._updateMessageLevelIcon();if(this._shouldRenderAsWarning())this._element.classList.add("console-warning-level");this._element.appendChild(this.contentElement());if(this._repeatCount>1)this._showRepeatCountElement()}_shouldRenderAsWarning(){return(this._message.level===SDK.ConsoleMessage.MessageLevel.Verbose||this._message.level===SDK.ConsoleMessage.MessageLevel.Info)&&(this._message.source===SDK.ConsoleMessage.MessageSource.Violation||this._message.source===SDK.ConsoleMessage.MessageSource.Deprecation||this._message.source===SDK.ConsoleMessage.MessageSource.Intervention||this._message.source===SDK.ConsoleMessage.MessageSource.Recommendation)}_updateMessageLevelIcon(){let e="";let t="";if(this._message.level===SDK.ConsoleMessage.MessageLevel.Warning){e="smallicon-warning";t=ls`Warning`}else if(this._message.level===SDK.ConsoleMessage.MessageLevel.Error){e="smallicon-error";t=ls`Error`}if(!e&&!this._messageLevelIcon)return;if(e&&!this._messageLevelIcon){this._messageLevelIcon=UI.Icon.create("","message-level-icon");if(this._contentElement)this._contentElement.insertBefore(this._messageLevelIcon,this._contentElement.firstChild)}this._messageLevelIcon.setIconType(e);UI.ARIAUtils.setAccessibleName(this._messageLevelIcon,t)}repeatCount(){return this._repeatCount||1}resetIncrementRepeatCount(){this._repeatCount=1;if(!this._repeatCountElement)return;this._repeatCountElement.remove();if(this._contentElement)this._contentElement.classList.remove("repeated-message");delete this._repeatCountElement}incrementRepeatCount(){this._repeatCount++;this._showRepeatCountElement()}setRepeatCount(e){this._repeatCount=e;this._showRepeatCountElement()}_showRepeatCountElement(){if(!this._element)return;if(!this._repeatCountElement){this._repeatCountElement=createElementWithClass("span","console-message-repeat-count","dt-small-bubble");switch(this._message.level){case SDK.ConsoleMessage.MessageLevel.Warning:this._repeatCountElement.type="warning";break;case SDK.ConsoleMessage.MessageLevel.Error:this._repeatCountElement.type="error";break;case SDK.ConsoleMessage.MessageLevel.Verbose:this._repeatCountElement.type="verbose";break;default:this._repeatCountElement.type="info"}if(this._shouldRenderAsWarning())this._repeatCountElement.type="warning";this._element.insertBefore(this._repeatCountElement,this._contentElement);this._contentElement.classList.add("repeated-message")}this._repeatCountElement.textContent=this._repeatCount;let e=ls`Repeat ${this._repeatCount}`;if(this._message.level===SDK.ConsoleMessage.MessageLevel.Warning)e=ls`Warning ${e}`;else if(this._message.level===SDK.ConsoleMessage.MessageLevel.Error)e=ls`Error ${e}`;UI.ARIAUtils.setAccessibleName(this._repeatCountElement,e)}get text(){return this._message.messageText}toExportString(){const e=[];const t=this.contentElement().childTextNodes();const s=t.map(Components.Linkifier.untruncatedNodeText).join("");for(let t=0;t<this.repeatCount();++t)e.push(s);return e.join("\n")}setSearchRegex(e){if(this._searchHiglightNodeChanges&&this._searchHiglightNodeChanges.length)UI.revertDomChanges(this._searchHiglightNodeChanges);this._searchRegex=e;this._searchHighlightNodes=[];this._searchHiglightNodeChanges=[];if(!this._searchRegex)return;const t=this.contentElement().deepTextContent();let s;this._searchRegex.lastIndex=0;const n=[];while((s=this._searchRegex.exec(t))&&s[0])n.push(new TextUtils.SourceRange(s.index,s[0].length));if(n.length){this._searchHighlightNodes=UI.highlightSearchResults(this.contentElement(),n,this._searchHiglightNodeChanges)}}searchRegex(){return this._searchRegex}searchCount(){return this._searchHighlightNodes.length}searchHighlightNode(e){return this._searchHighlightNodes[e]}_tryFormatAsError(e){function t(t){return e.startsWith(t)}const s=["EvalError","ReferenceError","SyntaxError","TypeError","RangeError","Error","URIError"];if(!this._message.runtimeModel()||!s.some(t))return null;const n=this._message.runtimeModel().debuggerModel();const o=this._message.runtimeModel().target().inspectedURL();const i=e.split("\n");const r=[];let l=0;for(let e=0;e<i.length;++e){l+=e>0?i[e-1].length+1:0;const t=/^\s*at\s/.test(i[e]);if(!t&&r.length)return null;if(!t)continue;let s=-1;let n=-1;const a=/\([^\)\(]+\)/.exec(i[e]);if(a){s=a.index;n=a.index+a[0].length-1}const h=s!==-1;const d=h?s+1:i[e].indexOf("at")+3;const m=h?n:i[e].length;const u=i[e].substring(d,m);const g=Common.ParsedURL.splitLineAndColumn(u);if(!g)return null;if(g.url==="<anonymous>")continue;let p=c(g.url);if(!p&&Common.ParsedURL.isRelativeURL(g.url))p=c(Common.ParsedURL.completeURL(o,g.url));if(!p)return null;r.push({url:p,positionLeft:l+d,positionRight:l+m,lineNumber:g.lineNumber,columnNumber:g.columnNumber})}if(!r.length)return null;const a=createElement("span");let h=0;for(let t=0;t<r.length;++t){a.appendChild(this._linkifyStringAsFragment(e.substring(h,r[t].positionLeft)));const s=this._linkifier.linkifyScriptLocation(n.target(),null,r[t].url,r[t].lineNumber,r[t].columnNumber);s.tabIndex=-1;this._selectableChildren.push({element:s,forceSelect:()=>s.focus()});a.appendChild(s);h=r[t].positionRight}if(h!==e.length)a.appendChild(this._linkifyStringAsFragment(e.substring(h)));return a;function c(e){if(!e)return null;const t=e.asParsedURL();if(t)return t.url;if(n.scriptsForSourceURL(e).length)return e;return null}}_linkifyWithCustomLinkifier(e,t){if(e.length>Console.ConsoleViewMessage._MaxTokenizableStringLength)return UI.createExpandableText(e,Console.ConsoleViewMessage._LongStringVisibleLength);const s=createDocumentFragment();const n=Console.ConsoleViewMessage._tokenizeMessageText(e);for(const e of n){if(!e.text)continue;switch(e.type){case"url":{const n=e.text.startsWith("www.")?"http://"+e.text:e.text;const o=Common.ParsedURL.splitLineAndColumn(n);let i;if(o)i=t(e.text,o.url,o.lineNumber,o.columnNumber);else i=t(e.text,e.value);s.appendChild(i);break}default:s.appendChild(createTextNode(e.text));break}}return s}_linkifyStringAsFragment(e){return this._linkifyWithCustomLinkifier(e,(e,t,s,n)=>{const o=Components.Linkifier.linkifyURL(t,{text:e,lineNumber:s,columnNumber:n});o.tabIndex=-1;this._selectableChildren.push({element:o,forceSelect:()=>o.focus()});return o})}static _tokenizeMessageText(e){if(!Console.ConsoleViewMessage._tokenizerRegexes){const e="\\u0000-\\u0020\\u007f-\\u009f";const t=new RegExp("(?:[a-zA-Z][a-zA-Z0-9+.-]{2,}:\\/\\/|data:|www\\.)[^\\s"+e+'"]{2,}[^\\s'+e+"\"')}\\],:;.!?]","u");const s=/(?:\/[\w\.-]*)+\:[\d]+/;const n=/took [\d]+ms/;const o=/'\w+' event/;const i=/\sM[6-7]\d/;const r=/\(suggested: \"[\w-]+\"\)/;const l=new Map;l.set(t,"url");l.set(s,"url");l.set(n,"time");l.set(o,"event");l.set(i,"milestone");l.set(r,"autofill");Console.ConsoleViewMessage._tokenizerRegexes=Array.from(l.keys());Console.ConsoleViewMessage._tokenizerTypes=Array.from(l.values())}if(e.length>Console.ConsoleViewMessage._MaxTokenizableStringLength)return[{text:e,type:undefined}];const t=TextUtils.TextUtils.splitStringByRegexes(e,Console.ConsoleViewMessage._tokenizerRegexes);return t.map(e=>({text:e.value,type:Console.ConsoleViewMessage._tokenizerTypes[e.regexIndex]}))}groupKey(){if(!this._groupKey)this._groupKey=this._message.groupCategoryKey()+":"+this.groupTitle();return this._groupKey}groupTitle(){const e=Console.ConsoleViewMessage._tokenizeMessageText(this._message.messageText);const t=e.reduce((e,t)=>{let s=t.text;if(t.type==="url")s=Common.UIString("<URL>");else if(t.type==="time")s=Common.UIString("took <N>ms");else if(t.type==="event")s=Common.UIString("<some> event");else if(t.type==="milestone")s=Common.UIString(" M<XX>");else if(t.type==="autofill")s=Common.UIString("<attribute>");return e+s},"");return t.replace(/[%]o/g,"")}};Console.ConsoleGroupViewMessage=class extends Console.ConsoleViewMessage{constructor(e,t,s,n,o,i){console.assert(e.isGroupStartMessage());super(e,t,s,n,i);this._collapsed=e.type===SDK.ConsoleMessage.MessageType.StartGroupCollapsed;this._expandGroupIcon=null;this._onToggle=o}_setCollapsed(e){this._collapsed=e;if(this._expandGroupIcon)this._expandGroupIcon.setIconType(this._collapsed?"smallicon-triangle-right":"smallicon-triangle-down");this._onToggle.call(null)}collapsed(){return this._collapsed}maybeHandleOnKeyDown(e){const t=this._focusedChildIndex();if(t===-1){if(e.key==="ArrowLeft"&&!this._collapsed||e.key==="ArrowRight"&&this._collapsed){this._setCollapsed(!this._collapsed);return true}}return super.maybeHandleOnKeyDown(e)}toMessageElement(){if(!this._element){super.toMessageElement();const e=this._collapsed?"smallicon-triangle-right":"smallicon-triangle-down";this._expandGroupIcon=UI.Icon.create(e,"expand-group-icon");this._contentElement.tabIndex=-1;if(this._repeatCountElement)this._repeatCountElement.insertBefore(this._expandGroupIcon,this._repeatCountElement.firstChild);else this._element.insertBefore(this._expandGroupIcon,this._contentElement);this._element.addEventListener("click",()=>this._setCollapsed(!this._collapsed))}return this._element}_showRepeatCountElement(){super._showRepeatCountElement();if(this._repeatCountElement&&this._expandGroupIcon)this._repeatCountElement.insertBefore(this._expandGroupIcon,this._repeatCountElement.firstChild)}};Console.ConsoleViewMessage.MaxLengthForLinks=40;Console.ConsoleViewMessage._MaxTokenizableStringLength=1e4;Console.ConsoleViewMessage._LongStringVisibleLength=5e3;Console.ConsolePrompt=class extends UI.Widget{constructor(){super();this.registerRequiredCSS("console/consolePrompt.css");this._addCompletionsFromHistory=true;this._history=new Console.ConsoleHistoryManager;this._initialText="";this._editor=null;this._eagerPreviewElement=createElementWithClass("div","console-eager-preview");this._textChangeThrottler=new Common.Throttler(150);this._formatter=new ObjectUI.RemoteObjectPreviewFormatter;this._requestPreviewBound=this._requestPreview.bind(this);this._innerPreviewElement=this._eagerPreviewElement.createChild("div","console-eager-inner-preview");this._eagerPreviewElement.appendChild(UI.Icon.create("smallicon-command-result","preview-result-icon"));const e=this.element.createChild("div","console-prompt-editor-container");this.element.appendChild(this._eagerPreviewElement);this._promptIcon=UI.Icon.create("smallicon-text-prompt","console-prompt-icon");this.element.appendChild(this._promptIcon);this._iconThrottler=new Common.Throttler(0);this._eagerEvalSetting=Common.settings.moduleSetting("consoleEagerEval");this._eagerEvalSetting.addChangeListener(this._eagerSettingChanged.bind(this));this._eagerPreviewElement.classList.toggle("hidden",!this._eagerEvalSetting.get());this.element.tabIndex=0;this._previewRequestForTest=null;this._defaultAutocompleteConfig=null;this._highlightingNode=false;self.runtime.extension(UI.TextEditorFactory).instance().then(t.bind(this));function t(t){this._editor=t.createEditor({lineNumbers:false,lineWrapping:true,mimeType:"javascript",autoHeight:true});this._defaultAutocompleteConfig=ObjectUI.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor);this._editor.configureAutocomplete(Object.assign({},this._defaultAutocompleteConfig,{suggestionsCallback:this._wordsWithQuery.bind(this),anchorBehavior:UI.GlassPane.AnchorBehavior.PreferTop}));this._editor.widget().element.addEventListener("keydown",this._editorKeyDown.bind(this),true);this._editor.widget().show(e);this._editor.addEventListener(UI.TextEditor.Events.CursorChanged,this._updatePromptIcon,this);this._editor.addEventListener(UI.TextEditor.Events.TextChanged,this._onTextChanged,this);this._editor.addEventListener(UI.TextEditor.Events.SuggestionChanged,this._onTextChanged,this);this.setText(this._initialText);delete this._initialText;if(this.hasFocus())this.focus();this.element.removeAttribute("tabindex");this._editor.widget().element.tabIndex=-1;this._editorSetForTest();Host.userMetrics.panelLoaded("console","DevTools.Launch.Console")}}_eagerSettingChanged(){const e=this._eagerEvalSetting.get();this._eagerPreviewElement.classList.toggle("hidden",!e);if(e)this._requestPreview()}belowEditorElement(){return this._eagerPreviewElement}_onTextChanged(){if(this._eagerEvalSetting.get()){const e=!this._editor.textWithCurrentSuggestion();this._previewRequestForTest=this._textChangeThrottler.schedule(this._requestPreviewBound,e)}this._updatePromptIcon();this.dispatchEventToListeners(Console.ConsolePrompt.Events.TextChanged)}async _requestPreview(){const e=this._editor.textWithCurrentSuggestion().trim();const t=UI.context.flavor(SDK.ExecutionContext);const{preview:s,result:n}=await ObjectUI.JavaScriptREPL.evaluateAndBuildPreview(e,true,500);this._innerPreviewElement.removeChildren();if(s.deepTextContent()!==this._editor.textWithCurrentSuggestion().trim())this._innerPreviewElement.appendChild(s);if(n&&n.object&&n.object.subtype==="node"){this._highlightingNode=true;SDK.OverlayModel.highlightObjectAsDOMNode(n.object)}else if(this._highlightingNode){this._highlightingNode=false;SDK.OverlayModel.hideDOMNodeHighlight()}if(n)t.runtimeModel.releaseEvaluationResult(n)}willHide(){if(this._highlightingNode){this._highlightingNode=false;SDK.OverlayModel.hideDOMNodeHighlight()}}history(){return this._history}clearAutocomplete(){if(this._editor)this._editor.clearAutocomplete()}_isCaretAtEndOfPrompt(){return!!this._editor&&this._editor.selection().collapseToEnd().equal(this._editor.fullRange().collapseToEnd())}moveCaretToEndOfPrompt(){if(this._editor)this._editor.setSelection(TextUtils.TextRange.createFromLocation(Infinity,Infinity))}setText(e){if(this._editor)this._editor.setText(e);else this._initialText=e;this.dispatchEventToListeners(Console.ConsolePrompt.Events.TextChanged)}text(){return this._editor?this._editor.text():this._initialText}setAddCompletionsFromHistory(e){this._addCompletionsFromHistory=e}_editorKeyDown(e){const t=e;let s;let n;const o=this._editor.selection();const i=this._editor.visualCoordinates(o.endLine,o.endColumn).y;switch(t.keyCode){case UI.KeyboardShortcut.Keys.Up.code:const e=this._editor.visualCoordinates(0,0).y;if(t.shiftKey||!o.isEmpty()||i!==e)break;s=this._history.previous(this.text());n=true;break;case UI.KeyboardShortcut.Keys.Down.code:const r=this._editor.fullRange();const l=this._editor.visualCoordinates(r.endLine,r.endColumn).y;if(t.shiftKey||!o.isEmpty()||i!==l)break;s=this._history.next();break;case UI.KeyboardShortcut.Keys.P.code:if(Host.isMac()&&t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.shiftKey){s=this._history.previous(this.text());n=true}break;case UI.KeyboardShortcut.Keys.N.code:if(Host.isMac()&&t.ctrlKey&&!t.metaKey&&!t.altKey&&!t.shiftKey)s=this._history.next();break;case UI.KeyboardShortcut.Keys.Enter.code:this._enterKeyPressed(t);break;case UI.KeyboardShortcut.Keys.Tab.code:if(!this.text())t.consume();break}if(s===undefined)return;t.consume(true);this.setText(s);if(n)this._editor.setSelection(TextUtils.TextRange.createFromLocation(0,Infinity));else this.moveCaretToEndOfPrompt()}async _enterWillEvaluate(){if(!this._isCaretAtEndOfPrompt())return true;return await ObjectUI.JavaScriptAutocomplete.isExpressionComplete(this.text())}_updatePromptIcon(){this._iconThrottler.schedule(async()=>{const e=await this._enterWillEvaluate();this._promptIcon.classList.toggle("console-prompt-incomplete",!e)})}async _enterKeyPressed(e){if(e.altKey||e.ctrlKey||e.shiftKey)return;e.consume(true);this.element.scrollIntoView();this.clearAutocomplete();const t=this.text();if(!t.length)return;if(await this._enterWillEvaluate())await this._appendCommand(t,true);else this._editor.newlineAndIndent();this._enterProcessedForTest()}async _appendCommand(e,t){this.setText("");const s=UI.context.flavor(SDK.ExecutionContext);if(s){const n=s;const o=SDK.consoleModel.addCommandMessage(n,e);const i=await ObjectUI.JavaScriptREPL.preprocessExpression(e);SDK.consoleModel.evaluateCommandInConsole(n,o,i.text,t,i.preprocessed);if(Console.ConsolePanel.instance().isShowing())Host.userMetrics.actionTaken(Host.UserMetrics.Action.CommandEvaluatedInConsolePanel)}}_enterProcessedForTest(){}_historyCompletions(e,t){const s=this.text();if(!this._addCompletionsFromHistory||!this._isCaretAtEndOfPrompt()||!s&&!t)return[];const n=[];const o=new Set;const i=this._history.historyData();for(let t=i.length-1;t>=0&&n.length<50;--t){const r=i[t];if(!r.startsWith(s))continue;if(o.has(r))continue;o.add(r);n.push({text:r.substring(s.length-e.length),iconType:"smallicon-text-prompt",isSecondary:true})}return n}focus(){if(this._editor)this._editor.widget().focus();else this.element.focus()}async _wordsWithQuery(e,t,s){const n=this._editor.text(e);const o=await this._defaultAutocompleteConfig.suggestionsCallback(e,t,s);const i=this._historyCompletions(n,s);return o.concat(i)}_editorSetForTest(){}};Console.ConsoleHistoryManager=class{constructor(){this._data=[];this._historyOffset=1}historyData(){return this._data}setHistoryData(e){this._data=e.slice();this._historyOffset=1}pushHistoryItem(e){if(this._uncommittedIsTop){this._data.pop();delete this._uncommittedIsTop}this._historyOffset=1;if(e===this._currentHistoryItem())return;this._data.push(e)}_pushCurrentText(e){if(this._uncommittedIsTop)this._data.pop();this._uncommittedIsTop=true;this._data.push(e)}previous(e){if(this._historyOffset>this._data.length)return undefined;if(this._historyOffset===1)this._pushCurrentText(e);++this._historyOffset;return this._currentHistoryItem()}next(){if(this._historyOffset===1)return undefined;--this._historyOffset;return this._currentHistoryItem()}_currentHistoryItem(){return this._data[this._data.length-this._historyOffset]}};Console.ConsolePrompt.Events={TextChanged:Symbol("TextChanged")};Console.ConsoleView=class extends UI.VBox{constructor(){super();this.setMinimumSize(0,35);this.registerRequiredCSS("console/consoleView.css");this.registerRequiredCSS("object_ui/objectValue.css");this._searchableView=new UI.SearchableView(this);this._searchableView.element.classList.add("console-searchable-view");this._searchableView.setPlaceholder(Common.UIString("Find string in logs"));this._searchableView.setMinimalSearchQuerySize(0);this._badgePool=new ProductRegistry.BadgePool;this._sidebar=new Console.ConsoleSidebar(this._badgePool);this._sidebar.addEventListener(Console.ConsoleSidebar.Events.FilterSelected,this._onFilterChanged.bind(this));this._isSidebarOpen=false;this._filter=new Console.ConsoleViewFilter(this._onFilterChanged.bind(this));const e=this.element.createChild("div","console-toolbar-container");this._splitWidget=new UI.SplitWidget(true,false,"console.sidebar.width",100);this._splitWidget.setMainWidget(this._searchableView);this._splitWidget.setSidebarWidget(this._sidebar);this._splitWidget.show(this.element);this._splitWidget.hideSidebar();this._splitWidget.enableShowModeSaving();this._isSidebarOpen=this._splitWidget.showMode()===UI.SplitWidget.ShowMode.Both;if(this._isSidebarOpen)this._filter._levelMenuButton.setEnabled(false);this._splitWidget.addEventListener(UI.SplitWidget.Events.ShowModeChanged,e=>{this._isSidebarOpen=e.data===UI.SplitWidget.ShowMode.Both;this._filter._levelMenuButton.setEnabled(!this._isSidebarOpen);this._onFilterChanged()});this._contentsElement=this._searchableView.element;this.element.classList.add("console-view");this._visibleViewMessages=[];this._hiddenByFilterCount=0;this._shouldBeHiddenCache=new Set;this._groupableMessages=new Map;this._groupableMessageTitle=new Map;this._regexMatchRanges=[];this._consoleContextSelector=new Console.ConsoleContextSelector;this._filterStatusText=new UI.ToolbarText;this._filterStatusText.element.classList.add("dimmed");this._showSettingsPaneSetting=Common.settings.createSetting("consoleShowSettingsToolbar",false);this._showSettingsPaneButton=new UI.ToolbarSettingToggle(this._showSettingsPaneSetting,"largeicon-settings-gear",Common.UIString("Console settings"));this._progressToolbarItem=new UI.ToolbarItem(createElement("div"));this._groupSimilarSetting=Common.settings.moduleSetting("consoleGroupSimilar");this._groupSimilarSetting.addChangeListener(()=>this._updateMessageList());const t=new UI.ToolbarSettingCheckbox(this._groupSimilarSetting,Common.UIString("Group similar"));const s=new UI.Toolbar("console-main-toolbar",e);const n=new UI.Toolbar("",e);s.appendToolbarItem(this._splitWidget.createShowHideSidebarButton("console sidebar"));s.appendToolbarItem(UI.Toolbar.createActionButton(UI.actionRegistry.action("console.clear")));s.appendSeparator();s.appendToolbarItem(this._consoleContextSelector.toolbarItem());s.appendSeparator();s.appendToolbarItem(UI.Toolbar.createActionButton(UI.actionRegistry.action("console.create-pin")));s.appendSeparator();s.appendToolbarItem(this._filter._textFilterUI);s.appendToolbarItem(this._filter._levelMenuButton);s.appendToolbarItem(this._progressToolbarItem);n.appendSeparator();n.appendToolbarItem(this._filterStatusText);n.appendToolbarItem(this._showSettingsPaneButton);this._preserveLogCheckbox=new UI.ToolbarSettingCheckbox(Common.moduleSetting("preserveConsoleLog"),Common.UIString("Do not clear log on page reload / navigation"),Common.UIString("Preserve log"));this._hideNetworkMessagesCheckbox=new UI.ToolbarSettingCheckbox(this._filter._hideNetworkMessagesSetting,this._filter._hideNetworkMessagesSetting.title(),Common.UIString("Hide network"));const o=new UI.ToolbarSettingCheckbox(this._filter._filterByExecutionContextSetting,Common.UIString("Only show messages from the current context (top, iframe, worker, extension)"),Common.UIString("Selected context only"));const i=Common.moduleSetting("monitoringXHREnabled");this._timestampsSetting=Common.moduleSetting("consoleTimestampsEnabled");this._consoleHistoryAutocompleteSetting=Common.moduleSetting("consoleHistoryAutocomplete");const r=new UI.HBox;r.show(this._contentsElement);r.element.classList.add("console-settings-pane");UI.ARIAUtils.setAccessibleName(r.element,ls`Console settings`);UI.ARIAUtils.markAsGroup(r.element);const l=new UI.Toolbar("",r.element);l.makeVertical();l.appendToolbarItem(this._hideNetworkMessagesCheckbox);l.appendToolbarItem(this._preserveLogCheckbox);l.appendToolbarItem(o);l.appendToolbarItem(t);const a=new UI.Toolbar("",r.element);a.makeVertical();a.appendToolbarItem(new UI.ToolbarSettingCheckbox(i));const h=new UI.ToolbarSettingCheckbox(Common.settings.moduleSetting("consoleEagerEval"),ls`Eagerly evaluate text in the prompt`);a.appendToolbarItem(h);a.appendToolbarItem(new UI.ToolbarSettingCheckbox(this._consoleHistoryAutocompleteSetting));const c=new UI.ToolbarSettingCheckbox(Common.settings.moduleSetting("consoleUserActivationEval"));a.appendToolbarItem(c);if(!this._showSettingsPaneSetting.get())r.element.classList.add("hidden");this._showSettingsPaneSetting.addChangeListener(()=>r.element.classList.toggle("hidden",!this._showSettingsPaneSetting.get()));this._pinPane=new Console.ConsolePinPane;this._pinPane.element.classList.add("console-view-pinpane");this._pinPane.show(this._contentsElement);this._pinPane.element.addEventListener("keydown",e=>{if(e.key==="Enter"&&UI.KeyboardShortcut.eventHasCtrlOrMeta(e)||e.keyCode===UI.KeyboardShortcut.Keys.Esc.code){this._prompt.focus();e.consume()}});this._viewport=new Console.ConsoleViewport(this);this._viewport.setStickToBottom(true);this._viewport.contentElement().classList.add("console-group","console-group-messages");this._contentsElement.appendChild(this._viewport.element);this._messagesElement=this._viewport.element;this._messagesElement.id="console-messages";this._messagesElement.classList.add("monospace");this._messagesElement.addEventListener("click",this._messagesClicked.bind(this),false);this._messagesElement.addEventListener("paste",this._messagesPasted.bind(this),true);this._messagesElement.addEventListener("clipboard-paste",this._messagesPasted.bind(this),true);this._viewportThrottler=new Common.Throttler(50);this._pendingBatchResize=false;this._onMessageResizedBound=this._onMessageResized.bind(this);this._topGroup=Console.ConsoleGroup.createTopGroup();this._currentGroup=this._topGroup;this._promptElement=this._messagesElement.createChild("div","source-code");this._promptElement.id="console-prompt";const d=this._messagesElement.createChild("div","console-view-fix-select-all");d.textContent=".";UI.ARIAUtils.markAsHidden(d);this._registerShortcuts();this._messagesElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),false);this._linkifier=new Components.Linkifier(Console.ConsoleViewMessage.MaxLengthForLinks);this._consoleMessages=[];this._viewMessageSymbol=Symbol("viewMessage");this._consoleHistorySetting=Common.settings.createLocalSetting("consoleHistory",[]);this._prompt=new Console.ConsolePrompt;this._prompt.show(this._promptElement);this._prompt.element.addEventListener("keydown",this._promptKeyDown.bind(this),true);this._prompt.addEventListener(Console.ConsolePrompt.Events.TextChanged,this._promptTextChanged,this);this._messagesElement.addEventListener("keydown",this._messagesKeyDown.bind(this),false);this._prompt.element.addEventListener("focusin",()=>{if(this._isScrolledToBottom())this._viewport.setStickToBottom(true)});this._consoleHistoryAutocompleteSetting.addChangeListener(this._consoleHistoryAutocompleteChanged,this);const m=this._consoleHistorySetting.get();this._prompt.history().setHistoryData(m);this._consoleHistoryAutocompleteChanged();this._updateFilterStatus();this._timestampsSetting.addChangeListener(this._consoleTimestampsSettingChanged,this);this._registerWithMessageSink();UI.context.addFlavorChangeListener(SDK.ExecutionContext,this._executionContextChanged,this);this._messagesElement.addEventListener("mousedown",e=>this._updateStickToBottomOnPointerDown(e.button===2),false);this._messagesElement.addEventListener("mouseup",this._updateStickToBottomOnPointerUp.bind(this),false);this._messagesElement.addEventListener("mouseleave",this._updateStickToBottomOnPointerUp.bind(this),false);this._messagesElement.addEventListener("wheel",this._updateStickToBottomOnWheel.bind(this),false);this._messagesElement.addEventListener("touchstart",this._updateStickToBottomOnPointerDown.bind(this,false),false);this._messagesElement.addEventListener("touchend",this._updateStickToBottomOnPointerUp.bind(this),false);this._messagesElement.addEventListener("touchcancel",this._updateStickToBottomOnPointerUp.bind(this),false);SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.ConsoleCleared,this._consoleCleared,this);SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageAdded,this._onConsoleMessageAdded,this);SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.MessageUpdated,this._onConsoleMessageUpdated,this);SDK.consoleModel.addEventListener(SDK.ConsoleModel.Events.CommandEvaluated,this._commandEvaluated,this);SDK.consoleModel.messages().forEach(this._addConsoleMessage,this)}static instance(){if(!Console.ConsoleView._instance)Console.ConsoleView._instance=new Console.ConsoleView;return Console.ConsoleView._instance}static clearConsole(){SDK.consoleModel.requestClearMessages()}_onFilterChanged(){this._filter._currentFilter.levelsMask=this._isSidebarOpen?Console.ConsoleFilter.allLevelsFilterValue():this._filter._messageLevelFiltersSetting.get();this._cancelBuildHiddenCache();if(this._immediatelyFilterMessagesForTest){for(const e of this._consoleMessages)this._computeShouldMessageBeVisible(e);this._updateMessageList();return}this._buildHiddenCache(0,this._consoleMessages.slice())}_setImmediatelyFilterMessagesForTest(){this._immediatelyFilterMessagesForTest=true}searchableView(){return this._searchableView}_clearHistory(){this._consoleHistorySetting.set([]);this._prompt.history().setHistoryData([])}_consoleHistoryAutocompleteChanged(){this._prompt.setAddCompletionsFromHistory(this._consoleHistoryAutocompleteSetting.get())}itemCount(){return this._visibleViewMessages.length}itemElement(e){return this._visibleViewMessages[e]}fastHeight(e){return this._visibleViewMessages[e].fastHeight()}minimumRowHeight(){return 16}_registerWithMessageSink(){Common.console.messages().forEach(this._addSinkMessage,this);Common.console.addEventListener(Common.Console.Events.MessageAdded,e,this);function e(e){this._addSinkMessage(e.data)}}_addSinkMessage(e){let t=SDK.ConsoleMessage.MessageLevel.Verbose;switch(e.level){case Common.Console.MessageLevel.Info:t=SDK.ConsoleMessage.MessageLevel.Info;break;case Common.Console.MessageLevel.Error:t=SDK.ConsoleMessage.MessageLevel.Error;break;case Common.Console.MessageLevel.Warning:t=SDK.ConsoleMessage.MessageLevel.Warning;break}const s=new SDK.ConsoleMessage(null,SDK.ConsoleMessage.MessageSource.Other,t,e.text,SDK.ConsoleMessage.MessageType.System,undefined,undefined,undefined,undefined,undefined,e.timestamp);this._addConsoleMessage(s)}_consoleTimestampsSettingChanged(){this._updateMessageList();this._consoleMessages.forEach(e=>e.updateTimestamp());this._groupableMessageTitle.forEach(e=>e.updateTimestamp())}_executionContextChanged(){this._prompt.clearAutocomplete()}willHide(){this._hidePromptSuggestBox()}wasShown(){this._viewport.refresh()}focus(){if(this._viewport.hasVirtualSelection())this._viewport.contentElement().focus();else this._focusPrompt()}_focusPrompt(){if(!this._prompt.hasFocus()){const e=this._viewport.stickToBottom();const t=this._viewport.element.scrollTop;this._prompt.focus();this._viewport.setStickToBottom(e);this._viewport.element.scrollTop=t}}restoreScrollPositions(){if(this._viewport.stickToBottom())this._immediatelyScrollToBottom();else super.restoreScrollPositions()}onResize(){this._scheduleViewportRefresh();this._hidePromptSuggestBox();if(this._viewport.stickToBottom())this._immediatelyScrollToBottom();for(let e=0;e<this._visibleViewMessages.length;++e)this._visibleViewMessages[e].onResize()}_hidePromptSuggestBox(){this._prompt.clearAutocomplete()}_invalidateViewport(){if(this._muteViewportUpdates){this._maybeDirtyWhileMuted=true;return Promise.resolve()}if(this._needsFullUpdate){this._updateMessageList();delete this._needsFullUpdate}else{this._viewport.invalidate()}return Promise.resolve()}_scheduleViewportRefresh(){if(this._muteViewportUpdates){this._maybeDirtyWhileMuted=true;this._scheduleViewportRefreshForTest(true);return}else{this._scheduleViewportRefreshForTest(false)}this._scheduledRefreshPromiseForTest=this._viewportThrottler.schedule(this._invalidateViewport.bind(this))}_scheduleViewportRefreshForTest(e){}_immediatelyScrollToBottom(){this._viewport.setStickToBottom(true);this._promptElement.scrollIntoView(true)}_updateFilterStatus(){if(this._hiddenByFilterCount===this._lastShownHiddenByFilterCount)return;this._filterStatusText.setText(ls`${this._hiddenByFilterCount} hidden`);this._filterStatusText.setVisible(!!this._hiddenByFilterCount);this._lastShownHiddenByFilterCount=this._hiddenByFilterCount}_onConsoleMessageAdded(e){const t=e.data;this._addConsoleMessage(t)}_addConsoleMessage(e){const t=this._createViewMessage(e);e[this._viewMessageSymbol]=t;if(e.type===SDK.ConsoleMessage.MessageType.Command||e.type===SDK.ConsoleMessage.MessageType.Result){const e=this._consoleMessages.peekLast();t[Console.ConsoleView._messageSortingTimeSymbol]=e?e[Console.ConsoleView._messageSortingTimeSymbol]:0}else{t[Console.ConsoleView._messageSortingTimeSymbol]=t.consoleMessage().timestamp}let s;if(!this._consoleMessages.length||i(t,this._consoleMessages[this._consoleMessages.length-1])>0)s=this._consoleMessages.length;else s=this._consoleMessages.upperBound(t,i);const n=s<this._consoleMessages.length;this._consoleMessages.splice(s,0,t);this._filter.onMessageAdded(e);this._sidebar.onMessageAdded(t);let o=false;if(e.isGroupable()){const e=t.groupKey();o=this._groupSimilarSetting.get()&&this._groupableMessages.has(e);let s=this._groupableMessages.get(e);if(!s){s=[];this._groupableMessages.set(e,s)}s.push(t)}this._computeShouldMessageBeVisible(t);if(!o&&!n){this._appendMessageToEnd(t);this._updateFilterStatus();this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length)}else{this._needsFullUpdate=true}this._scheduleViewportRefresh();this._consoleMessageAddedForTest(t);function i(e,t){return e[Console.ConsoleView._messageSortingTimeSymbol]-t[Console.ConsoleView._messageSortingTimeSymbol]}}_onConsoleMessageUpdated(e){const t=e.data;const s=t[this._viewMessageSymbol];if(s){s.updateMessageElement();this._computeShouldMessageBeVisible(s);this._updateMessageList()}}_consoleMessageAddedForTest(e){}_shouldMessageBeVisible(e){return!this._shouldBeHiddenCache.has(e)}_computeShouldMessageBeVisible(e){if(this._filter.shouldBeVisible(e)&&(!this._isSidebarOpen||this._sidebar.shouldBeVisible(e)))this._shouldBeHiddenCache.delete(e);else this._shouldBeHiddenCache.add(e)}_appendMessageToEnd(e,t){if(!this._shouldMessageBeVisible(e)){this._hiddenByFilterCount++;return}if(!t&&this._tryToCollapseMessages(e,this._visibleViewMessages.peekLast()))return;const s=this._visibleViewMessages.peekLast();if(e.consoleMessage().type===SDK.ConsoleMessage.MessageType.EndGroup){if(s&&!this._currentGroup.messagesHidden())s.incrementCloseGroupDecorationCount();this._currentGroup=this._currentGroup.parentGroup()||this._currentGroup;return}if(!this._currentGroup.messagesHidden()){const t=e.consoleMessage().originatingMessage();if(s&&t&&s.consoleMessage()===t)e.toMessageElement().classList.add("console-adjacent-user-command-result");this._visibleViewMessages.push(e);this._searchMessage(this._visibleViewMessages.length-1)}if(e.consoleMessage().isGroupStartMessage())this._currentGroup=new Console.ConsoleGroup(this._currentGroup,e);this._messageAppendedForTests()}_messageAppendedForTests(){}_createViewMessage(e){const t=this._currentGroup.nestingLevel();switch(e.type){case SDK.ConsoleMessage.MessageType.Command:return new Console.ConsoleCommand(e,this._linkifier,this._badgePool,t,this._onMessageResizedBound);case SDK.ConsoleMessage.MessageType.Result:return new Console.ConsoleCommandResult(e,this._linkifier,this._badgePool,t,this._onMessageResizedBound);case SDK.ConsoleMessage.MessageType.StartGroupCollapsed:case SDK.ConsoleMessage.MessageType.StartGroup:return new Console.ConsoleGroupViewMessage(e,this._linkifier,this._badgePool,t,this._updateMessageList.bind(this),this._onMessageResizedBound);default:return new Console.ConsoleViewMessage(e,this._linkifier,this._badgePool,t,this._onMessageResizedBound)}}async _onMessageResized(e){const t=e.data;if(this._pendingBatchResize||!t.treeOutline)return;this._pendingBatchResize=true;await Promise.resolve();const s=t.treeOutline.element;this._viewport.setStickToBottom(this._isScrolledToBottom());if(s.offsetHeight<=this._messagesElement.offsetHeight)s.scrollIntoViewIfNeeded();this._pendingBatchResize=false}_consoleCleared(){const e=this._viewport.element.hasFocus();this._cancelBuildHiddenCache();this._currentMatchRangeIndex=-1;this._consoleMessages=[];this._groupableMessages.clear();this._groupableMessageTitle.clear();this._sidebar.clear();this._updateMessageList();this._hidePromptSuggestBox();this._viewport.setStickToBottom(true);this._linkifier.reset();this._badgePool.reset();this._filter.clear();if(e)this._prompt.focus()}_handleContextMenuEvent(e){const t=new UI.ContextMenu(e);if(e.target.isSelfOrDescendant(this._promptElement)){t.show();return}const s=e.target.enclosingNodeOrSelfWithClass("console-message-wrapper");const n=s?s.message.consoleMessage():null;if(n&&n.url){const e=ls`Hide messages from ${new Common.ParsedURL(n.url).displayName}`;t.headerSection().appendItem(e,this._filter.addMessageURLFilter.bind(this._filter,n.url))}t.defaultSection().appendAction("console.clear");t.defaultSection().appendAction("console.clear.history");t.saveSection().appendItem(Common.UIString("Save as..."),this._saveConsole.bind(this));if(this.element.hasSelection()){t.clipboardSection().appendItem(Common.UIString("Copy visible styled selection"),this._viewport.copyWithStyles.bind(this._viewport))}if(n){const e=SDK.NetworkLog.requestForConsoleMessage(n);if(e&&SDK.NetworkManager.canReplayRequest(e))t.debugSection().appendItem(ls`Replay XHR`,SDK.NetworkManager.replayRequest.bind(null,e))}t.show()}async _saveConsole(){const e=SDK.targetManager.mainTarget().inspectedURL();const t=e.asParsedURL();const s=String.sprintf("%s-%d.log",t?t.host:"console",Date.now());const n=new Bindings.FileOutputStream;const o=new UI.ProgressIndicator;o.setTitle(Common.UIString("Writing file"));o.setTotalWork(this.itemCount());const i=350;if(!await n.open(s))return;this._progressToolbarItem.element.appendChild(o.element);let r=0;while(r<this.itemCount()&&!o.isCanceled()){const e=[];let t;for(t=0;t<i&&t+r<this.itemCount();++t){const s=this.itemElement(r+t);e.push(s.toExportString())}r+=t;await n.write(e.join("\n")+"\n");o.setWorked(r)}n.close();o.done()}_tryToCollapseMessages(e,t){const s=this._timestampsSetting.get();if(!s&&t&&!e.consoleMessage().isGroupMessage()&&e.consoleMessage().type!==SDK.ConsoleMessage.MessageType.Command&&e.consoleMessage().type!==SDK.ConsoleMessage.MessageType.Result&&e.consoleMessage().isEqual(t.consoleMessage())){t.incrementRepeatCount();if(e.isLastInSimilarGroup())t.setInSimilarGroup(true,true);return true}return false}_buildHiddenCache(e,t){const s=Date.now();let n;for(n=e;n<t.length;++n){this._computeShouldMessageBeVisible(t[n]);if(n%10===0&&Date.now()-s>12)break}if(n===t.length){this._updateMessageList();return}this._buildHiddenCacheTimeout=this.element.window().requestAnimationFrame(this._buildHiddenCache.bind(this,n,t))}_cancelBuildHiddenCache(){this._shouldBeHiddenCache.clear();if(this._buildHiddenCacheTimeout){this.element.window().cancelAnimationFrame(this._buildHiddenCacheTimeout);delete this._buildHiddenCacheTimeout}}_updateMessageList(){this._topGroup=Console.ConsoleGroup.createTopGroup();this._currentGroup=this._topGroup;this._regexMatchRanges=[];this._hiddenByFilterCount=0;for(let e=0;e<this._visibleViewMessages.length;++e){this._visibleViewMessages[e].resetCloseGroupDecorationCount();this._visibleViewMessages[e].resetIncrementRepeatCount()}this._visibleViewMessages=[];if(this._groupSimilarSetting.get()){this._addGroupableMessagesToEnd()}else{for(let e=0;e<this._consoleMessages.length;++e){this._consoleMessages[e].setInSimilarGroup(false);this._appendMessageToEnd(this._consoleMessages[e])}}this._updateFilterStatus();this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length);this._viewport.invalidate()}_addGroupableMessagesToEnd(){const e=new Set;const t=new Set;for(let s=0;s<this._consoleMessages.length;++s){const n=this._consoleMessages[s];const o=n.consoleMessage();if(e.has(o))continue;if(!o.isGroupable()){this._appendMessageToEnd(n);e.add(o);continue}const i=n.groupKey();const r=this._groupableMessages.get(i);if(!r||r.length<5){n.setInSimilarGroup(false);this._appendMessageToEnd(n);e.add(o);continue}if(t.has(i))continue;if(!r.find(e=>this._shouldMessageBeVisible(e))){e.addAll(r);t.add(i);continue}let l=this._groupableMessageTitle.get(i);if(!l){const e=new SDK.ConsoleMessage(null,o.source,o.level,n.groupTitle(),SDK.ConsoleMessage.MessageType.StartGroupCollapsed);l=this._createViewMessage(e);this._groupableMessageTitle.set(i,l)}l.setRepeatCount(r.length);this._appendMessageToEnd(l);for(const t of r){t.setInSimilarGroup(true,r.peekLast()===t);this._appendMessageToEnd(t,true);e.add(t.consoleMessage())}const a=new SDK.ConsoleMessage(null,o.source,o.level,o.messageText,SDK.ConsoleMessage.MessageType.EndGroup);this._appendMessageToEnd(this._createViewMessage(a))}}_messagesClicked(e){const t=e.target;if(!this._messagesElement.hasSelection()){const e=t===this._messagesElement||this._prompt.belowEditorElement().isSelfOrAncestor(t);if(e){this._prompt.moveCaretToEndOfPrompt();this._focusPrompt()}}}_messagesKeyDown(e){const t=e.ctrlKey||e.altKey||e.metaKey;if(t||e.key.length!==1||UI.isEditing()||this._messagesElement.hasSelection())return;this._prompt.moveCaretToEndOfPrompt();this._focusPrompt()}_messagesPasted(e){if(UI.isEditing())return;this._prompt.focus()}_registerShortcuts(){this._shortcuts={};this._shortcuts[UI.KeyboardShortcut.makeKey("u",UI.KeyboardShortcut.Modifiers.Ctrl)]=this._clearPromptBackwards.bind(this)}_clearPromptBackwards(){this._prompt.setText("")}_promptKeyDown(e){const t=e;if(t.key==="PageUp"){this._updateStickToBottomOnWheel();return}const s=UI.KeyboardShortcut.makeKeyFromEvent(t);const n=this._shortcuts[s];if(n){n();t.preventDefault()}}_printResult(e,t,s){if(!e)return;const n=!!s?SDK.ConsoleMessage.MessageLevel.Error:SDK.ConsoleMessage.MessageLevel.Info;let o;if(!s){o=new SDK.ConsoleMessage(e.runtimeModel(),SDK.ConsoleMessage.MessageSource.JS,n,"",SDK.ConsoleMessage.MessageType.Result,undefined,undefined,undefined,[e])}else{o=SDK.ConsoleMessage.fromException(e.runtimeModel(),s,SDK.ConsoleMessage.MessageType.Result,undefined,undefined)}o.setOriginatingMessage(t);SDK.consoleModel.addMessage(o)}_commandEvaluated(e){const t=e.data;this._prompt.history().pushHistoryItem(t.commandMessage.messageText);this._consoleHistorySetting.set(this._prompt.history().historyData().slice(-Console.ConsoleView.persistedHistorySize));this._printResult(t.result,t.commandMessage,t.exceptionDetails)}elementsToRestoreScrollPositionsFor(){return[this._messagesElement]}searchCanceled(){this._cleanupAfterSearch();for(let e=0;e<this._visibleViewMessages.length;++e){const t=this._visibleViewMessages[e];t.setSearchRegex(null)}this._currentMatchRangeIndex=-1;this._regexMatchRanges=[];delete this._searchRegex;this._viewport.refresh()}performSearch(e,t,s){this.searchCanceled();this._searchableView.updateSearchMatchesCount(0);this._searchRegex=e.toSearchRegex(true);this._regexMatchRanges=[];this._currentMatchRangeIndex=-1;if(t)this._searchShouldJumpBackwards=!!s;this._searchProgressIndicator=new UI.ProgressIndicator;this._searchProgressIndicator.setTitle(Common.UIString("Searching"));this._searchProgressIndicator.setTotalWork(this._visibleViewMessages.length);this._progressToolbarItem.element.appendChild(this._searchProgressIndicator.element);this._innerSearch(0)}_cleanupAfterSearch(){delete this._searchShouldJumpBackwards;if(this._innerSearchTimeoutId){clearTimeout(this._innerSearchTimeoutId);delete this._innerSearchTimeoutId}if(this._searchProgressIndicator){this._searchProgressIndicator.done();delete this._searchProgressIndicator}}_searchFinishedForTests(){}_innerSearch(e){delete this._innerSearchTimeoutId;if(this._searchProgressIndicator.isCanceled()){this._cleanupAfterSearch();return}const t=Date.now();for(;e<this._visibleViewMessages.length&&Date.now()-t<100;++e)this._searchMessage(e);this._searchableView.updateSearchMatchesCount(this._regexMatchRanges.length);if(typeof this._searchShouldJumpBackwards!=="undefined"&&this._regexMatchRanges.length){this._jumpToMatch(this._searchShouldJumpBackwards?-1:0);delete this._searchShouldJumpBackwards}if(e===this._visibleViewMessages.length){this._cleanupAfterSearch();setTimeout(this._searchFinishedForTests.bind(this),0);return}this._innerSearchTimeoutId=setTimeout(this._innerSearch.bind(this,e),100);this._searchProgressIndicator.setWorked(e)}_searchMessage(e){const t=this._visibleViewMessages[e];t.setSearchRegex(this._searchRegex);for(let s=0;s<t.searchCount();++s)this._regexMatchRanges.push({messageIndex:e,matchIndex:s})}jumpToNextSearchResult(){this._jumpToMatch(this._currentMatchRangeIndex+1)}jumpToPreviousSearchResult(){this._jumpToMatch(this._currentMatchRangeIndex-1)}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}_jumpToMatch(e){if(!this._regexMatchRanges.length)return;let t;if(this._currentMatchRangeIndex>=0){t=this._regexMatchRanges[this._currentMatchRangeIndex];const e=this._visibleViewMessages[t.messageIndex];e.searchHighlightNode(t.matchIndex).classList.remove(UI.highlightedCurrentSearchResultClassName)}e=mod(e,this._regexMatchRanges.length);this._currentMatchRangeIndex=e;this._searchableView.updateCurrentMatchIndex(e);t=this._regexMatchRanges[e];const s=this._visibleViewMessages[t.messageIndex];const n=s.searchHighlightNode(t.matchIndex);n.classList.add(UI.highlightedCurrentSearchResultClassName);this._viewport.scrollItemIntoView(t.messageIndex);n.scrollIntoViewIfNeeded()}_updateStickToBottomOnPointerDown(e){this._muteViewportUpdates=!e;this._viewport.setStickToBottom(false);if(this._waitForScrollTimeout){clearTimeout(this._waitForScrollTimeout);delete this._waitForScrollTimeout}}_updateStickToBottomOnPointerUp(){if(!this._muteViewportUpdates)return;this._waitForScrollTimeout=setTimeout(e.bind(this),200);function e(){this._muteViewportUpdates=false;if(this.isShowing())this._viewport.setStickToBottom(this._isScrolledToBottom());if(this._maybeDirtyWhileMuted){this._scheduleViewportRefresh();delete this._maybeDirtyWhileMuted}delete this._waitForScrollTimeout;this._updateViewportStickinessForTest()}}_updateViewportStickinessForTest(){}_updateStickToBottomOnWheel(){this._updateStickToBottomOnPointerDown();this._updateStickToBottomOnPointerUp()}_promptTextChanged(){const e=this._viewport.stickToBottom();const t=this._isScrolledToBottom();this._viewport.setStickToBottom(t);if(t&&!e)this._scheduleViewportRefresh();this._promptTextChangedForTest()}_promptTextChangedForTest(){}_isScrolledToBottom(){const e=this._messagesElement.scrollHeight-this._messagesElement.scrollTop-this._messagesElement.clientHeight-this._prompt.belowEditorElement().offsetHeight;return e<=2}};Console.ConsoleView.persistedHistorySize=300;Console.ConsoleViewFilter=class{constructor(e){this._filterChanged=e;this._messageLevelFiltersSetting=Console.ConsoleViewFilter.levelFilterSetting();this._hideNetworkMessagesSetting=Common.moduleSetting("hideNetworkMessages");this._filterByExecutionContextSetting=Common.moduleSetting("selectedContextFilterEnabled");this._messageLevelFiltersSetting.addChangeListener(this._onFilterChanged.bind(this));this._hideNetworkMessagesSetting.addChangeListener(this._onFilterChanged.bind(this));this._filterByExecutionContextSetting.addChangeListener(this._onFilterChanged.bind(this));UI.context.addFlavorChangeListener(SDK.ExecutionContext,this._onFilterChanged,this);const t=Object.values(Console.ConsoleFilter.FilterType);this._suggestionBuilder=new UI.FilterSuggestionBuilder(t);this._textFilterUI=new UI.ToolbarInput(Common.UIString("Filter"),.2,1,Common.UIString("e.g. /event\\d/ -cdn url:a.com"),this._suggestionBuilder.completions.bind(this._suggestionBuilder));this._textFilterSetting=Common.settings.createSetting("console.textFilter","");if(this._textFilterSetting.get())this._textFilterUI.setValue(this._textFilterSetting.get());this._textFilterUI.addEventListener(UI.ToolbarInput.Event.TextChanged,()=>{this._textFilterSetting.set(this._textFilterUI.value());this._onFilterChanged()});this._filterParser=new TextUtils.FilterParser(t);this._currentFilter=new Console.ConsoleFilter("",[],null,this._messageLevelFiltersSetting.get());this._updateCurrentFilter();this._levelLabels={};this._levelLabels[SDK.ConsoleMessage.MessageLevel.Verbose]=Common.UIString("Verbose");this._levelLabels[SDK.ConsoleMessage.MessageLevel.Info]=Common.UIString("Info");this._levelLabels[SDK.ConsoleMessage.MessageLevel.Warning]=Common.UIString("Warnings");this._levelLabels[SDK.ConsoleMessage.MessageLevel.Error]=Common.UIString("Errors");this._levelMenuButton=new UI.ToolbarButton(ls`Log levels`);this._levelMenuButton.turnIntoSelect();this._levelMenuButton.addEventListener(UI.ToolbarButton.Events.Click,this._showLevelContextMenu.bind(this));this._updateLevelMenuButtonText();this._messageLevelFiltersSetting.addChangeListener(this._updateLevelMenuButtonText.bind(this))}onMessageAdded(e){if(e.type===SDK.ConsoleMessage.MessageType.Command||e.type===SDK.ConsoleMessage.MessageType.Result||e.isGroupMessage())return;if(e.context)this._suggestionBuilder.addItem(Console.ConsoleFilter.FilterType.Context,e.context);if(e.source)this._suggestionBuilder.addItem(Console.ConsoleFilter.FilterType.Source,e.source);if(e.url)this._suggestionBuilder.addItem(Console.ConsoleFilter.FilterType.Url,e.url)}static levelFilterSetting(){return Common.settings.createSetting("messageLevelFilters",Console.ConsoleFilter.defaultLevelsFilterValue())}_updateCurrentFilter(){const e=this._filterParser.parse(this._textFilterUI.value());if(this._hideNetworkMessagesSetting.get()){e.push({key:Console.ConsoleFilter.FilterType.Source,text:SDK.ConsoleMessage.MessageSource.Network,negative:true})}this._currentFilter.executionContext=this._filterByExecutionContextSetting.get()?UI.context.flavor(SDK.ExecutionContext):null;this._currentFilter.parsedFilters=e;this._currentFilter.levelsMask=this._messageLevelFiltersSetting.get()}_onFilterChanged(){this._updateCurrentFilter();this._filterChanged()}_updateLevelMenuButtonText(){let e=true;let t=true;const s=Console.ConsoleFilter.allLevelsFilterValue();const n=Console.ConsoleFilter.defaultLevelsFilterValue();let o=null;const i=this._messageLevelFiltersSetting.get();for(const r of Object.values(SDK.ConsoleMessage.MessageLevel)){e=e&&i[r]===s[r];t=t&&i[r]===n[r];if(i[r])o=o?Common.UIString("Custom levels"):Common.UIString("%s only",this._levelLabels[r])}if(e)o=Common.UIString("All levels");else if(t)o=Common.UIString("Default levels");else o=o||Common.UIString("Hide all");this._levelMenuButton.element.classList.toggle("warning",!e&&!t);this._levelMenuButton.setText(o)}_showLevelContextMenu(e){const t=e.data;const s=this._messageLevelFiltersSetting;const n=s.get();const o=new UI.ContextMenu(t,true,this._levelMenuButton.element.totalOffsetLeft(),this._levelMenuButton.element.totalOffsetTop()+this._levelMenuButton.element.offsetHeight);o.headerSection().appendItem(Common.UIString("Default"),()=>s.set(Console.ConsoleFilter.defaultLevelsFilterValue()));for(const e in this._levelLabels){o.defaultSection().appendCheckboxItem(this._levelLabels[e],i.bind(null,e),n[e])}o.show();function i(e){n[e]=!n[e];s.set(n)}}addMessageURLFilter(e){if(!e)return;const t=this._textFilterUI.value()?` ${this._textFilterUI.value()}`:"";this._textFilterUI.setValue(`-url:${e}${t}`);this._textFilterSetting.set(this._textFilterUI.value());this._onFilterChanged()}shouldBeVisible(e){return this._currentFilter.shouldBeVisible(e)}clear(){this._suggestionBuilder.clear()}reset(){this._messageLevelFiltersSetting.set(Console.ConsoleFilter.defaultLevelsFilterValue());this._filterByExecutionContextSetting.set(false);this._hideNetworkMessagesSetting.set(false);this._textFilterUI.setValue("");this._onFilterChanged()}};Console.ConsoleCommand=class extends Console.ConsoleViewMessage{contentElement(){if(!this._contentElement){this._contentElement=createElementWithClass("div","console-user-command");const e=UI.Icon.create("smallicon-user-command","command-result-icon");this._contentElement.appendChild(e);this._contentElement.message=this;this._formattedCommand=createElementWithClass("span","source-code");this._formattedCommand.textContent=this.text.replaceControlCharacters();this._contentElement.appendChild(this._formattedCommand);if(this._formattedCommand.textContent.length<Console.ConsoleCommand.MaxLengthToIgnoreHighlighter){const e=new UI.SyntaxHighlighter("text/javascript",true);e.syntaxHighlightNode(this._formattedCommand).then(this._updateSearch.bind(this))}else{this._updateSearch()}this.updateTimestamp()}return this._contentElement}_updateSearch(){this.setSearchRegex(this.searchRegex())}};Console.ConsoleCommand.MaxLengthToIgnoreHighlighter=1e4;Console.ConsoleCommandResult=class extends Console.ConsoleViewMessage{contentElement(){const e=super.contentElement();if(!e.classList.contains("console-user-command-result")){e.classList.add("console-user-command-result");if(this.consoleMessage().level===SDK.ConsoleMessage.MessageLevel.Info){const t=UI.Icon.create("smallicon-command-result","command-result-icon");e.insertBefore(t,e.firstChild)}}return e}};Console.ConsoleGroup=class{constructor(e,t){this._parentGroup=e;this._nestingLevel=e?e.nestingLevel()+1:0;this._messagesHidden=t&&t.collapsed()||this._parentGroup&&this._parentGroup.messagesHidden()}static createTopGroup(){return new Console.ConsoleGroup(null,null)}messagesHidden(){return this._messagesHidden}nestingLevel(){return this._nestingLevel}parentGroup(){return this._parentGroup}};Console.ConsoleView.ActionDelegate=class{handleAction(e,t){switch(t){case"console.show":InspectorFrontendHost.bringToFront();Common.console.show();Console.ConsoleView.instance()._focusPrompt();return true;case"console.clear":Console.ConsoleView.clearConsole();return true;case"console.clear.history":Console.ConsoleView.instance()._clearHistory();return true;case"console.create-pin":Console.ConsoleView.instance()._pinPane.addPin("",true);return true}return false}};Console.ConsoleView.RegexMatchRange;Console.ConsoleView._messageSortingTimeSymbol=Symbol("messageSortingTime");Console.ConsolePanel=class extends UI.Panel{constructor(){super("console");this._view=Console.ConsoleView.instance()}static instance(){return self.runtime.sharedInstance(Console.ConsolePanel)}static _updateContextFlavor(){const e=Console.ConsolePanel.instance()._view;UI.context.setFlavor(Console.ConsoleView,e.isShowing()?e:null)}wasShown(){super.wasShown();const e=Console.ConsolePanel.WrapperView._instance;if(e&&e.isShowing())UI.inspectorView.setDrawerMinimized(true);this._view.show(this.element);Console.ConsolePanel._updateContextFlavor()}willHide(){super.willHide();UI.inspectorView.setDrawerMinimized(false);if(Console.ConsolePanel.WrapperView._instance)Console.ConsolePanel.WrapperView._instance._showViewInWrapper();Console.ConsolePanel._updateContextFlavor()}searchableView(){return Console.ConsoleView.instance().searchableView()}};Console.ConsolePanel.WrapperView=class extends UI.VBox{constructor(){super();this.element.classList.add("console-view-wrapper");Console.ConsolePanel.WrapperView._instance=this;this._view=Console.ConsoleView.instance()}wasShown(){if(!Console.ConsolePanel.instance().isShowing())this._showViewInWrapper();else UI.inspectorView.setDrawerMinimized(true);Console.ConsolePanel._updateContextFlavor()}willHide(){UI.inspectorView.setDrawerMinimized(false);Console.ConsolePanel._updateContextFlavor()}_showViewInWrapper(){this._view.show(this.element)}};Console.ConsolePanel.ConsoleRevealer=class{reveal(e){const t=Console.ConsoleView.instance();if(t.isShowing()){t.focus();return Promise.resolve()}UI.viewManager.showView("console-view");return Promise.resolve()}};Runtime.cachedResources["console/consoleContextSelector.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    padding: 2px 1px 2px 2px;\n    white-space: nowrap;\n    display: flex;\n    flex-direction: column;\n    height: 36px;\n    justify-content: center;\n}\n\n.title {\n    overflow: hidden;\n    text-overflow: ellipsis;\n    flex-grow: 0;\n}\n\n.badge {\n    pointer-events: none;\n    margin-right: 4px;\n    display: inline-block;\n    height: 15px;\n}\n\n.subtitle {\n    color: #999;\n    margin-right: 3px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    flex-grow: 0;\n}\n\n:host(.highlighted) .subtitle {\n    color: inherit;\n}\n";Runtime.cachedResources["console/consolePinPane.css"]='/*\n * Copyright 2018 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.console-pins {\n  overflow-y: auto;\n  background: var(--toolbar-bg-color);\n  --error-background-color: hsl(0, 100%, 97%);\n  --error-border-color: hsl(0, 100%, 92%);\n  --error-text-color: red;\n}\n\n:host-context(.-theme-with-dark-background) .console-pins {\n  --error-background-color: hsl(0, 100%, 8%);\n  --error-border-color: rgb(92, 0, 0);\n  --error-text-color: hsl(0, 100%, 75%);\n}\n\n.console-pins:not(:empty) {\n  border-bottom: 1px solid var(--divider-color);\n}\n\n.console-pin {\n  position: relative;\n  user-select: text;\n  flex: none;\n  padding: 2px 0 6px 24px;\n}\n\n.console-pin:not(:last-child) {\n  border-bottom: 1px solid #e4e4e4;\n}\n\n.console-pin:not(:last-child).error-level:not(:focus-within) {\n  border-top: 1px solid var(--error-border-color);\n  border-bottom: 1px solid var(--error-border-color);\n  margin-top: -1px;\n}\n\n.console-pin.error-level:not(:focus-within) {\n  background-color: var(--error-background-color);\n  color: var(--error-text-color);\n}\n\n.console-pin-name {\n  margin-left: -4px;\n  margin-bottom: 1px;\n  height: auto;\n}\n\n.console-pin-name,\n.console-pin-preview {\n  width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  min-height: 13px;\n}\n\n:host-context(.-theme-with-dark-background) .console-delete-pin {\n  filter: brightness(2);\n}\n\n.console-delete-pin {\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  opacity: 0.7;\n  cursor: pointer;\n}\n\n.console-delete-pin:hover,\n.console-delete-pin[data-keyboard-focus="true"]:focus {\n  opacity: 1;\n}\n\n.console-pin-name:focus-within {\n  background: #fff;\n  box-shadow: var(--focus-ring-active-shadow) inset;\n}\n\n.console-pin:focus-within .console-pin-preview,\n.console-pin-name:not(:focus-within):not(:hover) {\n  opacity: 0.6;\n}\n';Runtime.cachedResources["console/consolePrompt.css"]="/*\n * Copyright 2018 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n#console-prompt .CodeMirror {\n  padding: 3px 0 1px 0;\n}\n\n#console-prompt .CodeMirror-line {\n  padding-top: 0;\n}\n\n#console-prompt .CodeMirror-lines {\n  padding-top: 0;\n}\n\n#console-prompt .console-prompt-icon {\n  position: absolute;\n  left: -13px;\n  top: 5px;\n  -webkit-user-select: none;\n}\n\n.console-eager-preview {\n  padding-bottom: 2px;\n  opacity: 0.6;\n  position: relative;\n  height: 15px;\n}\n\n.console-eager-inner-preview {\n  text-overflow: ellipsis;\n  overflow: hidden;\n  margin-left: 4px;\n  height: 100%;\n}\n\n.console-eager-inner-preview {\n  white-space: nowrap;\n}\n\n.console-eager-inner-preview:empty,\n.console-eager-inner-preview:empty + .preview-result-icon {\n  opacity: 0;\n}\n\n.preview-result-icon {\n  position: absolute;\n  left: -13px;\n  top: 1px;\n}\n\n.console-prompt-icon.console-prompt-incomplete {\n  opacity: 0.65;\n}\n";Runtime.cachedResources["console/consoleSidebar.css"]="/*\n * Copyright (c) 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    overflow: auto;\n    background-color: var(--toolbar-bg-color);\n}\n\n.tree-outline-disclosure {\n    max-width: 100%;\n    padding-left: 6px;\n}\n\n.count {\n    flex: none;\n    margin: 0 8px;\n}\n\n[is=ui-icon] {\n    margin: 0 5px;\n}\n\n[is=ui-icon].icon-mask {\n    background-color: #555;\n}\n\nli {\n    height: 24px;\n}\n\nli .largeicon-navigator-file {\n    background: linear-gradient(45deg, hsl(48, 70%, 50%), hsl(48, 70%, 70%));\n    margin: 0;\n}\n\nli .largeicon-navigator-folder {\n    background: linear-gradient(45deg, hsl(210, 82%, 65%), hsl(210, 82%, 80%));\n    margin: -3px -3px 0 -5px;\n}\n\n.tree-element-title {\n    flex-shrink: 100;\n    flex-grow: 1;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.tree-outline li:hover:not(.selected) .selection {\n    display: block;\n    background-color: rgba(56, 121, 217, 0.1);\n}\n";Runtime.cachedResources["console/consoleView.css"]='/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.console-view {\n    background-color: white;\n    overflow: hidden;\n    --message-border-color: rgb(240, 240, 240);\n    --warning-border-color: hsl(50, 100%, 88%);\n    --error-border-color: hsl(0, 100%, 92%);\n    --error-text-color: red;\n}\n\n.-theme-with-dark-background .console-view {\n    --message-border-color: rgb(58, 58, 58);\n    --warning-border-color: rgb(102, 85, 0);\n    --error-border-color: rgb(92, 0, 0);\n    --error-text-color: hsl(0, 100%, 75%);\n}\n\n.console-toolbar-container {\n    display: flex;\n    flex: none;\n}\n\n.console-main-toolbar {\n    flex: 1 1 auto;\n}\n\n.console-toolbar-container > .toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.console-view-wrapper {\n    background-color: #eee;\n}\n\n.console-view-fix-select-all {\n    height: 0;\n    overflow: hidden;\n}\n\n.console-settings-pane {\n    flex: none;\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.console-settings-pane .toolbar {\n    flex: 1 1;\n}\n\n#console-messages {\n    flex: 1 1;\n    overflow-y: auto;\n    word-wrap: break-word;\n    -webkit-user-select: text;\n    transform: translateZ(0);\n    overflow-anchor: none;  /* Chrome-specific scroll-anchoring opt-out */\n}\n\n#console-prompt {\n    clear: right;\n    position: relative;\n    margin: 0 22px 0 20px;\n}\n\n.console-prompt-editor-container {\n    min-height: 21px;\n}\n\n.console-message,\n.console-user-command {\n    clear: right;\n    position: relative;\n    padding: 3px 22px 1px 0;\n    margin-left: 24px;\n    min-height: 17px;  /* Sync with ConsoleViewMessage.js */\n    flex: auto;\n    display: flex;\n}\n\n.console-message > * {\n    flex: auto;\n}\n\n.console-timestamp {\n    color: gray;\n    -webkit-user-select: none;\n    flex: none;\n    margin-right: 5px;\n}\n\n.message-level-icon, .command-result-icon {\n    position: absolute;\n    left: -17px;\n    top: 4px;\n    -webkit-user-select: none;\n}\n\n.console-message-repeat-count {\n    margin: 2px 0 0 10px;\n    flex: none;\n}\n\n.repeated-message {\n    margin-left: 4px;\n}\n\n.repeated-message .message-level-icon {\n    display: none;\n}\n\n.repeated-message .console-message-stack-trace-toggle,\n.repeated-message > .console-message-text {\n    flex: 1;\n}\n\n.console-error-level .repeated-message,\n.console-warning-level .repeated-message,\n.console-verbose-level .repeated-message,\n.console-info-level .repeated-message {\n    display: flex;\n}\n\n.console-info {\n    color: rgb(128, 128, 128);\n    font-style: italic;\n    padding-bottom: 2px;\n}\n\n.console-group .console-group > .console-group-messages {\n    margin-left: 16px;\n}\n\n.console-group-title.console-from-api {\n    font-weight: bold;\n}\n\n.console-group-title .console-message {\n    margin-left: 12px;\n}\n\n.expand-group-icon {\n    -webkit-user-select: none;\n    flex: none;\n    background-color: rgb(110, 110, 110);\n    position: relative;\n    left: 10px;\n    top: 5px;\n    margin-right: 2px;\n}\n\n.console-group-title .message-level-icon {\n    display: none;\n}\n\n.console-message-repeat-count .expand-group-icon {\n    left: 2px;\n    top: 2px;\n    background-color: #fff;\n    margin-right: 4px;\n}\n\n.console-group {\n    position: relative;\n}\n\n.console-message-wrapper {\n    display: flex;\n    border-top: 1px solid var(--message-border-color);\n    border-bottom: 1px solid transparent;\n}\n\n.console-message-wrapper:first-of-type {\n    border-top-color: transparent;\n}\n\n.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level) {\n    border-top-width: 0px;\n}\n\n.console-message-wrapper.console-error-level,\n.console-message-wrapper.console-error-level:not(:focus) + .console-message-wrapper:not(.console-warning-level):not(:focus) {\n    border-top-color: var(--error-border-color);\n}\n\n.console-message-wrapper.console-warning-level,\n.console-message-wrapper.console-warning-level:not(:focus) + .console-message-wrapper:not(.console-error-level):not(:focus) {\n    border-top-color: var(--warning-border-color);\n}\n\n.console-message-wrapper:last-of-type {\n    border-bottom-color: var(--message-border-color);\n}\n\n.console-message-wrapper.console-error-level:last-of-type {\n    border-bottom-color: var(--error-border-color);\n}\n\n.console-message-wrapper.console-warning-level:last-of-type {\n    border-bottom-color: var(--warning-border-color);\n}\n\n.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus {\n    border-top-width: 1px;\n}\n\n.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus .console-message {\n    padding-top: 2px;\n    min-height: 16px;\n}\n\n.console-message-wrapper.console-adjacent-user-command-result:not(.console-error-level):not(.console-warning-level):focus .command-result-icon {\n    top: 3px;\n}\n\n.console-message-wrapper:focus,\n.console-message-wrapper:focus:last-of-type {\n    border-top-color: hsl(214, 67%, 88%);\n    border-bottom-color: hsl(214, 67%, 88%);\n    background-color: hsl(214, 48%, 95%);\n}\n\n.console-message-wrapper.console-error-level:focus,\n.console-message-wrapper.console-error-level:focus:last-of-type {\n    --error-text-color: rgb(200, 0, 0);\n}\n\n.-theme-with-dark-background .console-message-wrapper.console-error-level:focus,\n.-theme-with-dark-background .console-message-wrapper.console-error-level:focus:last-of-type {\n    --error-text-color: hsl(0, 100%, 75%);\n}\n\n.-theme-with-dark-background .console-message-wrapper:focus,\n.-theme-with-dark-background .console-message-wrapper:focus:last-of-type {\n    border-top-color: hsl(214, 47%, 48%);\n    border-bottom-color: hsl(214, 47%, 48%);\n    background-color: hsl(214, 19%, 20%);\n}\n\n.console-message-wrapper:focus + .console-message-wrapper {\n    border-top-color: transparent;\n}\n\n.console-message-wrapper .nesting-level-marker {\n    width: 14px;\n    flex: 0 0 auto;\n    border-right: 1px solid #a5a5a5;\n    position: relative;\n    margin-bottom: -1px;\n    margin-top: -1px;\n}\n\n.console-message-wrapper:last-child .nesting-level-marker::before,\n.console-message-wrapper .nesting-level-marker.group-closed::before {\n    content: "";\n}\n\n.console-message-wrapper .nesting-level-marker::before {\n    border-bottom: 1px solid #a5a5a5;\n    position: absolute;\n    top: 0;\n    left: 0;\n    margin-left: 100%;\n    width: 3px;\n    height: 100%;\n    box-sizing: border-box;\n}\n\n.console-error-level {\n    background-color: hsl(0, 100%, 97%);\n}\n\n.-theme-with-dark-background .console-error-level {\n    background-color: hsl(0, 100%, 8%);\n}\n\n.console-warning-level {\n    background-color: hsl(50, 100%, 95%);\n}\n\n.-theme-with-dark-background .console-warning-level {\n    background-color: hsl(50, 100%, 10%);\n}\n\n.console-warning-level .console-message-text {\n    color: hsl(39, 100%, 18%);\n}\n\n.console-error-level .console-message-text,\n.console-error-level .console-view-object-properties-section {\n    color: var(--error-text-color) !important;\n}\n\n.console-system-type.console-info-level {\n    color: blue;\n}\n\n.-theme-with-dark-background .console-verbose-level:not(.console-warning-level) .console-message-text,\n.-theme-with-dark-background .console-system-type.console-info-level {\n    color: hsl(220, 100%, 65%) !important;\n}\n\n.console-message.console-warning-level {\n    background-color: rgb(255, 250, 224);\n}\n\n#console-messages .link {\n    text-decoration: underline;\n}\n\n#console-messages .link,\n#console-messages .devtools-link {\n    color: rgb(33%, 33%, 33%);\n    cursor: pointer;\n    word-break: break-all;\n}\n\n#console-messages .link:hover,\n#console-messages .devtools-link:hover {\n    color: rgb(15%, 15%, 15%);\n}\n\n.console-group-messages .section {\n    margin: 0 0 0 12px !important;\n}\n\n.console-group-messages .section > .header {\n    padding: 0 8px 0 0;\n    background-image: none;\n    border: none;\n    min-height: 0;\n}\n\n.console-group-messages .section > .header::before {\n    margin-left: -12px;\n}\n\n.console-group-messages .section > .header .title {\n    color: #222;\n    font-weight: normal;\n    line-height: 13px;\n}\n\n.console-group-messages .section .properties li .info {\n    padding-top: 0;\n    padding-bottom: 0;\n    color: rgb(60%, 60%, 60%);\n}\n\n.console-object-preview {\n    white-space: normal;\n    word-wrap: break-word;\n    font-style: italic;\n}\n\n.console-object-preview .name {\n    /* Follows .section .properties .name, .event-properties .name */\n    color: rgb(136, 19, 145);\n    flex-shrink: 0;\n}\n\n.console-message-text .object-value-string,\n.console-message-text .object-value-regexp,\n.console-message-text .object-value-symbol {\n    white-space: pre-wrap;\n    word-break: break-all;\n}\n\n.console-message-formatted-table {\n    clear: both;\n}\n\n.console-message .source-code {\n    line-height: 1.2;\n}\n\n.console-message-anchor {\n    float: right;\n    text-align: right;\n    max-width: 100%;\n    margin-left: 4px;\n}\n\n.console-message-badge {\n    float: right;\n    margin-left: 4px;\n}\n\n.console-message-nowrap-below,\n.console-message-nowrap-below div,\n.console-message-nowrap-below span {\n    white-space: nowrap !important;\n}\n\n.object-state-note {\n    display: inline-block;\n    width: 11px;\n    height: 11px;\n    color: white;\n    text-align: center;\n    border-radius: 3px;\n    line-height: 13px;\n    margin: 0 6px;\n    font-size: 9px;\n}\n\n.-theme-with-dark-background .object-state-note {\n    background-color: hsl(230, 100%, 80%);\n}\n\n.info-note {\n    background-color: rgb(179, 203, 247);\n}\n\n.info-note::before {\n    content: "i";\n}\n\n.console-view-object-properties-section:not(.expanded) .info-note {\n    display: none;\n}\n\n.console-view-object-properties-section {\n    padding: 0px;\n    position: relative;\n    vertical-align: baseline;\n    color: inherit;\n    display: inline-block;\n    overflow-wrap: break-word;\n    max-width: 100%;\n}\n\n.console-object {\n    white-space: pre-wrap;\n    word-break: break-all;\n}\n\n.console-message-stack-trace-toggle {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n}\n\n.console-message-stack-trace-wrapper {\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n}\n\n.console-message-stack-trace-wrapper > * {\n    flex: none;\n}\n\n.console-message-expand-icon {\n    margin-bottom: -2px;\n}\n\n.console-searchable-view {\n    max-height: 100%;\n}\n\n.console-view-pinpane {\n    flex: none;\n    max-height: 200px;\n}\n';