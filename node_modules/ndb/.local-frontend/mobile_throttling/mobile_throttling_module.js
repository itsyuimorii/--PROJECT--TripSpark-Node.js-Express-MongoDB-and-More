self["MobileThrottling"]=self["MobileThrottling"]||{};MobileThrottling.CPUThrottlingRates={NoThrottling:1,MidTierMobile:4,LowEndMobile:6};MobileThrottling.Conditions;MobileThrottling.NoThrottlingConditions={title:SDK.NetworkManager.NoThrottlingConditions.title,description:Common.UIString("No throttling"),network:SDK.NetworkManager.NoThrottlingConditions,cpuThrottlingRate:MobileThrottling.CPUThrottlingRates.NoThrottling};MobileThrottling.OfflineConditions={title:SDK.NetworkManager.OfflineConditions.title,description:Common.UIString("No internet connectivity"),network:SDK.NetworkManager.OfflineConditions,cpuThrottlingRate:MobileThrottling.CPUThrottlingRates.NoThrottling};MobileThrottling.LowEndMobileConditions={title:Common.UIString("Low-end mobile"),description:Common.UIString("Slow 3G & 6x CPU slowdown"),network:SDK.NetworkManager.Slow3GConditions,cpuThrottlingRate:MobileThrottling.CPUThrottlingRates.LowEndMobile};MobileThrottling.MidTierMobileConditions={title:Common.UIString("Mid-tier mobile"),description:Common.UIString("Fast 3G & 4x CPU slowdown"),network:SDK.NetworkManager.Fast3GConditions,cpuThrottlingRate:MobileThrottling.CPUThrottlingRates.MidTierMobile};MobileThrottling.PlaceholderConditions;MobileThrottling.CustomConditions={title:Common.UIString("Custom"),description:Common.UIString("Check Network and Performance panels")};MobileThrottling.NetworkThrottlingConditionsGroup;MobileThrottling.MobileThrottlingConditionsGroup;MobileThrottling.ConditionsList;MobileThrottling.mobilePresets=[MobileThrottling.MidTierMobileConditions,MobileThrottling.LowEndMobileConditions,MobileThrottling.CustomConditions];MobileThrottling.advancedMobilePresets=[MobileThrottling.OfflineConditions];MobileThrottling.networkPresets=[SDK.NetworkManager.Fast3GConditions,SDK.NetworkManager.Slow3GConditions,SDK.NetworkManager.OfflineConditions];MobileThrottling.cpuThrottlingPresets=[MobileThrottling.CPUThrottlingRates.NoThrottling,MobileThrottling.CPUThrottlingRates.MidTierMobile,MobileThrottling.CPUThrottlingRates.LowEndMobile];MobileThrottling.MobileThrottlingSelector=class{constructor(t,n){this._populateCallback=t;this._selectCallback=n;MobileThrottling.throttlingManager().addEventListener(MobileThrottling.ThrottlingManager.Events.RateChanged,this._conditionsChanged,this);SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,this._conditionsChanged,this);this._options=this._populateOptions();this._conditionsChanged()}optionSelected(t){SDK.multitargetNetworkManager.setNetworkConditions(t.network);MobileThrottling.throttlingManager().setCPUThrottlingRate(t.cpuThrottlingRate)}_populateOptions(){const t={title:Common.UIString("Disabled"),items:[MobileThrottling.NoThrottlingConditions]};const n={title:Common.UIString("Presets"),items:MobileThrottling.mobilePresets};const o={title:Common.UIString("Advanced"),items:MobileThrottling.advancedMobilePresets};return this._populateCallback([t,n,o])}_conditionsChanged(){const t=SDK.multitargetNetworkManager.networkConditions();const n=MobileThrottling.throttlingManager().cpuThrottlingRate();for(let o=0;o<this._options.length;++o){const e=this._options[o];if(e&&e.network===t&&e.cpuThrottlingRate===n){this._selectCallback(o);return}}this._selectCallback(this._options.indexOf(MobileThrottling.CustomConditions))}};MobileThrottling.NetworkPanelIndicator=class{constructor(){if(!UI.inspectorView.hasPanel("network"))return;const t=SDK.multitargetNetworkManager;t.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,n);t.addEventListener(SDK.MultitargetNetworkManager.Events.BlockedPatternsChanged,n);t.addEventListener(SDK.MultitargetNetworkManager.Events.InterceptorsChanged,n);n();function n(){let n=null;if(t.isThrottling()){n=UI.Icon.create("smallicon-warning");n.title=Common.UIString("Network throttling is enabled")}else if(SDK.multitargetNetworkManager.isIntercepting()){n=UI.Icon.create("smallicon-warning");n.title=Common.UIString("Requests may be rewritten by local overrides")}else if(t.isBlocking()){n=UI.Icon.create("smallicon-warning");n.title=Common.UIString("Requests may be blocked")}UI.inspectorView.setPanelIcon("network",n)}}};MobileThrottling.NetworkThrottlingSelector=class{constructor(t,n,o){this._populateCallback=t;this._selectCallback=n;this._customNetworkConditionsSetting=o;this._customNetworkConditionsSetting.addChangeListener(this._populateOptions,this);SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,this._networkConditionsChanged,this);this._options;this._populateOptions()}revealAndUpdate(){Common.Revealer.reveal(this._customNetworkConditionsSetting);this._networkConditionsChanged()}optionSelected(t){SDK.multitargetNetworkManager.setNetworkConditions(t)}_populateOptions(){const t={title:Common.UIString("Disabled"),items:[SDK.NetworkManager.NoThrottlingConditions]};const n={title:Common.UIString("Presets"),items:MobileThrottling.networkPresets};const o={title:Common.UIString("Custom"),items:this._customNetworkConditionsSetting.get()};this._options=this._populateCallback([t,n,o]);if(!this._networkConditionsChanged()){for(let t=this._options.length-1;t>=0;t--){if(this._options[t]){this.optionSelected(this._options[t]);break}}}}_networkConditionsChanged(){const t=SDK.multitargetNetworkManager.networkConditions();for(let n=0;n<this._options.length;++n){const o=this._options[n];if(o&&o.download===t.download&&o.upload===t.upload&&o.latency===t.latency&&o.title===t.title){this._selectCallback(n);return true}}return false}};MobileThrottling.ThrottlingSettingsTab=class extends UI.VBox{constructor(){super(true);this.registerRequiredCSS("mobile_throttling/throttlingSettingsTab.css");this.contentElement.createChild("div","header").textContent=Common.UIString("Network Throttling Profiles");const t=UI.createTextButton(Common.UIString("Add custom profile..."),this._addButtonClicked.bind(this),"add-conditions-button");this.contentElement.appendChild(t);this._list=new UI.ListWidget(this);this._list.element.classList.add("conditions-list");this._list.registerRequiredCSS("mobile_throttling/throttlingSettingsTab.css");this._list.show(this.contentElement);this._customSetting=Common.moduleSetting("customNetworkConditions");this._customSetting.addChangeListener(this._conditionsUpdated,this);this.setDefaultFocusedElement(t);this.contentElement.tabIndex=0}wasShown(){super.wasShown();this._conditionsUpdated()}_conditionsUpdated(){this._list.clear();const t=this._customSetting.get();for(let n=0;n<t.length;++n)this._list.appendItem(t[n],true);this._list.appendSeparator()}_addButtonClicked(){this._list.addNewItem(this._customSetting.get().length,{title:"",download:-1,upload:-1,latency:0})}renderItem(t,n){const o=t;const e=createElementWithClass("div","conditions-list-item");const i=e.createChild("div","conditions-list-text conditions-list-title");const r=i.createChild("div","conditions-list-title-text");r.textContent=o.title;r.title=o.title;e.createChild("div","conditions-list-separator");e.createChild("div","conditions-list-text").textContent=MobileThrottling.throughputText(o.download);e.createChild("div","conditions-list-separator");e.createChild("div","conditions-list-text").textContent=MobileThrottling.throughputText(o.upload);e.createChild("div","conditions-list-separator");e.createChild("div","conditions-list-text").textContent=Common.UIString("%dms",o.latency);return e}removeItemRequested(t,n){const o=this._customSetting.get();o.splice(n,1);this._customSetting.set(o)}commitEdit(t,n,o){const e=t;e.title=n.control("title").value.trim();const i=n.control("download").value.trim();e.download=i?parseInt(i,10)*(1024/8):-1;const r=n.control("upload").value.trim();e.upload=r?parseInt(r,10)*(1024/8):-1;const l=n.control("latency").value.trim();e.latency=l?parseInt(l,10):0;const s=this._customSetting.get();if(o)s.push(e);this._customSetting.set(s)}beginEdit(t){const n=t;const o=this._createEditor();o.control("title").value=n.title;o.control("download").value=n.download<=0?"":String(n.download/(1024/8));o.control("upload").value=n.upload<=0?"":String(n.upload/(1024/8));o.control("latency").value=n.latency?String(n.latency):"";return o}_createEditor(){if(this._editor)return this._editor;const t=new UI.ListWidget.Editor;this._editor=t;const n=t.contentElement();const o=n.createChild("div","conditions-edit-row");o.createChild("div","conditions-list-text conditions-list-title").textContent=Common.UIString("Profile Name");o.createChild("div","conditions-list-separator conditions-list-separator-invisible");o.createChild("div","conditions-list-text").textContent=Common.UIString("Download");o.createChild("div","conditions-list-separator conditions-list-separator-invisible");o.createChild("div","conditions-list-text").textContent=Common.UIString("Upload");o.createChild("div","conditions-list-separator conditions-list-separator-invisible");o.createChild("div","conditions-list-text").textContent=Common.UIString("Latency");const e=n.createChild("div","conditions-edit-row");e.createChild("div","conditions-list-text conditions-list-title").appendChild(t.createInput("title","text","",r));e.createChild("div","conditions-list-separator conditions-list-separator-invisible");let i=e.createChild("div","conditions-list-text");i.appendChild(t.createInput("download","text",Common.UIString("kb/s"),l));i.createChild("div","conditions-edit-optional").textContent=Common.UIString("optional");e.createChild("div","conditions-list-separator conditions-list-separator-invisible");i=e.createChild("div","conditions-list-text");i.appendChild(t.createInput("upload","text",Common.UIString("kb/s"),l));i.createChild("div","conditions-edit-optional").textContent=Common.UIString("optional");e.createChild("div","conditions-list-separator conditions-list-separator-invisible");i=e.createChild("div","conditions-list-text");i.appendChild(t.createInput("latency","text",Common.UIString("ms"),s));i.createChild("div","conditions-edit-optional").textContent=Common.UIString("optional");return t;function r(t,n,o){const e=o.value.trim();return e.length>0&&e.length<50}function l(t,n,o){const e=o.value.trim();return!e||/^[\d]+(\.\d+)?|\.\d+$/.test(e)&&e>=0&&e<=1e7}function s(t,n,o){const e=o.value.trim();return!e||/^[\d]+$/.test(e)&&e>=0&&e<=1e6}}};MobileThrottling.throughputText=function(t,n){if(t<0)return"";const o=t/(1024/8);const e=n?"":" ";if(o<1024)return Common.UIString("%d%skb/s",o,e);if(o<1024*10)return Common.UIString("%.1f%sMb/s",o/1024,e);return Common.UIString("%d%sMb/s",o/1024|0,e)};MobileThrottling.ThrottlingManager=class extends Common.Object{constructor(){super();this._cpuThrottlingRate=MobileThrottling.CPUThrottlingRates.NoThrottling;this._cpuThrottlingControls=new Set;this._cpuThrottlingRates=MobileThrottling.cpuThrottlingPresets;this._customNetworkConditionsSetting=Common.moduleSetting("customNetworkConditions");this._currentNetworkThrottlingConditions=SDK.NetworkManager.NoThrottlingConditions;this._lastNetworkThrottlingConditions;SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,()=>{this._lastNetworkThrottlingConditions=this._currentNetworkThrottlingConditions;this._currentNetworkThrottlingConditions=SDK.multitargetNetworkManager.networkConditions()});SDK.targetManager.observeModels(SDK.EmulationModel,this)}decorateSelectWithNetworkThrottling(t){let n=[];const o=new MobileThrottling.NetworkThrottlingSelector(e,r,this._customNetworkConditionsSetting);t.addEventListener("change",i,false);return o;function e(o){t.removeChildren();n=[];for(let e=0;e<o.length;++e){const i=o[e];const r=t.createChild("optgroup");r.label=i.title;for(const t of i.items){const o=t.title;const e=new Option(o,o);r.appendChild(e);n.push(t)}if(e===o.length-1){r.appendChild(new Option(Common.UIString("Add…"),Common.UIString("Add…")));n.push(null)}}return n}function i(){if(t.selectedIndex===t.options.length-1)o.revealAndUpdate();else o.optionSelected(n[t.selectedIndex])}function r(n){if(t.selectedIndex!==n)t.selectedIndex=n}}createOfflineToolbarCheckbox(){const t=new UI.ToolbarCheckbox(Common.UIString("Offline"),Common.UIString("Force disconnected from network"),n.bind(this));SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,o);t.setChecked(SDK.multitargetNetworkManager.networkConditions()===SDK.NetworkManager.OfflineConditions);function n(){if(t.checked())SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.OfflineConditions);else SDK.multitargetNetworkManager.setNetworkConditions(this._lastNetworkThrottlingConditions)}function o(){t.setChecked(SDK.multitargetNetworkManager.networkConditions()===SDK.NetworkManager.OfflineConditions)}return t}createMobileThrottlingButton(){const t=new UI.ToolbarMenuButton(i);t.setTitle(Common.UIString("Throttling"));t.setGlyph("");t.turnIntoSelect();t.setDarkText();let n=[];let o=-1;const e=new MobileThrottling.MobileThrottlingSelector(r,l);return t;function i(t){for(let i=0;i<n.length;++i){const r=n[i];if(!r)continue;if(r.title===MobileThrottling.CustomConditions.title&&r.description===MobileThrottling.CustomConditions.description)continue;t.defaultSection().appendCheckboxItem(Common.UIString(r.title),e.optionSelected.bind(e,r),o===i)}}function r(t){n=[];for(const o of t){for(const t of o.items)n.push(t);n.push(null)}return n}function l(e){o=e;t.setText(n[e].title);t.setTitle(n[e].description)}}cpuThrottlingRate(){return this._cpuThrottlingRate}setCPUThrottlingRate(t){this._cpuThrottlingRate=t;for(const t of SDK.targetManager.models(SDK.EmulationModel))t.setCPUThrottlingRate(this._cpuThrottlingRate);let n=null;if(this._cpuThrottlingRate!==MobileThrottling.CPUThrottlingRates.NoThrottling){Host.userMetrics.actionTaken(Host.UserMetrics.Action.CpuThrottlingEnabled);n=UI.Icon.create("smallicon-warning");n.title=Common.UIString("CPU throttling is enabled")}const o=this._cpuThrottlingRates.indexOf(this._cpuThrottlingRate);for(const t of this._cpuThrottlingControls)t.setSelectedIndex(o);UI.inspectorView.setPanelIcon("timeline",n);this.dispatchEventToListeners(MobileThrottling.ThrottlingManager.Events.RateChanged,this._cpuThrottlingRate)}modelAdded(t){if(this._cpuThrottlingRate!==MobileThrottling.CPUThrottlingRates.NoThrottling)t.setCPUThrottlingRate(this._cpuThrottlingRate)}modelRemoved(t){}createCPUThrottlingSelector(){const t=new UI.ToolbarComboBox(t=>this.setCPUThrottlingRate(this._cpuThrottlingRates[t.target.selectedIndex]));this._cpuThrottlingControls.add(t);const n=this._cpuThrottlingRate;for(let o=0;o<this._cpuThrottlingRates.length;++o){const e=this._cpuThrottlingRates[o];const i=e===1?Common.UIString("No throttling"):Common.UIString("%d× slowdown",e);const r=t.createOption(i);t.addOption(r);if(n===e)t.setSelectedIndex(o)}return t}};MobileThrottling.ThrottlingManager.Events={RateChanged:Symbol("RateChanged")};MobileThrottling.ThrottlingManager.ActionDelegate=class{handleAction(t,n){if(n==="network-conditions.network-online"){SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.NoThrottlingConditions);return true}if(n==="network-conditions.network-low-end-mobile"){SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.Slow3GConditions);return true}if(n==="network-conditions.network-mid-tier-mobile"){SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.Fast3GConditions);return true}if(n==="network-conditions.network-offline"){SDK.multitargetNetworkManager.setNetworkConditions(SDK.NetworkManager.OfflineConditions);return true}return false}};MobileThrottling.throttlingManager=function(){return self.singleton(MobileThrottling.ThrottlingManager)};Runtime.cachedResources["mobile_throttling/throttlingSettingsTab.css"]="/*\n * Copyright 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n:host {\n    overflow:hidden;\n}\n\n.header {\n    padding: 0 0 6px;\n    border-bottom: 1px solid #EEEEEE;\n    font-size: 18px;\n    font-weight: normal;\n    flex: none;\n}\n\n.add-conditions-button {\n    flex: none;\n    margin: 10px 2px;\n    min-width: 140px;\n    align-self: flex-start;\n}\n\n.conditions-list {\n    max-width: 500px;\n    min-width: 340px;\n    flex: auto;\n}\n\n.conditions-list-item {\n    padding: 3px 5px 3px 5px;\n    height: 30px;\n    display: flex;\n    align-items: center;\n    position: relative;\n    flex: auto 1 1;\n}\n\n.conditions-list-text {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    flex: 0 0 70px;\n    -webkit-user-select: none;\n    color: #222;\n    text-align: end;\n    position: relative;\n}\n\n.conditions-list-title {\n    text-align: start;\n    flex: auto;\n    display: flex;\n    align-items: flex-start;\n}\n\n.conditions-list-title-text {\n    overflow: hidden;\n    flex: auto;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n}\n\n.conditions-list-separator {\n    flex: 0 0 1px;\n    background-color: rgb(231, 231, 231);\n    height: 30px;\n    margin: 0 4px;\n}\n\n.conditions-list-separator-invisible {\n    visibility: hidden;\n    height: 100% !important;\n}\n\n.conditions-edit-row {\n    flex: none;\n    display: flex;\n    flex-direction: row;\n    margin: 6px 5px;\n}\n\n.conditions-edit-row input {\n    width: 100%;\n    text-align: inherit;\n}\n\n.conditions-edit-optional {\n    position: absolute;\n    bottom: -20px;\n    right: 0;\n    color: rgb(128, 128, 128);\n}\n";