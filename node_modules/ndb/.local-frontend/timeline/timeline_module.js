self["Timeline"]=self["Timeline"]||{};Timeline.CountersGraph=class extends UI.VBox{constructor(e){super();this.element.id="memory-graphs-container";this._delegate=e;this._calculator=new Timeline.CountersGraph.Calculator;this._header=new UI.HBox;this._header.element.classList.add("timeline-memory-header");this._header.show(this.element);this._toolbar=new UI.Toolbar("timeline-memory-toolbar");this._header.element.appendChild(this._toolbar.element);this._graphsContainer=new UI.VBox;this._graphsContainer.show(this.element);const t=new UI.VBoxWithResizeCallback(this._resize.bind(this));t.show(this._graphsContainer.element);this._createCurrentValuesBar();this._canvasContainer=t.element;this._canvasContainer.id="memory-graphs-canvas-container";this._canvas=this._canvasContainer.createChild("canvas");this._canvas.id="memory-counters-graph";this._canvasContainer.addEventListener("mouseover",this._onMouseMove.bind(this),true);this._canvasContainer.addEventListener("mousemove",this._onMouseMove.bind(this),true);this._canvasContainer.addEventListener("mouseleave",this._onMouseLeave.bind(this),true);this._canvasContainer.addEventListener("click",this._onClick.bind(this),true);this._timelineGrid=new PerfUI.TimelineGrid;this._canvasContainer.appendChild(this._timelineGrid.dividersElement);this._counters=[];this._counterUI=[];this._countersByName={};this._countersByName["jsHeapSizeUsed"]=this._createCounter(Common.UIString("JS Heap"),Common.UIString("JS Heap: %s"),"hsl(220, 90%, 43%)",Number.bytesToString);this._countersByName["documents"]=this._createCounter(Common.UIString("Documents"),Common.UIString("Documents: %s"),"hsl(0, 90%, 43%)");this._countersByName["nodes"]=this._createCounter(Common.UIString("Nodes"),Common.UIString("Nodes: %s"),"hsl(120, 90%, 43%)");this._countersByName["jsEventListeners"]=this._createCounter(Common.UIString("Listeners"),Common.UIString("Listeners: %s"),"hsl(38, 90%, 43%)");this._gpuMemoryCounter=this._createCounter(Common.UIString("GPU Memory"),Common.UIString("GPU Memory [KB]: %s"),"hsl(300, 90%, 43%)",Number.bytesToString);this._countersByName["gpuMemoryUsedKB"]=this._gpuMemoryCounter}setModel(e,t){if(this._model!==e){if(this._model)this._model.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);this._model=e;if(this._model)this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this)}this._calculator.setZeroTime(e?e.timelineModel().minimumRecordTime():0);for(let e=0;e<this._counters.length;++e){this._counters[e].reset();this._counterUI[e].reset()}this.scheduleRefresh();this._track=t;if(!t)return;const i=t.syncEvents();for(let e=0;e<i.length;++e){const t=i[e];if(t.name!==TimelineModel.TimelineModel.RecordType.UpdateCounters)continue;const n=t.args.data;if(!n)return;for(const e in n){const i=this._countersByName[e];if(i)i.appendSample(t.startTime,n[e])}const s="gpuMemoryLimitKB";if(s in n)this._gpuMemoryCounter.setLimit(n[s])}}_createCurrentValuesBar(){this._currentValuesBar=this._graphsContainer.element.createChild("div");this._currentValuesBar.id="counter-values-bar"}_createCounter(e,t,i,n){const s=new Timeline.CountersGraph.Counter;this._counters.push(s);this._counterUI.push(new Timeline.CountersGraph.CounterUI(this,e,t,i,s,n));return s}resizerElement(){return this._header.element}_resize(){const e=this._canvas.parentElement;this._canvas.width=e.clientWidth*window.devicePixelRatio;this._canvas.height=e.clientHeight*window.devicePixelRatio;this._calculator.setDisplayWidth(this._canvas.width);this.refresh()}_onWindowChanged(e){const t=e.data.window;this._calculator.setWindow(t.left,t.right);this.scheduleRefresh()}scheduleRefresh(){UI.invokeOnceAfterBatchUpdate(this,this.refresh)}draw(){this._clear();for(const e of this._counters){e._calculateVisibleIndexes(this._calculator);e._calculateXValues(this._canvas.width)}for(const e of this._counterUI)e._drawGraph(this._canvas)}_onClick(e){const t=e.x-this._canvasContainer.totalOffsetLeft();let i=Infinity;let n;for(const e of this._counterUI){if(!e.counter.times.length)continue;const s=e._recordIndexAt(t);const r=Math.abs(t*window.devicePixelRatio-e.counter.x[s]);if(r<i){i=r;n=e.counter.times[s]}}if(n!==undefined){this._delegate.selectEntryAtTime(this._track.events.length?this._track.events:this._track.asyncEvents,n)}}_onMouseLeave(e){delete this._markerXPosition;this._clearCurrentValueAndMarker()}_clearCurrentValueAndMarker(){for(let e=0;e<this._counterUI.length;e++)this._counterUI[e]._clearCurrentValueAndMarker()}_onMouseMove(e){const t=e.x-this._canvasContainer.totalOffsetLeft();this._markerXPosition=t;this._refreshCurrentValues()}_refreshCurrentValues(){if(this._markerXPosition===undefined)return;for(let e=0;e<this._counterUI.length;++e)this._counterUI[e].updateCurrentValue(this._markerXPosition)}refresh(){this._timelineGrid.updateDividers(this._calculator);this.draw();this._refreshCurrentValues()}_clear(){const e=this._canvas.getContext("2d");e.clearRect(0,0,e.canvas.width,e.canvas.height)}};Timeline.CountersGraph.Counter=class{constructor(){this.times=[];this.values=[]}appendSample(e,t){if(this.values.length&&this.values.peekLast()===t)return;this.times.push(e);this.values.push(t)}reset(){this.times=[];this.values=[]}setLimit(e){this._limitValue=e}_calculateBounds(){let e;let t;for(let i=this._minimumIndex;i<=this._maximumIndex;i++){const n=this.values[i];if(t===undefined||n<t)t=n;if(e===undefined||n>e)e=n}t=t||0;e=e||1;if(this._limitValue){if(e>this._limitValue*.5)e=Math.max(e,this._limitValue);t=Math.min(t,this._limitValue)}return{min:t,max:e}}_calculateVisibleIndexes(e){const t=e.minimumBoundary();const i=e.maximumBoundary();this._minimumIndex=Number.constrain(this.times.upperBound(t)-1,0,this.times.length-1);this._maximumIndex=Number.constrain(this.times.lowerBound(i),0,this.times.length-1);this._minTime=t;this._maxTime=i}_calculateXValues(e){if(!this.values.length)return;const t=e/(this._maxTime-this._minTime);this.x=new Array(this.values.length);for(let e=this._minimumIndex+1;e<=this._maximumIndex;e++)this.x[e]=t*(this.times[e]-this._minTime)}};Timeline.CountersGraph.CounterUI=class{constructor(e,t,i,n,s,r){this._countersPane=e;this.counter=s;this._formatter=r||Number.withThousandsSeparator;this._setting=Common.settings.createSetting("timelineCountersGraph-"+t,true);this._setting.setTitle(t);this._filter=new UI.ToolbarSettingCheckbox(this._setting,t);this._filter.inputElement.classList.add("-theme-preserve");const o=Common.Color.parse(n).setAlpha(.5).asString(Common.Color.Format.RGBA);if(o){this._filter.element.backgroundColor=o;this._filter.element.borderColor="transparent"}this._filter.inputElement.addEventListener("click",this._toggleCounterGraph.bind(this));e._toolbar.appendToolbarItem(this._filter);this._range=this._filter.element.createChild("span","range");this._value=e._currentValuesBar.createChild("span","memory-counter-value");this._value.style.color=n;this.graphColor=n;this.limitColor=Common.Color.parse(n).setAlpha(.3).asString(Common.Color.Format.RGBA);this.graphYValues=[];this._verticalPadding=10;this._currentValueLabel=i;this._marker=e._canvasContainer.createChild("div","memory-counter-marker");this._marker.style.backgroundColor=n;this._clearCurrentValueAndMarker()}reset(){this._range.textContent=""}setRange(e,t){const i=this._formatter(e);const n=this._formatter(t);this._range.textContent=Common.UIString("[%s – %s]",i,n)}_toggleCounterGraph(e){this._value.classList.toggle("hidden",!this._filter.checked());this._countersPane.refresh()}_recordIndexAt(e){return this.counter.x.upperBound(e*window.devicePixelRatio,null,this.counter._minimumIndex+1,this.counter._maximumIndex+1)-1}updateCurrentValue(e){if(!this.visible()||!this.counter.values.length||!this.counter.x)return;const t=this._recordIndexAt(e);const i=Number.withThousandsSeparator(this.counter.values[t]);this._value.textContent=Common.UIString(this._currentValueLabel,i);const n=this.graphYValues[t]/window.devicePixelRatio;this._marker.style.left=e+"px";this._marker.style.top=n+"px";this._marker.classList.remove("hidden")}_clearCurrentValueAndMarker(){this._value.textContent="";this._marker.classList.add("hidden")}_drawGraph(e){const t=e.getContext("2d");const i=e.width;const n=e.height-2*this._verticalPadding;if(n<=0){this.graphYValues=[];return}const s=this._verticalPadding;const r=this.counter;const o=r.values;if(!o.length)return;const l=r._calculateBounds();const a=l.min;const d=l.max;this.setRange(a,d);if(!this.visible())return;const m=this.graphYValues;const c=d-a;const h=c?n/c:1;t.save();t.lineWidth=window.devicePixelRatio;if(t.lineWidth%2)t.translate(.5,.5);t.beginPath();let u=o[r._minimumIndex];let T=Math.round(s+n-(u-a)*h);t.moveTo(0,T);let p=r._minimumIndex;for(;p<=r._maximumIndex;p++){const e=Math.round(r.x[p]);t.lineTo(e,T);const i=o[p];if(typeof i!=="undefined")u=i;T=Math.round(s+n-(u-a)*h);t.lineTo(e,T);m[p]=T}m.length=p;t.lineTo(i,T);t.strokeStyle=this.graphColor;t.stroke();if(r._limitValue){const e=Math.round(s+n-(r._limitValue-a)*h);t.moveTo(0,e);t.lineTo(i,e);t.strokeStyle=this.limitColor;t.stroke()}t.closePath();t.restore()}visible(){return this._filter.checked()}};Timeline.CountersGraph.Calculator=class{setZeroTime(e){this._zeroTime=e}computePosition(e){return(e-this._minimumBoundary)/this.boundarySpan()*this._workingArea}setWindow(e,t){this._minimumBoundary=e;this._maximumBoundary=t}setDisplayWidth(e){this._workingArea=e}formatValue(e,t){return Number.preciseMillisToString(e-this.zeroTime(),t)}maximumBoundary(){return this._maximumBoundary}minimumBoundary(){return this._minimumBoundary}zeroTime(){return this._zeroTime}boundarySpan(){return this._maximumBoundary-this._minimumBoundary}};Timeline.ExtensionTracingSession=class{constructor(e,t){this._provider=e;this._performanceModel=t;this._completionCallback;this._completionPromise=new Promise(e=>{this._completionCallback=e});this._timeOffset=0}loadingStarted(){}processingStarted(){}loadingProgress(e){}loadingComplete(e){if(!e)return;this._performanceModel.addExtensionEvents(this._provider.longDisplayName(),e,this._timeOffset);this._completionCallback()}complete(e,t){if(!e){this._completionCallback();return}this._timeOffset=t;Timeline.TimelineLoader.loadFromURL(e,this)}start(){this._provider.start(this)}stop(){this._provider.stop();return this._completionPromise}};Timeline.PerformanceModel=class extends Common.Object{constructor(){super();this._mainTarget=null;this._tracingModel=null;this._filters=[];this._timelineModel=new TimelineModel.TimelineModel;this._frameModel=new TimelineModel.TimelineFrameModel(e=>Timeline.TimelineUIUtils.eventStyle(e).category.name);this._filmStripModel=null;this._irModel=new TimelineModel.TimelineIRModel;this._window={left:0,right:Infinity};this._extensionTracingModels=[];this._recordStartTime=undefined}setMainTarget(e){this._mainTarget=e}setRecordStartTime(e){this._recordStartTime=e}recordStartTime(){return this._recordStartTime}setFilters(e){this._filters=e}filters(){return this._filters}isVisible(e){return this._filters.every(t=>t.accept(e))}setTracingModel(e){this._tracingModel=e;this._timelineModel.setEvents(e);let t=null;let i=null;for(const e of this._timelineModel.tracks()){if(e.type===TimelineModel.TimelineModel.TrackType.Input)t=e.asyncEvents;if(e.type===TimelineModel.TimelineModel.TrackType.Animation)i=e.asyncEvents}if(t||i)this._irModel.populate(t||[],i||[]);const n=this._timelineModel.tracks().filter(e=>e.type===TimelineModel.TimelineModel.TrackType.MainThread&&e.forMainFrame&&e.events.length);const s=n.map(e=>{const t=e.events[0];return{thread:t.thread,time:t.startTime}});this._frameModel.addTraceEvents(this._mainTarget,this._timelineModel.inspectedTargetEvents(),s);for(const e of this._extensionTracingModels){e.model.adjustTime(this._tracingModel.minimumRecordTime()+e.timeOffset/1e3-this._recordStartTime)}this._autoWindowTimes()}addExtensionEvents(e,t,i){this._extensionTracingModels.push({model:t,title:e,timeOffset:i});if(!this._tracingModel)return;t.adjustTime(this._tracingModel.minimumRecordTime()+i/1e3-this._recordStartTime);this.dispatchEventToListeners(Timeline.PerformanceModel.Events.ExtensionDataAdded)}tracingModel(){if(!this._tracingModel)throw"call setTracingModel before accessing PerformanceModel";return this._tracingModel}timelineModel(){return this._timelineModel}filmStripModel(){if(this._filmStripModel)return this._filmStripModel;if(!this._tracingModel)throw"call setTracingModel before accessing PerformanceModel";this._filmStripModel=new SDK.FilmStripModel(this._tracingModel);return this._filmStripModel}frames(){return this._frameModel.frames()}frameModel(){return this._frameModel}interactionRecords(){return this._irModel.interactionRecords()}extensionInfo(){return this._extensionTracingModels}dispose(){if(this._tracingModel)this._tracingModel.dispose();for(const e of this._extensionTracingModels)e.model.dispose()}filmStripModelFrame(e){const t=e.idle?e.startTime:e.endTime;const i=this._filmStripModel.frameByTimestamp(t);return i&&i.timestamp-e.endTime<10?i:null}save(e){const t=this._tracingModel.backingStorage();return t.writeToStream(e)}setWindow(e,t){this._window=e;this.dispatchEventToListeners(Timeline.PerformanceModel.Events.WindowChanged,{window:e,animate:t})}window(){return this._window}_autoWindowTimes(){const e=this._timelineModel;let t=[];for(const i of e.tracks()){if(i.type===TimelineModel.TimelineModel.TrackType.MainThread&&i.forMainFrame)t=i.tasks}if(!t.length){this.setWindow({left:e.minimumRecordTime(),right:e.maximumRecordTime()});return}function i(e,i){const n=.1;let s=e;let r=(t[s].startTime+t[s].endTime)/2;let o=0;const l=Math.sign(i-e);for(let a=e;a!==i;a+=l){const e=t[a];const i=(e.startTime+e.endTime)/2;const l=Math.abs(r-i);if(o<n*l){s=a;r=i;o=0}o+=e.duration}return s}const n=i(t.length-1,0);const s=i(0,n);let r=t[s].startTime;let o=t[n].endTime;const l=o-r;const a=e.maximumRecordTime()-e.minimumRecordTime();if(l<a*.1){r=e.minimumRecordTime();o=e.maximumRecordTime()}else{r=Math.max(r-.05*l,e.minimumRecordTime());o=Math.min(o+.05*l,e.maximumRecordTime())}this.setWindow({left:r,right:o})}};Timeline.PerformanceModel.Events={ExtensionDataAdded:Symbol("ExtensionDataAdded"),WindowChanged:Symbol("WindowChanged")};Timeline.PerformanceModel.Window;Timeline.TimelineController=class{constructor(e,t){this._target=e;this._tracingManager=e.model(SDK.TracingManager);this._performanceModel=new Timeline.PerformanceModel;this._performanceModel.setMainTarget(e);this._client=t;const i=new Bindings.TempFileBackingStorage;this._tracingModel=new SDK.TracingModel(i);this._extensionSessions=[];SDK.targetManager.observeModels(SDK.CPUProfilerModel,this)}dispose(){SDK.targetManager.unobserveModels(SDK.CPUProfilerModel,this)}mainTarget(){return this._target}startRecording(e,t){this._extensionTraceProviders=Extensions.extensionServer.traceProviders().slice();function i(e){return"disabled-by-default-"+e}const n=["-*","devtools.timeline",i("devtools.timeline"),i("devtools.timeline.frame"),"v8.execute",TimelineModel.TimelineModel.Category.Console,TimelineModel.TimelineModel.Category.UserTiming];n.push(TimelineModel.TimelineModel.Category.LatencyInfo);if(Runtime.experiments.isEnabled("timelineFlowEvents"))n.push("devtools.timeline.async");if(Runtime.experiments.isEnabled("timelineV8RuntimeCallStats")&&e.enableJSSampling)n.push(i("v8.runtime_stats_sampling"));if(!Runtime.queryParam("timelineTracingJSProfileDisabled")&&e.enableJSSampling){n.push(i("v8.cpu_profiler"));if(Common.moduleSetting("highResolutionCpuProfiling").get())n.push(i("v8.cpu_profiler.hires"))}n.push(i("devtools.timeline.stack"));if(Runtime.experiments.isEnabled("timelineInvalidationTracking"))n.push(i("devtools.timeline.invalidationTracking"));if(e.capturePictures){n.push(i("devtools.timeline.layers"),i("devtools.timeline.picture"),i("blink.graphics_context_annotations"))}if(e.captureFilmStrip)n.push(i("devtools.screenshot"));this._extensionSessions=t.map(e=>new Timeline.ExtensionTracingSession(e,this._performanceModel));this._extensionSessions.forEach(e=>e.start());const s=this._startRecordingWithCategories(n.join(","),e.enableJSSampling);this._performanceModel.setRecordStartTime(Date.now());return s}async stopRecording(){const e=[];if(this._tracingManager)e.push(new Promise(e=>this._tracingCompleteCallback=e));e.push(this._stopProfilingOnAllModels());if(this._tracingManager)this._tracingManager.stop();this._client.loadingStarted();const t=this._extensionSessions.map(e=>e.stop());if(t.length){e.push(Promise.race([Promise.all(t),new Promise(e=>setTimeout(e,5e3))]))}await Promise.all(e);this._allSourcesFinished();return this._performanceModel}modelAdded(e){if(this._profiling)e.startRecording()}modelRemoved(e){}_startProfilingOnAllModels(){this._profiling=true;const e=SDK.targetManager.models(SDK.CPUProfilerModel);return Promise.all(e.map(e=>e.startRecording()))}_addCpuProfile(e,t){if(!t){Common.console.warn(Common.UIString("CPU profile for a target is not available."));return}if(!this._cpuProfiles)this._cpuProfiles=new Map;this._cpuProfiles.set(e,t)}_stopProfilingOnAllModels(){const e=this._profiling?SDK.targetManager.models(SDK.CPUProfilerModel):[];this._profiling=false;const t=[];for(const i of e){const e=i.target().id();const n=i.stopRecording().then(this._addCpuProfile.bind(this,e));t.push(n)}return Promise.all(t)}async _startRecordingWithCategories(e,t){SDK.targetManager.suspendAllTargets();if(t&&Runtime.queryParam("timelineTracingJSProfileDisabled"))await this._startProfilingOnAllModels();if(!this._tracingManager)return;const i=Common.moduleSetting("highResolutionCpuProfiling").get()?1e4:1e3;const n="sampling-frequency="+i;return this._tracingManager.start(this,e,n)}traceEventsCollected(e){this._tracingModel.addEvents(e)}tracingComplete(){this._tracingCompleteCallback();this._tracingCompleteCallback=null}_allSourcesFinished(){this._client.processingStarted();setTimeout(()=>this._finalizeTrace(),0)}async _finalizeTrace(){this._injectCpuProfileEvents();await SDK.targetManager.resumeAllTargets();this._tracingModel.tracingComplete();this._client.loadingComplete(this._tracingModel)}_injectCpuProfileEvent(e,t,i){if(!i)return;const n={cat:SDK.TracingModel.DevToolsMetadataEventCategory,ph:SDK.TracingModel.Phase.Instant,ts:this._tracingModel.maximumRecordTime()*1e3,pid:e,tid:t,name:TimelineModel.TimelineModel.RecordType.CpuProfile,args:{data:{cpuProfile:i}}};this._tracingModel.addEvents([n])}_buildTargetToProcessIdMap(){const e=TimelineModel.TimelineModel.DevToolsMetadataEvent;const t=this._tracingModel.devToolsMetadataEvents();const i=t.find(t=>t.name===e.TracingStartedInBrowser);if(!i)return null;const n=new Multimap;const s=new Map;const r=i.args.data["frames"];for(const e of r)s.set(e.frame,e.processId);for(const i of t){const t=i.args.data;switch(i.name){case e.FrameCommittedInBrowser:if(t.processId)s.set(t.frame,t.processId);else n.set(t.processPseudoId,t.frame);break;case e.ProcessReadyInBrowser:for(const e of n.get(t.processPseudoId)||[])s.set(e,t.processId);break}}const o=r.find(e=>!e.parent);const l=o.processId;const a=this._tracingModel.processById(l);if(a)s.set(SDK.targetManager.mainTarget().id(),a.id());return s}_injectCpuProfileEvents(){if(!this._cpuProfiles)return;const e=TimelineModel.TimelineModel.DevToolsMetadataEvent;const t=this._tracingModel.devToolsMetadataEvents();const i=this._buildTargetToProcessIdMap();if(i){for(const[e,t]of this._cpuProfiles){const n=i.get(e);if(!n)continue;const s=this._tracingModel.processById(n);const r=s&&s.threadByName(TimelineModel.TimelineModel.RendererMainThreadName);if(r)this._injectCpuProfileEvent(n,r.id(),t)}}else{const i=t.filter(t=>t.name===e.TracingStartedInPage).peekLast();if(i){const e=i.thread.process().id();const t=this._cpuProfiles.get(this._tracingManager.target().id());this._injectCpuProfileEvent(e,i.thread.id(),t)}else{let e=0;for(const t of this._cpuProfiles){const i=SDK.targetManager.targetById(t[0]);const n=i&&i.name();this._tracingModel.addEvents(TimelineModel.TimelineJSProfileProcessor.buildTraceProfileFromCpuProfile(t[1],++e,e===1,n))}}}const n=t.filter(t=>t.name===e.TracingSessionIdForWorker);for(const e of n){const t=e.args["data"]["workerId"];const i=this._cpuProfiles.get(t);this._injectCpuProfileEvent(e.thread.process().id(),e.args["data"]["workerThreadId"],i)}this._cpuProfiles=null}tracingBufferUsage(e){this._client.recordingProgress(e)}eventsRetrievalProgress(e){this._client.loadingProgress(e)}};Timeline.TimelineController.Client=function(){};Timeline.TimelineController.Client.prototype={recordingProgress(e){}};Timeline.TimelineController.RecordingOptions;Timeline.TimelineDetailsView=class extends UI.VBox{constructor(e){super();this.element.classList.add("timeline-details");this._detailsLinkifier=new Components.Linkifier;this._badgePool=new ProductRegistry.BadgePool;this._badgePool.setShowTitles(true);this._tabbedPane=new UI.TabbedPane;this._tabbedPane.show(this.element);const t=Timeline.TimelineDetailsView.Tab;this._defaultDetailsWidget=new UI.VBox;this._defaultDetailsWidget.element.classList.add("timeline-details-view");this._defaultDetailsContentElement=this._defaultDetailsWidget.element.createChild("div","timeline-details-view-body vbox");this._defaultDetailsContentElement.tabIndex=0;this._appendTab(t.Details,Common.UIString("Summary"),this._defaultDetailsWidget);this.setPreferredTab(t.Details);this._rangeDetailViews=new Map;const i=new Timeline.BottomUpTimelineTreeView;this._appendTab(t.BottomUp,Common.UIString("Bottom-Up"),i);this._rangeDetailViews.set(t.BottomUp,i);const n=new Timeline.CallTreeTimelineTreeView;this._appendTab(t.CallTree,Common.UIString("Call Tree"),n);this._rangeDetailViews.set(t.CallTree,n);const s=new Timeline.EventsTimelineTreeView(e);this._appendTab(t.EventLog,Common.UIString("Event Log"),s);this._rangeDetailViews.set(t.EventLog,s);this._tabbedPane.addEventListener(UI.TabbedPane.Events.TabSelected,this._tabSelected,this)}setModel(e,t){if(this._model!==e){if(this._model)this._model.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this);this._model=e;if(this._model)this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this)}this._track=t;this._tabbedPane.closeTabs([Timeline.TimelineDetailsView.Tab.PaintProfiler,Timeline.TimelineDetailsView.Tab.LayerViewer],false);for(const i of this._rangeDetailViews.values())i.setModel(e,t);this._lazyPaintProfilerView=null;this._lazyLayersView=null;this.setSelection(null)}_setContent(e){const t=this._tabbedPane.otherTabs(Timeline.TimelineDetailsView.Tab.Details);for(let e=0;e<t.length;++e){if(!this._rangeDetailViews.has(t[e]))this._tabbedPane.closeTab(t[e])}this._defaultDetailsContentElement.removeChildren();this._defaultDetailsContentElement.appendChild(e)}_updateContents(){const e=this._rangeDetailViews.get(this._tabbedPane.selectedTabId||"");if(e){const t=this._model.window();e.updateContents(this._selection||Timeline.TimelineSelection.fromRange(t.left,t.right))}}_appendTab(e,t,i,n){this._tabbedPane.appendTab(e,t,i,undefined,undefined,n);if(this._preferredTabId!==this._tabbedPane.selectedTabId)this._tabbedPane.selectTab(e)}headerElement(){return this._tabbedPane.headerElement()}setPreferredTab(e){this._preferredTabId=e}_onWindowChanged(e){if(!this._selection)this._updateContentsFromWindow()}_updateContentsFromWindow(){if(!this._model){this._setContent(UI.html`<div/>`);return}const e=this._model.window();this._updateSelectedRangeStats(e.left,e.right);this._updateContents()}setSelection(e){this._detailsLinkifier.reset();this._badgePool.reset();this._selection=e;if(!this._selection){this._updateContentsFromWindow();return}switch(this._selection.type()){case Timeline.TimelineSelection.Type.TraceEvent:const e=this._selection.object();Timeline.TimelineUIUtils.buildTraceEventDetails(e,this._model.timelineModel(),this._detailsLinkifier,this._badgePool,true).then(t=>this._appendDetailsTabsForTraceEventAndShowDetails(e,t));break;case Timeline.TimelineSelection.Type.Frame:const t=this._selection.object();const i=this._model.filmStripModelFrame(t);this._setContent(Timeline.TimelineUIUtils.generateDetailsContentForFrame(t,i));if(t.layerTree){const e=this._layersView();e.showLayerTree(t.layerTree);if(!this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.LayerViewer))this._appendTab(Timeline.TimelineDetailsView.Tab.LayerViewer,Common.UIString("Layers"),e)}break;case Timeline.TimelineSelection.Type.NetworkRequest:const n=this._selection.object();Timeline.TimelineUIUtils.buildNetworkRequestDetails(n,this._model.timelineModel(),this._detailsLinkifier,this._badgePool).then(this._setContent.bind(this));break;case Timeline.TimelineSelection.Type.Range:this._updateSelectedRangeStats(this._selection.startTime(),this._selection.endTime());break}this._updateContents()}_tabSelected(e){if(!e.data.isUserGesture)return;this.setPreferredTab(e.data.tabId);this._updateContents()}_layersView(){if(this._lazyLayersView)return this._lazyLayersView;this._lazyLayersView=new Timeline.TimelineLayersView(this._model.timelineModel(),this._showSnapshotInPaintProfiler.bind(this));return this._lazyLayersView}_paintProfilerView(){if(this._lazyPaintProfilerView)return this._lazyPaintProfilerView;this._lazyPaintProfilerView=new Timeline.TimelinePaintProfilerView(this._model.frameModel());return this._lazyPaintProfilerView}_showSnapshotInPaintProfiler(e){const t=this._paintProfilerView();t.setSnapshot(e);if(!this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.PaintProfiler)){this._appendTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,Common.UIString("Paint Profiler"),t,true)}this._tabbedPane.selectTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,true)}_appendDetailsTabsForTraceEventAndShowDetails(e,t){this._setContent(t);if(e.name===TimelineModel.TimelineModel.RecordType.Paint||e.name===TimelineModel.TimelineModel.RecordType.RasterTask)this._showEventInPaintProfiler(e)}_showEventInPaintProfiler(e){const t=SDK.targetManager.models(SDK.PaintProfilerModel)[0];if(!t)return;const i=this._paintProfilerView();const n=i.setEvent(t,e);if(!n)return;if(this._tabbedPane.hasTab(Timeline.TimelineDetailsView.Tab.PaintProfiler))return;this._appendTab(Timeline.TimelineDetailsView.Tab.PaintProfiler,Common.UIString("Paint Profiler"),i)}_updateSelectedRangeStats(e,t){if(!this._model||!this._track)return;const i=Timeline.TimelineUIUtils.statsForTimeRange(this._track.syncEvents(),e,t);const n=e-this._model.timelineModel().minimumRecordTime();const s=t-this._model.timelineModel().minimumRecordTime();const r=new Timeline.TimelineDetailsContentHelper(null,null);r.addSection(ls`Range:  ${Number.millisToString(n)} \u2013 ${Number.millisToString(s)}`);const o=Timeline.TimelineUIUtils.generatePieChart(i);r.appendElementRow("",o);this._setContent(r.fragment)}};Timeline.TimelineDetailsView.Tab={Details:"Details",EventLog:"EventLog",CallTree:"CallTree",BottomUp:"BottomUp",PaintProfiler:"PaintProfiler",LayerViewer:"LayerViewer"};Timeline.TimelineLoader=class{constructor(e){this._client=e;this._backingStorage=new Bindings.TempFileBackingStorage;this._tracingModel=new SDK.TracingModel(this._backingStorage);this._canceledCallback=null;this._state=Timeline.TimelineLoader.State.Initial;this._buffer="";this._firstRawChunk=true;this._firstChunk=true;this._loadedBytes=0;this._totalSize;this._jsonTokenizer=new TextUtils.TextUtils.BalancedJSONTokenizer(this._writeBalancedJSON.bind(this),true)}static loadFromFile(e,t){const i=new Timeline.TimelineLoader(t);const n=new Bindings.ChunkedFileReader(e,Timeline.TimelineLoader.TransferChunkLengthBytes);i._canceledCallback=n.cancel.bind(n);i._totalSize=e.size;n.read(i).then(e=>{if(!e)this._reportErrorAndCancelLoading(n.error().message)});return i}static loadFromEvents(e,t){const i=new Timeline.TimelineLoader(t);setTimeout(async()=>{const n=5e3;t.loadingStarted();for(let s=0;s<e.length;s+=n){const r=e.slice(s,s+n);i._tracingModel.addEvents(r);t.loadingProgress((s+r.length)/e.length);await new Promise(e=>setTimeout(e))}i.close()});return i}static loadFromURL(e,t){const i=new Timeline.TimelineLoader(t);Host.ResourceLoader.loadAsStream(e,null,i);return i}cancel(){this._tracingModel=null;this._backingStorage.reset();this._client.loadingComplete(null);this._client=null;if(this._canceledCallback)this._canceledCallback()}write(e){if(!this._client)return Promise.resolve();this._loadedBytes+=e.length;if(this._firstRawChunk)this._client.loadingStarted();else this._client.loadingProgress(this._totalSize?this._loadedBytes/this._totalSize:undefined);this._firstRawChunk=false;if(this._state===Timeline.TimelineLoader.State.Initial){if(e.startsWith('{"nodes":[')){this._state=Timeline.TimelineLoader.State.LoadingCPUProfileFormat}else if(e[0]==="{"){this._state=Timeline.TimelineLoader.State.LookingForEvents}else if(e[0]==="["){this._state=Timeline.TimelineLoader.State.ReadingEvents}else{this._reportErrorAndCancelLoading(Common.UIString("Malformed timeline data: Unknown JSON format"));return Promise.resolve()}}if(this._state===Timeline.TimelineLoader.State.LoadingCPUProfileFormat){this._buffer+=e;return Promise.resolve()}if(this._state===Timeline.TimelineLoader.State.LookingForEvents){const t='"traceEvents":';const i=this._buffer.length-t.length;this._buffer+=e;const n=this._buffer.indexOf(t,i);if(n===-1)return Promise.resolve();e=this._buffer.slice(n+t.length);this._state=Timeline.TimelineLoader.State.ReadingEvents}if(this._state!==Timeline.TimelineLoader.State.ReadingEvents)return Promise.resolve();if(this._jsonTokenizer.write(e))return Promise.resolve();this._state=Timeline.TimelineLoader.State.SkippingTail;if(this._firstChunk)this._reportErrorAndCancelLoading(Common.UIString("Malformed timeline input, wrong JSON brackets balance"));return Promise.resolve()}_writeBalancedJSON(e){let t=e+"]";if(!this._firstChunk){const e=t.indexOf(",");if(e!==-1)t=t.slice(e+1);t="["+t}let i;try{i=JSON.parse(t)}catch(e){this._reportErrorAndCancelLoading(Common.UIString("Malformed timeline data: %s",e.toString()));return}if(this._firstChunk){this._firstChunk=false;if(this._looksLikeAppVersion(i[0])){this._reportErrorAndCancelLoading(Common.UIString("Legacy Timeline format is not supported."));return}}try{this._tracingModel.addEvents(i)}catch(e){this._reportErrorAndCancelLoading(Common.UIString("Malformed timeline data: %s",e.toString()))}}_reportErrorAndCancelLoading(e){if(e)Common.console.error(e);this.cancel()}_looksLikeAppVersion(e){return typeof e==="string"&&e.indexOf("Chrome")!==-1}close(){if(!this._client)return;this._client.processingStarted();setTimeout(()=>this._finalizeTrace(),0)}_finalizeTrace(){if(this._state===Timeline.TimelineLoader.State.LoadingCPUProfileFormat){this._parseCPUProfileFormat(this._buffer);this._buffer=""}this._tracingModel.tracingComplete();this._client.loadingComplete(this._tracingModel)}_parseCPUProfileFormat(e){let t;try{const i=JSON.parse(e);t=TimelineModel.TimelineJSProfileProcessor.buildTraceProfileFromCpuProfile(i,1,true)}catch(e){this._reportErrorAndCancelLoading(Common.UIString("Malformed CPU profile format"));return}this._tracingModel.addEvents(t)}};Timeline.TimelineLoader.TransferChunkLengthBytes=5e6;Timeline.TimelineLoader.Client=function(){};Timeline.TimelineLoader.Client.prototype={loadingStarted(){},loadingProgress(e){},processingStarted(){},loadingComplete(e){}};Timeline.TimelineLoader.State={Initial:Symbol("Initial"),LookingForEvents:Symbol("LookingForEvents"),ReadingEvents:Symbol("ReadingEvents"),SkippingTail:Symbol("SkippingTail"),LoadingCPUProfileFormat:Symbol("LoadingCPUProfileFormat")};Timeline.TimelineEventOverview=class extends PerfUI.TimelineOverviewBase{constructor(e,t){super();this.element.id="timeline-overview-"+e;this.element.classList.add("overview-strip");this._model=null;if(t)this.element.createChild("div","timeline-overview-strip-title").textContent=t}setModel(e){this._model=e}_renderBar(e,t,i,n,s){const r=e;const o=t-e;const l=this.context();l.fillStyle=s;l.fillRect(r,i,o,n)}};Timeline.TimelineEventOverviewInput=class extends Timeline.TimelineEventOverview{constructor(){super("input",null)}update(){super.update();if(!this._model)return;const e=this.height();const t=Timeline.TimelineUIUtils.eventDispatchDesciptors();const i=new Map;let n=-1;for(const e of t){for(const t of e.eventTypes)i.set(t,e);n=Math.max(n,e.priority)}const s=2*window.devicePixelRatio;const r=this._model.timelineModel().minimumRecordTime();const o=this._model.timelineModel().maximumRecordTime()-r;const l=this.width();const a=l/o;for(let t=0;t<=n;++t){for(const n of this._model.timelineModel().tracks()){for(let o=0;o<n.events.length;++o){const d=n.events[o];if(d.name!==TimelineModel.TimelineModel.RecordType.EventDispatch)continue;const m=i.get(d.args["data"]["type"]);if(!m||m.priority!==t)continue;const c=Number.constrain(Math.floor((d.startTime-r)*a),0,l);const h=Number.constrain(Math.ceil((d.endTime-r)*a),0,l);const u=Math.max(h-c,s);this._renderBar(c,c+u,0,e,m.color)}}}}};Timeline.TimelineEventOverviewNetwork=class extends Timeline.TimelineEventOverview{constructor(){super("network",Common.UIString("NET"))}update(){super.update();if(!this._model)return;const e=this._model.timelineModel();const t=this.height()/2;const i=e.minimumRecordTime();const n=e.maximumRecordTime()-i;const s=this.width();const r=s/n;const o=new Path2D;const l=new Path2D;const a=Protocol.Network.ResourcePriority;const d=new Set([a.VeryHigh,a.High,a.Medium]);for(const n of e.networkRequests()){const e=d.has(n.priority)?o:l;const a=Math.max(Math.floor((n.startTime-i)*r),0);const m=Math.min(Math.ceil((n.endTime-i)*r+1),s);e.rect(a,0,m-a,t-1)}const m=this.context();m.save();m.fillStyle="hsl(214, 60%, 60%)";m.fill(o);m.translate(0,t);m.fillStyle="hsl(214, 80%, 80%)";m.fill(l);m.restore()}};Timeline.TimelineEventOverviewCPUActivity=class extends Timeline.TimelineEventOverview{constructor(){super("cpu-activity",Common.UIString("CPU"));this._backgroundCanvas=this.element.createChild("canvas","fill background")}resetCanvas(){super.resetCanvas();this._backgroundCanvas.width=this.element.clientWidth*window.devicePixelRatio;this._backgroundCanvas.height=this.element.clientHeight*window.devicePixelRatio}update(){super.update();if(!this._model)return;const e=this._model.timelineModel();const t=4*window.devicePixelRatio;const i=this.width();const n=this.height();const s=n;const r=e.minimumRecordTime();const o=e.maximumRecordTime()-r;const l=i/o;const a=t/l;const d=Timeline.TimelineUIUtils.categories();const m=["idle","loading","painting","rendering","scripting","other"];const c=m.indexOf("other");const h=0;console.assert(h===m.indexOf("idle"));for(let e=h+1;e<m.length;++e)d[m[e]]._overviewIndex=e;const u=this._backgroundCanvas.getContext("2d");for(const t of e.tracks()){if(t.type===TimelineModel.TimelineModel.TrackType.MainThread&&t.forMainFrame)T(this.context(),t.events);else T(u,t.events)}p(u);function T(e,l){const u=new Timeline.Quantizer(r,a,f);let T=0;const p=[];const g=[];const _=[];for(let e=0;e<m.length;++e){g[e]=new Path2D;g[e].moveTo(0,n);_[e]=n}function f(e){let i=s;for(let s=h+1;s<m.length;++s){const r=(e[s]||0)/a*n;i-=r;g[s].bezierCurveTo(T,_[s],T,i,T+t/2,i);_[s]=i}T+=t}function v(e){const t=p.length?p.peekLast():h;u.appendInterval(e.startTime,t);p.push(Timeline.TimelineUIUtils.eventStyle(e).category._overviewIndex||c)}function w(e){u.appendInterval(e.endTime,p.pop())}TimelineModel.TimelineModel.forEachEvent(l,v,w);u.appendInterval(r+o+a,h);for(let t=m.length-1;t>0;--t){g[t].lineTo(i,n);e.fillStyle=d[m[t]].color;e.fill(g[t])}}function p(e){const t=4*window.devicePixelRatio;e.save();e.lineWidth=t/Math.sqrt(8);for(let s=.5;s<i+n;s+=t){e.moveTo(s,0);e.lineTo(s-n,n)}e.globalCompositeOperation="destination-out";e.stroke();e.restore()}}};Timeline.TimelineEventOverviewResponsiveness=class extends Timeline.TimelineEventOverview{constructor(){super("responsiveness",null)}update(){super.update();if(!this._model)return;const e=this.height();const t=this._model.timelineModel().minimumRecordTime();const i=this._model.timelineModel().maximumRecordTime()-t;const n=this.width()/i;const s=this._model.frames();const r=this.context();const o=new Path2D;const l=new Path2D;for(let e=0;e<s.length;++e){const t=s[e];if(!t.hasWarnings())continue;a(t.startTime,t.duration)}for(const e of this._model.timelineModel().tracks()){const t=e.events;for(let e=0;e<t.length;++e){if(!TimelineModel.TimelineData.forEvent(t[e]).warning)continue;a(t[e].startTime,t[e].duration)}}r.fillStyle="hsl(0, 80%, 90%)";r.strokeStyle="red";r.lineWidth=2*window.devicePixelRatio;r.fill(o);r.stroke(l);function a(i,s){const r=Math.round(n*(i-t));const a=Math.round(n*s);o.rect(r,0,a,e);l.moveTo(r+a,0);l.lineTo(r+a,e)}}};Timeline.TimelineFilmStripOverview=class extends Timeline.TimelineEventOverview{constructor(){super("filmstrip",null);this.reset()}update(){super.update();const e=this._model?this._model.filmStripModel().frames():[];if(!e.length)return;const t=Symbol("drawGeneration");this._drawGeneration=t;this._imageByFrame(e[0]).then(e=>{if(this._drawGeneration!==t)return;if(!e||!e.naturalWidth||!e.naturalHeight)return;const i=this.height()-2*Timeline.TimelineFilmStripOverview.Padding;const n=Math.ceil(i*e.naturalWidth/e.naturalHeight);const s=Math.min(200/e.naturalWidth,1);this._emptyImage=new Image(e.naturalWidth*s,e.naturalHeight*s);this._drawFrames(n,i)})}_imageByFrame(e){let t=this._frameToImagePromise.get(e);if(!t){t=e.imageDataPromise().then(e=>UI.loadImageFromData(e));this._frameToImagePromise.set(e,t)}return t}_drawFrames(e,t){if(!e||!this._model)return;const i=this._model.filmStripModel();if(!i.frames().length)return;const n=Timeline.TimelineFilmStripOverview.Padding;const s=this.width();const r=i.zeroTime();const o=i.spanTime();const l=o/s;const a=this.context();const d=this._drawGeneration;a.beginPath();for(let o=n;o<s;o+=e+2*n){const n=r+(o+e/2)*l;const s=i.frameByTimestamp(n);if(!s)continue;a.rect(o-.5,.5,e+1,t+1);this._imageByFrame(s).then(m.bind(this,o))}a.strokeStyle="#ddd";a.stroke();function m(i,n){if(this._drawGeneration!==d||!n)return;a.drawImage(n,i,1,e,t)}}overviewInfoPromise(e){if(!this._model||!this._model.filmStripModel().frames().length)return Promise.resolve(null);const t=this.calculator().positionToTime(e);const i=this._model.filmStripModel().frameByTimestamp(t);if(i===this._lastFrame)return Promise.resolve(this._lastElement);const n=i?this._imageByFrame(i):Promise.resolve(this._emptyImage);return n.then(s.bind(this));function s(e){const t=createElementWithClass("div","frame");if(e)t.createChild("div","thumbnail").appendChild(e);this._lastFrame=i;this._lastElement=t;return t}}reset(){this._lastFrame=undefined;this._lastElement=null;this._frameToImagePromise=new Map;this._imageWidth=0}};Timeline.TimelineFilmStripOverview.Padding=2;Timeline.TimelineEventOverviewFrames=class extends Timeline.TimelineEventOverview{constructor(){super("framerate",Common.UIString("FPS"))}update(){super.update();if(!this._model)return;const e=this._model.frames();if(!e.length)return;const t=this.height();const i=1*window.devicePixelRatio;const n=1e3/60;const s=t-2*i;const r=this._model.timelineModel().minimumRecordTime();const o=this._model.timelineModel().maximumRecordTime()-r;const l=this.width()/o;const a=t-i;const d=this.context();const m=a+10*window.devicePixelRatio;let c=0;let h=m;const u=window.devicePixelRatio;const T=u&1?.5:0;const p=1.5*window.devicePixelRatio;d.beginPath();d.moveTo(0,h);for(let t=0;t<e.length;++t){const i=e[t];c=Math.round((i.startTime-r)*l)+T;d.lineTo(c,h);d.lineTo(c,h+p);h=i.idle?m:Math.round(a-s*Math.min(n/i.duration,1))-T;d.lineTo(c,h+p);d.lineTo(c,h)}const g=e.peekLast();c=Math.round((g.startTime+g.duration-r)*l)+T;d.lineTo(c,h);d.lineTo(c,m);d.fillStyle="hsl(110, 50%, 88%)";d.strokeStyle="hsl(110, 50%, 60%)";d.lineWidth=u;d.fill();d.stroke()}};Timeline.TimelineEventOverviewMemory=class extends Timeline.TimelineEventOverview{constructor(){super("memory",Common.UIString("HEAP"));this._heapSizeLabel=this.element.createChild("div","memory-graph-label")}resetHeapSizeLabels(){this._heapSizeLabel.textContent=""}update(){super.update();const e=window.devicePixelRatio;if(!this._model){this.resetHeapSizeLabels();return}const t=this._model.timelineModel().tracks().filter(e=>e.type===TimelineModel.TimelineModel.TrackType.MainThread&&e.forMainFrame);const i=t.map(e=>e.events);const n=3*e;let s=0;let r=1e11;const o=this._model.timelineModel().minimumRecordTime();const l=this._model.timelineModel().maximumRecordTime();function a(e){return e.name===TimelineModel.TimelineModel.RecordType.UpdateCounters}for(let e=0;e<i.length;e++)i[e]=i[e].filter(a);function d(e){const t=e.args.data;if(!t||!t.jsHeapSizeUsed)return;s=Math.max(s,t.jsHeapSizeUsed);r=Math.min(r,t.jsHeapSizeUsed)}for(let e=0;e<i.length;e++)i[e].forEach(d);r=Math.min(r,s);const m=1;const c=this.width();const h=this.height()-n;const u=c/(l-o);const T=(h-m)/Math.max(s-r,1);const p=new Array(c);function g(e){const t=e.args.data;if(!t||!t.jsHeapSizeUsed)return;const i=Math.round((e.startTime-o)*u);const n=Math.round((t.jsHeapSizeUsed-r)*T);p[i]=Math.max(p[i]||0,n)}for(let e=0;e<i.length;e++)i[e].forEach(g);const _=this.context();const f=h+n+m;_.translate(.5,.5);_.beginPath();_.moveTo(-m,f);let v=0;let w=true;let y=0;for(let e=0;e<p.length;e++){if(typeof p[e]==="undefined")continue;if(w){w=false;v=p[e];_.lineTo(-m,h-v)}const t=p[e];if(Math.abs(t-v)>2&&Math.abs(e-y)>1)_.lineTo(e,h-v);v=t;_.lineTo(e,h-v);y=e}_.lineTo(c+m,h-v);_.lineTo(c+m,f);_.closePath();_.fillStyle="hsla(220, 90%, 70%, 0.2)";_.fill();_.lineWidth=m;_.strokeStyle="hsl(220, 90%, 70%)";_.stroke();this._heapSizeLabel.textContent=Common.UIString("%s – %s",Number.bytesToString(r),Number.bytesToString(s))}};Timeline.Quantizer=class{constructor(e,t,i){this._lastTime=e;this._quantDuration=t;this._callback=i;this._counters=[];this._remainder=t}appendInterval(e,t){let i=e-this._lastTime;if(i<=this._remainder){this._counters[t]=(this._counters[t]||0)+i;this._remainder-=i;this._lastTime=e;return}this._counters[t]=(this._counters[t]||0)+this._remainder;this._callback(this._counters);i-=this._remainder;while(i>=this._quantDuration){const e=[];e[t]=this._quantDuration;this._callback(e);i-=this._quantDuration}this._counters=[];this._counters[t]=i;this._lastTime=e;this._remainder=this._quantDuration-i}};Timeline.TimelineFilters={};Timeline.TimelineFilters.IsLong=class extends TimelineModel.TimelineModelFilter{constructor(){super();this._minimumRecordDuration=0}setMinimumRecordDuration(e){this._minimumRecordDuration=e}accept(e){const t=e.endTime?e.endTime-e.startTime:0;return t>=this._minimumRecordDuration}};Timeline.TimelineFilters.Category=class extends TimelineModel.TimelineModelFilter{constructor(){super()}accept(e){return!Timeline.TimelineUIUtils.eventStyle(e).category.hidden}};Timeline.TimelineFilters.RegExp=class extends TimelineModel.TimelineModelFilter{constructor(e){super();this._regExp;this.setRegExp(e||null)}setRegExp(e){this._regExp=e}regExp(){return this._regExp}accept(e){return!this._regExp||Timeline.TimelineUIUtils.testContentMatching(e,this._regExp)}};Timeline.TimelineFlameChartDataProvider=class extends Common.Object{constructor(){super();this.reset();this._font="11px "+Host.fontFamily();this._timelineData=null;this._currentLevel=0;this._performanceModel=null;this._model=null;this._minimumBoundary=0;this._maximumBoundary=0;this._timeSpan=0;this._consoleColorGenerator=new Common.Color.Generator({min:30,max:55},{min:70,max:100,count:6},50,.7);this._extensionColorGenerator=new Common.Color.Generator({min:210,max:300},{min:70,max:100,count:6},70,.7);this._headerLevel1=this._buildGroupStyle({shareHeaderLine:false});this._headerLevel2=this._buildGroupStyle({padding:2,nestingLevel:1,collapsible:false});this._staticHeader=this._buildGroupStyle({collapsible:false});this._framesHeader=this._buildGroupStyle({useFirstLineForOverview:true});this._timingsHeader=this._buildGroupStyle({shareHeaderLine:true,useFirstLineForOverview:true});this._screenshotsHeader=this._buildGroupStyle({useFirstLineForOverview:true,nestingLevel:1,collapsible:false,itemsHeight:150});this._interactionsHeaderLevel1=this._buildGroupStyle({useFirstLineForOverview:true});this._interactionsHeaderLevel2=this._buildGroupStyle({padding:2,nestingLevel:1});this._flowEventIndexById=new Map}_buildGroupStyle(e){const t={padding:4,height:17,collapsible:true,color:UI.themeSupport.patchColorText("#222",UI.ThemeSupport.ColorUsage.Foreground),backgroundColor:UI.themeSupport.patchColorText("white",UI.ThemeSupport.ColorUsage.Background),font:this._font,nestingLevel:0,shareHeaderLine:true};return Object.assign(t,e)}setModel(e){this.reset();this._performanceModel=e;this._model=e&&e.timelineModel()}groupTrack(e){return e._track||null}entryTitle(e){const t=Timeline.TimelineFlameChartDataProvider.EntryType;const i=this._entryType(e);if(i===t.Event){const t=this._entryData[e];if(t.phase===SDK.TracingModel.Phase.AsyncStepInto||t.phase===SDK.TracingModel.Phase.AsyncStepPast)return t.name+":"+t.args["step"];if(t._blackboxRoot)return Common.UIString("Blackboxed");if(this._performanceModel.timelineModel().isMarkerEvent(t))return Timeline.TimelineUIUtils.markerShortTitle(t);return Timeline.TimelineUIUtils.eventTitle(t)}if(i===t.ExtensionEvent){const t=this._entryData[e];return t.name}if(i===t.Screenshot)return"";let n=this._entryIndexToTitle[e];if(!n){n=Common.UIString("Unexpected entryIndex %d",e);console.error(n)}return n}textColor(e){const t=this._entryData[e];return t&&t._blackboxRoot?"#888":Timeline.FlameChartStyle.textColor}entryFont(e){return this._font}reset(){this._currentLevel=0;this._timelineData=null;this._entryData=[];this._entryParent=[];this._entryTypeByLevel=[];this._entryIndexToTitle=[];this._markers=[];this._asyncColorByCategory=new Map;this._asyncColorByInteractionPhase=new Map;this._extensionInfo=[];this._screenshotImageCache=new Map}maxStackDepth(){return this._currentLevel}timelineData(){if(this._timelineData)return this._timelineData;this._timelineData=new PerfUI.FlameChart.TimelineData([],[],[],[]);if(!this._model)return this._timelineData;this._flowEventIndexById.clear();this._minimumBoundary=this._model.minimumRecordTime();this._timeSpan=this._model.isEmpty()?1e3:this._model.maximumRecordTime()-this._minimumBoundary;this._currentLevel=0;if(this._model.isGenericTrace())this._processGenericTrace();else this._processInspectorTrace();return this._timelineData}_processGenericTrace(){const e=this._buildGroupStyle({shareHeaderLine:false});const t=this._buildGroupStyle({padding:2,nestingLevel:1,shareHeaderLine:false});const i=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const n=new Multimap;for(const e of this._model.tracks()){if(e.thread!==null){n.set(e.thread.process(),e)}else{console.error("Failed to process track")}}for(const s of n.keysArray()){if(n.size>1){const t=`${s.name()} ${s.id()}`;this._appendHeader(t,e,false)}for(const e of n.get(s)){const n=this._appendSyncEvents(e,e.events,e.name,t,i,true);if(!this._timelineData.selectedGroup||e.name===TimelineModel.TimelineModel.BrowserMainThreadName)this._timelineData.selectedGroup=n}}}_processInspectorTrace(){this._appendFrames();this._appendInteractionRecords();const e=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const t=e=>{switch(e.type){case TimelineModel.TimelineModel.TrackType.Input:return 0;case TimelineModel.TimelineModel.TrackType.Animation:return 1;case TimelineModel.TimelineModel.TrackType.Timings:return 2;case TimelineModel.TimelineModel.TrackType.Console:return 3;case TimelineModel.TimelineModel.TrackType.MainThread:return e.forMainFrame?4:5;case TimelineModel.TimelineModel.TrackType.Worker:return 6;case TimelineModel.TimelineModel.TrackType.Raster:return 7;case TimelineModel.TimelineModel.TrackType.GPU:return 8;case TimelineModel.TimelineModel.TrackType.Other:return 9}};const i=this._model.tracks().slice();i.stableSort((e,i)=>t(e)-t(i));let n=0;for(const t of i){switch(t.type){case TimelineModel.TimelineModel.TrackType.Input:this._appendAsyncEventsGroup(t,ls`Input`,t.asyncEvents,this._interactionsHeaderLevel2,e,false);break;case TimelineModel.TimelineModel.TrackType.Animation:this._appendAsyncEventsGroup(t,ls`Animation`,t.asyncEvents,this._interactionsHeaderLevel2,e,false);break;case TimelineModel.TimelineModel.TrackType.Timings:const i=this._appendHeader(ls`Timings`,this._timingsHeader,true);i._track=t;this._appendPageMetrics();this._appendAsyncEventsGroup(t,null,t.asyncEvents,this._timingsHeader,e,true);break;case TimelineModel.TimelineModel.TrackType.Console:this._appendAsyncEventsGroup(t,ls`Console`,t.asyncEvents,this._headerLevel1,e,true);break;case TimelineModel.TimelineModel.TrackType.MainThread:if(t.forMainFrame){const i=this._appendSyncEvents(t,t.events,t.url?ls`Main \u2014 ${t.url}`:ls`Main`,this._headerLevel1,e,true);if(i)this._timelineData.selectedGroup=i}else{this._appendSyncEvents(t,t.events,t.url?ls`Frame \u2014 ${t.url}`:ls`Subframe`,this._headerLevel1,e,true)}break;case TimelineModel.TimelineModel.TrackType.Worker:this._appendSyncEvents(t,t.events,t.url?ls`Worker \u2014 ${t.url}`:ls`Dedicated Worker`,this._headerLevel1,e,true);break;case TimelineModel.TimelineModel.TrackType.Raster:if(!n)this._appendHeader(ls`Raster`,this._headerLevel1,false);++n;this._appendSyncEvents(t,t.events,ls`Rasterizer Thread ${n}`,this._headerLevel2,e,true);break;case TimelineModel.TimelineModel.TrackType.GPU:this._appendSyncEvents(t,t.events,ls`GPU`,this._headerLevel1,e,true);break;case TimelineModel.TimelineModel.TrackType.Other:this._appendSyncEvents(t,t.events,t.name||ls`Thread`,this._headerLevel1,e,true);this._appendAsyncEventsGroup(t,t.name,t.asyncEvents,this._headerLevel1,e,true);break}}if(this._timelineData.selectedGroup)this._timelineData.selectedGroup.expanded=true;for(let e=0;e<this._extensionInfo.length;e++)this._innerAppendExtensionEvents(e);this._markers.sort((e,t)=>e.startTime()-t.startTime());this._timelineData.markers=this._markers;this._flowEventIndexById.clear()}minimumBoundary(){return this._minimumBoundary}totalTime(){return this._timeSpan}search(e,t,i){const n=[];const s=Timeline.TimelineFlameChartDataProvider.EntryType;this.timelineData();for(let r=0;r<this._entryData.length;++r){if(this._entryType(r)!==s.Event)continue;const o=this._entryData[r];if(o.startTime>t)continue;if((o.endTime||o.startTime)<e)continue;if(i.accept(o))n.push(r)}n.sort((e,t)=>SDK.TracingModel.Event.compareStartTime(this._entryData[e],this._entryData[t]));return n}_appendSyncEvents(e,t,i,n,s,r){if(!t.length)return null;const o=s===Timeline.TimelineFlameChartDataProvider.EntryType.ExtensionEvent;const l=[];const a=Runtime.experiments.isEnabled("timelineFlowEvents");const d=!o&&Runtime.experiments.isEnabled("blackboxJSFramesOnTimeline");let m=0;let c=null;if(e&&e.type===TimelineModel.TimelineModel.TrackType.MainThread){c=this._appendHeader(i,n,r);c._track=e}for(let s=0;s<t.length;++s){const h=t[s];if(!o&&this._performanceModel.timelineModel().isMarkerEvent(h)){this._markers.push(new Timeline.TimelineFlameChartMarker(h.startTime,h.startTime-this._model.minimumRecordTime(),Timeline.TimelineUIUtils.markerStyleForEvent(h)))}if(!SDK.TracingModel.isFlowPhase(h.phase)){if(!h.endTime&&h.phase!==SDK.TracingModel.Phase.Instant)continue;if(SDK.TracingModel.isAsyncPhase(h.phase))continue;if(!o&&!this._performanceModel.isVisible(h))continue}while(l.length&&l.peekLast().endTime<=h.startTime)l.pop();h._blackboxRoot=false;if(d&&this._isBlackboxedEvent(h)){const e=l.peekLast();if(e&&e._blackboxRoot)continue;h._blackboxRoot=true}if(!c){c=this._appendHeader(i,n,r);if(r)c._track=e}const u=this._currentLevel+l.length;if(a)this._appendFlowEvent(h,u);const T=this._appendEvent(h,u);if(l.length)this._entryParent[T]=l.peekLast();if(!o&&this._performanceModel.timelineModel().isMarkerEvent(h))this._timelineData.entryTotalTimes[this._entryData.length]=undefined;m=Math.max(m,l.length+1);if(h.endTime)l.push(h)}this._entryTypeByLevel.length=this._currentLevel+m;this._entryTypeByLevel.fill(s,this._currentLevel);this._currentLevel+=m;return c}_isBlackboxedEvent(e){if(e.name!==TimelineModel.TimelineModel.RecordType.JSFrame)return false;const t=e.args["data"]["url"];return t&&this._isBlackboxedURL(t)}_isBlackboxedURL(e){return Bindings.blackboxManager.isBlackboxedURL(e)}_appendAsyncEventsGroup(e,t,i,n,s,r){if(!i.length)return null;const o=[];let l=null;for(let s=0;s<i.length;++s){const a=i[s];if(!this._performanceModel.isVisible(a))continue;if(!l&&t){l=this._appendHeader(t,n,r);if(r)l._track=e}const d=a.startTime;let m;for(m=0;m<o.length&&o[m]>d;++m){}this._appendAsyncEvent(a,this._currentLevel+m);o[m]=a.endTime}this._entryTypeByLevel.length=this._currentLevel+o.length;this._entryTypeByLevel.fill(s,this._currentLevel);this._currentLevel+=o.length;return l}_appendInteractionRecords(){const e=this._performanceModel.interactionRecords();if(!e.length)return;this._appendHeader(ls`Interactions`,this._interactionsHeaderLevel1,false);for(const t of e){const e=this._entryData.length;this._entryData.push(t.data);this._entryIndexToTitle[e]=t.data;this._timelineData.entryLevels[e]=this._currentLevel;this._timelineData.entryTotalTimes[e]=t.end-t.begin;this._timelineData.entryStartTimes[e]=t.begin}this._entryTypeByLevel[this._currentLevel++]=Timeline.TimelineFlameChartDataProvider.EntryType.InteractionRecord}_appendPageMetrics(){this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Event;const e=[];for(const t of this._model.tracks()){for(const i of t.events){if(!this._performanceModel.timelineModel().isMarkerEvent(i))continue;e.push(i)}}e.stableSort(SDK.TracingModel.Event.compareStartTime);const t=this._timelineData.entryTotalTimes;for(const i of e){this._appendEvent(i,this._currentLevel);t[t.length-1]=Number.NaN}++this._currentLevel}_appendFrames(){const e=this._performanceModel.filmStripModel().frames();const t=!!e.length;this._framesHeader.collapsible=t;this._appendHeader(Common.UIString("Frames"),this._framesHeader,false);this._frameGroup=this._timelineData.groups.peekLast();const i=Timeline.TimelineUIUtils.markerStyleForFrame();this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Frame;for(const e of this._performanceModel.frames()){this._markers.push(new Timeline.TimelineFlameChartMarker(e.startTime,e.startTime-this._model.minimumRecordTime(),i));this._appendFrame(e)}++this._currentLevel;if(!t)return;this._appendHeader("",this._screenshotsHeader,false);this._entryTypeByLevel[this._currentLevel]=Timeline.TimelineFlameChartDataProvider.EntryType.Screenshot;let n;for(const t of e){this._entryData.push(t);this._timelineData.entryLevels.push(this._currentLevel);this._timelineData.entryStartTimes.push(t.timestamp);if(n)this._timelineData.entryTotalTimes.push(t.timestamp-n);n=t.timestamp}if(e.length)this._timelineData.entryTotalTimes.push(this._model.maximumRecordTime()-n);++this._currentLevel}_entryType(e){return this._entryTypeByLevel[this._timelineData.entryLevels[e]]}prepareHighlightedEntryInfo(e){let t="";let i;let n;const s=this._entryType(e);if(s===Timeline.TimelineFlameChartDataProvider.EntryType.Event){const s=this._entryData[e];const r=s.duration;const o=s.selfTime;const l=1e-6;if(typeof r==="number"){t=Math.abs(r-o)>l&&o>l?Common.UIString("%s (self %s)",Number.millisToString(r,true),Number.millisToString(o,true)):Number.millisToString(r,true)}if(this._performanceModel.timelineModel().isMarkerEvent(s))i=Timeline.TimelineUIUtils.eventTitle(s);else i=this.entryTitle(e);n=Timeline.TimelineUIUtils.eventWarning(s)}else if(s===Timeline.TimelineFlameChartDataProvider.EntryType.Frame){const s=this._entryData[e];t=Common.UIString("%s ~ %.0f fps",Number.preciseMillisToString(s.duration,1),1e3/s.duration);i=s.idle?Common.UIString("Idle Frame"):Common.UIString("Frame");if(s.hasWarnings()){n=createElement("span");n.textContent=Common.UIString("Long frame")}}else{return null}const r=createElement("div");const o=UI.createShadowRootWithCoreStyles(r,"timeline/timelineFlamechartPopover.css");const l=o.createChild("div","timeline-flamechart-popover");l.createChild("span","timeline-info-time").textContent=t;l.createChild("span","timeline-info-title").textContent=i;if(n){n.classList.add("timeline-info-warning");l.appendChild(n)}return r}entryColor(e){function t(e,t,i){let n=e.get(t);if(n)return n;const s=Common.Color.parse(i(t));n=s.setAlpha(.7).asString(Common.Color.Format.RGBA)||"";e.set(t,n);return n}const i=Timeline.TimelineFlameChartDataProvider.EntryType;const n=this._entryType(e);if(n===i.Event){const i=this._entryData[e];if(this._model.isGenericTrace())return this._genericTraceEventColor(i);if(this._performanceModel.timelineModel().isMarkerEvent(i))return Timeline.TimelineUIUtils.markerStyleForEvent(i).color;if(!SDK.TracingModel.isAsyncPhase(i.phase))return this._colorForEvent(i);if(i.hasCategory(TimelineModel.TimelineModel.Category.Console)||i.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))return this._consoleColorGenerator.colorForID(i.name);if(i.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const e=TimelineModel.TimelineIRModel.phaseForEvent(i)||TimelineModel.TimelineIRModel.Phases.Uncategorized;return t(this._asyncColorByInteractionPhase,e,Timeline.TimelineUIUtils.interactionPhaseColor)}const n=Timeline.TimelineUIUtils.eventStyle(i).category;return t(this._asyncColorByCategory,n,()=>n.color)}if(n===i.Frame)return"white";if(n===i.InteractionRecord)return"transparent";if(n===i.ExtensionEvent){const t=this._entryData[e];return this._extensionColorGenerator.colorForID(t.name)}return""}_genericTraceEventColor(e){const t=e.categoriesString||e.name;return t?`hsl(${String.hashCode(t)%300+30}, 40%, 70%)`:"#ccc"}_drawFrame(e,t,i,n,s,r,o){const l=1;const a=this._entryData[e];n+=l;r-=2*l;t.fillStyle=a.idle?"white":a.hasWarnings()?"#fad1d1":"#d7f0d1";t.fillRect(n,s,r,o);const d=Number.preciseMillisToString(a.duration,1);const m=t.measureText(d).width;if(m<=r){t.fillStyle=this.textColor(e);t.fillText(d,n+(r-m)/2,s+o-4)}}async _drawScreenshot(e,t,i,n,s,r){const o=this._entryData[e];if(!this._screenshotImageCache.has(o)){this._screenshotImageCache.set(o,null);const e=await o.imageDataPromise();const t=await UI.loadImageFromData(e);this._screenshotImageCache.set(o,t);this.dispatchEventToListeners(Timeline.TimelineFlameChartDataProvider.Events.DataChanged);return}const l=this._screenshotImageCache.get(o);if(!l)return;const a=i+1;const d=n+1;const m=r-2;const c=m/l.naturalHeight;const h=Math.floor(l.naturalWidth*c);t.save();t.beginPath();t.rect(i,n,s,r);t.clip();t.drawImage(l,a,d,h,m);t.strokeStyle="#ccc";t.strokeRect(a-.5,d-.5,Math.min(s-1,h+1),m);t.restore()}decorateEntry(e,t,i,n,s,r,o,l,a){const d=this._entryData[e];const m=this._entryType(e);const c=Timeline.TimelineFlameChartDataProvider.EntryType;if(m===c.Frame){this._drawFrame(e,t,i,n,s,r,o);return true}if(m===c.Screenshot){this._drawScreenshot(e,t,n,s,r,o);return true}if(m===c.InteractionRecord){const e=Timeline.TimelineUIUtils.interactionPhaseColor(d);t.fillStyle=e;t.fillRect(n,s,r-1,2);t.fillRect(n,s-3,2,3);t.fillRect(n+r-3,s-3,2,3);return false}if(m===c.Event){const e=d;if(e.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const i=TimelineModel.TimelineData.forEvent(e).timeWaitingForMainThread;if(i){t.fillStyle="hsla(0, 70%, 60%, 1)";const e=Math.floor(l-n+i*a);t.fillRect(n,s+o-3,e,2)}}if(TimelineModel.TimelineData.forEvent(e).warning)h(n,r-1.5)}function h(e,i){const n=8;t.save();t.beginPath();t.rect(e,s,i,o);t.clip();t.beginPath();t.fillStyle="red";t.moveTo(e+i-n,s);t.lineTo(e+i,s);t.lineTo(e+i,s+n);t.fill();t.restore()}return false}forceDecoration(e){const t=Timeline.TimelineFlameChartDataProvider.EntryType;const i=this._entryType(e);if(i===t.Frame)return true;if(i===t.Screenshot)return true;if(i===t.Event){const t=this._entryData[e];return!!TimelineModel.TimelineData.forEvent(t).warning}return false}appendExtensionEvents(e){this._extensionInfo.push(e);if(this._timelineData)this._innerAppendExtensionEvents(this._extensionInfo.length-1)}_innerAppendExtensionEvents(e){const t=this._extensionInfo[e];const i=Timeline.TimelineFlameChartDataProvider.EntryType.ExtensionEvent;const n=[].concat(...t.model.sortedProcesses().map(e=>e.sortedThreads()));if(!n.length)return;const s=n.length===1&&(!n[0].events().length||!n[0].asyncEvents().length);if(!s)this._appendHeader(t.title,this._headerLevel1,false);const r=s?this._headerLevel2:this._headerLevel1;let o=0;for(const e of n){const n=s?t.title:e.name()||ls`Thread ${++o}`;this._appendAsyncEventsGroup(null,n,e.asyncEvents(),r,i,false);this._appendSyncEvents(null,e.events(),n,r,i,false)}}_appendHeader(e,t,i){const n={startLevel:this._currentLevel,name:e,style:t,selectable:i};this._timelineData.groups.push(n);return n}_appendEvent(e,t){const i=this._entryData.length;this._entryData.push(e);this._timelineData.entryLevels[i]=t;this._timelineData.entryTotalTimes[i]=e.duration||Timeline.TimelineFlameChartDataProvider.InstantEventVisibleDurationMs;this._timelineData.entryStartTimes[i]=e.startTime;e[Timeline.TimelineFlameChartDataProvider._indexSymbol]=i;return i}_appendAsyncEvent(e,t){if(SDK.TracingModel.isNestableAsyncPhase(e.phase)){this._appendEvent(e,t);return}const i=e.steps;const n=i.length>1&&i[1].phase===SDK.TracingModel.Phase.AsyncStepPast?1:0;for(let e=0;e<i.length-1;++e){const s=this._entryData.length;this._entryData.push(i[e+n]);const r=i[e].startTime;this._timelineData.entryLevels[s]=t;this._timelineData.entryTotalTimes[s]=i[e+1].startTime-r;this._timelineData.entryStartTimes[s]=r}}_appendFlowEvent(e,t){const i=this._timelineData;function n(e){const n=i.flowStartTimes.length;i.flowStartTimes.push(e.startTime);i.flowStartLevels.push(t);return n}function s(e,n){i.flowEndTimes[n]=e.startTime;i.flowEndLevels[n]=t}switch(e.phase){case SDK.TracingModel.Phase.FlowBegin:this._flowEventIndexById.set(e.id,n(e));break;case SDK.TracingModel.Phase.FlowStep:s(e,this._flowEventIndexById.get(e.id));this._flowEventIndexById.set(e.id,n(e));break;case SDK.TracingModel.Phase.FlowEnd:s(e,this._flowEventIndexById.get(e.id));this._flowEventIndexById.delete(e.id);break}}_appendFrame(e){const t=this._entryData.length;this._entryData.push(e);this._entryIndexToTitle[t]=Number.millisToString(e.duration,true);this._timelineData.entryLevels[t]=this._currentLevel;this._timelineData.entryTotalTimes[t]=e.duration;this._timelineData.entryStartTimes[t]=e.startTime}createSelection(e){const t=this._entryType(e);let i=null;if(t===Timeline.TimelineFlameChartDataProvider.EntryType.Event){i=Timeline.TimelineSelection.fromTraceEvent(this._entryData[e])}else if(t===Timeline.TimelineFlameChartDataProvider.EntryType.Frame){i=Timeline.TimelineSelection.fromFrame(this._entryData[e])}if(i)this._lastSelection=new Timeline.TimelineFlameChartView.Selection(i,e);return i}formatValue(e,t){return Number.preciseMillisToString(e,t)}canJumpToEntry(e){return false}entryIndexForSelection(e){if(!e||e.type()===Timeline.TimelineSelection.Type.Range)return-1;if(this._lastSelection&&this._lastSelection.timelineSelection.object()===e.object())return this._lastSelection.entryIndex;const t=this._entryData.indexOf(e.object());if(t!==-1)this._lastSelection=new Timeline.TimelineFlameChartView.Selection(e,t);return t}buildFlowForInitiator(e){if(this._lastInitiatorEntry===e)return false;this._lastInitiatorEntry=e;let t=this.eventByIndex(e);const i=this._timelineData;i.flowStartTimes=[];i.flowStartLevels=[];i.flowEndTimes=[];i.flowEndLevels=[];while(t){let e;for(;t;t=this._eventParent(t)){e=TimelineModel.TimelineData.forEvent(t).initiator();if(e)break}if(!e)break;const n=t[Timeline.TimelineFlameChartDataProvider._indexSymbol];const s=e[Timeline.TimelineFlameChartDataProvider._indexSymbol];i.flowStartTimes.push(e.endTime||e.startTime);i.flowStartLevels.push(i.entryLevels[s]);i.flowEndTimes.push(t.startTime);i.flowEndLevels.push(i.entryLevels[n]);t=e}return true}_eventParent(e){return this._entryParent[e[Timeline.TimelineFlameChartDataProvider._indexSymbol]]||null}eventByIndex(e){return e>=0&&this._entryType(e)===Timeline.TimelineFlameChartDataProvider.EntryType.Event?this._entryData[e]:null}setEventColorMapping(e){this._colorForEvent=e}};Timeline.TimelineFlameChartDataProvider.InstantEventVisibleDurationMs=.001;Timeline.TimelineFlameChartDataProvider._indexSymbol=Symbol("index");Timeline.TimelineFlameChartDataProvider.Events={DataChanged:Symbol("DataChanged")};Timeline.TimelineFlameChartDataProvider.EntryType={Frame:Symbol("Frame"),Event:Symbol("Event"),InteractionRecord:Symbol("InteractionRecord"),ExtensionEvent:Symbol("ExtensionEvent"),Screenshot:Symbol("Screenshot")};Timeline.TimelineFlameChartNetworkDataProvider=class{constructor(){this._font="11px "+Host.fontFamily();this.setModel(null);this._style={padding:4,height:17,collapsible:true,color:UI.themeSupport.patchColorText("#222",UI.ThemeSupport.ColorUsage.Foreground),font:this._font,backgroundColor:UI.themeSupport.patchColorText("white",UI.ThemeSupport.ColorUsage.Background),nestingLevel:0,useFirstLineForOverview:false,useDecoratorsForOverview:true,shareHeaderLine:false};this._group={startLevel:0,name:Common.UIString("Network"),expanded:false,style:this._style};this._minimumBoundary=0;this._maximumBoundary=0;this._timeSpan=0}setModel(e){this._model=e&&e.timelineModel();this._maxLevel=0;this._timelineData=null;this._requests=[]}isEmpty(){this.timelineData();return!this._requests.length}maxStackDepth(){return this._maxLevel}timelineData(){if(this._timelineData)return this._timelineData;this._requests=[];this._timelineData=new PerfUI.FlameChart.TimelineData([],[],[],[]);if(this._model)this._appendTimelineData();return this._timelineData}minimumBoundary(){return this._minimumBoundary}totalTime(){return this._timeSpan}setWindowTimes(e,t){this._startTime=e;this._endTime=t;this._updateTimelineData()}createSelection(e){if(e===-1)return null;const t=this._requests[e];this._lastSelection=new Timeline.TimelineFlameChartView.Selection(Timeline.TimelineSelection.fromNetworkRequest(t),e);return this._lastSelection.timelineSelection}entryIndexForSelection(e){if(!e)return-1;if(this._lastSelection&&this._lastSelection.timelineSelection.object()===e.object())return this._lastSelection.entryIndex;if(e.type()!==Timeline.TimelineSelection.Type.NetworkRequest)return-1;const t=e.object();const i=this._requests.indexOf(t);if(i!==-1){this._lastSelection=new Timeline.TimelineFlameChartView.Selection(Timeline.TimelineSelection.fromNetworkRequest(t),i)}return i}entryColor(e){const t=this._requests[e];const i=Timeline.TimelineUIUtils.networkRequestCategory(t);return Timeline.TimelineUIUtils.networkCategoryColor(i)}textColor(e){return Timeline.FlameChartStyle.textColor}entryTitle(e){const t=this._requests[e];const i=new Common.ParsedURL(t.url||"");return i.isValid?`${i.displayName} (${i.host})`:t.url||null}entryFont(e){return this._font}decorateEntry(e,t,i,n,s,r,o,l,a){const d=this._requests[e];if(!d.timing)return false;function m(e){return Math.floor(l+(e-h)*a)}const c=2;const h=d.beginTime();const u=Math.min(d.startTime,d.timing&&d.timing.requestTime*1e3||Infinity);const T=d.endTime;const p=d.timing.requestTime*1e3;const g=Math.max(m(p+d.timing.sendStart),l);const _=Math.max(m(p+d.timing.receiveHeadersEnd),g);const f=Math.max(m(d.finishTime||T),_+c);const v=m(u);const w=Math.max(m(T),f);t.fillStyle="hsla(0, 100%, 100%, 0.8)";t.fillRect(g+.5,s+.5,_-g-.5,o-2);t.fillStyle=UI.themeSupport.patchColorText("white",UI.ThemeSupport.ColorUsage.Background);t.fillRect(n,s-.5,g-n,o);t.fillRect(f,s-.5,n+r-f,o);if(d.timing.pushStart){const i=m(d.timing.pushStart*1e3);const n=m(d.timing.pushEnd*1e3);const r=Number.constrain(n-i-2,0,4);const l=1;t.save();t.beginPath();t.moveTo(i+r,s+o/2);t.lineTo(i,s+l);t.lineTo(n-r,s+l);t.lineTo(n,s+o/2);t.lineTo(n-r,s+o-l);t.lineTo(i,s+o-l);t.closePath();t.fillStyle=this.entryColor(e);t.globalAlpha=.3;t.fill();t.restore()}function y(e,i,n){const s=6;t.moveTo(e,n-s/2);t.lineTo(e,n+s/2);t.moveTo(e,n);t.lineTo(i,n)}t.beginPath();t.lineWidth=1;t.strokeStyle="#ccc";const S=Math.floor(s+o/2)+.5;const C=v+.5;const b=w-.5;y(C,g,S);y(b,f,S);t.stroke();if(typeof d.priority==="string"){const e=this._colorForPriority(d.priority);if(e){t.fillStyle=e;t.fillRect(g+.5,s+.5,3.5,3.5)}}const M=Math.max(g,0);const I=f-M;const P=20;if(I>=P){i=this.entryTitle(e)||"";if(d.fromServiceWorker)i="⚙ "+i;if(i){const e=4;const n=5;const r=o-n;const l=UI.trimTextEnd(t,i,I-2*e);t.fillStyle="#333";t.fillText(l,M+e,s+r)}}return true}forceDecoration(e){return true}prepareHighlightedEntryInfo(e){const t=80;const i=this._requests[e];if(!i.url)return null;const n=createElement("div");const s=UI.createShadowRootWithCoreStyles(n,"timeline/timelineFlamechartPopover.css");const r=s.createChild("div","timeline-flamechart-popover");const o=i.endTime-i.startTime;if(i.startTime&&isFinite(o))r.createChild("span","timeline-info-network-time").textContent=Number.millisToString(o);if(typeof i.priority==="string"){const e=r.createChild("span");e.textContent=PerfUI.uiLabelForNetworkPriority(i.priority);e.style.color=this._colorForPriority(i.priority)||"black"}r.createChild("span").textContent=i.url.trimMiddle(t);return n}_colorForPriority(e){if(!this._priorityToValue){const e=Protocol.Network.ResourcePriority;this._priorityToValue=new Map([[e.VeryLow,1],[e.Low,2],[e.Medium,3],[e.High,4],[e.VeryHigh,5]])}const t=this._priorityToValue.get(e);return t?`hsla(214, 80%, 50%, ${t/5})`:null}_appendTimelineData(){this._minimumBoundary=this._model.minimumRecordTime();this._maximumBoundary=this._model.maximumRecordTime();this._timeSpan=this._model.isEmpty()?1e3:this._maximumBoundary-this._minimumBoundary;this._model.networkRequests().forEach(this._appendEntry.bind(this));this._updateTimelineData()}_updateTimelineData(){if(!this._timelineData)return;const e=[];let t=0;for(let i=0;i<this._requests.length;++i){const n=this._requests[i];const s=n.beginTime();const r=s<this._endTime&&n.endTime>this._startTime;if(!r){this._timelineData.entryLevels[i]=-1;continue}while(e.length&&e.peekLast()<=s)e.pop();this._timelineData.entryLevels[i]=e.length;e.push(n.endTime);t=Math.max(t,e.length)}for(let e=0;e<this._requests.length;++e){if(this._timelineData.entryLevels[e]===-1)this._timelineData.entryLevels[e]=t}this._timelineData=new PerfUI.FlameChart.TimelineData(this._timelineData.entryLevels,this._timelineData.entryTotalTimes,this._timelineData.entryStartTimes,[this._group]);this._maxLevel=t}_appendEntry(e){this._requests.push(e);this._timelineData.entryStartTimes.push(e.beginTime());this._timelineData.entryTotalTimes.push(e.endTime-e.beginTime());this._timelineData.entryLevels.push(this._requests.length-1)}preferredHeight(){return this._style.height*(this._group.expanded?Number.constrain(this._maxLevel+1,4,8.5):1)}isExpanded(){return this._group.expanded}formatValue(e,t){return Number.preciseMillisToString(e,t)}canJumpToEntry(e){return false}};Timeline.TimelineFlameChartView=class extends UI.VBox{constructor(e){super();this.element.classList.add("timeline-flamechart");this._delegate=e;this._model=null;this._searchResults;this._eventListeners=[];this._showMemoryGraphSetting=Common.settings.createSetting("timelineShowMemory",false);this._networkSplitWidget=new UI.SplitWidget(false,false,"timelineFlamechartMainView",150);const t=Common.settings.createSetting("timelineFlamechartMainViewGroupExpansion",{});this._mainDataProvider=new Timeline.TimelineFlameChartDataProvider;this._mainDataProvider.addEventListener(Timeline.TimelineFlameChartDataProvider.Events.DataChanged,()=>this._mainFlameChart.scheduleUpdate());this._mainFlameChart=new PerfUI.FlameChart(this._mainDataProvider,this,t);this._mainFlameChart.alwaysShowVerticalScroll();this._mainFlameChart.enableRuler(false);this._networkFlameChartGroupExpansionSetting=Common.settings.createSetting("timelineFlamechartNetworkViewGroupExpansion",{});this._networkDataProvider=new Timeline.TimelineFlameChartNetworkDataProvider;this._networkFlameChart=new PerfUI.FlameChart(this._networkDataProvider,this,this._networkFlameChartGroupExpansionSetting);this._networkFlameChart.alwaysShowVerticalScroll();this._networkFlameChart.disableRangeSelection();this._networkPane=new UI.VBox;this._networkPane.setMinimumSize(23,23);this._networkFlameChart.show(this._networkPane.element);this._splitResizer=this._networkPane.element.createChild("div","timeline-flamechart-resizer");this._networkSplitWidget.hideDefaultResizer(true);this._networkSplitWidget.installResizer(this._splitResizer);this._networkSplitWidget.setMainWidget(this._mainFlameChart);this._networkSplitWidget.setSidebarWidget(this._networkPane);this._chartSplitWidget=new UI.SplitWidget(false,true,"timelineCountersSplitViewState");this._countersView=new Timeline.CountersGraph(this._delegate);this._chartSplitWidget.setMainWidget(this._networkSplitWidget);this._chartSplitWidget.setSidebarWidget(this._countersView);this._chartSplitWidget.hideDefaultResizer();this._chartSplitWidget.installResizer(this._countersView.resizerElement());this._updateCountersGraphToggle();this._detailsSplitWidget=new UI.SplitWidget(false,true,"timelinePanelDetailsSplitViewState");this._detailsSplitWidget.element.classList.add("timeline-details-split");this._detailsView=new Timeline.TimelineDetailsView(e);this._detailsSplitWidget.installResizer(this._detailsView.headerElement());this._detailsSplitWidget.setMainWidget(this._chartSplitWidget);this._detailsSplitWidget.setSidebarWidget(this._detailsView);this._detailsSplitWidget.show(this.element);this._onMainEntrySelected=this._onEntrySelected.bind(this,this._mainDataProvider);this._onNetworkEntrySelected=this._onEntrySelected.bind(this,this._networkDataProvider);this._mainFlameChart.addEventListener(PerfUI.FlameChart.Events.EntrySelected,this._onMainEntrySelected,this);this._networkFlameChart.addEventListener(PerfUI.FlameChart.Events.EntrySelected,this._onNetworkEntrySelected,this);this._mainFlameChart.addEventListener(PerfUI.FlameChart.Events.EntryHighlighted,this._onEntryHighlighted,this);this._nextExtensionIndex=0;this._boundRefresh=this._refresh.bind(this);this._selectedTrack=null;this._mainDataProvider.setEventColorMapping(Timeline.TimelineUIUtils.eventColor);this._groupBySetting=Common.settings.createSetting("timelineTreeGroupBy",Timeline.AggregatedTimelineTreeView.GroupBy.None);this._groupBySetting.addChangeListener(this._updateColorMapper,this);this._updateColorMapper();ProductRegistry.instance().then(e=>this._productRegistry=e)}_updateColorMapper(){this._urlToColorCache=new Map;if(!this._model)return;const e=this._groupBySetting.get()===Timeline.AggregatedTimelineTreeView.GroupBy.Product;this._mainDataProvider.setEventColorMapping(e?this._colorByProductForEvent.bind(this):Timeline.TimelineUIUtils.eventColor);this._mainFlameChart.update()}_colorByProductForEvent(e){return Timeline.TimelineUIUtils.eventColorByProduct(this._productRegistry,this._model.timelineModel(),this._urlToColorCache,e)}_onWindowChanged(e){const t=e.data.window;const i=!!e.data.animate;this._mainFlameChart.setWindowTimes(t.left,t.right,i);this._networkFlameChart.setWindowTimes(t.left,t.right,i);this._networkDataProvider.setWindowTimes(t.left,t.right);this._updateSearchResults(false,false)}windowChanged(e,t,i){this._model.setWindow({left:e,right:t},i)}updateRangeSelection(e,t){this._delegate.select(Timeline.TimelineSelection.fromRange(e,t))}updateSelectedGroup(e,t){if(e!==this._mainFlameChart)return;const i=t?this._mainDataProvider.groupTrack(t):null;this._selectedTrack=i;this._updateTrack()}setModel(e){if(e===this._model)return;Common.EventTarget.removeEventListeners(this._eventListeners);this._model=e;this._selectedTrack=null;this._mainDataProvider.setModel(this._model);this._networkDataProvider.setModel(this._model);if(this._model){this._eventListeners=[this._model.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onWindowChanged,this),this._model.addEventListener(Timeline.PerformanceModel.Events.ExtensionDataAdded,this._appendExtensionData,this)];const t=e.window();this._mainFlameChart.setWindowTimes(t.left,t.right);this._networkFlameChart.setWindowTimes(t.left,t.right);this._networkDataProvider.setWindowTimes(t.left,t.right);this._updateSearchResults(false,false)}this._updateColorMapper();this._updateTrack();this._nextExtensionIndex=0;this._appendExtensionData();this._refresh()}_updateTrack(){this._countersView.setModel(this._model,this._selectedTrack);this._detailsView.setModel(this._model,this._selectedTrack)}_refresh(){if(this._networkDataProvider.isEmpty()){this._mainFlameChart.enableRuler(true);this._networkSplitWidget.hideSidebar()}else{this._mainFlameChart.enableRuler(false);this._networkSplitWidget.showBoth();this.resizeToPreferredHeights()}this._mainFlameChart.reset();this._networkFlameChart.reset();this._updateSearchResults(false,false)}_appendExtensionData(){if(!this._model)return;const e=this._model.extensionInfo();while(this._nextExtensionIndex<e.length)this._mainDataProvider.appendExtensionEvents(e[this._nextExtensionIndex++]);this._mainFlameChart.scheduleUpdate()}_onEntryHighlighted(e){SDK.OverlayModel.hideDOMNodeHighlight();const t=e.data;const i=this._mainDataProvider.eventByIndex(t);if(!i)return;const n=this._model&&this._model.timelineModel().targetByEvent(i);if(!n)return;const s=TimelineModel.TimelineData.forEvent(i);const r=s.backendNodeId;if(!r)return;new SDK.DeferredDOMNode(n,r).highlight()}highlightEvent(e){const t=e?this._mainDataProvider.entryIndexForSelection(Timeline.TimelineSelection.fromTraceEvent(e)):-1;if(t>=0)this._mainFlameChart.highlightEntry(t);else this._mainFlameChart.hideHighlight()}willHide(){this._networkFlameChartGroupExpansionSetting.removeChangeListener(this.resizeToPreferredHeights,this);this._showMemoryGraphSetting.removeChangeListener(this._updateCountersGraphToggle,this);Bindings.blackboxManager.removeChangeListener(this._boundRefresh)}wasShown(){this._networkFlameChartGroupExpansionSetting.addChangeListener(this.resizeToPreferredHeights,this);this._showMemoryGraphSetting.addChangeListener(this._updateCountersGraphToggle,this);Bindings.blackboxManager.addChangeListener(this._boundRefresh);if(this._needsResizeToPreferredHeights)this.resizeToPreferredHeights();this._mainFlameChart.scheduleUpdate();this._networkFlameChart.scheduleUpdate()}_updateCountersGraphToggle(){if(this._showMemoryGraphSetting.get())this._chartSplitWidget.showBoth();else this._chartSplitWidget.hideSidebar()}setSelection(e){let t=this._mainDataProvider.entryIndexForSelection(e);this._mainFlameChart.setSelectedEntry(t);t=this._networkDataProvider.entryIndexForSelection(e);this._networkFlameChart.setSelectedEntry(t);if(this._detailsView)this._detailsView.setSelection(e)}_onEntrySelected(e,t){const i=t.data;if(Runtime.experiments.isEnabled("timelineEventInitiators")&&e===this._mainDataProvider){if(this._mainDataProvider.buildFlowForInitiator(i))this._mainFlameChart.scheduleUpdate()}this._delegate.select(e.createSelection(i))}resizeToPreferredHeights(){if(!this.isShowing()){this._needsResizeToPreferredHeights=true;return}this._needsResizeToPreferredHeights=false;this._networkPane.element.classList.toggle("timeline-network-resizer-disabled",!this._networkDataProvider.isExpanded());this._networkSplitWidget.setSidebarSize(this._networkDataProvider.preferredHeight()+this._splitResizer.clientHeight+PerfUI.FlameChart.HeaderHeight+2)}setSearchableView(e){this._searchableView=e}jumpToNextSearchResult(){if(!this._searchResults||!this._searchResults.length)return;const e=typeof this._selectedSearchResult!=="undefined"?this._searchResults.indexOf(this._selectedSearchResult):-1;this._selectSearchResult(mod(e+1,this._searchResults.length))}jumpToPreviousSearchResult(){if(!this._searchResults||!this._searchResults.length)return;const e=typeof this._selectedSearchResult!=="undefined"?this._searchResults.indexOf(this._selectedSearchResult):0;this._selectSearchResult(mod(e-1,this._searchResults.length))}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}_selectSearchResult(e){this._searchableView.updateCurrentMatchIndex(e);this._selectedSearchResult=this._searchResults[e];this._delegate.select(this._mainDataProvider.createSelection(this._selectedSearchResult))}_updateSearchResults(e,t){const i=this._selectedSearchResult;delete this._selectedSearchResult;this._searchResults=[];if(!this._searchRegex||!this._model)return;const n=new Timeline.TimelineFilters.RegExp(this._searchRegex);const s=this._model.window();this._searchResults=this._mainDataProvider.search(s.left,s.right,n);this._searchableView.updateSearchMatchesCount(this._searchResults.length);if(!e||!this._searchResults.length)return;let r=this._searchResults.indexOf(i);if(r===-1)r=t?this._searchResults.length-1:0;this._selectSearchResult(r)}searchCanceled(){if(typeof this._selectedSearchResult!=="undefined")this._delegate.select(null);delete this._searchResults;delete this._selectedSearchResult;delete this._searchRegex}performSearch(e,t,i){this._searchRegex=e.toSearchRegex();this._updateSearchResults(t,i)}};Timeline.TimelineFlameChartView.Selection=class{constructor(e,t){this.timelineSelection=e;this.entryIndex=t}};Timeline.FlameChartStyle={textColor:"#333"};Timeline.TimelineFlameChartMarker=class{constructor(e,t,i){this._startTime=e;this._startOffset=t;this._style=i}startTime(){return this._startTime}color(){return this._style.color}title(){if(this._style.lowPriority)return null;const e=Number.millisToString(this._startOffset);return ls`${this._style.title} at ${e}`}draw(e,t,i,n){const s=4;if(this._style.lowPriority&&n<s)return;e.save();if(this._style.tall){e.strokeStyle=this._style.color;e.lineWidth=this._style.lineWidth;e.translate(this._style.lineWidth<1||this._style.lineWidth&1?.5:0,.5);e.beginPath();e.moveTo(t,0);e.setLineDash(this._style.dashStyle);e.lineTo(t,e.canvas.height);e.stroke()}e.restore()}};Timeline.TimelineFlameChartView._ColorBy={URL:"URL",Product:"Product"};Timeline.TimelineHistoryManager=class{constructor(){this._recordings=[];this._action=UI.actionRegistry.action("timeline.show-history");this._nextNumberByDomain=new Map;this._button=new Timeline.TimelineHistoryManager.ToolbarButton(this._action);this.clear();this._allOverviews=[{constructor:Timeline.TimelineEventOverviewResponsiveness,height:3},{constructor:Timeline.TimelineEventOverviewFrames,height:16},{constructor:Timeline.TimelineEventOverviewCPUActivity,height:20},{constructor:Timeline.TimelineEventOverviewNetwork,height:8}];this._totalHeight=this._allOverviews.reduce((e,t)=>e+t.height,0);this._enabled=true;this._lastActiveModel=null}addRecording(e){this._lastActiveModel=e;this._recordings.unshift(e);this._buildPreview(e);this._button.setText(this._title(e));this._updateState();if(this._recordings.length<=Timeline.TimelineHistoryManager._maxRecordings)return;const t=this._recordings.reduce((e,t)=>i(e)<i(t)?e:t);this._recordings.splice(this._recordings.indexOf(t),1);t.dispose();function i(e){return Timeline.TimelineHistoryManager._dataForModel(e).lastUsed}}setEnabled(e){this._enabled=e;this._updateState()}button(){return this._button}clear(){this._recordings.forEach(e=>e.dispose());this._recordings=[];this._lastActiveModel=null;this._updateState();this._button.setText(Common.UIString("(no recordings)"));this._nextNumberByDomain.clear()}async showHistoryDropDown(){if(this._recordings.length<2||!this._enabled)return null;const e=await Timeline.TimelineHistoryManager.DropDown.show(this._recordings,this._lastActiveModel,this._button.element);if(!e)return null;const t=this._recordings.indexOf(e);if(t<0){console.assert(false,`selected recording not found`);return null}this._setCurrentModel(e);return e}cancelIfShowing(){Timeline.TimelineHistoryManager.DropDown.cancelIfShowing()}navigate(e){if(!this._enabled||!this._lastActiveModel)return null;const t=this._recordings.indexOf(this._lastActiveModel);if(t<0)return null;const i=Number.constrain(t+e,0,this._recordings.length-1);const n=this._recordings[i];this._setCurrentModel(n);return n}_setCurrentModel(e){Timeline.TimelineHistoryManager._dataForModel(e).lastUsed=Date.now();this._lastActiveModel=e;this._button.setText(this._title(e))}_updateState(){this._action.setEnabled(this._recordings.length>1&&this._enabled)}static _previewElement(e){const t=Timeline.TimelineHistoryManager._dataForModel(e);const i=e.recordStartTime();t.time.textContent=i?Common.UIString("(%s ago)",Timeline.TimelineHistoryManager._coarseAge(i)):"";return t.preview}static _coarseAge(e){const t=Math.round((Date.now()-e)/1e3);if(t<50)return Common.UIString("moments");const i=Math.round(t/60);if(i<50)return Common.UIString("%s m",i);const n=Math.round(i/60);return Common.UIString("%s h",n)}_title(e){return Timeline.TimelineHistoryManager._dataForModel(e).title}_buildPreview(e){const t=e.timelineModel().pageURL().asParsedURL();const i=t?t.host:"";const n=this._nextNumberByDomain.get(i)||1;const s=Common.UIString("%s #%d",i,n);this._nextNumberByDomain.set(i,n+1);const r=createElement("span");const o=createElementWithClass("div","preview-item vbox");const l={preview:o,title:s,time:r,lastUsed:Date.now()};e[Timeline.TimelineHistoryManager._previewDataSymbol]=l;o.appendChild(this._buildTextDetails(e,s,r));const a=o.createChild("div","hbox");a.appendChild(this._buildScreenshotThumbnail(e));a.appendChild(this._buildOverview(e));return l.preview}_buildTextDetails(e,t,i){const n=createElementWithClass("div","text-details hbox");n.createChild("span","name").textContent=t;const s=e.tracingModel();const r=Number.millisToString(s.maximumRecordTime()-s.minimumRecordTime(),false);const o=n.createChild("span","time");o.appendChild(createTextNode(r));o.appendChild(i);return n}_buildScreenshotThumbnail(e){const t=createElementWithClass("div","screenshot-thumb");const i=3/2;t.style.width=this._totalHeight*i+"px";t.style.height=this._totalHeight+"px";const n=e.filmStripModel();const s=n.frames().peekLast();if(!s)return t;s.imageDataPromise().then(e=>UI.loadImageFromData(e)).then(e=>e&&t.appendChild(e));return t}_buildOverview(e){const t=createElement("div");t.style.width=Timeline.TimelineHistoryManager._previewWidth+"px";t.style.height=this._totalHeight+"px";const i=t.createChild("canvas");i.width=window.devicePixelRatio*Timeline.TimelineHistoryManager._previewWidth;i.height=window.devicePixelRatio*this._totalHeight;const n=i.getContext("2d");let s=0;for(const t of this._allOverviews){const i=new t.constructor;i.setCanvasSize(Timeline.TimelineHistoryManager._previewWidth,t.height);i.setModel(e);i.update();const r=i.context();const o=r.getImageData(0,0,r.canvas.width,r.canvas.height);n.putImageData(o,0,s);s+=t.height*window.devicePixelRatio}return t}static _dataForModel(e){return e[Timeline.TimelineHistoryManager._previewDataSymbol]||null}};Timeline.TimelineHistoryManager.PreviewData;Timeline.TimelineHistoryManager._maxRecordings=5;Timeline.TimelineHistoryManager._previewWidth=450;Timeline.TimelineHistoryManager._previewDataSymbol=Symbol("previewData");Timeline.TimelineHistoryManager.DropDown=class{constructor(e){this._glassPane=new UI.GlassPane;this._glassPane.setSizeBehavior(UI.GlassPane.SizeBehavior.MeasureContent);this._glassPane.setOutsideClickCallback(()=>this._close(null));this._glassPane.setPointerEventsBehavior(UI.GlassPane.PointerEventsBehavior.BlockedByGlassPane);this._glassPane.setAnchorBehavior(UI.GlassPane.AnchorBehavior.PreferBottom);const t=UI.createShadowRootWithCoreStyles(this._glassPane.contentElement,"timeline/timelineHistoryManager.css");const i=t.createChild("div","drop-down");const n=new UI.ListModel;this._listControl=new UI.ListControl(n,this,UI.ListMode.NonViewport);this._listControl.element.addEventListener("mousemove",this._onMouseMove.bind(this),false);n.replaceAll(e);i.appendChild(this._listControl.element);i.addEventListener("keydown",this._onKeyDown.bind(this),false);i.addEventListener("click",this._onClick.bind(this),false);this._selectionDone=null}static show(e,t,i){if(Timeline.TimelineHistoryManager.DropDown._instance)return Promise.resolve(null);const n=new Timeline.TimelineHistoryManager.DropDown(e);return n._show(i,t)}static cancelIfShowing(){if(!Timeline.TimelineHistoryManager.DropDown._instance)return;Timeline.TimelineHistoryManager.DropDown._instance._close(null)}_show(e,t){Timeline.TimelineHistoryManager.DropDown._instance=this;this._glassPane.setContentAnchorBox(e.boxInWindow());this._glassPane.show(this._glassPane.contentElement.ownerDocument);this._listControl.element.focus();this._listControl.selectItem(t);return new Promise(e=>this._selectionDone=e)}_onMouseMove(e){const t=e.target.enclosingNodeOrSelfWithClass("preview-item");const i=t&&this._listControl.itemForNode(t);if(!i)return;this._listControl.selectItem(i)}_onClick(e){if(!e.target.enclosingNodeOrSelfWithClass("preview-item"))return;this._close(this._listControl.selectedItem())}_onKeyDown(e){switch(e.key){case"Escape":this._close(null);break;case"Enter":this._close(this._listControl.selectedItem());break;default:return}e.consume(true)}_close(e){this._selectionDone(e);this._glassPane.hide();Timeline.TimelineHistoryManager.DropDown._instance=null}createElementForItem(e){const t=Timeline.TimelineHistoryManager._previewElement(e);t.classList.remove("selected");return t}heightForItem(e){console.assert(false,"Should not be called");return 0}isItemSelectable(e){return true}selectedItemChanged(e,t,i,n){if(i)i.classList.remove("selected");if(n)n.classList.add("selected")}};Timeline.TimelineHistoryManager.DropDown._instance=null;Timeline.TimelineHistoryManager.ToolbarButton=class extends UI.ToolbarItem{constructor(e){super(createElementWithClass("button","history-dropdown-button"));UI.appendStyle(this.element,"timeline/historyToolbarButton.css");this._contentElement=this.element.createChild("span","content");const t=UI.Icon.create("smallicon-triangle-down");this.element.appendChild(t);this.element.addEventListener("click",()=>void e.execute(),false);this.setEnabled(e.enabled());e.addEventListener(UI.Action.Events.Enabled,e=>this.setEnabled(e.data));this.setTitle(e.title())}setText(e){this._contentElement.textContent=e}};Timeline.TimelineTreeView=class extends UI.VBox{constructor(){super();this._model=null;this._track=null;this._tree=null;this.element.classList.add("timeline-tree-view")}static eventNameForSorting(e){if(e.name===TimelineModel.TimelineModel.RecordType.JSFrame){const t=e.args["data"];return t["functionName"]+"@"+(t["scriptId"]||t["url"]||"")}return e.name+":@"+TimelineModel.TimelineProfileTree.eventURL(e)}setSearchableView(e){this._searchableView=e}setModel(e,t){this._model=e;this._track=t;this.refreshTree()}model(){return this._model}init(){this._linkifier=new Components.Linkifier;this._taskFilter=new TimelineModel.ExclusiveNameFilter([TimelineModel.TimelineModel.RecordType.Task]);this._textFilter=new Timeline.TimelineFilters.RegExp;this._currentThreadSetting=Common.settings.createSetting("timelineTreeCurrentThread",0);this._currentThreadSetting.addChangeListener(this.refreshTree,this);const e=[];this.populateColumns(e);this._splitWidget=new UI.SplitWidget(true,true,"timelineTreeViewDetailsSplitWidget");const t=new UI.VBox;const i=new UI.Toolbar("",t.element);this.populateToolbar(i);this._dataGrid=new DataGrid.SortableDataGrid(e);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SortingChanged,this._sortingChanged,this);this._dataGrid.element.addEventListener("mousemove",this._onMouseMove.bind(this),true);this._dataGrid.setResizeMethod(DataGrid.DataGrid.ResizeMethod.Last);this._dataGrid.setRowContextMenuCallback(this._onContextMenu.bind(this));this._dataGrid.asWidget().show(t.element);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,this._updateDetailsForSelection,this);this._detailsView=new UI.VBox;this._detailsView.element.classList.add("timeline-details-view","timeline-details-view-body");this._splitWidget.setMainWidget(t);this._splitWidget.setSidebarWidget(this._detailsView);this._splitWidget.hideSidebar();this._splitWidget.show(this.element);this._splitWidget.addEventListener(UI.SplitWidget.Events.ShowModeChanged,this._onShowModeChanged,this);this._lastSelectedNode}lastSelectedNode(){return this._lastSelectedNode}updateContents(e){this.setRange(e.startTime(),e.endTime())}setRange(e,t){this._startTime=e;this._endTime=t;this.refreshTree()}filters(){return[this._taskFilter,this._textFilter,...this._model.filters()]}_exposePercentages(){return false}populateToolbar(e){this._textFilterUI=new UI.ToolbarInput(Common.UIString("Filter"));this._textFilterUI.addEventListener(UI.ToolbarInput.Event.TextChanged,t,this);e.appendToolbarItem(this._textFilterUI);function t(){const e=this._textFilterUI.value();this._textFilter.setRegExp(e?createPlainTextSearchRegex(e,"i"):null);this.refreshTree()}}_modelEvents(){return this._track?this._track.syncEvents():[]}_onHover(e){}_appendContextMenuItems(e,t){}_linkifyLocation(e){const t=this._model.timelineModel().targetByEvent(e);if(!t)return null;const i=TimelineModel.TimelineProfileTree.eventStackFrame(e);if(!i)return null;return this._linkifier.maybeLinkifyConsoleCallFrame(t,i)}selectProfileNode(e,t){const i=[];for(let t=e;t;t=t.parent)i.push(t);for(let e=i.length-1;e>0;--e){const t=this.dataGridNodeForTreeNode(i[e]);if(t&&t.dataGrid)t.expand()}const n=this.dataGridNodeForTreeNode(e);if(n.dataGrid){n.reveal();n.select(t)}}refreshTree(){this._linkifier.reset();this._dataGrid.rootNode().removeChildren();if(!this._model){this._updateDetailsForSelection();return}this._root=this._buildTree();const e=this._root.children();let t=0;let i=0;const n=this._root.totalTime-this._root.selfTime;for(const n of e.values()){t=Math.max(t,n.selfTime);i=Math.max(i,n.totalTime)}for(const s of e.values()){const e=new Timeline.TimelineTreeView.TreeGridNode(s,n,t,i,this);this._dataGrid.insertChild(e)}this._sortingChanged();this._updateDetailsForSelection();if(this._searchableView)this._searchableView.refreshSearch()}_buildTree(){throw new Error("Not Implemented")}buildTopDownTree(e,t){return new TimelineModel.TimelineProfileTree.TopDownRootNode(this._modelEvents(),this.filters(),this._startTime,this._endTime,e,t)}populateColumns(e){e.push({id:"self",title:Common.UIString("Self Time"),width:"120px",fixedWidth:true,sortable:true});e.push({id:"total",title:Common.UIString("Total Time"),width:"120px",fixedWidth:true,sortable:true});e.push({id:"activity",title:Common.UIString("Activity"),disclosure:true,sortable:true})}_sortingChanged(){const e=this._dataGrid.sortColumnId();if(!e)return;let t;switch(e){case"startTime":t=n;break;case"self":t=i.bind(null,"selfTime");break;case"total":t=i.bind(null,"totalTime");break;case"activity":t=s;break;default:console.assert(false,"Unknown sort field: "+e);return}this._dataGrid.sortNodes(t,!this._dataGrid.isSortOrderAscending());function i(e,t,i){const n=t;const s=i;return n._profileNode[e]-s._profileNode[e]}function n(e,t){const i=e;const n=t;return i._profileNode.event.startTime-n._profileNode.event.startTime}function s(e,t){const i=e;const n=t;const s=Timeline.TimelineTreeView.eventNameForSorting(i._profileNode.event);const r=Timeline.TimelineTreeView.eventNameForSorting(n._profileNode.event);return s.localeCompare(r)}}_onShowModeChanged(){if(this._splitWidget.showMode()===UI.SplitWidget.ShowMode.OnlyMain)return;this._lastSelectedNode=undefined;this._updateDetailsForSelection()}_updateDetailsForSelection(){const e=this._dataGrid.selectedNode?this._dataGrid.selectedNode._profileNode:null;if(e===this._lastSelectedNode)return;this._lastSelectedNode=e;if(this._splitWidget.showMode()===UI.SplitWidget.ShowMode.OnlyMain)return;this._detailsView.detachChildWidgets();this._detailsView.element.removeChildren();if(e&&this._showDetailsForNode(e))return;const t=this._detailsView.element.createChild("div","full-widget-dimmed-banner");t.createTextChild(Common.UIString("Select item for details."))}_showDetailsForNode(e){return false}_onMouseMove(e){const t=e.target&&e.target instanceof Node?this._dataGrid.dataGridNodeFromNode(e.target):null;const i=t&&t._profileNode;if(i===this._lastHoveredProfileNode)return;this._lastHoveredProfileNode=i;this._onHover(i)}_onContextMenu(e,t){const i=t._profileNode;if(!i)return;this._appendContextMenuItems(e,i)}dataGridNodeForTreeNode(e){return e[Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol]||null}searchCanceled(){this._searchResults=[];this._currentResult=0}performSearch(e,t,i){this._searchResults=[];this._currentResult=0;if(!this._root)return;const n=e.toSearchRegex();this._searchResults=this._root.searchTree(e=>Timeline.TimelineUIUtils.testContentMatching(e,n));this._searchableView.updateSearchMatchesCount(this._searchResults.length)}jumpToNextSearchResult(){if(!this._searchResults.length)return;this.selectProfileNode(this._searchResults[this._currentResult],false);this._currentResult=mod(this._currentResult+1,this._searchResults.length)}jumpToPreviousSearchResult(){if(!this._searchResults.length)return;this.selectProfileNode(this._searchResults[this._currentResult],false);this._currentResult=mod(this._currentResult-1,this._searchResults.length)}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}};Timeline.TimelineTreeView.GridNode=class extends DataGrid.SortableDataGridNode{constructor(e,t,i,n,s){super(null,false);this._populated=false;this._profileNode=e;this._treeView=s;this._grandTotalTime=t;this._maxSelfTime=i;this._maxTotalTime=n}createCell(e){if(e==="activity")return this._createNameCell(e);return this._createValueCell(e)||super.createCell(e)}_createNameCell(e){const t=this.createTD(e);const i=t.createChild("div","name-container");const n=i.createChild("div","activity-icon-container");const s=n.createChild("div","activity-icon");const r=i.createChild("div","activity-name");const o=this._profileNode.event;if(this._profileNode.isGroupNode()){const e=this._treeView;const t=e._displayInfoForGroupNode(this._profileNode);r.textContent=t.name;s.style.backgroundColor=t.color;if(t.icon)n.insertBefore(t.icon,s)}else if(o){const e=o.args["data"];const t=e&&e["deoptReason"];if(t)i.createChild("div","activity-warning").title=Common.UIString("Not optimized: %s",t);r.textContent=Timeline.TimelineUIUtils.eventTitle(o);const n=this._treeView._linkifyLocation(o);if(n)i.createChild("div","activity-link").appendChild(n);s.style.backgroundColor=Timeline.TimelineUIUtils.eventColor(o)}return t}_createValueCell(e){if(e!=="self"&&e!=="total"&&e!=="startTime")return null;let t=false;let i;let n;switch(e){case"startTime":i=this._profileNode.event.startTime-this._treeView._model.timelineModel().minimumRecordTime();break;case"self":i=this._profileNode.selfTime;n=this._maxSelfTime;t=true;break;case"total":i=this._profileNode.totalTime;n=this._maxTotalTime;t=true;break;default:return null}const s=this.createTD(e);s.className="numeric-column";const r=s.createChild("div");r.createChild("span").textContent=Common.UIString("%.1f ms",i);if(t&&this._treeView._exposePercentages()){r.createChild("span","percent-column").textContent=Common.UIString("%.1f %%",i/this._grandTotalTime*100)}if(n){r.classList.add("background-percent-bar");s.createChild("div","background-bar-container").createChild("div","background-bar").style.width=(i*100/n).toFixed(1)+"%"}return s}};Timeline.TimelineTreeView.TreeGridNode=class extends Timeline.TimelineTreeView.GridNode{constructor(e,t,i,n,s){super(e,t,i,n,s);this.setHasChildren(this._profileNode.hasChildren());e[Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol]=this}populate(){if(this._populated)return;this._populated=true;if(!this._profileNode.children)return;for(const e of this._profileNode.children().values()){const t=new Timeline.TimelineTreeView.TreeGridNode(e,this._grandTotalTime,this._maxSelfTime,this._maxTotalTime,this._treeView);this.insertChildOrdered(t)}}};Timeline.TimelineTreeView.TreeGridNode._gridNodeSymbol=Symbol("treeGridNode");Timeline.AggregatedTimelineTreeView=class extends Timeline.TimelineTreeView{constructor(){super();this._groupBySetting=Common.settings.createSetting("timelineTreeGroupBy",Timeline.AggregatedTimelineTreeView.GroupBy.None);this._groupBySetting.addChangeListener(this.refreshTree.bind(this));this.init();this._stackView=new Timeline.TimelineStackView(this);this._stackView.addEventListener(Timeline.TimelineStackView.Events.SelectionChanged,this._onStackViewSelectionChanged,this);this._badgePool=new ProductRegistry.BadgePool(true);this._productByURLCache=new Map;this._colorByURLCache=new Map;ProductRegistry.instance().then(e=>{this._productRegistry=e;this.refreshTree()})}setModel(e,t){this._badgePool.reset();super.setModel(e,t)}updateContents(e){this._updateExtensionResolver();super.updateContents(e);const t=this._dataGrid.rootNode();if(t.children.length)t.children[0].revealAndSelect()}_updateExtensionResolver(){this._executionContextNamesByOrigin=new Map;for(const e of SDK.targetManager.models(SDK.RuntimeModel)){for(const t of e.executionContexts())this._executionContextNamesByOrigin.set(t.origin,t.name)}}_beautifyDomainName(e){if(Timeline.AggregatedTimelineTreeView._isExtensionInternalURL(e))e=Common.UIString("[Chrome extensions overhead]");else if(Timeline.AggregatedTimelineTreeView._isV8NativeURL(e))e=Common.UIString("[V8 Runtime]");else if(e.startsWith("chrome-extension"))e=this._executionContextNamesByOrigin.get(e)||e;return e}_displayInfoForGroupNode(e){const t=Timeline.TimelineUIUtils.categories();let i=e.id?Timeline.TimelineUIUtils.eventColor(e.event):t["other"].color;const n=Common.UIString("[unattributed]");switch(this._groupBySetting.get()){case Timeline.AggregatedTimelineTreeView.GroupBy.Category:{const i=t[e.id]||t["other"];return{name:i.title,color:i.color}}case Timeline.AggregatedTimelineTreeView.GroupBy.Domain:case Timeline.AggregatedTimelineTreeView.GroupBy.Subdomain:{let t=this._beautifyDomainName(e.id);if(t){const i=this._productByEvent(e.event);if(i)t+=" — "+i}return{name:t||n,color:i}}case Timeline.AggregatedTimelineTreeView.GroupBy.EventName:{const t=e.event.name===TimelineModel.TimelineModel.RecordType.JSFrame?Common.UIString("JavaScript"):Timeline.TimelineUIUtils.eventTitle(e.event);return{name:t,color:e.event.name===TimelineModel.TimelineModel.RecordType.JSFrame?Timeline.TimelineUIUtils.eventStyle(e.event).category.color:i}}case Timeline.AggregatedTimelineTreeView.GroupBy.Product:{const t=e.event;const s=this._productAndBadgeByEvent(t);const r=s&&s.name||n;i=Timeline.TimelineUIUtils.eventColorByProduct(this._productRegistry,this._model.timelineModel(),this._colorByURLCache,t);return{name:r,color:i,icon:s&&s.badge||undefined}}case Timeline.AggregatedTimelineTreeView.GroupBy.URL:break;case Timeline.AggregatedTimelineTreeView.GroupBy.Frame:{const t=this._model.timelineModel().pageFrameById(e.id);const n=t?Timeline.TimelineUIUtils.displayNameForFrame(t,80):Common.UIString("Page");return{name:n,color:i}}default:console.assert(false,"Unexpected grouping type")}return{name:e.id||n,color:i}}populateToolbar(e){super.populateToolbar(e);const t=Timeline.AggregatedTimelineTreeView.GroupBy;const i=[{label:Common.UIString("No Grouping"),value:t.None},{label:Common.UIString("Group by Activity"),value:t.EventName},{label:Common.UIString("Group by Category"),value:t.Category},{label:Common.UIString("Group by Domain"),value:t.Domain},{label:Common.UIString("Group by Frame"),value:t.Frame},{label:Common.UIString("Group by Product"),value:t.Product},{label:Common.UIString("Group by Subdomain"),value:t.Subdomain},{label:Common.UIString("Group by URL"),value:t.URL}];e.appendToolbarItem(new UI.ToolbarSettingComboBox(i,this._groupBySetting));e.appendSpacer();e.appendToolbarItem(this._splitWidget.createShowHideSidebarButton(Common.UIString("heaviest stack")))}_buildHeaviestStack(e){console.assert(!!e.parent,"Attempt to build stack for tree root");let t=[];for(let i=e;i&&i.parent;i=i.parent)t.push(i);t=t.reverse();for(let i=e;i&&i.children()&&i.children().size;){const e=Array.from(i.children().values());i=e.reduce((e,t)=>e.totalTime>t.totalTime?e:t);t.push(i)}return t}_exposePercentages(){return true}_onStackViewSelectionChanged(){const e=this._stackView.selectedTreeNode();if(e)this.selectProfileNode(e,true)}_showDetailsForNode(e){const t=this._buildHeaviestStack(e);this._stackView.setStack(t,e);this._stackView.show(this._detailsView.element);return true}_groupingFunction(e){const t=Timeline.AggregatedTimelineTreeView.GroupBy;switch(e){case t.None:return null;case t.EventName:return e=>Timeline.TimelineUIUtils.eventStyle(e).title;case t.Category:return e=>Timeline.TimelineUIUtils.eventStyle(e).category.name;case t.Subdomain:return this._domainByEvent.bind(this,false);case t.Domain:return this._domainByEvent.bind(this,true);case t.Product:return e=>this._productByEvent(e)||this._domainByEvent(true,e)||"";case t.URL:return e=>TimelineModel.TimelineProfileTree.eventURL(e)||"";case t.Frame:return e=>TimelineModel.TimelineData.forEvent(e).frameId;default:console.assert(false,`Unexpected aggregation setting: ${e}`);return null}}_domainByEvent(e,t){const i=TimelineModel.TimelineProfileTree.eventURL(t);if(!i)return"";if(Timeline.AggregatedTimelineTreeView._isExtensionInternalURL(i))return Timeline.AggregatedTimelineTreeView._extensionInternalPrefix;if(Timeline.AggregatedTimelineTreeView._isV8NativeURL(i))return Timeline.AggregatedTimelineTreeView._v8NativePrefix;const n=i.asParsedURL();if(!n)return"";if(n.scheme==="chrome-extension")return n.scheme+"://"+n.host;if(!e)return n.host;if(/^[.0-9]+$/.test(n.host))return n.host;const s=/([^.]*\.)?[^.]*$/.exec(n.host);return s&&s[0]||""}_productByEvent(e){const t=TimelineModel.TimelineProfileTree.eventURL(e);if(!t)return"";if(this._productByURLCache.has(t))return this._productByURLCache.get(t);if(!this._productRegistry)return"";const i=t.asParsedURL();const n=i&&this._productRegistry.nameForUrl(i)||"";this._productByURLCache.set(t,n);return n}_productAndBadgeByEvent(e){const t=TimelineModel.TimelineProfileTree.eventURL(e);if(!t||!this._productRegistry)return null;const i=t.asParsedURL();const n=i&&this._productRegistry.nameForUrl(i)||this._domainByEvent(true,e);if(!n)return null;const s=i&&this._badgePool.badgeForURL(i);return{name:this._beautifyDomainName(n),badge:s}}_appendContextMenuItems(e,t){if(this._groupBySetting.get()!==Timeline.AggregatedTimelineTreeView.GroupBy.Frame)return;if(!t.isGroupNode())return;const i=this._model.timelineModel().pageFrameById(t.id);if(!i||!i.ownerNode)return;e.appendApplicableItems(i.ownerNode)}static _isExtensionInternalURL(e){return e.startsWith(Timeline.AggregatedTimelineTreeView._extensionInternalPrefix)}static _isV8NativeURL(e){return e.startsWith(Timeline.AggregatedTimelineTreeView._v8NativePrefix)}};Timeline.AggregatedTimelineTreeView._extensionInternalPrefix="extensions::";Timeline.AggregatedTimelineTreeView._v8NativePrefix="native ";Timeline.AggregatedTimelineTreeView.GroupBy={None:"None",EventName:"EventName",Category:"Category",Domain:"Domain",Subdomain:"Subdomain",Product:"Product",URL:"URL",Frame:"Frame"};Timeline.CallTreeTimelineTreeView=class extends Timeline.AggregatedTimelineTreeView{constructor(){super();this._dataGrid.markColumnAsSortedBy("total",DataGrid.DataGrid.Order.Descending)}_buildTree(){const e=this._groupBySetting.get();return this.buildTopDownTree(false,this._groupingFunction(e))}};Timeline.BottomUpTimelineTreeView=class extends Timeline.AggregatedTimelineTreeView{constructor(){super();this._dataGrid.markColumnAsSortedBy("self",DataGrid.DataGrid.Order.Descending)}_buildTree(){return new TimelineModel.TimelineProfileTree.BottomUpRootNode(this._modelEvents(),this.filters(),this._startTime,this._endTime,this._groupingFunction(this._groupBySetting.get()))}};Timeline.TimelineStackView=class extends UI.VBox{constructor(e){super();const t=this.element.createChild("div","timeline-stack-view-header");t.textContent=Common.UIString("Heaviest stack");this._treeView=e;const i=[{id:"total",title:Common.UIString("Total Time"),fixedWidth:true,width:"110px"},{id:"activity",title:Common.UIString("Activity")}];this._dataGrid=new DataGrid.ViewportDataGrid(i);this._dataGrid.setResizeMethod(DataGrid.DataGrid.ResizeMethod.Last);this._dataGrid.addEventListener(DataGrid.DataGrid.Events.SelectedNode,this._onSelectionChanged,this);this._dataGrid.asWidget().show(this.element)}setStack(e,t){const i=this._dataGrid.rootNode();i.removeChildren();let n=null;const s=Math.max.apply(Math,e.map(e=>e.totalTime));for(const r of e){const e=new Timeline.TimelineTreeView.GridNode(r,s,s,s,this._treeView);i.appendChild(e);if(r===t)n=e}n.revealAndSelect()}selectedTreeNode(){const e=this._dataGrid.selectedNode;return e&&e._profileNode}_onSelectionChanged(){this.dispatchEventToListeners(Timeline.TimelineStackView.Events.SelectionChanged)}};Timeline.TimelineStackView.Events={SelectionChanged:Symbol("SelectionChanged")};Timeline.EventsTimelineTreeView=class extends Timeline.TimelineTreeView{constructor(e){super();this._filtersControl=new Timeline.EventsTimelineTreeView.Filters;this._filtersControl.addEventListener(Timeline.EventsTimelineTreeView.Filters.Events.FilterChanged,this._onFilterChanged,this);this.init();this._delegate=e;this._badgePool=new ProductRegistry.BadgePool(true);this._dataGrid.markColumnAsSortedBy("startTime",DataGrid.DataGrid.Order.Ascending);this._splitWidget.showBoth()}filters(){return[...super.filters(),...this._filtersControl.filters()]}updateContents(e){this._badgePool.reset();super.updateContents(e);if(e.type()===Timeline.TimelineSelection.Type.TraceEvent){const t=e.object();this._selectEvent(t,true)}}_buildTree(){this._currentTree=this.buildTopDownTree(true,null);return this._currentTree}_onFilterChanged(){const e=this.lastSelectedNode()&&this.lastSelectedNode().event;this.refreshTree();if(e)this._selectEvent(e,false)}_findNodeWithEvent(e){const t=[this._currentTree.children().values()];while(t.length){const i=t.peekLast().next();if(i.done){t.pop();continue}const n=i.value;if(n.event===e)return n;t.push(n.children().values())}return null}_selectEvent(e,t){const i=this._findNodeWithEvent(e);if(!i)return;this.selectProfileNode(i,false);if(t)this.dataGridNodeForTreeNode(i).expand()}populateColumns(e){e.push({id:"startTime",title:Common.UIString("Start Time"),width:"80px",fixedWidth:true,sortable:true});super.populateColumns(e);e.filter(e=>e.fixedWidth).forEach(e=>e.width="80px")}populateToolbar(e){super.populateToolbar(e);this._filtersControl.populateToolbar(e)}_showDetailsForNode(e){const t=e.event;if(!t)return false;Timeline.TimelineUIUtils.buildTraceEventDetails(t,this.model().timelineModel(),this._linkifier,this._badgePool,false).then(e=>this._detailsView.element.appendChild(e));return true}_onHover(e){this._delegate.highlightEvent(e&&e.event)}};Timeline.EventsTimelineTreeView.Filters=class extends Common.Object{constructor(){super();this._categoryFilter=new Timeline.TimelineFilters.Category;this._durationFilter=new Timeline.TimelineFilters.IsLong;this._filters=[this._categoryFilter,this._durationFilter]}filters(){return this._filters}populateToolbar(e){const t=new UI.ToolbarComboBox(s.bind(this));for(const e of Timeline.EventsTimelineTreeView.Filters._durationFilterPresetsMs){t.addOption(t.createOption(e?Common.UIString("≥ %d ms",e):Common.UIString("All"),e?Common.UIString("Hide records shorter than %d ms",e):Common.UIString("Show all records"),String(e)))}e.appendToolbarItem(t);const i={};const n=Timeline.TimelineUIUtils.categories();for(const t in n){const s=n[t];if(!s.visible)continue;const o=new UI.ToolbarCheckbox(s.title,undefined,r.bind(this,t));o.setChecked(true);o.inputElement.style.backgroundColor=s.color;i[s.name]=o;e.appendToolbarItem(o)}function s(){const e=t.selectedOption().value;const i=parseInt(e,10);this._durationFilter.setMinimumRecordDuration(i);this._notifyFiltersChanged()}function r(e){const t=Timeline.TimelineUIUtils.categories();t[e].hidden=!i[e].checked();this._notifyFiltersChanged()}}_notifyFiltersChanged(){this.dispatchEventToListeners(Timeline.EventsTimelineTreeView.Filters.Events.FilterChanged)}};Timeline.EventsTimelineTreeView.Filters._durationFilterPresetsMs=[0,1,15];Timeline.EventsTimelineTreeView.Filters.Events={FilterChanged:Symbol("FilterChanged")};Timeline.TimelineUIUtils=class{static _initEventStyles(){if(Timeline.TimelineUIUtils._eventStylesMap)return Timeline.TimelineUIUtils._eventStylesMap;const e=TimelineModel.TimelineModel.RecordType;const t=Timeline.TimelineUIUtils.categories();const i=t["rendering"];const n=t["scripting"];const s=t["loading"];const r=t["painting"];const o=t["other"];const l={};l[e.Task]=new Timeline.TimelineRecordStyle(ls`Task`,o);l[e.Program]=new Timeline.TimelineRecordStyle(ls`Other`,o);l[e.Animation]=new Timeline.TimelineRecordStyle(ls`Animation`,i);l[e.EventDispatch]=new Timeline.TimelineRecordStyle(ls`Event`,n);l[e.RequestMainThreadFrame]=new Timeline.TimelineRecordStyle(ls`Request Main Thread Frame`,i,true);l[e.BeginFrame]=new Timeline.TimelineRecordStyle(ls`Frame Start`,i,true);l[e.BeginMainThreadFrame]=new Timeline.TimelineRecordStyle(ls`Frame Start (main thread)`,i,true);l[e.DrawFrame]=new Timeline.TimelineRecordStyle(ls`Draw Frame`,i,true);l[e.HitTest]=new Timeline.TimelineRecordStyle(ls`Hit Test`,i);l[e.ScheduleStyleRecalculation]=new Timeline.TimelineRecordStyle(ls`Schedule Style Recalculation`,i);l[e.RecalculateStyles]=new Timeline.TimelineRecordStyle(ls`Recalculate Style`,i);l[e.UpdateLayoutTree]=new Timeline.TimelineRecordStyle(ls`Recalculate Style`,i);l[e.InvalidateLayout]=new Timeline.TimelineRecordStyle(ls`Invalidate Layout`,i,true);l[e.Layout]=new Timeline.TimelineRecordStyle(ls`Layout`,i);l[e.PaintSetup]=new Timeline.TimelineRecordStyle(ls`Paint Setup`,r);l[e.PaintImage]=new Timeline.TimelineRecordStyle(ls`Paint Image`,r,true);l[e.UpdateLayer]=new Timeline.TimelineRecordStyle(ls`Update Layer`,r,true);l[e.UpdateLayerTree]=new Timeline.TimelineRecordStyle(ls`Update Layer Tree`,i);l[e.Paint]=new Timeline.TimelineRecordStyle(ls`Paint`,r);l[e.RasterTask]=new Timeline.TimelineRecordStyle(ls`Rasterize Paint`,r);l[e.ScrollLayer]=new Timeline.TimelineRecordStyle(ls`Scroll`,i);l[e.CompositeLayers]=new Timeline.TimelineRecordStyle(ls`Composite Layers`,r);l[e.ParseHTML]=new Timeline.TimelineRecordStyle(ls`Parse HTML`,s);l[e.ParseAuthorStyleSheet]=new Timeline.TimelineRecordStyle(ls`Parse Stylesheet`,s);l[e.TimerInstall]=new Timeline.TimelineRecordStyle(ls`Install Timer`,n);l[e.TimerRemove]=new Timeline.TimelineRecordStyle(ls`Remove Timer`,n);l[e.TimerFire]=new Timeline.TimelineRecordStyle(ls`Timer Fired`,n);l[e.XHRReadyStateChange]=new Timeline.TimelineRecordStyle(ls`XHR Ready State Change`,n);l[e.XHRLoad]=new Timeline.TimelineRecordStyle(ls`XHR Load`,n);l[e.CompileScript]=new Timeline.TimelineRecordStyle(ls`Compile Script`,n);l[e.EvaluateScript]=new Timeline.TimelineRecordStyle(ls`Evaluate Script`,n);l[e.CompileModule]=new Timeline.TimelineRecordStyle(ls`Compile Module`,n);l[e.EvaluateModule]=new Timeline.TimelineRecordStyle(ls`Evaluate Module`,n);l[e.ParseScriptOnBackground]=new Timeline.TimelineRecordStyle(ls`Parse Script`,n);l[e.WasmStreamFromResponseCallback]=new Timeline.TimelineRecordStyle(ls`Streaming Wasm Response`,n);l[e.WasmCompiledModule]=new Timeline.TimelineRecordStyle(ls`Compiled Wasm Module`,n);l[e.WasmCachedModule]=new Timeline.TimelineRecordStyle(ls`Cached Wasm Module`,n);l[e.WasmModuleCacheHit]=new Timeline.TimelineRecordStyle(ls`Wasm Module Cache Hit`,n);l[e.WasmModuleCacheInvalid]=new Timeline.TimelineRecordStyle(ls`Wasm Module Cache Invalid`,n);l[e.FrameStartedLoading]=new Timeline.TimelineRecordStyle(ls`Frame Started Loading`,s,true);l[e.MarkLoad]=new Timeline.TimelineRecordStyle(ls`Onload Event`,n,true);l[e.MarkDOMContent]=new Timeline.TimelineRecordStyle(ls`DOMContentLoaded Event`,n,true);l[e.MarkFirstPaint]=new Timeline.TimelineRecordStyle(ls`First Paint`,r,true);l[e.MarkFCP]=new Timeline.TimelineRecordStyle(ls`First Contentful Paint`,i,true);l[e.MarkFMP]=new Timeline.TimelineRecordStyle(ls`First Meaningful Paint`,i,true);l[e.TimeStamp]=new Timeline.TimelineRecordStyle(ls`Timestamp`,n);l[e.ConsoleTime]=new Timeline.TimelineRecordStyle(ls`Console Time`,n);l[e.UserTiming]=new Timeline.TimelineRecordStyle(ls`User Timing`,n);l[e.ResourceSendRequest]=new Timeline.TimelineRecordStyle(ls`Send Request`,s);l[e.ResourceReceiveResponse]=new Timeline.TimelineRecordStyle(ls`Receive Response`,s);l[e.ResourceFinish]=new Timeline.TimelineRecordStyle(ls`Finish Loading`,s);l[e.ResourceReceivedData]=new Timeline.TimelineRecordStyle(ls`Receive Data`,s);l[e.RunMicrotasks]=new Timeline.TimelineRecordStyle(ls`Run Microtasks`,n);l[e.FunctionCall]=new Timeline.TimelineRecordStyle(ls`Function Call`,n);l[e.GCEvent]=new Timeline.TimelineRecordStyle(ls`GC Event`,n);l[e.MajorGC]=new Timeline.TimelineRecordStyle(ls`Major GC`,n);l[e.MinorGC]=new Timeline.TimelineRecordStyle(ls`Minor GC`,n);l[e.JSFrame]=new Timeline.TimelineRecordStyle(ls`JS Frame`,n);l[e.RequestAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Request Animation Frame`,n);l[e.CancelAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Cancel Animation Frame`,n);l[e.FireAnimationFrame]=new Timeline.TimelineRecordStyle(ls`Animation Frame Fired`,n);l[e.RequestIdleCallback]=new Timeline.TimelineRecordStyle(ls`Request Idle Callback`,n);l[e.CancelIdleCallback]=new Timeline.TimelineRecordStyle(ls`Cancel Idle Callback`,n);l[e.FireIdleCallback]=new Timeline.TimelineRecordStyle(ls`Fire Idle Callback`,n);l[e.WebSocketCreate]=new Timeline.TimelineRecordStyle(ls`Create WebSocket`,n);l[e.WebSocketSendHandshakeRequest]=new Timeline.TimelineRecordStyle(ls`Send WebSocket Handshake`,n);l[e.WebSocketReceiveHandshakeResponse]=new Timeline.TimelineRecordStyle(ls`Receive WebSocket Handshake`,n);l[e.WebSocketDestroy]=new Timeline.TimelineRecordStyle(ls`Destroy WebSocket`,n);l[e.EmbedderCallback]=new Timeline.TimelineRecordStyle(ls`Embedder Callback`,n);l[e.DecodeImage]=new Timeline.TimelineRecordStyle(ls`Image Decode`,r);l[e.ResizeImage]=new Timeline.TimelineRecordStyle(ls`Image Resize`,r);l[e.GPUTask]=new Timeline.TimelineRecordStyle(ls`GPU`,t["gpu"]);l[e.LatencyInfo]=new Timeline.TimelineRecordStyle(ls`Input Latency`,n);l[e.GCCollectGarbage]=new Timeline.TimelineRecordStyle(ls`DOM GC`,n);l[e.CryptoDoEncrypt]=new Timeline.TimelineRecordStyle(ls`Encrypt`,n);l[e.CryptoDoEncryptReply]=new Timeline.TimelineRecordStyle(ls`Encrypt Reply`,n);l[e.CryptoDoDecrypt]=new Timeline.TimelineRecordStyle(ls`Decrypt`,n);l[e.CryptoDoDecryptReply]=new Timeline.TimelineRecordStyle(ls`Decrypt Reply`,n);l[e.CryptoDoDigest]=new Timeline.TimelineRecordStyle(ls`Digest`,n);l[e.CryptoDoDigestReply]=new Timeline.TimelineRecordStyle(ls`Digest Reply`,n);l[e.CryptoDoSign]=new Timeline.TimelineRecordStyle(ls`Sign`,n);l[e.CryptoDoSignReply]=new Timeline.TimelineRecordStyle(ls`Sign Reply`,n);l[e.CryptoDoVerify]=new Timeline.TimelineRecordStyle(ls`Verify`,n);l[e.CryptoDoVerifyReply]=new Timeline.TimelineRecordStyle(ls`Verify Reply`,n);l[e.AsyncTask]=new Timeline.TimelineRecordStyle(ls`Async Task`,t["async"]);Timeline.TimelineUIUtils._eventStylesMap=l;return l}static inputEventDisplayName(e){if(!Timeline.TimelineUIUtils._inputEventToDisplayName){const e=TimelineModel.TimelineIRModel.InputEvents;Timeline.TimelineUIUtils._inputEventToDisplayName=new Map([[e.Char,ls`Key Character`],[e.KeyDown,ls`Key Down`],[e.KeyDownRaw,ls`Key Down`],[e.KeyUp,ls`Key Up`],[e.Click,ls`Click`],[e.ContextMenu,ls`Context Menu`],[e.MouseDown,ls`Mouse Down`],[e.MouseMove,ls`Mouse Move`],[e.MouseUp,ls`Mouse Up`],[e.MouseWheel,ls`Mouse Wheel`],[e.ScrollBegin,ls`Scroll Begin`],[e.ScrollEnd,ls`Scroll End`],[e.ScrollUpdate,ls`Scroll Update`],[e.FlingStart,ls`Fling Start`],[e.FlingCancel,ls`Fling Halt`],[e.Tap,ls`Tap`],[e.TapCancel,ls`Tap Halt`],[e.ShowPress,ls`Tap Begin`],[e.TapDown,ls`Tap Down`],[e.TouchCancel,ls`Touch Cancel`],[e.TouchEnd,ls`Touch End`],[e.TouchMove,ls`Touch Move`],[e.TouchStart,ls`Touch Start`],[e.PinchBegin,ls`Pinch Begin`],[e.PinchEnd,ls`Pinch End`],[e.PinchUpdate,ls`Pinch Update`]])}return Timeline.TimelineUIUtils._inputEventToDisplayName.get(e)||null}static frameDisplayName(e){if(!TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(e))return UI.beautifyFunctionName(e.functionName);const t=TimelineModel.TimelineJSProfileProcessor.nativeGroup(e.functionName);const i=TimelineModel.TimelineJSProfileProcessor.NativeGroups;switch(t){case i.Compile:return ls`Compile`;case i.Parse:return ls`Parse`}return e.functionName}static testContentMatching(e,t){const i=Timeline.TimelineUIUtils.eventStyle(e).title;const n=[i];const s=TimelineModel.TimelineData.forEvent(e).url;if(s)n.push(s);r(e.args,2);return t.test(n.join("|"));function r(e,t){if(!t)return;for(const i in e){const s=e[i];const o=typeof s;if(o==="string")n.push(s);else if(o==="number")n.push(String(s));else if(o==="object")r(s,t-1)}}}static eventURL(e){const t=e.args["data"]||e.args["beginData"];const i=t&&t.url;if(i)return i;const n=t&&t["stackTrace"];const s=n&&n.length&&n[0]||TimelineModel.TimelineData.forEvent(e).topFrame();return s&&s.url||null}static eventStyle(e){const t=Timeline.TimelineUIUtils._initEventStyles();if(e.hasCategory(TimelineModel.TimelineModel.Category.Console)||e.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))return{title:e.name,category:Timeline.TimelineUIUtils.categories()["scripting"]};if(e.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){const t="InputLatency::";const i=e.name.startsWith(t)?e.name.substr(t.length):e.name;const n=Timeline.TimelineUIUtils.inputEventDisplayName(i);return{title:n||i,category:Timeline.TimelineUIUtils.categories()["scripting"]}}let i=t[e.name];if(!i){i=new Timeline.TimelineRecordStyle(e.name,Timeline.TimelineUIUtils.categories()["other"],true);t[e.name]=i}return i}static eventColor(e){if(e.name===TimelineModel.TimelineModel.RecordType.JSFrame){const t=e.args["data"];if(Timeline.TimelineUIUtils.isUserFrame(t))return Timeline.TimelineUIUtils.colorForId(t.url)}return Timeline.TimelineUIUtils.eventStyle(e).category.color}static eventColorByProduct(e,t,i,n){const s=Timeline.TimelineUIUtils.eventURL(n)||"";let r=i.get(s);if(r)return r;const o="#f2ecdc";const l=s.asParsedURL();if(!l)return o;let a=e&&e.nameForUrl(l);if(!a){a=l.host;const e=t.rootFrames();if(e.some(e=>new Common.ParsedURL(e.url).host===a))r=o}if(!r)r=a?ProductRegistry.BadgePool.colorForEntryName(a):o;i.set(s,r);return r}static eventTitle(e){const t=TimelineModel.TimelineModel.RecordType;const i=e.args["data"];if(e.name===t.JSFrame)return Timeline.TimelineUIUtils.frameDisplayName(i);const n=Timeline.TimelineUIUtils.eventStyle(e).title;if(e.hasCategory(TimelineModel.TimelineModel.Category.Console))return n;if(e.name===t.TimeStamp)return ls`${n}: ${i["message"]}`;if(e.name===t.Animation&&i&&i["name"])return ls`${n}: ${i["name"]}`;if(e.name===t.EventDispatch&&i&&i["type"])return ls`${n}: ${i["type"]}`;return n}static _interactionPhaseStyles(){let e=Timeline.TimelineUIUtils._interactionPhaseStylesMap;if(!e){e=new Map([[TimelineModel.TimelineIRModel.Phases.Idle,{color:"white",label:"Idle"}],[TimelineModel.TimelineIRModel.Phases.Response,{color:"hsl(43, 83%, 64%)",label:ls`Response`}],[TimelineModel.TimelineIRModel.Phases.Scroll,{color:"hsl(256, 67%, 70%)",label:ls`Scroll`}],[TimelineModel.TimelineIRModel.Phases.Fling,{color:"hsl(256, 67%, 70%)",label:ls`Fling`}],[TimelineModel.TimelineIRModel.Phases.Drag,{color:"hsl(256, 67%, 70%)",label:ls`Drag`}],[TimelineModel.TimelineIRModel.Phases.Animation,{color:"hsl(256, 67%, 70%)",label:ls`Animation`}],[TimelineModel.TimelineIRModel.Phases.Uncategorized,{color:"hsl(0, 0%, 87%)",label:ls`Uncategorized`}]]);Timeline.TimelineUIUtils._interactionPhaseStylesMap=e}return e}static interactionPhaseColor(e){return Timeline.TimelineUIUtils._interactionPhaseStyles().get(e).color}static interactionPhaseLabel(e){return Timeline.TimelineUIUtils._interactionPhaseStyles().get(e).label}static isUserFrame(e){return e.scriptId!=="0"&&!(e.url&&e.url.startsWith("native "))}static networkRequestCategory(e){const t=Timeline.TimelineUIUtils.NetworkCategory;switch(e.mimeType){case"text/html":return t.HTML;case"application/javascript":case"application/x-javascript":case"text/javascript":return t.Script;case"text/css":return t.Style;case"audio/ogg":case"image/gif":case"image/jpeg":case"image/png":case"image/svg+xml":case"image/webp":case"image/x-icon":case"font/opentype":case"font/woff2":case"application/font-woff":return t.Media;default:return t.Other}}static networkCategoryColor(e){const t=Timeline.TimelineUIUtils.NetworkCategory;switch(e){case t.HTML:return"hsl(214, 67%, 66%)";case t.Script:return"hsl(43, 83%, 64%)";case t.Style:return"hsl(256, 67%, 70%)";case t.Media:return"hsl(109, 33%, 55%)";default:return"hsl(0, 0%, 70%)"}}static buildDetailsTextForTraceEvent(e,t){const i=TimelineModel.TimelineModel.RecordType;let n;const s=e.args["data"];switch(e.name){case i.GCEvent:case i.MajorGC:case i.MinorGC:{const t=e.args["usedHeapSizeBefore"]-e.args["usedHeapSizeAfter"];n=Common.UIString("%s collected",Number.bytesToString(t));break}case i.FunctionCall:if(s){n=r(s["scriptId"],s["lineNumber"],s["columnNumber"])}break;case i.JSFrame:n=Timeline.TimelineUIUtils.frameDisplayName(s);break;case i.EventDispatch:n=s?s["type"]:null;break;case i.Paint:{const e=Timeline.TimelineUIUtils.quadWidth(s.clip);const t=Timeline.TimelineUIUtils.quadHeight(s.clip);if(e&&t)n=Common.UIString("%d × %d",e,t);break}case i.ParseHTML:{const t=e.args["beginData"]["startLine"];const i=e.args["endData"]&&e.args["endData"]["endLine"];const s=Bindings.displayNameForURL(e.args["beginData"]["url"]);if(i>=0)n=Common.UIString("%s [%s…%s]",s,t+1,i+1);else n=Common.UIString("%s [%s…]",s,t+1);break}case i.CompileModule:n=Bindings.displayNameForURL(e.args["fileName"]);break;case i.CompileScript:case i.EvaluateScript:{const e=s&&s["url"];if(e)n=Bindings.displayNameForURL(e)+":"+(s["lineNumber"]+1);break}case i.WasmCompiledModule:case i.WasmModuleCacheHit:{const t=e.args["url"];if(t)n=Bindings.displayNameForURL(t);break}case i.ParseScriptOnBackground:case i.XHRReadyStateChange:case i.XHRLoad:{const e=s["url"];if(e)n=Bindings.displayNameForURL(e);break}case i.TimeStamp:n=s["message"];break;case i.WebSocketCreate:case i.WebSocketSendHandshakeRequest:case i.WebSocketReceiveHandshakeResponse:case i.WebSocketDestroy:case i.ResourceSendRequest:case i.ResourceReceivedData:case i.ResourceReceiveResponse:case i.ResourceFinish:case i.PaintImage:case i.DecodeImage:case i.ResizeImage:case i.DecodeLazyPixelRef:{const t=TimelineModel.TimelineData.forEvent(e).url;if(t)n=Bindings.displayNameForURL(t);break}case i.EmbedderCallback:n=s["callbackName"];break;case i.Animation:n=s&&s["name"];break;case i.AsyncTask:n=s?s["name"]:null;break;default:if(e.hasCategory(TimelineModel.TimelineModel.Category.Console))n=null;else n=o();break}return n;function r(e,i,n){const s=t?t.model(SDK.DebuggerModel):null;if(!t||t.isDisposed()||!e||!s)return null;const r=s.createRawLocationByScriptId(e,i,n);if(!r)return null;const o=Bindings.debuggerWorkspaceBinding.rawLocationToUILocation(r);return o?o.linkText():null}function o(){const t=TimelineModel.TimelineData.forEvent(e).topFrame();if(!t)return null;let i=r(t.scriptId,t.lineNumber,t.columnNumber);if(!i){i=t.url;if(typeof t.lineNumber==="number")i+=":"+(t.lineNumber+1)}return i}}static buildDetailsNodeForTraceEvent(e,t,i){const n=TimelineModel.TimelineModel.RecordType;let s=null;let r;const o=e.args["data"];switch(e.name){case n.GCEvent:case n.MajorGC:case n.MinorGC:case n.EventDispatch:case n.Paint:case n.Animation:case n.EmbedderCallback:case n.ParseHTML:case n.WasmStreamFromResponseCallback:case n.WasmCompiledModule:case n.WasmModuleCacheHit:case n.WasmCachedModule:case n.WasmModuleCacheInvalid:case n.WebSocketCreate:case n.WebSocketSendHandshakeRequest:case n.WebSocketReceiveHandshakeResponse:case n.WebSocketDestroy:r=Timeline.TimelineUIUtils.buildDetailsTextForTraceEvent(e,t);break;case n.PaintImage:case n.DecodeImage:case n.ResizeImage:case n.DecodeLazyPixelRef:case n.XHRReadyStateChange:case n.XHRLoad:case n.ResourceSendRequest:case n.ResourceReceivedData:case n.ResourceReceiveResponse:case n.ResourceFinish:{const t=TimelineModel.TimelineData.forEvent(e).url;if(t)s=Components.Linkifier.linkifyURL(t);break}case n.FunctionCall:case n.JSFrame:s=createElement("span");s.createTextChild(Timeline.TimelineUIUtils.frameDisplayName(o));const i=l(o["scriptId"],o["url"],o["lineNumber"],o["columnNumber"]);if(i){s.createTextChild(" @ ");s.appendChild(i)}break;case n.CompileModule:s=l("",e.args["fileName"],0,0);break;case n.CompileScript:case n.EvaluateScript:{const e=o["url"];if(e)s=l("",e,o["lineNumber"],0);break}case n.ParseScriptOnBackground:{const e=o["url"];if(e)s=l("",e,0,0);break}default:if(e.hasCategory(TimelineModel.TimelineModel.Category.Console))r=null;else s=a();break}if(!s&&r)s=createTextNode(r);return s;function l(e,n,s,r){return i.linkifyScriptLocation(t,e,n,s,r,"timeline-details")}function a(){const n=TimelineModel.TimelineData.forEvent(e).topFrame();return n?i.maybeLinkifyConsoleCallFrame(t,n,"timeline-details"):null}}static async buildTraceEventDetails(e,t,i,n,s){const r=t.targetByEvent(e);let o=null;if(r){const t=r;if(typeof e[Timeline.TimelineUIUtils._previewElementSymbol]==="undefined"){let i=null;const n=TimelineModel.TimelineData.forEvent(e).url;if(n)i=await Components.ImagePreview.build(t,n,false);else if(TimelineModel.TimelineData.forEvent(e).picture)i=await Timeline.TimelineUIUtils.buildPicturePreviewContent(e,t);e[Timeline.TimelineUIUtils._previewElementSymbol]=i}const i=new Set;const n=TimelineModel.TimelineData.forEvent(e);if(n.backendNodeId)i.add(n.backendNodeId);const s=TimelineModel.InvalidationTracker.invalidationEventsFor(e);if(s)Timeline.TimelineUIUtils._collectInvalidationNodeIds(i,s);if(i.size){const e=t.model(SDK.DOMModel);if(e)o=await e.pushNodesByBackendIdsToFrontend(i)}}const l=TimelineModel.TimelineModel.RecordType;let a;const d=new Timeline.TimelineDetailsContentHelper(t.targetByEvent(e),i);const m=t.isMarkerEvent(e)?Timeline.TimelineUIUtils.markerStyleForEvent(e).color:Timeline.TimelineUIUtils.eventStyle(e).category.color;d.addSection(Timeline.TimelineUIUtils.eventTitle(e),m);const c=e.args["data"];const h=TimelineModel.TimelineData.forEvent(e);const u=h.initiator();let T=null;if(h.warning)d.appendWarningRow(e);if(e.name===l.JSFrame&&c["deoptReason"])d.appendWarningRow(e,TimelineModel.TimelineModel.WarningType.V8Deopt);if(s&&!Number.isNaN(e.duration+0)){d.appendTextRow(ls`Total Time`,Number.millisToString(e.duration,true));d.appendTextRow(ls`Self Time`,Number.millisToString(e.selfTime,true))}if(t.isGenericTrace()){for(const t in e.args){try{d.appendTextRow(t,JSON.stringify(e.args[t]))}catch(i){d.appendTextRow(t,`<${typeof e.args[t]}>`)}}return d.fragment}switch(e.name){case l.GCEvent:case l.MajorGC:case l.MinorGC:const n=e.args["usedHeapSizeBefore"]-e.args["usedHeapSizeAfter"];d.appendTextRow(ls`Collected`,Number.bytesToString(n));break;case l.JSFrame:case l.FunctionCall:const s=Timeline.TimelineUIUtils.buildDetailsNodeForTraceEvent(e,t.targetByEvent(e),i);if(s)d.appendElementRow(ls`Function`,s);break;case l.TimerFire:case l.TimerInstall:case l.TimerRemove:d.appendTextRow(ls`Timer ID`,c["timerId"]);if(e.name===l.TimerInstall){d.appendTextRow(ls`Timeout`,Number.millisToString(c["timeout"]));d.appendTextRow(ls`Repeats`,!c["singleShot"])}break;case l.FireAnimationFrame:d.appendTextRow(ls`Callback ID`,c["id"]);break;case l.ResourceSendRequest:case l.ResourceReceiveResponse:case l.ResourceReceivedData:case l.ResourceFinish:T=h.url;if(T)d.appendElementRow(ls`Resource`,Components.Linkifier.linkifyURL(T));if(c["requestMethod"])d.appendTextRow(ls`Request Method`,c["requestMethod"]);if(typeof c["statusCode"]==="number")d.appendTextRow(ls`Status Code`,c["statusCode"]);if(c["mimeType"])d.appendTextRow(ls`MIME Type`,c["mimeType"]);if("priority"in c){const e=PerfUI.uiLabelForNetworkPriority(c["priority"]);d.appendTextRow(ls`Priority`,e)}if(c["encodedDataLength"])d.appendTextRow(ls`Encoded Data`,ls`${c["encodedDataLength"]} Bytes`);if(c["decodedBodyLength"])d.appendTextRow(ls`Decoded Body`,ls`${c["decodedBodyLength"]} Bytes`);break;case l.CompileModule:d.appendLocationRow(ls`Module`,e.args["fileName"],0);break;case l.CompileScript:T=c&&c["url"];if(T)d.appendLocationRow(ls`Script`,T,c["lineNumber"],c["columnNumber"]);d.appendTextRow(ls`Streamed`,c["streamed"]);const r=c&&c["producedCacheSize"];if(r)d.appendTextRow(ls`Produced Cache Size`,r);const o=c&&c["cacheConsumeOptions"];if(o){d.appendTextRow(ls`Cache Consume Options`,o);d.appendTextRow(ls`Consumed Cache Size`,c["consumedCacheSize"]);d.appendTextRow(ls`Cache Rejected`,c["cacheRejected"])}break;case l.EvaluateScript:T=c&&c["url"];if(T)d.appendLocationRow(ls`Script`,T,c["lineNumber"],c["columnNumber"]);break;case l.WasmStreamFromResponseCallback:case l.WasmCompiledModule:case l.WasmCachedModule:case l.WasmModuleCacheHit:case l.WasmModuleCacheInvalid:if(c){T=e.args["url"];if(T)d.appendTextRow(ls`Url`,T);const t=e.args["producedCachedSize"];if(t)d.appendTextRow(ls`Produced Cache Size`,t);const i=e.args["consumedCachedSize"];if(i)d.appendTextRow(ls`Consumed Cache Size`,i)}break;case l.Paint:const m=c["clip"];d.appendTextRow(ls`Location`,ls`(${m[0]}, ${m[1]})`);const p=Timeline.TimelineUIUtils.quadWidth(m);const g=Timeline.TimelineUIUtils.quadHeight(m);d.appendTextRow(ls`Dimensions`,ls`${p} × ${g}`);case l.PaintSetup:case l.Rasterize:case l.ScrollLayer:a=ls`Layer Root`;break;case l.PaintImage:case l.DecodeLazyPixelRef:case l.DecodeImage:case l.ResizeImage:case l.DrawLazyPixelRef:a=ls`Owner Element`;T=h.url;if(T)d.appendElementRow(ls`Image URL`,Components.Linkifier.linkifyURL(T));break;case l.ParseAuthorStyleSheet:T=c["styleSheetUrl"];if(T)d.appendElementRow(ls`Stylesheet URL`,Components.Linkifier.linkifyURL(T));break;case l.UpdateLayoutTree:case l.RecalculateStyles:d.appendTextRow(ls`Elements Affected`,e.args["elementCount"]);break;case l.Layout:const _=e.args["beginData"];d.appendTextRow(ls`Nodes That Need Layout`,ls`${_["dirtyObjects"]} of ${_["totalObjects"]}`);a=ls`Layout root`;break;case l.ConsoleTime:d.appendTextRow(ls`Message`,e.name);break;case l.WebSocketCreate:case l.WebSocketSendHandshakeRequest:case l.WebSocketReceiveHandshakeResponse:case l.WebSocketDestroy:const f=u?u.args["data"]:c;if(typeof f["webSocketURL"]!=="undefined")d.appendTextRow(ls`URL`,f["webSocketURL"]);if(typeof f["webSocketProtocol"]!=="undefined")d.appendTextRow(ls`WebSocket Protocol`,f["webSocketProtocol"]);if(typeof c["message"]!=="undefined")d.appendTextRow(ls`Message`,c["message"]);break;case l.EmbedderCallback:d.appendTextRow(ls`Callback Function`,c["callbackName"]);break;case l.Animation:if(e.phase===SDK.TracingModel.Phase.NestableAsyncInstant)d.appendTextRow(ls`State`,c["state"]);break;case l.ParseHTML:{const t=e.args["beginData"];const i=t["startLine"]-1;const n=e.args["endData"]?e.args["endData"]["endLine"]-1:undefined;T=t["url"];if(T)d.appendLocationRange(ls`Range`,T,i,n);break}case l.FireIdleCallback:d.appendTextRow(ls`Allotted Time`,Number.millisToString(c["allottedMilliseconds"]));d.appendTextRow(ls`Invoked by Timeout`,c["timedOut"]);case l.RequestIdleCallback:case l.CancelIdleCallback:d.appendTextRow(ls`Callback ID`,c["id"]);break;case l.EventDispatch:d.appendTextRow(ls`Type`,c["type"]);break;case l.MarkFirstPaint:case l.MarkFCP:case l.MarkFMP:case l.MarkLoad:case l.MarkDOMContent:d.appendTextRow(ls`Timestamp`,Number.preciseMillisToString(e.startTime-t.minimumRecordTime(),1));const v=UI.XLink.create("https://developers.google.com/web/fundamentals/performance/user-centric-performance-metrics#user-centric_performance_metrics",ls`Learn more`);const w=UI.html`<div>${v} about page performance metrics.</div>`;d.appendElementRow(ls`Details`,w);break;default:{const n=Timeline.TimelineUIUtils.buildDetailsNodeForTraceEvent(e,t.targetByEvent(e),i);if(n)d.appendElementRow(ls`Details`,n);break}}Timeline.TimelineUIUtils._maybeAppendProductToDetails(d,n,T||c&&c["url"]);if(h.timeWaitingForMainThread){d.appendTextRow(ls`Time Waiting for Main Thread`,Number.millisToString(h.timeWaitingForMainThread,true))}const p=o&&o.get(h.backendNodeId);if(p){const e=await Common.Linkifier.linkify(p);d.appendElementRow(a||ls`Related Node`,e)}if(e[Timeline.TimelineUIUtils._previewElementSymbol]){d.addSection(ls`Preview`);d.appendElementRow("",e[Timeline.TimelineUIUtils._previewElementSymbol])}if(u||h.stackTraceForSelfOrInitiator()||TimelineModel.InvalidationTracker.invalidationEventsFor(e))Timeline.TimelineUIUtils._generateCauses(e,t.targetByEvent(e),o,d);const g={};const _=s&&Timeline.TimelineUIUtils._aggregatedStatsForTraceEvent(g,t,e);if(_){d.addSection(ls`Aggregated Time`);const t=Timeline.TimelineUIUtils.generatePieChart(g,Timeline.TimelineUIUtils.eventStyle(e).category,e.selfTime);d.appendElementRow("",t)}return d.fragment}static _maybeAppendProductToDetails(e,t,i){const n=i?i.asParsedURL():null;if(n)e.appendElementRow("",t.badgeForURL(n))}static statsForTimeRange(e,t,i){if(!e.length)return{idle:i-t};l(e);const n=o(r(i),r(t));const s=Object.values(n).reduce((e,t)=>e+t,0);n["idle"]=Math.max(0,i-t-s);return n;function r(t){const i={};const n=e[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol];for(const e in n){const s=n[e];const r=s.time.upperBound(t);let o;if(r===0){o=0}else if(r===s.time.length){o=s.value.peekLast()}else{const e=s.time[r-1];const i=s.time[r];const n=s.value[r-1];const l=s.value[r];o=n+(l-n)*(t-e)/(i-e)}i[e]=o}return i}function o(e,t){const i=Object.assign({},e);for(const e in t)i[e]-=t[e];return i}function l(e){if(e[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol])return;const t={};const i=[];let n=0;TimelineModel.TimelineModel.forEachEvent(e,l,a,undefined,undefined,undefined,s());function s(){const e=Timeline.TimelineUIUtils.visibleEventsFilter();return t=>e.accept(t)||SDK.TracingModel.isTopLevelEvent(t)}function r(e,i){let s=t[e];if(!s){s={time:[],value:[]};t[e]=s}if(s.time.length&&s.time.peekLast()===i)return;const r=s.value.length?s.value.peekLast():0;s.value.push(r+i-n);s.time.push(i)}function o(e,t,i){if(e)r(e,i);n=i;if(t)r(t,i)}function l(e){const t=Timeline.TimelineUIUtils.eventStyle(e).category.name;const n=i.length?i.peekLast():null;if(t!==n)o(n,t,e.startTime);i.push(t)}function a(e){const t=i.pop();const n=i.length?i.peekLast():null;if(t!==n)o(t,n,e.endTime)}const d=e;d[Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol]=t}}static async buildNetworkRequestDetails(e,t,i,n){const s=t.targetByEvent(e.children[0]);const r=new Timeline.TimelineDetailsContentHelper(s,i);const o=Timeline.TimelineUIUtils.networkRequestCategory(e);const l=Timeline.TimelineUIUtils.networkCategoryColor(o);r.addSection(ls`Network request`,l);const a=e.endTime-(e.startTime||-Infinity);if(e.url)r.appendElementRow(ls`URL`,Components.Linkifier.linkifyURL(e.url));Timeline.TimelineUIUtils._maybeAppendProductToDetails(r,n,e.url);if(isFinite(a))r.appendTextRow(ls`Duration`,Number.millisToString(a,true));if(e.requestMethod)r.appendTextRow(ls`Request Method`,e.requestMethod);if(typeof e.priority==="string"){const t=PerfUI.uiLabelForNetworkPriority(e.priority);r.appendTextRow(ls`Priority`,t)}if(e.mimeType)r.appendTextRow(ls`Mime Type`,e.mimeType);let d="";if(e.fromCache)d+=ls` (from cache)`;if(e.fromServiceWorker)d+=ls` (from service worker)`;if(e.encodedDataLength||!d)d=`${Number.bytesToString(e.encodedDataLength)}${d}`;r.appendTextRow(ls`Encoded Data`,d);if(e.decodedBodyLength)r.appendTextRow(ls`Decoded Body`,Number.bytesToString(e.decodedBodyLength));const m=ls`Initiator`;const c=e.children[0];const h=TimelineModel.TimelineData.forEvent(c).topFrame();if(h){const e=i.maybeLinkifyConsoleCallFrame(s,h);if(e)r.appendElementRow(m,e)}else{const e=TimelineModel.TimelineData.forEvent(c).initiator();if(e){const t=TimelineModel.TimelineData.forEvent(e).url;if(t){const e=i.maybeLinkifyScriptLocation(s,null,t,0);if(e)r.appendElementRow(m,e)}}}if(!e.previewElement&&e.url&&s)e.previewElement=await Components.ImagePreview.build(s,e.url,false);if(e.previewElement)r.appendElementRow(ls`Preview`,e.previewElement);return r.fragment}static _stackTraceFromCallFrames(e){return{callFrames:e}}static _generateCauses(e,t,i,n){const s=TimelineModel.TimelineModel.RecordType;let r;let o;switch(e.name){case s.TimerFire:r=ls`Timer Installed`;break;case s.FireAnimationFrame:r=ls`Animation Frame Requested`;break;case s.FireIdleCallback:r=ls`Idle Callback Requested`;break;case s.UpdateLayoutTree:case s.RecalculateStyles:o=ls`Recalculation Forced`;break;case s.Layout:r=ls`First Layout Invalidation`;o=ls`Layout Forced`;break}const l=TimelineModel.TimelineData.forEvent(e);if(l.stackTrace&&l.stackTrace.length){n.addSection(ls`Call Stacks`);n.appendStackTrace(o||ls`Stack Trace`,Timeline.TimelineUIUtils._stackTraceFromCallFrames(l.stackTrace))}const a=TimelineModel.TimelineData.forEvent(e).initiator();if(TimelineModel.InvalidationTracker.invalidationEventsFor(e)&&t){n.addSection(ls`Invalidations`);Timeline.TimelineUIUtils._generateInvalidations(e,t,i,n)}else if(a){const t=e.startTime-a.startTime;n.appendTextRow(ls`Pending for`,Number.preciseMillisToString(t,1));const i=createElementWithClass("span","devtools-link");i.textContent=ls`Reveal`;i.addEventListener("click",()=>{Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent(a))});n.appendElementRow(ls`Initiator`,i);const s=TimelineModel.TimelineData.forEvent(a).stackTrace;if(s){n.appendStackTrace(r||ls`First Invalidated`,Timeline.TimelineUIUtils._stackTraceFromCallFrames(s))}}}static _generateInvalidations(e,t,i,n){const s=TimelineModel.InvalidationTracker.invalidationEventsFor(e);const r={};s.forEach(function(e){if(!r[e.type])r[e.type]=[e];else r[e.type].push(e)});Object.keys(r).forEach(function(e){Timeline.TimelineUIUtils._generateInvalidationsForType(e,t,r[e],i,n)})}static _generateInvalidationsForType(e,t,i,n,s){let r;switch(e){case TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking:r=ls`Style Invalidations`;break;case TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking:r=ls`Layout Invalidations`;break;default:r=ls`Other Invalidations`;break}const o=new UI.TreeOutlineInShadow;o.registerRequiredCSS("timeline/invalidationsTree.css");o.element.classList.add("invalidations-tree");const l=a(i);l.forEach(function(e){const i=new Timeline.TimelineUIUtils.InvalidationsGroupElement(t,n,s,e);o.appendChild(i)});s.appendElementRow(r,o.element,false,true);function a(e){const t=new Map;for(let i=0;i<e.length;i++){const n=e[i];let s="";if(n.cause.reason)s+=n.cause.reason+".";if(n.cause.stackTrace){n.cause.stackTrace.forEach(function(e){s+=e["functionName"]+".";s+=e["scriptId"]+".";s+=e["url"]+".";s+=e["lineNumber"]+".";s+=e["columnNumber"]+"."})}if(t.has(s))t.get(s).push(n);else t.set(s,[n])}return t.valuesArray()}}static _collectInvalidationNodeIds(e,t){e.addAll(t.map(e=>e.nodeId).filter(e=>e))}static _aggregatedStatsForTraceEvent(e,t,i){const n=t.inspectedTargetEvents();function s(e,t){return e-t.startTime}const r=n.binaryIndexOf(i.startTime,s);if(r<0)return false;let o=false;const l=i.endTime;if(l){for(let t=r;t<n.length;t++){const s=n[t];if(s.startTime>=l)break;if(!s.selfTime)continue;if(s.thread!==i.thread)continue;if(t>r)o=true;const a=Timeline.TimelineUIUtils.eventStyle(s).category.name;e[a]=(e[a]||0)+s.selfTime}}if(SDK.TracingModel.isAsyncPhase(i.phase)){if(i.endTime){let t=0;for(const i in e)t+=e[i];e["idle"]=Math.max(0,i.endTime-i.startTime-t)}return false}return o}static async buildPicturePreviewContent(e,t){const i=await new TimelineModel.LayerPaintEvent(e,t).snapshotPromise();if(!i)return null;const n=i.snapshot.replay();i.snapshot.release();const s=await n;if(!s)return null;const r=createElement("div");UI.appendStyle(r,"components/imagePreview.css");r.classList.add("image-preview-container","vbox","link");const o=r.createChild("img");o.src=s;const l=r.createChild("a");l.textContent=ls`Paint Profiler`;r.addEventListener("click",()=>Timeline.TimelinePanel.instance().select(Timeline.TimelineSelection.fromTraceEvent(e)),false);return r}static createEventDivider(e,t){const i=createElementWithClass("div","resources-event-divider");const n=Number.millisToString(e.startTime-t);i.title=Common.UIString("%s at %s",Timeline.TimelineUIUtils.eventTitle(e),n);const s=Timeline.TimelineUIUtils.markerStyleForEvent(e);if(s.tall)i.style.backgroundColor=s.color;return i}static _visibleTypes(){const e=Timeline.TimelineUIUtils._initEventStyles();const t=[];for(const i in e){if(!e[i].hidden)t.push(i)}return t}static visibleEventsFilter(){return new TimelineModel.TimelineVisibleEventsFilter(Timeline.TimelineUIUtils._visibleTypes())}static categories(){if(Timeline.TimelineUIUtils._categories)return Timeline.TimelineUIUtils._categories;Timeline.TimelineUIUtils._categories={loading:new Timeline.TimelineCategory("loading",ls`Loading`,true,"hsl(214, 67%, 74%)","hsl(214, 67%, 66%)"),scripting:new Timeline.TimelineCategory("scripting",ls`Scripting`,true,"hsl(43, 83%, 72%)","hsl(43, 83%, 64%) "),rendering:new Timeline.TimelineCategory("rendering",ls`Rendering`,true,"hsl(256, 67%, 76%)","hsl(256, 67%, 70%)"),painting:new Timeline.TimelineCategory("painting",ls`Painting`,true,"hsl(109, 33%, 64%)","hsl(109, 33%, 55%)"),gpu:new Timeline.TimelineCategory("gpu",ls`GPU`,false,"hsl(109, 33%, 64%)","hsl(109, 33%, 55%)"),async:new Timeline.TimelineCategory("async",ls`Async`,false,"hsl(0, 100%, 50%)","hsl(0, 100%, 40%)"),other:new Timeline.TimelineCategory("other",ls`System`,false,"hsl(0, 0%, 87%)","hsl(0, 0%, 79%)"),idle:new Timeline.TimelineCategory("idle",ls`Idle`,false,"hsl(0, 0%, 98%)","hsl(0, 0%, 98%)")};return Timeline.TimelineUIUtils._categories}static generatePieChart(e,t,i){let n=0;for(const t in e)n+=e[t];const s=createElementWithClass("div","timeline-details-view-pie-chart-wrapper hbox");const r=new PerfUI.PieChart({chartName:ls`Time spent in rendering`,size:110,formatter:e=>Number.preciseMillisToString(e),showLegend:true});r.element.classList.add("timeline-details-view-pie-chart");r.setTotal(n);const o=s.createChild("div","vbox");o.appendChild(r.element);function l(e,t,i,n){if(!i)return;r.addSlice(i,n,t)}if(t){if(i){l(t.name,Common.UIString("%s (self)",t.title),i,t.color)}const n=e[t.name];const s=n-i;if(s>0){l(t.name,Common.UIString("%s (children)",t.title),s,t.childColor)}}for(const i in Timeline.TimelineUIUtils.categories()){const n=Timeline.TimelineUIUtils.categories()[i];if(n===t)continue;l(n.name,n.title,e[n.name],n.childColor)}return s}static generateDetailsContentForFrame(e,t){const i=new Timeline.TimelineDetailsContentHelper(null,null);i.addSection(ls`Frame`);const n=Timeline.TimelineUIUtils.frameDuration(e);i.appendElementRow(ls`Duration`,n,e.hasWarnings());const s=e.endTime-e.startTime;i.appendTextRow(ls`FPS`,Math.floor(1e3/s));i.appendTextRow(ls`CPU time`,Number.millisToString(e.cpuTime,true));if(t){const e=createElementWithClass("div","timeline-filmstrip-preview");t.imageDataPromise().then(e=>UI.loadImageFromData(e)).then(t=>t&&e.appendChild(t));i.appendElementRow("",e);e.addEventListener("click",r.bind(null,t),false)}if(e.layerTree)i.appendElementRow(ls`Layer tree`,Components.Linkifier.linkifyRevealable(e.layerTree,ls`Show`));function r(e){new PerfUI.FilmStripView.Dialog(e,0)}return i.fragment}static frameDuration(e){const t=Common.UIString("%s (at %s)",Number.millisToString(e.endTime-e.startTime,true),Number.millisToString(e.startTimeOffset,true));if(!e.hasWarnings())return UI.formatLocalized("%s",[t]);const i=UI.XLink.create("https://developers.google.com/web/fundamentals/performance/rendering/",ls`jank`);return UI.formatLocalized("%s. Long frame times are an indication of %s",[t,i])}static createFillStyle(e,t,i,n,s,r){const o=e.createLinearGradient(0,0,t,i);o.addColorStop(0,n);o.addColorStop(.25,s);o.addColorStop(.75,s);o.addColorStop(1,r);return o}static quadWidth(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2)))}static quadHeight(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[6],2)+Math.pow(e[1]-e[7],2)))}static eventDispatchDesciptors(){if(Timeline.TimelineUIUtils._eventDispatchDesciptors)return Timeline.TimelineUIUtils._eventDispatchDesciptors;const e="hsl(40,100%,80%)";const t="hsl(40,100%,50%)";const i="hsl(90,100%,40%)";const n="hsl(256,100%,75%)";Timeline.TimelineUIUtils._eventDispatchDesciptors=[new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(1,e,["mousemove","mouseenter","mouseleave","mouseout","mouseover"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(1,e,["pointerover","pointerout","pointerenter","pointerleave","pointermove"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(2,i,["wheel"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,t,["click","mousedown","mouseup"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,t,["touchstart","touchend","touchmove","touchcancel"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,t,["pointerdown","pointerup","pointercancel","gotpointercapture","lostpointercapture"]),new Timeline.TimelineUIUtils.EventDispatchTypeDescriptor(3,n,["keydown","keyup","keypress"])];return Timeline.TimelineUIUtils._eventDispatchDesciptors}static markerShortTitle(e){const t=TimelineModel.TimelineModel.RecordType;switch(e.name){case t.MarkDOMContent:return ls`DCL`;case t.MarkLoad:return ls`L`;case t.MarkFirstPaint:return ls`FP`;case t.MarkFCP:return ls`FCP`;case t.MarkFMP:return ls`FMP`}return null}static markerStyleForEvent(e){const t=[6,4];const i=Timeline.TimelineUIUtils.eventTitle(e);if(e.hasCategory(TimelineModel.TimelineModel.Category.Console)||e.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)){return{title:i,dashStyle:t,lineWidth:.5,color:e.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)?"purple":"orange",tall:false,lowPriority:false}}const n=TimelineModel.TimelineModel.RecordType;let s=false;let r="grey";switch(e.name){case n.FrameStartedLoading:r="green";s=true;break;case n.MarkDOMContent:r="#0867CB";s=true;break;case n.MarkLoad:r="#B31412";s=true;break;case n.MarkFirstPaint:r="#228847";s=true;break;case n.MarkFCP:r="#1A6937";s=true;break;case n.MarkFMP:r="#134A26";s=true;break;case n.TimeStamp:r="orange";break}return{title:i,dashStyle:t,lineWidth:.5,color:r,tall:s,lowPriority:false}}static markerStyleForFrame(){return{title:ls`Frame`,color:"rgba(100, 100, 100, 0.4)",lineWidth:3,dashStyle:[3],tall:true,lowPriority:true}}static colorForId(e){if(!Timeline.TimelineUIUtils.colorForId._colorGenerator){Timeline.TimelineUIUtils.colorForId._colorGenerator=new Common.Color.Generator({min:30,max:330},{min:50,max:80,count:3},85);Timeline.TimelineUIUtils.colorForId._colorGenerator.setColorForID("","#f2ecdc")}return Timeline.TimelineUIUtils.colorForId._colorGenerator.colorForID(e)}static eventWarning(e,t){const i=TimelineModel.TimelineData.forEvent(e);const n=t||i.warning;if(!n)return null;const s=TimelineModel.TimelineModel.WarningType;const r=createElement("span");const o=e.args["data"];switch(n){case s.ForcedStyle:case s.ForcedLayout:const t=UI.createDocumentationLink("../../fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing#avoid-forced-synchronous-layouts",ls`Forced reflow`);r.appendChild(UI.formatLocalized("%s is a likely performance bottleneck.",[t]));break;case s.IdleDeadlineExceeded:const i=Number.millisToString(e.duration-o["allottedMilliseconds"],true);r.textContent=ls`Idle callback execution extended beyond deadline by ${i}`;break;case s.LongHandler:r.textContent=Common.UIString("Handler took %s",Number.millisToString(e.duration,true));break;case s.LongRecurringHandler:r.textContent=Common.UIString("Recurring handler took %s",Number.millisToString(e.duration,true));break;case s.LongTask:const l=UI.createDocumentationLink("../../fundamentals/performance/rail#goals-and-guidelines",ls`Long task`);r.appendChild(UI.formatLocalized("%s took %s.",[l,Number.millisToString(e.duration,true)]));break;case s.V8Deopt:r.appendChild(UI.XLink.create("https://github.com/GoogleChrome/devtools-docs/issues/53",Common.UIString("Not optimized")));r.createTextChild(Common.UIString(": %s",o["deoptReason"]));break;default:console.assert(false,"Unhandled TimelineModel.WarningType")}return r}static displayNameForFrame(e,t){const i=e.url;if(!t)t=30;return i.startsWith("about:")?`"${e.name.trimMiddle(t)}"`:e.url.trimEnd(t)}};Timeline.TimelineRecordStyle=class{constructor(e,t,i){this.title=e;this.category=t;this.hidden=!!i}};Timeline.TimelineUIUtils.NetworkCategory={HTML:Symbol("HTML"),Script:Symbol("Script"),Style:Symbol("Style"),Media:Symbol("Media"),Other:Symbol("Other")};Timeline.TimelineUIUtils._aggregatedStatsKey=Symbol("aggregatedStats");Timeline.TimelineUIUtils.InvalidationsGroupElement=class extends UI.TreeElement{constructor(e,t,i,n){super("",true);this.listItemElement.classList.add("header");this.selectable=false;this.toggleOnClick=true;this._relatedNodesMap=t;this._contentHelper=i;this._invalidations=n;this.title=this._createTitle(e)}_createTitle(e){const t=this._invalidations[0];const i=t.cause.reason||ls`Unknown cause`;const n=t.cause.stackTrace&&t.cause.stackTrace[0];const s=this._getTruncatedNodesElement(this._invalidations);if(s===null)return UI.formatLocalized(i,[]);const r=UI.formatLocalized("%s for %s",[i,s]);if(n&&this._contentHelper.linkifier()){const t=createElementWithClass("span","monospace");const i=UI.formatLocalized("%s. %s",[r,t]);t.createChild("span").textContent=Timeline.TimelineUIUtils.frameDisplayName(n);const s=this._contentHelper.linkifier().maybeLinkifyConsoleCallFrame(e,n);if(s){t.createChild("span").textContent=" @ ";t.createChild("span").appendChild(s)}return i}return r}async onpopulate(){const e=createElementWithClass("div","content");const t=this._invalidations[0];if(t.cause.stackTrace){const i=e.createChild("div");i.createTextChild(ls`Stack trace:`);this._contentHelper.createChildStackTraceElement(i,Timeline.TimelineUIUtils._stackTraceFromCallFrames(t.cause.stackTrace))}e.createTextChild(this._invalidations.length!==1?ls`Nodes:`:ls`Node:`);const i=e.createChild("div","node-list");let n=true;for(let e=0;e<this._invalidations.length;e++){const t=this._invalidations[e];const s=this._createInvalidationNode(t,true);if(s){if(!n)i.createTextChild(ls`, `);n=false;i.appendChild(s);const e=t.extraData?", "+t.extraData:"";if(t.changedId){i.createTextChild(Common.UIString('(changed id to "%s"%s)',t.changedId,e))}else if(t.changedClass){i.createTextChild(Common.UIString('(changed class to "%s"%s)',t.changedClass,e))}else if(t.changedAttribute){i.createTextChild(Common.UIString('(changed attribute to "%s"%s)',t.changedAttribute,e))}else if(t.changedPseudo){i.createTextChild(Common.UIString('(changed pesudo to "%s"%s)',t.changedPseudo,e))}else if(t.selectorPart){i.createTextChild(Common.UIString('(changed "%s"%s)',t.selectorPart,e))}}}const s=new UI.TreeElement(e,false);s.selectable=false;this.appendChild(s)}_getTruncatedNodesElement(e){const t=[];const i={};for(let n=0;n<e.length;n++){const s=e[n];const r=this._createInvalidationNode(s,false);r.addEventListener("click",e=>e.consume(),false);if(r&&!i[s.nodeId]){t.push(r);i[s.nodeId]=true}}if(t.length===1){return t[0]}else if(t.length===2){return UI.formatLocalized("%s and %s",t)}else if(t.length===3){return UI.formatLocalized("%s, %s, and 1 other",t.slice(0,2))}else if(t.length>=4){return UI.formatLocalized("%s, %s, and %s others",[...t.slice(0,2),(t.length-2).toString()])}return null}_createInvalidationNode(e,t){const i=e.nodeId&&this._relatedNodesMap?this._relatedNodesMap.get(e.nodeId):null;if(i){const e=createElement("span");Common.Linkifier.linkify(i).then(t=>e.appendChild(t));return e}if(e.nodeName){const t=createElement("span");t.textContent=Common.UIString("[ %s ]",e.nodeName);return t}if(t){const e=createElement("span");return e.createTextChild(Common.UIString("[ unknown node ]"))}}};Timeline.TimelineUIUtils._previewElementSymbol=Symbol("previewElement");Timeline.TimelineUIUtils.EventDispatchTypeDescriptor=class{constructor(e,t,i){this.priority=e;this.color=t;this.eventTypes=i}};Timeline.TimelineCategory=class extends Common.Object{constructor(e,t,i,n,s){super();this.name=e;this.title=t;this.visible=i;this.childColor=n;this.color=s;this.hidden=false}get hidden(){return this._hidden}set hidden(e){this._hidden=e;this.dispatchEventToListeners(Timeline.TimelineCategory.Events.VisibilityChanged,this)}};Timeline.TimelineCategory.Events={VisibilityChanged:Symbol("VisibilityChanged")};Timeline.TimelineMarkerStyle;Timeline.TimelinePopupContentHelper=class{constructor(e){this._contentTable=createElement("table");const t=this._createCell(Common.UIString("%s - Details",e),"timeline-details-title");t.colSpan=2;const i=createElement("tr");i.appendChild(t);this._contentTable.appendChild(i)}contentTable(){return this._contentTable}_createCell(e,t){const i=createElement("label");i.createTextChild(String(e));const n=createElement("td");n.className="timeline-details";if(t)n.className+=" "+t;n.textContent=e;return n}appendTextRow(e,t){const i=createElement("tr");i.appendChild(this._createCell(e,"timeline-details-row-title"));i.appendChild(this._createCell(t,"timeline-details-row-data"));this._contentTable.appendChild(i)}appendElementRow(e,t){const i=createElement("tr");const n=this._createCell(e,"timeline-details-row-title");i.appendChild(n);const s=createElement("td");s.className="details";if(t instanceof Node)s.appendChild(t);else s.createTextChild(t||"");i.appendChild(s);this._contentTable.appendChild(i)}};Timeline.TimelineDetailsContentHelper=class{constructor(e,t){this.fragment=createDocumentFragment();this._linkifier=t;this._target=e;this.element=createElementWithClass("div","timeline-details-view-block");this._tableElement=this.element.createChild("div","vbox timeline-details-chip-body");this.fragment.appendChild(this.element)}addSection(e,t){if(!this._tableElement.hasChildNodes()){this.element.removeChildren()}else{this.element=createElementWithClass("div","timeline-details-view-block");this.fragment.appendChild(this.element)}if(e){const i=this.element.createChild("div","timeline-details-chip-title");if(t)i.createChild("div").style.backgroundColor=t;i.createTextChild(e)}this._tableElement=this.element.createChild("div","vbox timeline-details-chip-body");this.fragment.appendChild(this.element)}linkifier(){return this._linkifier}appendTextRow(e,t){const i=this._tableElement.createChild("div","timeline-details-view-row");i.createChild("div","timeline-details-view-row-title").textContent=e;i.createChild("div","timeline-details-view-row-value").textContent=t}appendElementRow(e,t,i,n){const s=this._tableElement.createChild("div","timeline-details-view-row");if(i)s.classList.add("timeline-details-warning");if(n)s.classList.add("timeline-details-stack-values");const r=s.createChild("div","timeline-details-view-row-title");r.textContent=e;const o=s.createChild("div","timeline-details-view-row-value");if(t instanceof Node)o.appendChild(t);else o.createTextChild(t||"")}appendLocationRow(e,t,i,n){if(!this._linkifier||!this._target)return;const s=this._linkifier.maybeLinkifyScriptLocation(this._target,null,t,i,n);if(!s)return;this.appendElementRow(e,s)}appendLocationRange(e,t,i,n){if(!this._linkifier||!this._target)return;const s=createElement("span");const r=this._linkifier.maybeLinkifyScriptLocation(this._target,null,t,i);if(!r)return;s.appendChild(r);s.createTextChild(String.sprintf(" [%s…%s]",i+1,n+1||""));this.appendElementRow(e,s)}appendStackTrace(e,t){if(!this._linkifier||!this._target)return;const i=this._tableElement.createChild("div","timeline-details-view-row");i.createChild("div","timeline-details-view-row-title").textContent=e;this.createChildStackTraceElement(i,t)}createChildStackTraceElement(e,t){if(!this._linkifier||!this._target)return;e.classList.add("timeline-details-stack-values");const i=e.createChild("div","timeline-details-view-row-value timeline-details-view-row-stack-trace");const n=Components.JSPresentationUtils.buildStackTracePreviewContents(this._target,this._linkifier,t);i.appendChild(n.element)}appendWarningRow(e,t){const i=Timeline.TimelineUIUtils.eventWarning(e,t);if(i)this.appendElementRow(ls`Warning`,i,true)}};Timeline.TimelineUIUtils._categoryBreakdownCacheSymbol=Symbol("categoryBreakdownCache");Timeline.TimelineLayersView=class extends UI.SplitWidget{constructor(e,t){super(true,false,"timelineLayersView");this._model=e;this._showPaintProfilerCallback=t;this.element.classList.add("timeline-layers-view");this._rightSplitWidget=new UI.SplitWidget(true,true,"timelineLayersViewDetails");this._rightSplitWidget.element.classList.add("timeline-layers-view-properties");this.setMainWidget(this._rightSplitWidget);const i=new UI.VBox;this.setSidebarWidget(i);this._layerViewHost=new LayerViewer.LayerViewHost;const n=new LayerViewer.LayerTreeOutline(this._layerViewHost);i.element.appendChild(n.element);this._layers3DView=new LayerViewer.Layers3DView(this._layerViewHost);this._layers3DView.addEventListener(LayerViewer.Layers3DView.Events.PaintProfilerRequested,this._onPaintProfilerRequested,this);this._rightSplitWidget.setMainWidget(this._layers3DView);const s=new LayerViewer.LayerDetailsView(this._layerViewHost);this._rightSplitWidget.setSidebarWidget(s);s.addEventListener(LayerViewer.LayerDetailsView.Events.PaintProfilerRequested,this._onPaintProfilerRequested,this)}showLayerTree(e){this._frameLayerTree=e;if(this.isShowing())this._update();else this._updateWhenVisible=true}wasShown(){if(this._updateWhenVisible){this._updateWhenVisible=false;this._update()}}_onPaintProfilerRequested(e){const t=e.data;this._layers3DView.snapshotForSelection(t).then(e=>{if(e)this._showPaintProfilerCallback(e.snapshot)})}_update(){this._frameLayerTree.layerTreePromise().then(e=>this._layerViewHost.setLayerTree(e))}};Timeline.TimelinePaintProfilerView=class extends UI.SplitWidget{constructor(e){super(false,false);this.element.classList.add("timeline-paint-profiler-view");this.setSidebarSize(60);this.setResizable(false);this._frameModel=e;this._logAndImageSplitWidget=new UI.SplitWidget(true,false);this._logAndImageSplitWidget.element.classList.add("timeline-paint-profiler-log-split");this.setMainWidget(this._logAndImageSplitWidget);this._imageView=new Timeline.TimelinePaintImageView;this._logAndImageSplitWidget.setMainWidget(this._imageView);this._paintProfilerView=new LayerViewer.PaintProfilerView(this._imageView.showImage.bind(this._imageView));this._paintProfilerView.addEventListener(LayerViewer.PaintProfilerView.Events.WindowChanged,this._onWindowChanged,this);this.setSidebarWidget(this._paintProfilerView);this._logTreeView=new LayerViewer.PaintProfilerCommandLogView;this._logAndImageSplitWidget.setSidebarWidget(this._logTreeView);this._needsUpdateWhenVisible=false;this._pendingSnapshot=null;this._event=null;this._paintProfilerModel=null;this._lastLoadedSnapshot=null}wasShown(){if(this._needsUpdateWhenVisible){this._needsUpdateWhenVisible=false;this._update()}}setSnapshot(e){this._releaseSnapshot();this._pendingSnapshot=e;this._event=null;this._updateWhenVisible()}setEvent(e,t){this._releaseSnapshot();this._paintProfilerModel=e;this._pendingSnapshot=null;this._event=t;this._updateWhenVisible();if(this._event.name===TimelineModel.TimelineModel.RecordType.Paint)return!!TimelineModel.TimelineData.forEvent(t).picture;if(this._event.name===TimelineModel.TimelineModel.RecordType.RasterTask)return this._frameModel.hasRasterTile(this._event);return false}_updateWhenVisible(){if(this.isShowing())this._update();else this._needsUpdateWhenVisible=true}_update(){this._logTreeView.setCommandLog([]);this._paintProfilerView.setSnapshotAndLog(null,[],null);let e;if(this._pendingSnapshot){e=Promise.resolve({rect:null,snapshot:this._pendingSnapshot})}else if(this._event.name===TimelineModel.TimelineModel.RecordType.Paint){const t=TimelineModel.TimelineData.forEvent(this._event).picture;e=t.objectPromise().then(e=>this._paintProfilerModel.loadSnapshot(e["skp64"])).then(e=>e&&{rect:null,snapshot:e})}else if(this._event.name===TimelineModel.TimelineModel.RecordType.RasterTask){e=this._frameModel.rasterTilePromise(this._event)}else{console.assert(false,"Unexpected event type or no snapshot");return}e.then(e=>{this._releaseSnapshot();if(!e){this._imageView.showImage();return}const i=e.snapshot;this._lastLoadedSnapshot=i;this._imageView.setMask(e.rect);i.commandLog().then(n=>t.call(this,i,e.rect,n))});function t(e,t,i){this._logTreeView.setCommandLog(i||[]);this._paintProfilerView.setSnapshotAndLog(e,i||[],t)}}_releaseSnapshot(){if(!this._lastLoadedSnapshot)return;this._lastLoadedSnapshot.release();this._lastLoadedSnapshot=null}_onWindowChanged(){this._logTreeView.updateWindow(this._paintProfilerView.selectionWindow())}};Timeline.TimelinePaintImageView=class extends UI.Widget{constructor(){super(true);this.registerRequiredCSS("timeline/timelinePaintProfiler.css");this.contentElement.classList.add("fill","paint-profiler-image-view");this._imageContainer=this.contentElement.createChild("div","paint-profiler-image-container");this._imageElement=this._imageContainer.createChild("img");this._maskElement=this._imageContainer.createChild("div");this._imageElement.addEventListener("load",this._updateImagePosition.bind(this),false);this._transformController=new LayerViewer.TransformController(this.contentElement,true);this._transformController.addEventListener(LayerViewer.TransformController.Events.TransformChanged,this._updateImagePosition,this)}onResize(){if(this._imageElement.src)this._updateImagePosition()}_updateImagePosition(){const e=this._imageElement.naturalWidth;const t=this._imageElement.naturalHeight;const i=this.contentElement.clientWidth;const n=this.contentElement.clientHeight;const s=.1;const r=i*s;const o=n*s;const l=(i-r)/e;const a=(n-o)/t;const d=Math.min(l,a);if(this._maskRectangle){const i=this._maskElement.style;i.width=e+"px";i.height=t+"px";i.borderLeftWidth=this._maskRectangle.x+"px";i.borderTopWidth=this._maskRectangle.y+"px";i.borderRightWidth=e-this._maskRectangle.x-this._maskRectangle.width+"px";i.borderBottomWidth=t-this._maskRectangle.y-this._maskRectangle.height+"px"}this._transformController.setScaleConstraints(.5,10/d);let m=(new WebKitCSSMatrix).scale(this._transformController.scale(),this._transformController.scale()).translate(i/2,n/2).scale(d,d).translate(-e/2,-t/2);const c=UI.Geometry.boundsForTransformedPoints(m,[0,0,0,e,t,0]);this._transformController.clampOffsets(r-c.maxX,i-r-c.minX,o-c.maxY,n-o-c.minY);m=(new WebKitCSSMatrix).translate(this._transformController.offsetX(),this._transformController.offsetY()).multiply(m);this._imageContainer.style.webkitTransform=m.toString()}showImage(e){this._imageContainer.classList.toggle("hidden",!e);if(e)this._imageElement.src=e}setMask(e){this._maskRectangle=e;this._maskElement.classList.toggle("hidden",!e)}};Timeline.TimelinePanel=class extends UI.Panel{constructor(){super("timeline");this.registerRequiredCSS("timeline/timelinePanel.css");this.element.addEventListener("contextmenu",this._contextMenu.bind(this),false);this._dropTarget=new UI.DropTarget(this.element,[UI.DropTarget.Type.File,UI.DropTarget.Type.URI],Common.UIString("Drop timeline file or URL here"),this._handleDrop.bind(this));this._recordingOptionUIControls=[];this._state=Timeline.TimelinePanel.State.Idle;this._recordingPageReload=false;this._millisecondsToRecordAfterLoadEvent=3e3;this._toggleRecordAction=UI.actionRegistry.action("timeline.toggle-recording");this._recordReloadAction=UI.actionRegistry.action("timeline.record-reload");this._historyManager=new Timeline.TimelineHistoryManager;this._performanceModel=null;this._viewModeSetting=Common.settings.createSetting("timelineViewMode",Timeline.TimelinePanel.ViewMode.FlameChart);this._disableCaptureJSProfileSetting=Common.settings.createSetting("timelineDisableJSSampling",false);this._disableCaptureJSProfileSetting.setTitle(Common.UIString("Disable JavaScript samples"));this._captureLayersAndPicturesSetting=Common.settings.createSetting("timelineCaptureLayersAndPictures",false);this._captureLayersAndPicturesSetting.setTitle(Common.UIString("Enable advanced paint instrumentation (slow)"));this._showScreenshotsSetting=Common.settings.createSetting("timelineShowScreenshots",true);this._showScreenshotsSetting.setTitle(Common.UIString("Screenshots"));this._showScreenshotsSetting.addChangeListener(this._updateOverviewControls,this);this._showMemorySetting=Common.settings.createSetting("timelineShowMemory",false);this._showMemorySetting.setTitle(Common.UIString("Memory"));this._showMemorySetting.addChangeListener(this._onModeChanged,this);const e=this.element.createChild("div","timeline-toolbar-container");this._panelToolbar=new UI.Toolbar("timeline-main-toolbar",e);this._panelRightToolbar=new UI.Toolbar("",e);this._createSettingsPane();this._updateShowSettingsToolbarButton();this._timelinePane=new UI.VBox;this._timelinePane.show(this.element);const t=this._timelinePane.element.createChild("div","hbox");t.id="timeline-overview-panel";this._overviewPane=new PerfUI.TimelineOverviewPane("timeline");this._overviewPane.addEventListener(PerfUI.TimelineOverviewPane.Events.WindowChanged,this._onOverviewWindowChanged.bind(this));this._overviewPane.show(t);this._overviewControls=[];this._statusPaneContainer=this._timelinePane.element.createChild("div","status-pane-container fill");this._createFileSelector();SDK.targetManager.addModelListener(SDK.ResourceTreeModel,SDK.ResourceTreeModel.Events.Load,this._loadEventFired,this);this._flameChart=new Timeline.TimelineFlameChartView(this);this._searchableView=new UI.SearchableView(this._flameChart);this._searchableView.setMinimumSize(0,100);this._searchableView.element.classList.add("searchable-view");this._searchableView.show(this._timelinePane.element);this._flameChart.show(this._searchableView.element);this._flameChart.setSearchableView(this._searchableView);this._onModeChanged();this._populateToolbar();this._showLandingPage();this._updateTimelineControls();Extensions.extensionServer.addEventListener(Extensions.ExtensionServer.Events.TraceProviderAdded,this._appendExtensionsToToolbar,this);SDK.targetManager.addEventListener(SDK.TargetManager.Events.SuspendStateChanged,this._onSuspendStateChanged,this)}static instance(){return self.runtime.sharedInstance(Timeline.TimelinePanel)}searchableView(){return this._searchableView}wasShown(){UI.context.setFlavor(Timeline.TimelinePanel,this)}willHide(){UI.context.setFlavor(Timeline.TimelinePanel,null);this._historyManager.cancelIfShowing()}loadFromEvents(e){if(this._state!==Timeline.TimelinePanel.State.Idle)return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromEvents(e,this)}_onOverviewWindowChanged(e){const t=e.data.startTime;const i=e.data.endTime;this._performanceModel.setWindow({left:t,right:i},true)}_onModelWindowChanged(e){const t=e.data.window;this._overviewPane.setWindowTimes(t.left,t.right)}_setState(e){this._state=e;this._updateTimelineControls()}_createSettingCheckbox(e,t){const i=new UI.ToolbarSettingCheckbox(e,t);this._recordingOptionUIControls.push(i);return i}_populateToolbar(){this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._toggleRecordAction));this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButton(this._recordReloadAction));this._clearButton=new UI.ToolbarButton(Common.UIString("Clear"),"largeicon-clear");this._clearButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._onClearButton());this._panelToolbar.appendToolbarItem(this._clearButton);this._loadButton=new UI.ToolbarButton(Common.UIString("Load profile..."),"largeicon-load");this._loadButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._selectFileToLoad());this._saveButton=new UI.ToolbarButton(Common.UIString("Save profile..."),"largeicon-download");this._saveButton.addEventListener(UI.ToolbarButton.Events.Click,()=>this._saveToFile());this._panelToolbar.appendSeparator();this._panelToolbar.appendToolbarItem(this._loadButton);this._panelToolbar.appendToolbarItem(this._saveButton);this._panelToolbar.appendSeparator();this._panelToolbar.appendToolbarItem(this._historyManager.button());this._panelToolbar.appendSeparator();this._panelToolbar.appendSeparator();this._showScreenshotsToolbarCheckbox=this._createSettingCheckbox(this._showScreenshotsSetting,Common.UIString("Capture screenshots"));this._panelToolbar.appendToolbarItem(this._showScreenshotsToolbarCheckbox);this._showMemoryToolbarCheckbox=this._createSettingCheckbox(this._showMemorySetting,Common.UIString("Show memory timeline"));this._panelToolbar.appendToolbarItem(this._showMemoryToolbarCheckbox);this._panelToolbar.appendToolbarItem(UI.Toolbar.createActionButtonForId("components.collect-garbage"));this._panelRightToolbar.appendSeparator();this._panelRightToolbar.appendToolbarItem(this._showSettingsPaneButton)}_createSettingsPane(){this._showSettingsPaneSetting=Common.settings.createSetting("timelineShowSettingsToolbar",false);this._showSettingsPaneButton=new UI.ToolbarSettingToggle(this._showSettingsPaneSetting,"largeicon-settings-gear",Common.UIString("Capture settings"));SDK.multitargetNetworkManager.addEventListener(SDK.MultitargetNetworkManager.Events.ConditionsChanged,this._updateShowSettingsToolbarButton,this);MobileThrottling.throttlingManager().addEventListener(MobileThrottling.ThrottlingManager.Events.RateChanged,this._updateShowSettingsToolbarButton,this);this._disableCaptureJSProfileSetting.addChangeListener(this._updateShowSettingsToolbarButton,this);this._captureLayersAndPicturesSetting.addChangeListener(this._updateShowSettingsToolbarButton,this);this._settingsPane=new UI.HBox;this._settingsPane.element.classList.add("timeline-settings-pane");this._settingsPane.show(this.element);const e=new UI.Toolbar("",this._settingsPane.element);e.element.classList.add("flex-auto");e.makeVertical();e.appendToolbarItem(this._createSettingCheckbox(this._disableCaptureJSProfileSetting,Common.UIString("Disables JavaScript sampling, reduces overhead when running against mobile devices")));e.appendToolbarItem(this._createSettingCheckbox(this._captureLayersAndPicturesSetting,Common.UIString("Captures advanced paint instrumentation, introduces significant performance overhead")));const t=new UI.VBox;t.element.classList.add("flex-auto");t.show(this._settingsPane.element);const i=new UI.Toolbar("",t.element);i.appendText(Common.UIString("Network:"));this._networkThrottlingSelect=this._createNetworkConditionsSelect();i.appendToolbarItem(this._networkThrottlingSelect);const n=new UI.Toolbar("",t.element);n.appendText(Common.UIString("CPU:"));this._cpuThrottlingSelect=MobileThrottling.throttlingManager().createCPUThrottlingSelector();n.appendToolbarItem(this._cpuThrottlingSelect);this._showSettingsPaneSetting.addChangeListener(this._updateSettingsPaneVisibility.bind(this));this._updateSettingsPaneVisibility()}_appendExtensionsToToolbar(e){const t=e.data;const i=Timeline.TimelinePanel._settingForTraceProvider(t);const n=this._createSettingCheckbox(i,t.longDisplayName());this._panelToolbar.appendToolbarItem(n)}static _settingForTraceProvider(e){let t=e[Timeline.TimelinePanel._traceProviderSettingSymbol];if(!t){const i=e.persistentIdentifier();t=Common.settings.createSetting(i,false);t.setTitle(e.shortDisplayName());e[Timeline.TimelinePanel._traceProviderSettingSymbol]=t}return t}_createNetworkConditionsSelect(){const e=new UI.ToolbarComboBox(null);e.setMaxWidth(140);MobileThrottling.throttlingManager().decorateSelectWithNetworkThrottling(e.selectElement());return e}_prepareToLoadTimeline(){console.assert(this._state===Timeline.TimelinePanel.State.Idle);this._setState(Timeline.TimelinePanel.State.Loading);if(this._performanceModel){this._performanceModel.dispose();this._performanceModel=null}}_createFileSelector(){if(this._fileSelectorElement)this._fileSelectorElement.remove();this._fileSelectorElement=UI.createFileSelectorElement(this._loadFromFile.bind(this));this._timelinePane.element.appendChild(this._fileSelectorElement)}_contextMenu(e){const t=new UI.ContextMenu(e);t.appendItemsAtLocation("timelineMenu");t.show()}async _saveToFile(){if(this._state!==Timeline.TimelinePanel.State.Idle)return;const e=this._performanceModel;if(!e)return;const t=new Date;const i="Profile-"+t.toISO8601Compact()+".json";const n=new Bindings.FileOutputStream;const s=await n.open(i);if(!s)return;const r=await e.save(n);if(!r)return;Common.console.error(Common.UIString("Failed to save timeline: %s (%s, %s)",r.message,r.name,r.code))}async _showHistory(){const e=await this._historyManager.showHistoryDropDown();if(e&&e!==this._performanceModel)this._setModel(e)}_navigateHistory(e){const t=this._historyManager.navigate(e);if(t&&t!==this._performanceModel)this._setModel(t);return true}_selectFileToLoad(){this._fileSelectorElement.click()}_loadFromFile(e){if(this._state!==Timeline.TimelinePanel.State.Idle)return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromFile(e,this);this._createFileSelector()}_loadFromURL(e){if(this._state!==Timeline.TimelinePanel.State.Idle)return;this._prepareToLoadTimeline();this._loader=Timeline.TimelineLoader.loadFromURL(e,this)}_updateOverviewControls(){this._overviewControls=[];this._overviewControls.push(new Timeline.TimelineEventOverviewResponsiveness);if(Runtime.experiments.isEnabled("inputEventsOnTimelineOverview"))this._overviewControls.push(new Timeline.TimelineEventOverviewInput);this._overviewControls.push(new Timeline.TimelineEventOverviewFrames);this._overviewControls.push(new Timeline.TimelineEventOverviewCPUActivity);this._overviewControls.push(new Timeline.TimelineEventOverviewNetwork);if(this._showScreenshotsSetting.get()&&this._performanceModel&&this._performanceModel.filmStripModel().frames().length)this._overviewControls.push(new Timeline.TimelineFilmStripOverview);if(this._showMemorySetting.get())this._overviewControls.push(new Timeline.TimelineEventOverviewMemory);for(const e of this._overviewControls)e.setModel(this._performanceModel);this._overviewPane.setOverviewControls(this._overviewControls)}_onModeChanged(){this._updateOverviewControls();this.doResize();this.select(null)}_updateSettingsPaneVisibility(){if(this._showSettingsPaneSetting.get())this._settingsPane.showWidget();else this._settingsPane.hideWidget()}_updateShowSettingsToolbarButton(){const e=[];if(MobileThrottling.throttlingManager().cpuThrottlingRate()!==1)e.push(Common.UIString("- CPU throttling is enabled"));if(SDK.multitargetNetworkManager.isThrottling())e.push(Common.UIString("- Network throttling is enabled"));if(this._captureLayersAndPicturesSetting.get())e.push(Common.UIString("- Significant overhead due to paint instrumentation"));if(this._disableCaptureJSProfileSetting.get())e.push(Common.UIString("- JavaScript sampling is disabled"));this._showSettingsPaneButton.setDefaultWithRedColor(e.length);this._showSettingsPaneButton.setToggleWithRedColor(e.length);if(e.length){const t=createElement("div");e.forEach(e=>{t.createChild("div").textContent=e});this._showSettingsPaneButton.setTitle(t)}else{this._showSettingsPaneButton.setTitle(Common.UIString("Capture settings"))}}_setUIControlsEnabled(e){this._recordingOptionUIControls.forEach(t=>t.setEnabled(e))}async _startRecording(){console.assert(!this._statusPane,"Status pane is already opened.");this._setState(Timeline.TimelinePanel.State.StartPending);this._showRecordingStarted();const e=Extensions.extensionServer.traceProviders().filter(e=>Timeline.TimelinePanel._settingForTraceProvider(e).get());const t={enableJSSampling:!this._disableCaptureJSProfileSetting.get(),capturePictures:this._captureLayersAndPicturesSetting.get(),captureFilmStrip:this._showScreenshotsSetting.get()};const i=SDK.targetManager.mainTarget();this._controller=new Timeline.TimelineController(i,this);this._setUIControlsEnabled(false);this._hideLandingPage();await this._controller.startRecording(t,e);this._recordingStarted()}async _stopRecording(){if(this._statusPane){this._statusPane.finish();this._statusPane.updateStatus(Common.UIString("Stopping timeline…"));this._statusPane.updateProgressBar(Common.UIString("Received"),0)}this._setState(Timeline.TimelinePanel.State.StopPending);this._performanceModel=await this._controller.stopRecording();this._setUIControlsEnabled(true);this._controller.dispose();this._controller=null}_onSuspendStateChanged(){this._updateTimelineControls()}_updateTimelineControls(){const e=Timeline.TimelinePanel.State;this._toggleRecordAction.setToggled(this._state===e.Recording);this._toggleRecordAction.setEnabled(this._state===e.Recording||this._state===e.Idle);this._recordReloadAction.setEnabled(this._state===e.Idle);this._historyManager.setEnabled(this._state===e.Idle);this._clearButton.setEnabled(this._state===e.Idle);this._panelToolbar.setEnabled(this._state!==e.Loading);this._panelRightToolbar.setEnabled(this._state!==e.Loading);this._dropTarget.setEnabled(this._state===e.Idle);this._loadButton.setEnabled(this._state===e.Idle);this._saveButton.setEnabled(this._state===e.Idle&&!!this._performanceModel)}_toggleRecording(){if(this._state===Timeline.TimelinePanel.State.Idle){this._recordingPageReload=false;this._startRecording();Host.userMetrics.actionTaken(Host.UserMetrics.Action.TimelineStarted)}else if(this._state===Timeline.TimelinePanel.State.Recording){this._stopRecording()}}_recordReload(){if(this._state!==Timeline.TimelinePanel.State.Idle)return;this._recordingPageReload=true;this._startRecording();Host.userMetrics.actionTaken(Host.UserMetrics.Action.TimelinePageReloadStarted)}_onClearButton(){this._historyManager.clear();this._clear()}_clear(){this._showLandingPage();this._reset()}_reset(){self.runtime.sharedInstance(PerfUI.LineLevelProfile.Performance).reset();this._setModel(null)}_applyFilters(e){if(e.timelineModel().isGenericTrace()||Runtime.experiments.isEnabled("timelineShowAllEvents"))return;e.setFilters([Timeline.TimelineUIUtils.visibleEventsFilter()])}_setModel(e){if(this._performanceModel){this._performanceModel.removeEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onModelWindowChanged,this)}this._performanceModel=e;if(e)this._applyFilters(e);this._flameChart.setModel(e);this._updateOverviewControls();this._overviewPane.reset();if(e){this._performanceModel.addEventListener(Timeline.PerformanceModel.Events.WindowChanged,this._onModelWindowChanged,this);this._overviewPane.setBounds(e.timelineModel().minimumRecordTime(),e.timelineModel().maximumRecordTime());const t=self.runtime.sharedInstance(PerfUI.LineLevelProfile.Performance);t.reset();for(const i of e.timelineModel().cpuProfiles())t.appendCPUProfile(i);this._setMarkers(e.timelineModel());this._flameChart.setSelection(null);this._overviewPane.setWindowTimes(e.window().left,e.window().right)}for(const t of this._overviewControls)t.setModel(e);if(this._flameChart)this._flameChart.resizeToPreferredHeights();this._updateTimelineControls()}_recordingStarted(){if(this._recordingPageReload){const e=this._controller.mainTarget();const t=e.model(SDK.ResourceTreeModel);if(t)t.reloadPage()}this._reset();this._setState(Timeline.TimelinePanel.State.Recording);this._showRecordingStarted();this._statusPane.updateStatus(Common.UIString("Profiling…"));this._statusPane.updateProgressBar(Common.UIString("Buffer usage"),0);this._statusPane.startTimer();this._hideLandingPage()}recordingProgress(e){this._statusPane.updateProgressBar(Common.UIString("Buffer usage"),e*100)}_showLandingPage(){if(this._landingPage){this._landingPage.show(this._statusPaneContainer);return}function e(e,t){const i=createElement(e);i.textContent=t;return i}const t=UI.XLink.create("https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/",Common.UIString("Learn more"));const i=e("b",UI.shortcutRegistry.shortcutDescriptorsForAction("timeline.toggle-recording")[0].name);const n=e("b",UI.shortcutRegistry.shortcutDescriptorsForAction("timeline.record-reload")[0].name);const s=e("b",Common.UIString("WASD"));this._landingPage=new UI.VBox;this._landingPage.contentElement.classList.add("timeline-landing-page","fill");const r=this._landingPage.contentElement.createChild("div");const o=UI.createInlineButton(UI.Toolbar.createActionButton(this._toggleRecordAction));const l=UI.createInlineButton(UI.Toolbar.createActionButtonForId("timeline.record-reload"));r.createChild("p").appendChild(UI.formatLocalized("Click the record button %s or hit %s to start a new recording.\nClick the reload button %s or hit %s to record the page load.",[o,i,l,n]));r.createChild("p").appendChild(UI.formatLocalized("After recording, select an area of interest in the overview by dragging.\nThen, zoom and pan the timeline with the mousewheel or %s keys.\n%s",[s,t]));this._landingPage.show(this._statusPaneContainer)}_hideLandingPage(){this._landingPage.detach()}loadingStarted(){this._hideLandingPage();if(this._statusPane)this._statusPane.hide();this._statusPane=new Timeline.TimelinePanel.StatusPane(false,this._cancelLoading.bind(this));this._statusPane.showPane(this._statusPaneContainer);this._statusPane.updateStatus(Common.UIString("Loading profile…"));if(!this._loader)this._statusPane.finish();this.loadingProgress(0)}loadingProgress(e){if(typeof e==="number")this._statusPane.updateProgressBar(Common.UIString("Received"),e*100)}processingStarted(){this._statusPane.updateStatus(Common.UIString("Processing profile…"))}loadingComplete(e){delete this._loader;this._setState(Timeline.TimelinePanel.State.Idle);if(this._statusPane)this._statusPane.hide();delete this._statusPane;if(!e){this._clear();return}if(!this._performanceModel)this._performanceModel=new Timeline.PerformanceModel;this._performanceModel.setTracingModel(e);this._setModel(this._performanceModel);this._historyManager.addRecording(this._performanceModel)}_showRecordingStarted(){if(this._statusPane)return;this._statusPane=new Timeline.TimelinePanel.StatusPane(true,this._stopRecording.bind(this));this._statusPane.showPane(this._statusPaneContainer);this._statusPane.updateStatus(Common.UIString("Initializing profiler…"))}_cancelLoading(){if(this._loader)this._loader.cancel()}_setMarkers(e){const t=new Map;const i=TimelineModel.TimelineModel.RecordType;const n=e.minimumRecordTime();for(const s of e.timeMarkerEvents()){if(s.name===i.TimeStamp||s.name===i.ConsoleTime)continue;t.set(s.startTime,Timeline.TimelineUIUtils.createEventDivider(s,n))}this._overviewPane.setMarkers(t)}async _loadEventFired(e){if(this._state!==Timeline.TimelinePanel.State.Recording||!this._recordingPageReload||this._controller.mainTarget()!==e.data.resourceTreeModel.target())return;const t=this._controller;await new Promise(e=>setTimeout(e,this._millisecondsToRecordAfterLoadEvent));if(t!==this._controller||this._state!==Timeline.TimelinePanel.State.Recording)return;this._stopRecording()}_frameForSelection(e){switch(e.type()){case Timeline.TimelineSelection.Type.Frame:return e.object();case Timeline.TimelineSelection.Type.Range:return null;case Timeline.TimelineSelection.Type.TraceEvent:return this._performanceModel.frameModel().frames(e._endTime,e._endTime)[0];default:console.assert(false,"Should never be reached");return null}}_jumpToFrame(e){const t=this._selection&&this._frameForSelection(this._selection);if(!t)return;const i=this._performanceModel.frames();let n=i.indexOf(t);console.assert(n>=0,"Can't find current frame in the frame list");n=Number.constrain(n+e,0,i.length-1);const s=i[n];this._revealTimeRange(s.startTime,s.endTime);this.select(Timeline.TimelineSelection.fromFrame(s));return true}select(e){this._selection=e;this._flameChart.setSelection(e)}selectEntryAtTime(e,t){if(!e)return;for(let i=e.upperBound(t,(e,t)=>e-t.startTime)-1;i>=0;--i){const n=e[i];const s=n.endTime||n.startTime;if(SDK.TracingModel.isTopLevelEvent(n)&&s<t)break;if(this._performanceModel.isVisible(n)&&s>=t){this.select(Timeline.TimelineSelection.fromTraceEvent(n));return}}this.select(null)}highlightEvent(e){this._flameChart.highlightEvent(e)}_revealTimeRange(e,t){const i=this._performanceModel.window();let n=0;if(i.right<t)n=t-i.right;else if(i.left>e)n=e-i.left;this._performanceModel.setWindow({left:i.left+n,right:i.right+n},true)}_handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0];if(i.kind==="string"){const t=e.getData("text/uri-list");if(new Common.ParsedURL(t).isValid)this._loadFromURL(t)}else if(i.kind==="file"){const e=t[0].webkitGetAsEntry();if(!e.isFile)return;e.file(this._loadFromFile.bind(this))}}};Timeline.TimelinePanel.State={Idle:Symbol("Idle"),StartPending:Symbol("StartPending"),Recording:Symbol("Recording"),StopPending:Symbol("StopPending"),Loading:Symbol("Loading")};Timeline.TimelinePanel.ViewMode={FlameChart:"FlameChart",BottomUp:"BottomUp",CallTree:"CallTree",EventLog:"EventLog"};Timeline.TimelinePanel.rowHeight=18;Timeline.TimelinePanel.headerHeight=20;Timeline.TimelinePanel.ModelSelectionData;Timeline.TimelineSelection=class{constructor(e,t,i,n){this._type=e;this._startTime=t;this._endTime=i;this._object=n||null}static fromFrame(e){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.Frame,e.startTime,e.endTime,e)}static fromNetworkRequest(e){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.NetworkRequest,e.startTime,e.endTime||e.startTime,e)}static fromTraceEvent(e){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.TraceEvent,e.startTime,e.endTime||e.startTime+1,e)}static fromRange(e,t){return new Timeline.TimelineSelection(Timeline.TimelineSelection.Type.Range,e,t)}type(){return this._type}object(){return this._object}startTime(){return this._startTime}endTime(){return this._endTime}};Timeline.TimelineSelection.Type={Frame:"Frame",NetworkRequest:"NetworkRequest",TraceEvent:"TraceEvent",Range:"Range"};Timeline.TimelineModeViewDelegate=function(){};Timeline.TimelineModeViewDelegate.prototype={select(e){},selectEntryAtTime(e,t){},highlightEvent(e){}};Timeline.TimelinePanel.StatusPane=class extends UI.VBox{constructor(e,t){super(true);this.registerRequiredCSS("timeline/timelineStatusDialog.css");this.contentElement.classList.add("timeline-status-dialog");const i=this.contentElement.createChild("div","status-dialog-line status");i.createChild("div","label").textContent=Common.UIString("Status");this._status=i.createChild("div","content");if(e){const e=this.contentElement.createChild("div","status-dialog-line time");e.createChild("div","label").textContent=Common.UIString("Time");this._time=e.createChild("div","content")}const n=this.contentElement.createChild("div","status-dialog-line progress");this._progressLabel=n.createChild("div","label");this._progressBar=n.createChild("div","indicator-container").createChild("div","indicator");this._stopButton=UI.createTextButton(Common.UIString("Stop"),t,"",true);this.contentElement.createChild("div","stop-button").appendChild(this._stopButton)}finish(){this._stopTimer();this._stopButton.disabled=true}hide(){this.element.parentNode.classList.remove("tinted");this.element.remove()}showPane(e){this.show(e);e.classList.add("tinted");this._stopButton.focus()}updateStatus(e){this._status.textContent=e}updateProgressBar(e,t){this._progressLabel.textContent=e;this._progressBar.style.width=t.toFixed(1)+"%";this._updateTimer()}startTimer(){this._startTime=Date.now();this._timeUpdateTimer=setInterval(this._updateTimer.bind(this,false),1e3);this._updateTimer()}_stopTimer(){if(!this._timeUpdateTimer)return;clearInterval(this._timeUpdateTimer);this._updateTimer(true);delete this._timeUpdateTimer}_updateTimer(e){if(!this._timeUpdateTimer)return;const t=(Date.now()-this._startTime)/1e3;this._time.textContent=Common.UIString("%s sec",t.toFixed(e?1:0))}};Timeline.LoadTimelineHandler=class{handleQueryParam(e){UI.viewManager.showView("timeline").then(()=>{Timeline.TimelinePanel.instance()._loadFromURL(window.decodeURIComponent(e))})}};Timeline.TimelinePanel.ActionDelegate=class{handleAction(e,t){const i=UI.context.flavor(Timeline.TimelinePanel);console.assert(i&&i instanceof Timeline.TimelinePanel);switch(t){case"timeline.toggle-recording":i._toggleRecording();return true;case"timeline.record-reload":i._recordReload();return true;case"timeline.save-to-file":i._saveToFile();return true;case"timeline.load-from-file":i._selectFileToLoad();return true;case"timeline.jump-to-previous-frame":i._jumpToFrame(-1);return true;case"timeline.jump-to-next-frame":i._jumpToFrame(1);return true;case"timeline.show-history":i._showHistory();return true;case"timeline.previous-recording":i._navigateHistory(1);return true;case"timeline.next-recording":i._navigateHistory(-1);return true}return false}};Timeline.TimelinePanel._traceProviderSettingSymbol=Symbol("traceProviderSetting");Runtime.cachedResources["timeline/historyToolbarButton.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.history-dropdown-button {\n  width: 160px;\n  height: 26px;\n  text-align: left;\n  display: flex;\n}\n\n.history-dropdown-button[disabled] {\n  opacity: .5;\n}\n\n.history-dropdown-button > .content {\n  padding-right: 5px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  flex: 1 1;\n  min-width: 35px;\n}\n";Runtime.cachedResources["timeline/invalidationsTree.css"]="/*\n * Copyright 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.header, .children, .content {\n    min-height: initial;\n    line-height: initial;\n}\n\n/* This TreeElement is always expanded and has no arrow.   */\n/* FIXME(crbug.com/475618): Implement this in TreeElement. */\n.children li::before {\n    display: none;\n}\n\n.content {\n    margin-bottom: 4px;\n}\n\n.content .stack-preview-container {\n    margin-left: 8px;\n}\n\n.content .node-list {\n    margin-left: 10px;\n}\n";Runtime.cachedResources["timeline/timelineFlamechartPopover.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.timeline-flamechart-popover {\n    overflow: hidden;\n}\n\n.timeline-flamechart-popover span {\n    margin-right: 5px;\n}\n\n.timeline-flamechart-popover span.timeline-info-network-time {\n    color: #009;\n}\n\n.timeline-flamechart-popover span.timeline-info-time {\n    color: #282;\n}\n\n.timeline-flamechart-popover span.timeline-info-warning {\n    color: #e44;\n}\n\n.timeline-flamechart-popover span.timeline-info-warning * {\n    color: inherit;\n}\n";Runtime.cachedResources["timeline/timelineHistoryManager.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.drop-down {\n  padding: 1px;\n  box-shadow: var(--drop-shadow);\n  background: white;\n}\n\n.preview-item {\n  border-color: transparent;\n  border-style: solid;\n  border-width: 1px 5px;\n  padding: 2px 0px;\n  margin: 2px 1px;\n}\n\n.preview-item.selected {\n  border-color: var(--selection-bg-color);\n}\n\n.preview-item canvas {\n  width: 100%;\n  height: 100%;\n}\n\n.text-details {\n  font-size: 11px;\n  padding: 3px;\n}\n\n.text-details span {\n  flex: 1 0;\n  padding-left: 8px;\n  padding-right: 8px;\n}\n\n.text-details .name {\n  font-weight: bold;\n}\n\n.text-details span.time {\n  color: #555;\n  text-align: right;\n}\n\n.screenshot-thumb {\n  display: flex;\n  border: 1px solid #ccc;\n  margin: 2px 4px;\n}\n\n.screenshot-thumb img {\n  margin: auto;\n  max-width: 100%;\n  max-height: 100%;\n}\n";Runtime.cachedResources["timeline/timelinePanel.css"]='/*\n * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.\n * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n *\n * 1.  Redistributions of source code must retain the above copyright\n *     notice, this list of conditions and the following disclaimer.\n * 2.  Redistributions in binary form must reproduce the above copyright\n *     notice, this list of conditions and the following disclaimer in the\n *     documentation and/or other materials provided with the distribution.\n * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of\n *     its contributors may be used to endorse or promote products derived\n *     from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY\n * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF\n * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n.timeline-toolbar-container {\n    display: flex;\n    flex: none;\n}\n\n.timeline-toolbar-container > .toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.timeline-main-toolbar {\n    flex: 1 1 auto;\n}\n\n.timeline-settings-pane {\n    flex: none;\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n#timeline-overview-panel {\n    flex: none;\n    position: relative;\n    border-bottom: 1px solid #bbb;\n}\n\n#timeline-overview-grid {\n    background-color: rgb(255, 255, 255);\n}\n\n#timeline-overview-grid .timeline-grid-header {\n    height: 12px;\n}\n\n#timeline-overview-grid .resources-dividers-label-bar {\n    pointer-events: auto;\n    height: 12px;\n}\n\n#timeline-overview-grid .resources-divider-label {\n    top: 1px;\n}\n\n.timeline-details-split {\n    flex: auto;\n}\n\n.timeline.panel .status-pane-container {\n    z-index: 1000;\n    display: flex;\n    align-items: center;\n    pointer-events: none;\n}\n\n.timeline.panel .status-pane-container.tinted {\n    background-color: lightgray;\n    pointer-events: auto;\n}\n\n.timeline.panel .status-pane-container > div {\n    pointer-events: auto;\n}\n\n#timeline-overview-panel .overview-strip {\n    margin-top: 2px;\n    justify-content: center;\n}\n\n#timeline-overview-panel .overview-strip .timeline-overview-strip-title {\n    color: #666;\n    font-size: 10px;\n    font-weight: bold;\n    z-index: 100;\n    background-color: rgba(255, 255, 255, 0.7);\n    padding: 0 4px;\n    position: absolute;\n    top: -2px;\n    right: 0;\n}\n\n#timeline-overview-cpu-activity {\n    flex-basis: 20px;\n}\n\n#timeline-overview-network {\n    flex-basis: 8px;\n}\n\n#timeline-overview-framerate {\n    flex-basis: 16px;\n    margin-top: 0 !important;\n}\n\n#timeline-overview-filmstrip {\n    flex-basis: 30px;\n}\n\n#timeline-overview-memory {\n    flex-basis: 20px;\n}\n\n#timeline-overview-framerate::before,\n#timeline-overview-network::before,\n#timeline-overview-cpu-activity::before {\n    content: "";\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    border-bottom: 1px solid hsla(0, 0%, 0%, 0.06);\n    z-index: -200;\n}\n\n.overview-strip .background {\n    z-index: -10;\n}\n\n#timeline-overview-responsiveness {\n    flex-basis: 5px;\n    margin-top: 0 !important;\n}\n\n#timeline-overview-input {\n    flex-basis: 6px;\n}\n\n#timeline-overview-pane {\n    flex: auto;\n    position: relative;\n    overflow: hidden;\n}\n\n#timeline-overview-container {\n    display: flex;\n    flex-direction: column;\n    flex: none;\n    position: relative;\n    overflow: hidden;\n}\n\n#timeline-overview-container canvas {\n    width: 100%;\n    height: 100%;\n}\n\n.popover ul {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n}\n\n.memory-graph-label {\n    position: absolute;\n    right: 0;\n    bottom: 0;\n    font-size: 9px;\n    color: #888;\n    white-space: nowrap;\n    padding: 0 4px;\n    background-color: hsla(0, 0%, 100%, 0.8);\n}\n\n#memory-graphs-canvas-container {\n    overflow: hidden;\n    flex: auto;\n    position: relative;\n}\n\n#memory-counters-graph {\n    flex: auto;\n}\n\n#memory-graphs-canvas-container .memory-counter-marker {\n    position: absolute;\n    border-radius: 3px;\n    width: 5px;\n    height: 5px;\n    margin-left: -3px;\n    margin-top: -2px;\n}\n\n#memory-graphs-container .timeline-memory-header {\n    flex: 0 0 26px;\n    background-color: #eee;\n    border-bottom: 1px solid #ddd;\n    justify-content: space-between;\n}\n\n#memory-graphs-container .timeline-memory-header::after {\n    content: "";\n    background-image: url(Images/toolbarResizerVertical.png);\n    background-repeat: no-repeat;\n    background-position: right center, center;\n    flex: 20px 0 0;\n    margin: 0 4px;\n}\n\n.timeline-memory-toolbar {\n    flex-shrink: 1;\n}\n\n.memory-counter-value {\n    margin: 8px;\n}\n\n#counter-values-bar {\n    flex: 0 0 20px;\n    border-top: solid 1px lightgray;\n    width: 100%;\n    overflow: hidden;\n    line-height: 18px;\n}\n\n.timeline-details {\n    vertical-align: top;\n}\n\n.timeline-details-title {\n    border-bottom: 1px solid #B8B8B8;\n    font-weight: bold;\n    padding-bottom: 5px;\n    padding-top: 0;\n    white-space: nowrap;\n}\n\n.timeline-details-row-title {\n    font-weight: bold;\n    text-align: right;\n    white-space: nowrap;\n}\n\n.timeline-details-row-data {\n    white-space: nowrap;\n}\n\n.timeline-details-view {\n    color: #333;\n    overflow: hidden;\n}\n\n.timeline-details-view-body {\n    flex: auto;\n    overflow: auto;\n    position: relative;\n    background-color: var(--toolbar-bg-color);\n    -webkit-user-select: text;\n}\n\n.timeline-details-view-body > div {\n    overflow: hidden;\n}\n\n.timeline-details-view-block {\n    flex: none;\n    display: flex;\n    background-color: white;\n    flex-direction: column;\n    padding-bottom: 5px;\n    border-bottom: var(--divider-border);\n}\n\n.timeline-details-view-row {\n    padding-left: 10px;\n    flex-direction: row;\n    display: flex;\n    line-height: 20px;\n}\n\n.timeline-details-view-block .timeline-details-stack-values {\n    flex-direction: column !important;\n}\n\n.timeline-details-chip-title {\n    font-size: 13px;\n    padding: 8px;\n    display: flex;\n    align-items: center;\n}\n\n.timeline-details-chip-title > div {\n    width: 12px;\n    height: 12px;\n    border: 1px solid rgba(0, 0, 0, 0.2);\n    display: inline-block;\n    margin-right: 4px;\n    content: " ";\n}\n\n.timeline-details-view-row-title:not(:empty) {\n    color: rgb(152, 152, 152);\n    overflow: hidden;\n    padding-right: 10px;\n}\n\n.timeline-details-warning {\n    background-color: rgba(250, 209, 209, 0.48);\n}\n\n.timeline-details-warning .timeline-details-view-row-title {\n    color: red;\n}\n\n.timeline-details-warning .timeline-details-view-row-value {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.timeline-details-view-row-value {\n    -webkit-user-select: text;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.timeline-details-view-row-value .stack-preview-container {\n    line-height: 11px;\n}\n\n.timeline-details-view-pie-chart-wrapper {\n    margin: 4px 0;\n}\n\n.timeline-details-view-pie-chart {\n    margin-top: 5px;\n}\n\n.timeline-details-view-row-stack-trace {\n    padding: 4px 0;\n    line-height: inherit;\n}\n\n.timeline-details-view-row-stack-trace div {\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    line-height: 12px;\n}\n\n.timeline-flamechart {\n    overflow: hidden;\n}\n\n.timeline-flamechart-resizer {\n    flex: 8px 0 0;\n    background-color: var(--toolbar-bg-color);\n    border: 1px #a3a3a3;\n    border-style: solid none;\n    display: flex;\n    flex-direction: row;\n    align-items: flex-end;\n    justify-content: center;\n}\n\n.timeline-network-resizer-disabled > .timeline-flamechart-resizer {\n    display: none;\n}\n\n.timeline-flamechart-resizer:after {\n    content: "...";\n    font-size: 14px;\n    margin-bottom: -1px;\n}\n\n.timeline-layers-view > div:last-child,\n.timeline-layers-view-properties > div:last-child {\n    background-color: #eee;\n}\n\n.timeline-layers-view-properties table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.timeline-layers-view-properties td {\n    border: 1px solid #e1e1e1;\n    line-height: 22px;\n}\n\n.timeline-paint-profiler-log-split > div:last-child {\n    background-color: #eee;\n    z-index: 0;\n}\n\n.timeline-filmstrip-preview > img {\n    margin-top: 5px;\n    max-width: 500px;\n    max-height: 300px;\n    cursor: pointer;\n    border: 1px solid #ddd;\n}\n\n.timeline-tree-view {\n    display: flex;\n    overflow: hidden;\n}\n\n.timeline-tree-view .toolbar {\n    background-color: var(--toolbar-bg-color);\n    border-bottom: var(--divider-border);\n}\n\n.timeline-tree-view .data-grid {\n    border: none;\n    flex: auto;\n}\n\n.timeline-tree-view .data-grid .data-container {\n    overflow-y: scroll;\n}\n\n.timeline-tree-view .data-grid.data-grid-fits-viewport .corner {\n    display: table-cell;\n}\n\n.timeline-tree-view .data-grid table.data {\n    background: white;\n}\n\n.timeline-tree-view .data-grid tr:not(.selected) .highlight {\n    background-color: rgb(255, 230, 179);\n}\n\n.timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td) {\n    background-color: rgba(0, 0, 0, 0.1);\n}\n\n.timeline-tree-view .data-grid td.numeric-column {\n    text-align: right;\n    position: relative;\n}\n\n.timeline-tree-view .data-grid div.background-percent-bar {\n    float: right;\n}\n\n.timeline-tree-view .data-grid span.percent-column {\n    color: #888;\n    width: 45px;\n    display: inline-block;\n}\n\n.timeline-tree-view .data-grid tr.selected span {\n    color: inherit;\n}\n\n.timeline-tree-view .data-grid .name-container {\n    display: flex;\n    align-items: center;\n    padding-left: 2px;\n}\n\n.timeline-tree-view .data-grid .name-container div {\n    flex: none;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-icon {\n    width: 12px;\n    height: 12px;\n    border: 1px solid rgba(0, 0, 0, 0.05);\n    margin: 3px 0;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-icon-container {\n    margin-right: 3px;\n    display: flex;\n    flex-wrap: wrap;\n    align-items: center;\n    justify-content: center;\n    width: 18px;\n    height: 18px;\n    overflow: hidden;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-warning::after {\n    content: "[deopt]";\n    margin: 0 4px;\n    line-height: 12px;\n    font-size: 10px;\n    color: #777;\n}\n\n.timeline-tree-view .data-grid tr.selected .name-container .activity-warning::after {\n    color: white;\n}\n\n.timeline-tree-view .data-grid .name-container .activity-link {\n    flex: auto;\n    text-align: right;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    margin-left: 5px;\n}\n\n.timeline-tree-view .data-grid .background-bar-container {\n    position: absolute;\n    left: 3px;\n    right: 0;\n}\n\n.timeline-tree-view .data-grid .background-bar {\n    float: right;\n    height: 18px;\n    background-color: hsla(43, 84%, 64%, 0.2);\n    border-bottom: 1px solid hsl(43, 84%, 64%);\n}\n\n.timeline-tree-view .data-grid .selected .background-bar {\n    background-color: rgba(255, 255, 255, 0.3);\n    border-bottom-color: rgba(255, 255, 255, 0.9);\n}\n\n.timeline-tree-view .timeline-details-view-body .full-widget-dimmed-banner {\n    background-color: inherit;\n}\n\n.timeline-details .filter-input-field {\n    width: 120px;\n}\n\n.timeline-tree-view .data-grid .header-container {\n    height: 21px;\n}\n\n.timeline-tree-view .data-grid .data-container {\n    top: 21px;\n}\n\n.timeline-stack-view-header {\n    height: 27px;\n    background-color: var(--toolbar-bg-color);\n    padding: 6px 10px;\n    color: #5a5a5a;\n    white-space: nowrap;\n    border-bottom: var(--divider-border);\n}\n\n.timeline-landing-page {\n    position: absolute;\n    background-color: white;\n    justify-content: center;\n    align-items: center;\n    overflow: auto;\n    font-size: 13px;\n    color: #777;\n}\n\n.timeline-landing-page > div {\n    max-width: 450px;\n    margin: 10px;\n}\n\n.timeline-landing-page > div > p {\n    flex: none;\n    white-space: pre-line;\n}\n';Runtime.cachedResources["timeline/timelinePaintProfiler.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.paint-profiler-image-view {\n    overflow: hidden;\n}\n\n.paint-profiler-image-view .paint-profiler-image-container {\n    -webkit-transform-origin: 0 0;\n}\n\n.paint-profiler-image-view .paint-profiler-image-container div {\n    border-color: rgba(100, 100, 100, 0.4);\n    border-style: solid;\n    z-index: 100;\n    position: absolute;\n    top: 0;\n    left: 0;\n}\n\n.paint-profiler-image-view img {\n    border: solid 1px black;\n}\n";Runtime.cachedResources["timeline/timelineStatusDialog.css"]="/*\n * Copyright (c) 2015 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.timeline-status-dialog {\n    display: flex;\n    flex-direction: column;\n    padding: 16px 16px 12px 16px;\n    align-self: center;\n    background-color: white;\n    box-shadow: var(--drop-shadow);\n}\n\n.status-dialog-line {\n    margin: 2px;\n    height: 14px;\n    display: flex;\n    align-items: baseline;\n}\n\n.status-dialog-line .label {\n    display: inline-block;\n    width: 80px;\n    text-align: right;\n    color: #aaa;\n    margin-right: 10px;\n}\n\n.timeline-status-dialog .progress .indicator-container {\n    display: inline-block;\n    width: 200px;\n    height: 8px;\n    background-color: #f4f4f4;\n    display: inline-block;\n}\n\n.timeline-status-dialog .progress .indicator {\n    background-color: rgb(112, 166, 255);\n    height: 100%;\n    width: 0;\n    margin: 0;\n}\n\n.timeline-status-dialog .stop-button {\n    margin-top: 8px;\n    height: 100%;\n    align-self: flex-end;\n}\n\n.timeline-status-dialog .stop-button button {\n    min-width: 80px;\n}\n";