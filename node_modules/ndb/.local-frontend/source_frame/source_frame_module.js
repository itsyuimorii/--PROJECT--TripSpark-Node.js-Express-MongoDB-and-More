self["SourceFrame"]=self["SourceFrame"]||{};SourceFrame.BinaryResourceViewFactory=class{constructor(e,t,i){this._base64content=e;this._contentUrl=t;this._resourceType=i;this._arrayPromise=null;this._hexPromise=null;this._utf8Promise=null}async _fetchContentAsArray(){if(!this._arrayPromise){this._arrayPromise=new Promise(async e=>{const t=await fetch("data:;base64,"+this._base64content);e(new Uint8Array(await t.arrayBuffer()))})}return await this._arrayPromise}async hex(){if(!this._hexPromise){this._hexPromise=new Promise(async e=>{const t=await this._fetchContentAsArray();const i=SourceFrame.BinaryResourceViewFactory.uint8ArrayToHexString(t);e(i)})}return this._hexPromise}async base64(){return this._base64content}async utf8(){if(!this._utf8Promise){this._utf8Promise=new Promise(async e=>{const t=await this._fetchContentAsArray();const i=new TextDecoder("utf8").decode(t);e(i)})}return this._utf8Promise}createBase64View(){return new SourceFrame.ResourceSourceFrame(Common.StaticContentProvider.fromString(this._contentUrl,this._resourceType,this._base64content),false,{lineNumbers:false,lineWrapping:true})}createHexView(){const e=new Common.StaticContentProvider(this._contentUrl,this._resourceType,async()=>SourceFrame.BinaryResourceViewFactory.uint8ArrayToHexViewer(await this._fetchContentAsArray()));return new SourceFrame.ResourceSourceFrame(e,false,{lineNumbers:false,lineWrapping:false})}createUtf8View(){const e=this.utf8.bind(this);const t=new Common.StaticContentProvider(this._contentUrl,this._resourceType,e);return new SourceFrame.ResourceSourceFrame(t,false,{lineNumbers:true,lineWrapping:true})}static uint8ArrayToHexString(e){let t="";for(let i=0;i<e.length;i++)t+=SourceFrame.BinaryResourceViewFactory.numberToHex(e[i],2);return t}static numberToHex(e,t){let i=e.toString(16);while(i.length<t)i="0"+i;return i}static uint8ArrayToHexViewer(e){let t="";let i=0;while(i*16<e.length){const r=e.slice(i*16,(i+1)*16);t+=SourceFrame.BinaryResourceViewFactory.numberToHex(i,8)+":";let s=0;for(let e=0;e<r.length;e++){if(e%2===0){t+=" ";s++}t+=SourceFrame.BinaryResourceViewFactory.numberToHex(r[e],2);s+=2}while(s<42){t+=" ";s++}for(let e=0;e<r.length;e++){const i=r[e];if(i>=32&&i<=126){t+=String.fromCharCode(i)}else{t+="."}}t+="\n";i++}return t}};SourceFrame.SourcesTextEditor=class extends TextEditor.CodeMirrorTextEditor{constructor(e,t){const i={lineNumbers:true,lineWrapping:false,bracketMatchingSetting:Common.moduleSetting("textEditorBracketMatching"),padBottom:true};if(t)Object.assign(i,t);super(i);this.codeMirror().addKeyMap({Enter:"smartNewlineAndIndent",Esc:"sourcesDismiss"});this._delegate=e;this.codeMirror().on("cursorActivity",this._cursorActivity.bind(this));this.codeMirror().on("gutterClick",this._gutterClick.bind(this));this.codeMirror().on("scroll",this._scroll.bind(this));this.codeMirror().on("focus",this._focus.bind(this));this.codeMirror().on("blur",this._blur.bind(this));this.codeMirror().on("beforeSelectionChange",this._fireBeforeSelectionChanged.bind(this));this.element.addEventListener("contextmenu",this._contextMenu.bind(this),false);this._gutterMouseMove=(e=>{this.element.classList.toggle("CodeMirror-gutter-hovered",e.clientX<this.codeMirror().getGutterElement().getBoundingClientRect().right)});this._gutterMouseOut=(e=>{this.element.classList.toggle("CodeMirror-gutter-hovered",false)});this.codeMirror().addKeyMap(SourceFrame.SourcesTextEditor._BlockIndentController);this._tokenHighlighter=new SourceFrame.SourcesTextEditor.TokenHighlighter(this,this.codeMirror());this._gutters=["CodeMirror-linenumbers"];this.codeMirror().setOption("gutters",this._gutters.slice());this.codeMirror().setOption("electricChars",false);this.codeMirror().setOption("smartIndent",false);function r(e){this._isHandlingMouseDownEvent=e}this.element.addEventListener("mousedown",r.bind(this,true),true);this.element.addEventListener("mousedown",r.bind(this,false),false);Common.moduleSetting("textEditorIndent").addChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting("textEditorAutoDetectIndent").addChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting("showWhitespacesInEditor").addChangeListener(this._updateWhitespace,this);Common.moduleSetting("textEditorCodeFolding").addChangeListener(this._updateCodeFolding,this);this._updateCodeFolding();this._autocompleteConfig={isWordChar:TextUtils.TextUtils.isWordChar};Common.moduleSetting("textEditorAutocompletion").addChangeListener(this._updateAutocomplete,this);this._updateAutocomplete();this._onUpdateEditorIndentation();this._setupWhitespaceHighlight()}attachInfobar(e){this.element.insertBefore(e.element,this.element.firstChild);e.setParentView(this);this.doResize()}static _guessIndentationLevel(e){const t=/^\t+/;let i=0;const r={};for(let s=0;s<e.length;++s){const n=e[s];if(n.length===0||!TextUtils.TextUtils.isSpaceChar(n[0]))continue;if(t.test(n)){++i;continue}let o=0;while(o<n.length&&TextUtils.TextUtils.isSpaceChar(n[o]))++o;if(o%2!==0)continue;r[o]=1+(r[o]||0)}const s=3*e.length/100;if(i&&i>s)return"\t";let n=Infinity;for(const e in r){if(r[e]<s)continue;const t=parseInt(e,10);if(n>t)n=t}if(n===Infinity)return Common.moduleSetting("textEditorIndent").get();return" ".repeat(n)}_isSearchActive(){return!!this._tokenHighlighter.highlightedRegex()}scrollToLine(e){super.scrollToLine(e);this._scroll()}highlightSearchResults(e,t){function i(){if(t){this.scrollLineIntoView(t.startLine);if(t.endColumn>TextEditor.CodeMirrorTextEditor.maxHighlightLength)this.setSelection(t);else this.setSelection(TextUtils.TextRange.createFromLocation(t.startLine,t.startColumn))}this._tokenHighlighter.highlightSearchResults(e,t)}if(!this._selectionBeforeSearch)this._selectionBeforeSearch=this.selection();this.codeMirror().operation(i.bind(this))}cancelSearchResultsHighlight(){this.codeMirror().operation(this._tokenHighlighter.highlightSelectedTokens.bind(this._tokenHighlighter));if(this._selectionBeforeSearch){this._reportJump(this._selectionBeforeSearch,this.selection());delete this._selectionBeforeSearch}}removeHighlight(e){e.clear()}highlightRange(e,t){t="CodeMirror-persist-highlight "+t;const i=TextEditor.CodeMirrorUtils.toPos(e);++i.end.ch;return this.codeMirror().markText(i.start,i.end,{className:t,startStyle:t+"-start",endStyle:t+"-end"})}installGutter(e,t){if(this._gutters.indexOf(e)!==-1)return;if(t)this._gutters.unshift(e);else this._gutters.push(e);this.codeMirror().setOption("gutters",this._gutters.slice());this.refresh()}uninstallGutter(e){const t=this._gutters.indexOf(e);if(t===-1)return;this.codeMirror().clearGutter(e);this._gutters.splice(t,1);this.codeMirror().setOption("gutters",this._gutters.slice());this.refresh()}setGutterDecoration(e,t,i){console.assert(this._gutters.indexOf(t)!==-1,"Cannot decorate unexisting gutter.");this.codeMirror().setGutterMarker(e,t,i)}setExecutionLocation(e,t){this.clearPositionHighlight();this._executionLine=this.codeMirror().getLineHandle(e);if(!this._executionLine)return;this.showExecutionLineBackground();this.codeMirror().addLineClass(this._executionLine,"wrap","cm-execution-line-outline");let i=this.tokenAtTextPosition(e,t);if(i&&!i.type&&i.startColumn+1===i.endColumn){const t=this.codeMirror().getLine(e)[i.startColumn];if(t==="."||t==="(")i=this.tokenAtTextPosition(e,i.endColumn+1)}let r;if(i&&i.type)r=i.endColumn;else r=this.codeMirror().getLine(e).length;this._executionLineTailMarker=this.codeMirror().markText({line:e,ch:t},{line:e,ch:r},{className:"cm-execution-line-tail"})}showExecutionLineBackground(){if(this._executionLine)this.codeMirror().addLineClass(this._executionLine,"wrap","cm-execution-line")}hideExecutionLineBackground(){if(this._executionLine)this.codeMirror().removeLineClass(this._executionLine,"wrap","cm-execution-line")}clearExecutionLine(){this.clearPositionHighlight();if(this._executionLine){this.hideExecutionLineBackground();this.codeMirror().removeLineClass(this._executionLine,"wrap","cm-execution-line-outline")}delete this._executionLine;if(this._executionLineTailMarker)this._executionLineTailMarker.clear();delete this._executionLineTailMarker}toggleLineClass(e,t,i){if(this.hasLineClass(e,t)===i)return;const r=this.codeMirror().getLineHandle(e);if(!r)return;if(i){this.codeMirror().addLineClass(r,"gutter",t);this.codeMirror().addLineClass(r,"wrap",t)}else{this.codeMirror().removeLineClass(r,"gutter",t);this.codeMirror().removeLineClass(r,"wrap",t)}}hasLineClass(e,t){const i=this.codeMirror().lineInfo(e);const r=i.wrapClass||"";const s=r.split(" ");return s.indexOf(t)!==-1}_gutterClick(e,t,i,r){if(i!=="CodeMirror-linenumbers")return;this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.GutterClick,{lineNumber:t,event:r})}_contextMenu(e){const t=new UI.ContextMenu(e);e.consume(true);const i=e.target.enclosingNodeOrSelfWithClass("CodeMirror-gutter-wrapper");const r=i?i.querySelector(".CodeMirror-linenumber"):null;let s;if(r){s=this._delegate.populateLineGutterContextMenu(t,parseInt(r.textContent,10)-1)}else{const e=this.selection();s=this._delegate.populateTextAreaContextMenu(t,e.startLine,e.startColumn)}s.then(n.bind(this));function n(){t.appendApplicableItems(this);t.show()}}editRange(e,t,i){const r=super.editRange(e,t,i);if(Common.moduleSetting("textEditorAutoDetectIndent").get())this._onUpdateEditorIndentation();return r}_onUpdateEditorIndentation(){this._setEditorIndentation(TextEditor.CodeMirrorUtils.pullLines(this.codeMirror(),SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing))}_setEditorIndentation(e){const t={};let i=Common.moduleSetting("textEditorIndent").get();if(Common.moduleSetting("textEditorAutoDetectIndent").get())i=SourceFrame.SourcesTextEditor._guessIndentationLevel(e);if(i===TextUtils.TextUtils.Indent.TabCharacter){this.codeMirror().setOption("indentWithTabs",true);this.codeMirror().setOption("indentUnit",4)}else{this.codeMirror().setOption("indentWithTabs",false);this.codeMirror().setOption("indentUnit",i.length);t.Tab=function(e){if(e.somethingSelected())return CodeMirror.Pass;const t=e.getCursor("head");e.replaceRange(i.substring(t.ch%i.length),e.getCursor())}}this.codeMirror().setOption("extraKeys",t);this._indentationLevel=i}indent(){return this._indentationLevel}_onAutoAppendedSpaces(){this._autoAppendedSpaces=this._autoAppendedSpaces||[];for(let e=0;e<this._autoAppendedSpaces.length;++e){const t=this._autoAppendedSpaces[e].resolve();if(!t)continue;const i=this.line(t.lineNumber);if(i.length===t.columnNumber&&TextUtils.TextUtils.lineIndent(i).length===i.length){this.codeMirror().replaceRange("",new CodeMirror.Pos(t.lineNumber,0),new CodeMirror.Pos(t.lineNumber,t.columnNumber))}}this._autoAppendedSpaces=[];const e=this.selections();for(let t=0;t<e.length;++t){const i=e[t];this._autoAppendedSpaces.push(this.textEditorPositionHandle(i.startLine,i.startColumn))}}_cursorActivity(){if(!this._isSearchActive())this.codeMirror().operation(this._tokenHighlighter.highlightSelectedTokens.bind(this._tokenHighlighter));const e=this.codeMirror().getCursor("anchor");const t=this.codeMirror().getCursor("head");this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.SelectionChanged,TextEditor.CodeMirrorUtils.toRange(e,t))}_reportJump(e,t){if(e&&t&&e.equal(t))return;this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.JumpHappened,{from:e,to:t})}_scroll(){const e=this.codeMirror().lineAtHeight(this.codeMirror().getScrollInfo().top,"local");this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.ScrollChanged,e)}_focus(){this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.EditorFocused)}_blur(){this.dispatchEventToListeners(SourceFrame.SourcesTextEditor.Events.EditorBlurred)}_fireBeforeSelectionChanged(e,t){if(!this._isHandlingMouseDownEvent)return;if(!t.ranges.length)return;const i=t.ranges[0];this._reportJump(this.selection(),TextEditor.CodeMirrorUtils.toRange(i.anchor,i.head))}dispose(){super.dispose();Common.moduleSetting("textEditorIndent").removeChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting("textEditorAutoDetectIndent").removeChangeListener(this._onUpdateEditorIndentation,this);Common.moduleSetting("showWhitespacesInEditor").removeChangeListener(this._updateWhitespace,this);Common.moduleSetting("textEditorCodeFolding").removeChangeListener(this._updateCodeFolding,this)}setText(e){this._setEditorIndentation(e.split("\n").slice(0,SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing));super.setText(e)}_updateWhitespace(){this.setMimeType(this.mimeType())}_updateCodeFolding(){if(Common.moduleSetting("textEditorCodeFolding").get()){this.installGutter("CodeMirror-foldgutter",false);this.element.addEventListener("mousemove",this._gutterMouseMove);this.element.addEventListener("mouseout",this._gutterMouseOut);this.codeMirror().setOption("foldGutter",true);this.codeMirror().setOption("foldOptions",{minFoldSize:1})}else{this.codeMirror().execCommand("unfoldAll");this.element.removeEventListener("mousemove",this._gutterMouseMove);this.element.removeEventListener("mouseout",this._gutterMouseOut);this.uninstallGutter("CodeMirror-foldgutter");this.codeMirror().setOption("foldGutter",false)}}rewriteMimeType(e){this._setupWhitespaceHighlight();const t=Common.moduleSetting("showWhitespacesInEditor").get();this.element.classList.toggle("show-whitespaces",t==="all");if(t==="all")return this._allWhitespaceOverlayMode(e);else if(t==="trailing")return this._trailingWhitespaceOverlayMode(e);return e}_allWhitespaceOverlayMode(e){let t=CodeMirror.mimeModes[e]?CodeMirror.mimeModes[e].name||CodeMirror.mimeModes[e]:CodeMirror.mimeModes["text/plain"];t+="+all-whitespaces";if(CodeMirror.modes[t])return t;function i(t,i){function r(e){if(e.peek()===" "){let t=0;while(t<SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan&&e.peek()===" "){++t;e.next()}return"whitespace whitespace-"+t}while(!e.eol()&&e.peek()!==" ")e.next();return null}const s={token:r};return CodeMirror.overlayMode(CodeMirror.getMode(t,e),s,false)}CodeMirror.defineMode(t,i);return t}_trailingWhitespaceOverlayMode(e){let t=CodeMirror.mimeModes[e]?CodeMirror.mimeModes[e].name||CodeMirror.mimeModes[e]:CodeMirror.mimeModes["text/plain"];t+="+trailing-whitespaces";if(CodeMirror.modes[t])return t;function i(t,i){function r(e){if(e.match(/^\s+$/,true))return true?"trailing-whitespace":null;do{e.next()}while(!e.eol()&&e.peek()!==" ");return null}const s={token:r};return CodeMirror.overlayMode(CodeMirror.getMode(t,e),s,false)}CodeMirror.defineMode(t,i);return t}_setupWhitespaceHighlight(){const e=this.element.ownerDocument;if(e._codeMirrorWhitespaceStyleInjected||!Common.moduleSetting("showWhitespacesInEditor").get())return;e._codeMirrorWhitespaceStyleInjected=true;const t=".show-whitespaces .CodeMirror .cm-whitespace-";const i="·";let r="";let s="";for(let e=1;e<=SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan;++e){r+=i;const n=t+e+"::before { content: '"+r+"';}\n";s+=n}const n=e.createElement("style");n.textContent=s;e.head.appendChild(n)}configureAutocomplete(e){this._autocompleteConfig=e;this._updateAutocomplete()}_updateAutocomplete(){super.configureAutocomplete(Common.moduleSetting("textEditorAutocompletion").get()?this._autocompleteConfig:null)}};SourceFrame.SourcesTextEditor.GutterClickEventData;SourceFrame.SourcesTextEditor.Events={GutterClick:Symbol("GutterClick"),SelectionChanged:Symbol("SelectionChanged"),ScrollChanged:Symbol("ScrollChanged"),EditorFocused:Symbol("EditorFocused"),EditorBlurred:Symbol("EditorBlurred"),JumpHappened:Symbol("JumpHappened")};SourceFrame.SourcesTextEditorDelegate=function(){};SourceFrame.SourcesTextEditorDelegate.prototype={populateLineGutterContextMenu(e,t){},populateTextAreaContextMenu(e,t,i){}};CodeMirror.commands.smartNewlineAndIndent=function(e){e.operation(t.bind(null,e));function t(e){const t=e.listSelections();const i=[];for(let r=0;r<t.length;++r){const s=t[r];const n=CodeMirror.cmpPos(s.head,s.anchor)<0?s.head:s.anchor;const o=e.getLine(n.line);const h=TextUtils.TextUtils.lineIndent(o);i.push("\n"+h.substring(0,Math.min(n.ch,h.length)))}e.replaceSelections(i);e._codeMirrorTextEditor._onAutoAppendedSpaces()}};CodeMirror.commands.sourcesDismiss=function(e){if(e.listSelections().length===1&&e._codeMirrorTextEditor._isSearchActive())return CodeMirror.Pass;return CodeMirror.commands.dismiss(e)};SourceFrame.SourcesTextEditor._BlockIndentController={name:"blockIndentKeymap",Enter:function(e){let t=e.listSelections();const i=[];let r=false;for(let s=0;s<t.length;++s){const n=t[s];const o=CodeMirror.cmpPos(n.head,n.anchor)<0?n.head:n.anchor;const h=e.getLine(o.line);const a=TextUtils.TextUtils.lineIndent(h);let l="\n"+a+e._codeMirrorTextEditor.indent();let c=false;if(n.head.ch===0)return CodeMirror.Pass;if(h.substr(n.head.ch-1,2)==="{}"){l+="\n"+a;c=true}else if(h.substr(n.head.ch-1,1)!=="{"){return CodeMirror.Pass}if(s>0&&r!==c)return CodeMirror.Pass;i.push(l);r=c}e.replaceSelections(i);if(!r){e._codeMirrorTextEditor._onAutoAppendedSpaces();return}t=e.listSelections();const s=[];for(let i=0;i<t.length;++i){const r=t[i];const n=e.getLine(r.head.line-1);const o=new CodeMirror.Pos(r.head.line-1,n.length);s.push({head:o,anchor:o})}e.setSelections(s);e._codeMirrorTextEditor._onAutoAppendedSpaces()},"'}'":function(e){if(e.somethingSelected())return CodeMirror.Pass;let t=e.listSelections();let i=[];for(let r=0;r<t.length;++r){const s=t[r];const n=e.getLine(s.head.line);if(n!==TextUtils.TextUtils.lineIndent(n))return CodeMirror.Pass;i.push("}")}e.replaceSelections(i);t=e.listSelections();i=[];const r=[];for(let s=0;s<t.length;++s){const n=t[s];const o=e.findMatchingBracket(n.head);if(!o||!o.match)return;r.push({head:n.head,anchor:new CodeMirror.Pos(n.head.line,0)});const h=e.getLine(o.to.line);const a=TextUtils.TextUtils.lineIndent(h);i.push(a+"}")}e.setSelections(r);e.replaceSelections(i)}};SourceFrame.SourcesTextEditor.TokenHighlighter=class{constructor(e,t){this._textEditor=e;this._codeMirror=t}highlightSearchResults(e,t){const i=this._highlightRegex;this._highlightRegex=e;this._highlightRange=t;if(this._searchResultMarker){this._searchResultMarker.clear();delete this._searchResultMarker}if(this._highlightDescriptor&&this._highlightDescriptor.selectionStart)this._codeMirror.removeLineClass(this._highlightDescriptor.selectionStart.line,"wrap","cm-line-with-selection");const r=this._highlightRange?new CodeMirror.Pos(this._highlightRange.startLine,this._highlightRange.startColumn):null;if(r)this._codeMirror.addLineClass(r.line,"wrap","cm-line-with-selection");if(i&&this._highlightRegex.toString()===i.toString()){if(this._highlightDescriptor)this._highlightDescriptor.selectionStart=r}else{this._removeHighlight();this._setHighlighter(this._searchHighlighter.bind(this,this._highlightRegex),r)}if(this._highlightRange){const e=TextEditor.CodeMirrorUtils.toPos(this._highlightRange);this._searchResultMarker=this._codeMirror.markText(e.start,e.end,{className:"cm-column-with-selection"})}}highlightedRegex(){return this._highlightRegex}highlightSelectedTokens(){delete this._highlightRegex;delete this._highlightRange;if(this._highlightDescriptor&&this._highlightDescriptor.selectionStart)this._codeMirror.removeLineClass(this._highlightDescriptor.selectionStart.line,"wrap","cm-line-with-selection");this._removeHighlight();const e=this._codeMirror.getCursor("start");const t=this._codeMirror.getCursor("end");if(e.line!==t.line)return;if(e.ch===t.ch)return;const i=this._codeMirror.getSelections();if(i.length>1)return;const r=i[0];if(this._isWord(r,e.line,e.ch,t.ch)){if(e)this._codeMirror.addLineClass(e.line,"wrap","cm-line-with-selection");this._setHighlighter(this._tokenHighlighter.bind(this,r,e),e)}}_isWord(e,t,i,r){const s=this._codeMirror.getLine(t);const n=i===0||!TextUtils.TextUtils.isWordChar(s.charAt(i-1));const o=r===s.length||!TextUtils.TextUtils.isWordChar(s.charAt(r));return n&&o&&TextUtils.TextUtils.isWord(e)}_removeHighlight(){if(this._highlightDescriptor){this._codeMirror.removeOverlay(this._highlightDescriptor.overlay);delete this._highlightDescriptor}}_searchHighlighter(e,t){if(t.column()===0)delete this._searchMatchLength;if(this._searchMatchLength){if(this._searchMatchLength>2){for(let e=0;e<this._searchMatchLength-2;++e)t.next();this._searchMatchLength=1;return"search-highlight"}else{t.next();delete this._searchMatchLength;return"search-highlight search-highlight-end"}}const i=t.match(e,false);if(i){t.next();const e=i[0].length;if(e===1)return"search-highlight search-highlight-full";this._searchMatchLength=e;return"search-highlight search-highlight-start"}while(!t.match(e,false)&&t.next()){}}_tokenHighlighter(e,t,i){const r=e.charAt(0);if(i.match(e)&&(i.eol()||!TextUtils.TextUtils.isWordChar(i.peek())))return i.column()===t.ch?"token-highlight column-with-selection":"token-highlight";let s;do{s=i.next()}while(s&&(TextUtils.TextUtils.isWordChar(s)||i.peek()!==r))}_setHighlighter(e,t){const i={token:e};this._codeMirror.addOverlay(i);this._highlightDescriptor={overlay:i,selectionStart:t}}};SourceFrame.SourcesTextEditor.LinesToScanForIndentationGuessing=1e3;SourceFrame.SourcesTextEditor.MaximumNumberOfWhitespacesPerSingleSpan=16;SourceFrame.FontView=class extends UI.SimpleView{constructor(e,t){super(Common.UIString("Font"));this.registerRequiredCSS("source_frame/fontView.css");this.element.classList.add("font-view");this._url=t.contentURL();UI.ARIAUtils.setAccessibleName(this.element,ls`Preview of font from ${this._url}`);this._mimeType=e;this._contentProvider=t;this._mimeTypeLabel=new UI.ToolbarText(e)}syncToolbarItems(){return[this._mimeTypeLabel]}_onFontContentLoaded(e,t){const i=t?Common.ContentProvider.contentAsDataURL(t,this._mimeType,true):this._url;this.fontStyleElement.textContent=String.sprintf('@font-face { font-family: "%s"; src: url(%s); }',e,i)}_createContentIfNeeded(){if(this.fontPreviewElement)return;const e="WebInspectorFontPreview"+ ++SourceFrame.FontView._fontId;this.fontStyleElement=createElement("style");this._contentProvider.requestContent().then(this._onFontContentLoaded.bind(this,e));this.element.appendChild(this.fontStyleElement);const t=createElement("div");for(let e=0;e<SourceFrame.FontView._fontPreviewLines.length;++e){if(e>0)t.createChild("br");t.createTextChild(SourceFrame.FontView._fontPreviewLines[e])}this.fontPreviewElement=t.cloneNode(true);UI.ARIAUtils.markAsHidden(this.fontPreviewElement);this.fontPreviewElement.style.overflow="hidden";this.fontPreviewElement.style.setProperty("font-family",e);this.fontPreviewElement.style.setProperty("visibility","hidden");this._dummyElement=t;this._dummyElement.style.visibility="hidden";this._dummyElement.style.zIndex="-1";this._dummyElement.style.display="inline";this._dummyElement.style.position="absolute";this._dummyElement.style.setProperty("font-family",e);this._dummyElement.style.setProperty("font-size",SourceFrame.FontView._measureFontSize+"px");this.element.appendChild(this.fontPreviewElement)}wasShown(){this._createContentIfNeeded();this.updateFontPreviewSize()}onResize(){if(this._inResize)return;this._inResize=true;try{this.updateFontPreviewSize()}finally{delete this._inResize}}_measureElement(){this.element.appendChild(this._dummyElement);const e={width:this._dummyElement.offsetWidth,height:this._dummyElement.offsetHeight};this.element.removeChild(this._dummyElement);return e}updateFontPreviewSize(){if(!this.fontPreviewElement||!this.isShowing())return;this.fontPreviewElement.style.removeProperty("visibility");const e=this._measureElement();const t=e.height;const i=e.width;const r=this.element.offsetWidth-50;const s=this.element.offsetHeight-30;if(!t||!i||!r||!s){this.fontPreviewElement.style.removeProperty("font-size");return}const n=r/i;const o=s/t;const h=Math.floor(SourceFrame.FontView._measureFontSize*Math.min(n,o))-2;this.fontPreviewElement.style.setProperty("font-size",h+"px",null)}};SourceFrame.FontView._fontPreviewLines=["ABCDEFGHIJKLM","NOPQRSTUVWXYZ","abcdefghijklm","nopqrstuvwxyz","1234567890"];SourceFrame.FontView._fontId=0;SourceFrame.FontView._measureFontSize=50;SourceFrame.ImageView=class extends UI.SimpleView{constructor(e,t){super(Common.UIString("Image"));this.registerRequiredCSS("source_frame/imageView.css");this.element.tabIndex=0;this.element.classList.add("image-view");this._url=t.contentURL();this._parsedURL=new Common.ParsedURL(this._url);this._mimeType=e;this._contentProvider=t;this._uiSourceCode=t instanceof Workspace.UISourceCode?t:null;if(this._uiSourceCode){this._uiSourceCode.addEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this);new UI.DropTarget(this.element,[UI.DropTarget.Type.ImageFile,UI.DropTarget.Type.URI],Common.UIString("Drop image file here"),this._handleDrop.bind(this))}this._sizeLabel=new UI.ToolbarText;this._dimensionsLabel=new UI.ToolbarText;this._mimeTypeLabel=new UI.ToolbarText(e);this._container=this.element.createChild("div","image");this._imagePreviewElement=this._container.createChild("img","resource-image-view");this._imagePreviewElement.addEventListener("contextmenu",this._contextMenu.bind(this),true);this._imagePreviewElement.alt=ls`Image from ${this._url}`}syncToolbarItems(){return[this._sizeLabel,new UI.ToolbarSeparator,this._dimensionsLabel,new UI.ToolbarSeparator,this._mimeTypeLabel]}wasShown(){this._updateContentIfNeeded()}disposeView(){if(this._uiSourceCode){this._uiSourceCode.removeEventListener(Workspace.UISourceCode.Events.WorkingCopyCommitted,this._workingCopyCommitted,this)}}_workingCopyCommitted(){this._updateContentIfNeeded()}async _updateContentIfNeeded(){const e=await this._contentProvider.requestContent();if(this._cachedContent===e)return;const t=await this._contentProvider.contentEncoded();this._cachedContent=e;let i=Common.ContentProvider.contentAsDataURL(e,this._mimeType,t);if(e===null)i=this._url;const r=new Promise(e=>this._imagePreviewElement.onload=e);this._imagePreviewElement.src=i;const s=e&&!t?e.length:base64ToSize(e);this._sizeLabel.setText(Number.bytesToString(s));await r;this._dimensionsLabel.setText(Common.UIString("%d × %d",this._imagePreviewElement.naturalWidth,this._imagePreviewElement.naturalHeight))}_contextMenu(e){const t=new UI.ContextMenu(e);if(!this._parsedURL.isDataURL())t.clipboardSection().appendItem(Common.UIString("Copy image URL"),this._copyImageURL.bind(this));if(this._imagePreviewElement.src){t.clipboardSection().appendItem(Common.UIString("Copy image as data URI"),this._copyImageAsDataURL.bind(this))}t.clipboardSection().appendItem(Common.UIString("Open image in new tab"),this._openInNewTab.bind(this));t.clipboardSection().appendItem(Common.UIString("Save…"),this._saveImage.bind(this));t.show()}_copyImageAsDataURL(){InspectorFrontendHost.copyText(this._imagePreviewElement.src)}_copyImageURL(){InspectorFrontendHost.copyText(this._url)}_saveImage(){const e=createElement("a");e.download=this._parsedURL.displayName;e.href=this._url;e.click()}_openInNewTab(){InspectorFrontendHost.openInNewTab(this._url)}async _handleDrop(e){const t=e.items;if(!t.length||t[0].kind!=="file")return;const i=t[0].webkitGetAsEntry();const r=!i.name.endsWith(".svg");i.file(e=>{const t=new FileReader;t.onloadend=(()=>{let e;try{e=t.result}catch(t){e=null;console.error("Can't read file: "+t)}if(typeof e!=="string")return;this._uiSourceCode.setContent(r?btoa(e):e,r)});if(r)t.readAsBinaryString(e);else t.readAsText(e)})}};SourceFrame.SourceFrame=class extends UI.SimpleView{constructor(e,t){super(Common.UIString("Source"));this._lazyContent=e;this._pretty=false;this._rawContent=null;this._formattedContentPromise=null;this._formattedMap=null;this._prettyToggle=new UI.ToolbarToggle(ls`Pretty print`,"largeicon-pretty-print");this._prettyToggle.addEventListener(UI.ToolbarButton.Events.Click,()=>{this._setPretty(!this._prettyToggle.toggled())});this._shouldAutoPrettyPrint=false;this._prettyToggle.setVisible(false);this._textEditor=new SourceFrame.SourcesTextEditor(this,t);this._textEditor.show(this.element);this._prettyCleanGeneration=null;this._cleanGeneration=0;this._searchConfig=null;this._delayedFindSearchMatches=null;this._currentSearchResultIndex=-1;this._searchResults=[];this._searchRegex=null;this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.EditorFocused,this._resetCurrentSearchResultIndex,this);this._textEditor.addEventListener(SourceFrame.SourcesTextEditor.Events.SelectionChanged,this._updateSourcePosition,this);this._textEditor.addEventListener(UI.TextEditor.Events.TextChanged,e=>{if(!this._muteChangeEventsForSetContent)this.onTextChanged(e.data.oldRange,e.data.newRange)});this._muteChangeEventsForSetContent=false;this._sourcePosition=new UI.ToolbarText;this._searchableView=null;this._editable=false;this._textEditor.setReadOnly(true);this._positionToReveal=null;this._lineToScrollTo=null;this._selectionToSet=null;this._loaded=false;this._contentRequested=false;this._highlighterType="";this._transformer={editorToRawLocation:(e,t=0)=>{if(!this._pretty)return[e,t];return this._prettyToRawLocation(e,t)},rawToEditorLocation:(e,t=0)=>{if(!this._pretty)return[e,t];return this._rawToPrettyLocation(e,t)}}}setCanPrettyPrint(e,t){this._shouldAutoPrettyPrint=e&&!!t;this._prettyToggle.setVisible(e)}async _setPretty(e){this._pretty=e;this._prettyToggle.setEnabled(false);const t=this.loaded;const i=this.selection();let r;if(this._pretty){const e=await this._requestFormattedContent();this._formattedMap=e.map;this.setContent(e.content);this._prettyCleanGeneration=this._textEditor.markClean();const t=this._rawToPrettyLocation(i.startLine,i.startColumn);const s=this._rawToPrettyLocation(i.endLine,i.endColumn);r=new TextUtils.TextRange(t[0],t[1],s[0],s[1])}else{this.setContent(this._rawContent);this._cleanGeneration=this._textEditor.markClean();const e=this._prettyToRawLocation(i.startLine,i.startColumn);const t=this._prettyToRawLocation(i.endLine,i.endColumn);r=new TextUtils.TextRange(e[0],e[1],t[0],t[1])}if(t){this.textEditor.revealPosition(r.endLine,r.endColumn,this._editable);this.textEditor.setSelection(r)}this._prettyToggle.setEnabled(true);this._updatePrettyPrintState()}_updatePrettyPrintState(){this._prettyToggle.setToggled(this._pretty);this._textEditor.element.classList.toggle("pretty-printed",this._pretty);if(this._pretty){this._textEditor.setLineNumberFormatter(e=>{const t=this._prettyToRawLocation(e-1,0)[0]+1;if(e===1)return String(t);if(t!==this._prettyToRawLocation(e-2,0)[0]+1)return String(t);return"-"})}else{this._textEditor.setLineNumberFormatter(e=>{return String(e)})}}transformer(){return this._transformer}_prettyToRawLocation(e,t){if(!this._formattedMap)return[e,t];return this._formattedMap.formattedToOriginal(e,t)}_rawToPrettyLocation(e,t){if(!this._formattedMap)return[e,t];return this._formattedMap.originalToFormatted(e,t)}setEditable(e){this._editable=e;if(this._loaded)this._textEditor.setReadOnly(!e)}wasShown(){this._ensureContentLoaded();this._wasShownOrLoaded()}willHide(){super.willHide();this._clearPositionToReveal()}syncToolbarItems(){return[this._prettyToggle,this._sourcePosition]}get loaded(){return this._loaded}get textEditor(){return this._textEditor}get pretty(){return this._pretty}async _ensureContentLoaded(){if(!this._contentRequested){this._contentRequested=true;const e=await this._lazyContent();this._rawContent=e||"";this._formattedContentPromise=null;this._formattedMap=null;this._prettyToggle.setEnabled(true);if(this._shouldAutoPrettyPrint&&TextUtils.isMinified(e))await this._setPretty(true);else this.setContent(this._rawContent)}}_requestFormattedContent(){if(this._formattedContentPromise)return this._formattedContentPromise;let e;this._formattedContentPromise=new Promise(t=>e=t);new Formatter.ScriptFormatter(this._highlighterType,this._rawContent||"",(t,i)=>{e({content:t,map:i})});return this._formattedContentPromise}revealPosition(e,t,i){this._lineToScrollTo=null;this._selectionToSet=null;this._positionToReveal={line:e,column:t,shouldHighlight:i};this._innerRevealPositionIfNeeded()}_innerRevealPositionIfNeeded(){if(!this._positionToReveal)return;if(!this.loaded||!this.isShowing())return;const[e,t]=this._transformer.rawToEditorLocation(this._positionToReveal.line,this._positionToReveal.column);this._textEditor.revealPosition(e,t,this._positionToReveal.shouldHighlight);this._positionToReveal=null}_clearPositionToReveal(){this._textEditor.clearPositionHighlight();this._positionToReveal=null}scrollToLine(e){this._clearPositionToReveal();this._lineToScrollTo=e;this._innerScrollToLineIfNeeded()}_innerScrollToLineIfNeeded(){if(this._lineToScrollTo!==null){if(this.loaded&&this.isShowing()){this._textEditor.scrollToLine(this._lineToScrollTo);this._lineToScrollTo=null}}}selection(){return this.textEditor.selection()}setSelection(e){this._selectionToSet=e;this._innerSetSelectionIfNeeded()}_innerSetSelectionIfNeeded(){if(this._selectionToSet&&this.loaded&&this.isShowing()){this._textEditor.setSelection(this._selectionToSet,true);this._selectionToSet=null}}_wasShownOrLoaded(){this._innerRevealPositionIfNeeded();this._innerSetSelectionIfNeeded();this._innerScrollToLineIfNeeded()}onTextChanged(e,t){const i=this.pretty;this._pretty=this._prettyCleanGeneration!==null&&this.textEditor.isClean(this._prettyCleanGeneration);if(this._pretty!==i)this._updatePrettyPrintState();this._prettyToggle.setEnabled(this.isClean());if(this._searchConfig&&this._searchableView)this.performSearch(this._searchConfig,false,false)}isClean(){return this.textEditor.isClean(this._cleanGeneration)||this._prettyCleanGeneration!==null&&this.textEditor.isClean(this._prettyCleanGeneration)}contentCommitted(){this._cleanGeneration=this._textEditor.markClean();this._prettyCleanGeneration=null;this._rawContent=this.textEditor.text();this._formattedMap=null;this._formattedContentPromise=null;if(this._pretty){this._pretty=false;this._updatePrettyPrintState()}this._prettyToggle.setEnabled(true)}_simplifyMimeType(e,t){if(!t)return"";if(t.indexOf("javascript")>=0||t.indexOf("jscript")>=0||t.indexOf("ecmascript")>=0)return"text/javascript";if(t==="text/x-php"&&e.match(/\<\?.*\?\>/g))return"application/x-httpd-php";return t}setHighlighterType(e){this._highlighterType=e;this._updateHighlighterType("")}highlighterType(){return this._highlighterType}_updateHighlighterType(e){this._textEditor.setMimeType(this._simplifyMimeType(e,this._highlighterType))}setContent(e){this._muteChangeEventsForSetContent=true;if(!this._loaded){this._loaded=true;this._textEditor.setText(e||"");this._cleanGeneration=this._textEditor.markClean();this._textEditor.setReadOnly(!this._editable)}else{const t=this._textEditor.scrollTop();const i=this._textEditor.selection();this._textEditor.setText(e||"");this._textEditor.setScrollTop(t);this._textEditor.setSelection(i)}this._updateHighlighterType(e||"");this._wasShownOrLoaded();if(this._delayedFindSearchMatches){this._delayedFindSearchMatches();this._delayedFindSearchMatches=null}this._muteChangeEventsForSetContent=false}setSearchableView(e){this._searchableView=e}_doFindSearchMatches(e,t,i){this._currentSearchResultIndex=-1;this._searchResults=[];const r=e.toSearchRegex();this._searchRegex=r;this._searchResults=this._collectRegexMatches(r);if(this._searchableView)this._searchableView.updateSearchMatchesCount(this._searchResults.length);if(!this._searchResults.length)this._textEditor.cancelSearchResultsHighlight();else if(t&&i)this.jumpToPreviousSearchResult();else if(t)this.jumpToNextSearchResult();else this._textEditor.highlightSearchResults(r,null)}performSearch(e,t,i){if(this._searchableView)this._searchableView.updateSearchMatchesCount(0);this._resetSearch();this._searchConfig=e;if(this.loaded)this._doFindSearchMatches(e,t,!!i);else this._delayedFindSearchMatches=this._doFindSearchMatches.bind(this,e,t,!!i);this._ensureContentLoaded()}_resetCurrentSearchResultIndex(){if(!this._searchResults.length)return;this._currentSearchResultIndex=-1;if(this._searchableView)this._searchableView.updateCurrentMatchIndex(this._currentSearchResultIndex);this._textEditor.highlightSearchResults(this._searchRegex,null)}_resetSearch(){this._searchConfig=null;this._delayedFindSearchMatches=null;this._currentSearchResultIndex=-1;this._searchResults=[];this._searchRegex=null}searchCanceled(){const e=this._currentSearchResultIndex!==-1?this._searchResults[this._currentSearchResultIndex]:null;this._resetSearch();if(!this.loaded)return;this._textEditor.cancelSearchResultsHighlight();if(e)this.setSelection(e)}jumpToLastSearchResult(){this.jumpToSearchResult(this._searchResults.length-1)}_searchResultIndexForCurrentSelection(){return this._searchResults.lowerBound(this._textEditor.selection().collapseToEnd(),TextUtils.TextRange.comparator)}jumpToNextSearchResult(){const e=this._searchResultIndexForCurrentSelection();const t=this._currentSearchResultIndex===-1?e:e+1;this.jumpToSearchResult(t)}jumpToPreviousSearchResult(){const e=this._searchResultIndexForCurrentSelection();this.jumpToSearchResult(e-1)}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}jumpToSearchResult(e){if(!this.loaded||!this._searchResults.length)return;this._currentSearchResultIndex=(e+this._searchResults.length)%this._searchResults.length;if(this._searchableView)this._searchableView.updateCurrentMatchIndex(this._currentSearchResultIndex);this._textEditor.highlightSearchResults(this._searchRegex,this._searchResults[this._currentSearchResultIndex])}replaceSelectionWith(e,t){const i=this._searchResults[this._currentSearchResultIndex];if(!i)return;this._textEditor.highlightSearchResults(this._searchRegex,null);const r=this._textEditor.text(i);const s=e.toSearchRegex();let n;if(s.__fromRegExpQuery){n=r.replace(s,t)}else{n=r.replace(s,function(){return t})}const o=this._textEditor.editRange(i,n);this._textEditor.setSelection(o.collapseToEnd())}replaceAllWith(e,t){this._resetCurrentSearchResultIndex();let i=this._textEditor.text();const r=this._textEditor.fullRange();const s=e.toSearchRegex(true);if(s.__fromRegExpQuery){i=i.replace(s,t)}else{i=i.replace(s,function(){return t})}const n=this._collectRegexMatches(s);if(!n.length)return;const o=n.lowerBound(this._textEditor.selection(),TextUtils.TextRange.comparator);const h=mod(o-1,n.length);const a=n[h];const l=t.computeLineEndings();const c=l.length;const u=a.startLine+l.length-1;let d=a.startColumn;if(l.length>1){d=l[c-1]-l[c-2]-1}this._textEditor.editRange(r,i);this._textEditor.revealPosition(u,d);this._textEditor.setSelection(TextUtils.TextRange.createFromLocation(u,d))}_collectRegexMatches(e){const t=[];for(let i=0;i<this._textEditor.linesCount;++i){let r=this._textEditor.line(i);let s=0;let n;do{n=e.exec(r);if(n){const e=n.index+Math.max(n[0].length,1);if(n[0].length)t.push(new TextUtils.TextRange(i,s+n.index,i,s+e));s+=e;r=r.substring(e)}}while(n&&r)}return t}populateLineGutterContextMenu(e,t){return Promise.resolve()}populateTextAreaContextMenu(e,t,i){return Promise.resolve()}canEditSource(){return this._editable}_updateSourcePosition(){const e=this._textEditor.selections();if(!e.length)return;if(e.length>1){this._sourcePosition.setText(Common.UIString("%d selection regions",e.length));return}let t=e[0];if(t.isEmpty()){const e=this._prettyToRawLocation(t.endLine,t.endColumn);this._sourcePosition.setText(ls`Line ${e[0]+1}, Column ${e[1]+1}`);return}t=t.normalize();const i=this._textEditor.text(t);if(t.startLine===t.endLine){this._sourcePosition.setText(Common.UIString("%d characters selected",i.length))}else{this._sourcePosition.setText(Common.UIString("%d lines, %d characters selected",t.endLine-t.startLine+1,i.length))}}};SourceFrame.LineDecorator=function(){};SourceFrame.LineDecorator.prototype={decorate(e,t,i){}};SourceFrame.Transformer;SourceFrame.ResourceSourceFrame=class extends SourceFrame.SourceFrame{constructor(e,t,i){super(async()=>{let t=await e.requestContent();if(await e.contentEncoded())t=window.atob(t);return t},i);this._resource=e;this.setCanPrettyPrint(this._resource.contentType().isDocumentOrScriptOrStyleSheet(),t)}static createSearchableView(e,t,i){return new SourceFrame.ResourceSourceFrame.SearchableContainer(e,t,i)}get resource(){return this._resource}populateTextAreaContextMenu(e,t,i){e.appendApplicableItems(this._resource);return Promise.resolve()}};SourceFrame.ResourceSourceFrame.SearchableContainer=class extends UI.VBox{constructor(e,t,i){super(true);this.registerRequiredCSS("source_frame/resourceSourceFrame.css");const r=new SourceFrame.ResourceSourceFrame(e,i);this._sourceFrame=r;r.setHighlighterType(t);const s=new UI.SearchableView(r);s.element.classList.add("searchable-view");s.setPlaceholder(ls`Find`);r.show(s.element);r.setSearchableView(s);s.show(this.contentElement);const n=new UI.Toolbar("toolbar",this.contentElement);for(const e of r.syncToolbarItems())n.appendToolbarItem(e)}async revealPosition(e,t){this._sourceFrame.revealPosition(e,t,true)}};SourceFrame.JSONView=class extends UI.VBox{constructor(e){super();this._initialized=false;this.registerRequiredCSS("source_frame/jsonView.css");this._parsedJSON=e;this.element.classList.add("json-view");this._searchableView;this._treeOutline;this._currentSearchFocusIndex=0;this._currentSearchTreeElements=[];this._searchRegex=null}static async createView(e){const t=await SourceFrame.JSONView._parseJSON(e);if(!t||typeof t.data!=="object")return null;const i=new SourceFrame.JSONView(t);const r=new UI.SearchableView(i);r.setPlaceholder(Common.UIString("Find"));i._searchableView=r;i.show(r.element);return r}static createViewSync(e){const t=new SourceFrame.JSONView(new SourceFrame.ParsedJSON(e,"",""));const i=new UI.SearchableView(t);i.setPlaceholder(Common.UIString("Find"));t._searchableView=i;t.show(i.element);t.element.setAttribute("tabIndex",0);return i}static _parseJSON(e){let t=null;if(e)t=SourceFrame.JSONView._extractJSON(e);if(!t)return Promise.resolve(null);return Formatter.formatterWorkerPool().parseJSONRelaxed(t.data).then(i);function i(e){if(!e)return null;t.data=e;return t}}static _extractJSON(e){if(e.startsWith("<"))return null;let t=SourceFrame.JSONView._findBrackets(e,"{","}");const i=SourceFrame.JSONView._findBrackets(e,"[","]");t=i.length>t.length?i:t;if(t.length===-1||e.length-t.length>80)return null;const r=e.substring(0,t.start);const s=e.substring(t.end+1);e=e.substring(t.start,t.end+1);if(s.trim().length&&!(s.trim().startsWith(")")&&r.trim().endsWith("(")))return null;return new SourceFrame.ParsedJSON(e,r,s)}static _findBrackets(e,t,i){const r=e.indexOf(t);const s=e.lastIndexOf(i);let n=s-r-1;if(r===-1||s===-1||s<r)n=-1;return{start:r,end:s,length:n}}wasShown(){this._initialize()}_initialize(){if(this._initialized)return;this._initialized=true;const e=SDK.RemoteObject.fromLocalObject(this._parsedJSON.data);const t=this._parsedJSON.prefix+e.description+this._parsedJSON.suffix;this._treeOutline=new ObjectUI.ObjectPropertiesSection(e,t,undefined,undefined,undefined,undefined,true);this._treeOutline.enableContextMenu();this._treeOutline.setEditable(false);this._treeOutline.expand();this.element.appendChild(this._treeOutline.element);this._treeOutline.firstChild().select(true,false)}_jumpToMatch(e){if(!this._searchRegex)return;const t=this._currentSearchTreeElements[this._currentSearchFocusIndex];if(t)t.setSearchRegex(this._searchRegex);const i=this._currentSearchTreeElements[e];if(i){this._updateSearchIndex(e);i.setSearchRegex(this._searchRegex,UI.highlightedCurrentSearchResultClassName);i.reveal()}else{this._updateSearchIndex(0)}}_updateSearchCount(e){if(!this._searchableView)return;this._searchableView.updateSearchMatchesCount(e)}_updateSearchIndex(e){this._currentSearchFocusIndex=e;if(!this._searchableView)return;this._searchableView.updateCurrentMatchIndex(e)}searchCanceled(){this._searchRegex=null;this._currentSearchTreeElements=[];for(let e=this._treeOutline.rootElement();e;e=e.traverseNextTreeElement(false)){if(!(e instanceof ObjectUI.ObjectPropertyTreeElement))continue;e.revertHighlightChanges()}this._updateSearchCount(0);this._updateSearchIndex(0)}performSearch(e,t,i){let r=this._currentSearchFocusIndex;const s=this._currentSearchTreeElements[r];this.searchCanceled();this._searchRegex=e.toSearchRegex(true);for(let e=this._treeOutline.rootElement();e;e=e.traverseNextTreeElement(false)){if(!(e instanceof ObjectUI.ObjectPropertyTreeElement))continue;const t=e.setSearchRegex(this._searchRegex);if(t)this._currentSearchTreeElements.push(e);if(s===e){const e=this._currentSearchTreeElements.length-1;if(t||i)r=e;else r=e+1}}this._updateSearchCount(this._currentSearchTreeElements.length);if(!this._currentSearchTreeElements.length){this._updateSearchIndex(0);return}r=mod(r,this._currentSearchTreeElements.length);this._jumpToMatch(r)}jumpToNextSearchResult(){if(!this._currentSearchTreeElements.length)return;const e=mod(this._currentSearchFocusIndex+1,this._currentSearchTreeElements.length);this._jumpToMatch(e)}jumpToPreviousSearchResult(){if(!this._currentSearchTreeElements.length)return;const e=mod(this._currentSearchFocusIndex-1,this._currentSearchTreeElements.length);this._jumpToMatch(e)}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}};SourceFrame.ParsedJSON=class{constructor(e,t,i){this.data=e;this.prefix=t;this.suffix=i}};SourceFrame.XMLView=class extends UI.Widget{constructor(e){super(true);this.registerRequiredCSS("source_frame/xmlView.css");this.contentElement.classList.add("shadow-xml-view","source-code");this._treeOutline=new UI.TreeOutlineInShadow;this._treeOutline.registerRequiredCSS("source_frame/xmlTree.css");this.contentElement.appendChild(this._treeOutline.element);this._searchableView;this._currentSearchFocusIndex=0;this._currentSearchTreeElements=[];this._searchConfig;SourceFrame.XMLView.Node.populate(this._treeOutline,e,this);this._treeOutline.firstChild().select(true,false)}static createSearchableView(e){const t=new SourceFrame.XMLView(e);const i=new UI.SearchableView(t);i.setPlaceholder(Common.UIString("Find"));t._searchableView=i;t.show(i.element);return i}static parseXML(e,t){let i;try{i=(new DOMParser).parseFromString(e,t)}catch(e){return null}if(i.body)return null;return i}_jumpToMatch(e,t){if(!this._searchConfig)return;const i=this._searchConfig.toSearchRegex(true);const r=this._currentSearchTreeElements[this._currentSearchFocusIndex];if(r)r.setSearchRegex(i);const s=this._currentSearchTreeElements[e];if(s){this._updateSearchIndex(e);if(t)s.reveal(true);s.setSearchRegex(i,UI.highlightedCurrentSearchResultClassName)}else{this._updateSearchIndex(0)}}_updateSearchCount(e){if(!this._searchableView)return;this._searchableView.updateSearchMatchesCount(e)}_updateSearchIndex(e){this._currentSearchFocusIndex=e;if(!this._searchableView)return;this._searchableView.updateCurrentMatchIndex(e)}_innerPerformSearch(e,t){if(!this._searchConfig)return;let i=this._currentSearchFocusIndex;const r=this._currentSearchTreeElements[i];this._innerSearchCanceled();this._currentSearchTreeElements=[];const s=this._searchConfig.toSearchRegex(true);for(let e=this._treeOutline.rootElement();e;e=e.traverseNextTreeElement(false)){if(!(e instanceof SourceFrame.XMLView.Node))continue;const n=e.setSearchRegex(s);if(n)this._currentSearchTreeElements.push(e);if(r===e){const e=this._currentSearchTreeElements.length-1;if(n||t)i=e;else i=e+1}}this._updateSearchCount(this._currentSearchTreeElements.length);if(!this._currentSearchTreeElements.length){this._updateSearchIndex(0);return}i=mod(i,this._currentSearchTreeElements.length);this._jumpToMatch(i,e)}_innerSearchCanceled(){for(let e=this._treeOutline.rootElement();e;e=e.traverseNextTreeElement(false)){if(!(e instanceof SourceFrame.XMLView.Node))continue;e.revertHighlightChanges()}this._updateSearchCount(0);this._updateSearchIndex(0)}searchCanceled(){this._searchConfig=null;this._currentSearchTreeElements=[];this._innerSearchCanceled()}performSearch(e,t,i){this._searchConfig=e;this._innerPerformSearch(t,i)}jumpToNextSearchResult(){if(!this._currentSearchTreeElements.length)return;const e=mod(this._currentSearchFocusIndex+1,this._currentSearchTreeElements.length);this._jumpToMatch(e,true)}jumpToPreviousSearchResult(){if(!this._currentSearchTreeElements.length)return;const e=mod(this._currentSearchFocusIndex-1,this._currentSearchTreeElements.length);this._jumpToMatch(e,true)}supportsCaseSensitiveSearch(){return true}supportsRegexSearch(){return true}};SourceFrame.XMLView.Node=class extends UI.TreeElement{constructor(e,t,i){super("",!t&&!!e.childElementCount);this._node=e;this._closeTag=t;this.selectable=true;this._highlightChanges=[];this._xmlView=i;this._updateTitle()}static populate(e,t,i){let r=t.firstChild;while(r){const t=r;r=r.nextSibling;const s=t.nodeType;if(s===3&&t.nodeValue.match(/\s+/))continue;if(s!==1&&s!==3&&s!==4&&s!==7&&s!==8)continue;e.appendChild(new SourceFrame.XMLView.Node(t,false,i))}}setSearchRegex(e,t){this.revertHighlightChanges();if(!e)return false;if(this._closeTag&&this.parent&&!this.parent.expanded)return false;e.lastIndex=0;let i=UI.highlightedSearchResultClassName;if(t)i+=" "+t;const r=this.listItemElement.textContent.replace(/\xA0/g," ");let s=e.exec(r);const n=[];while(s){n.push(new TextUtils.SourceRange(s.index,s[0].length));s=e.exec(r)}if(n.length)UI.highlightRangesWithStyleClass(this.listItemElement,n,i,this._highlightChanges);return!!this._highlightChanges.length}revertHighlightChanges(){UI.revertDomChanges(this._highlightChanges);this._highlightChanges=[]}_updateTitle(){const e=this._node;switch(e.nodeType){case 1:const t=e.tagName;if(this._closeTag){this._setTitle(["</"+t+">","shadow-xml-view-tag"]);return}const i=["<"+t,"shadow-xml-view-tag"];const r=e.attributes;for(let e=0;e<r.length;++e){const t=r.item(e);i.push(" ","shadow-xml-view-tag",t.name,"shadow-xml-view-attribute-name",'="',"shadow-xml-view-tag",t.value,"shadow-xml-view-attribute-value",'"',"shadow-xml-view-tag")}if(!this.expanded){if(e.childElementCount){i.push(">","shadow-xml-view-tag","…","shadow-xml-view-comment","</"+t,"shadow-xml-view-tag")}else if(this._node.textContent){i.push(">","shadow-xml-view-tag",e.textContent,"shadow-xml-view-text","</"+t,"shadow-xml-view-tag")}else{i.push(" /","shadow-xml-view-tag")}}i.push(">","shadow-xml-view-tag");this._setTitle(i);return;case 3:this._setTitle([e.nodeValue,"shadow-xml-view-text"]);return;case 4:this._setTitle(["<![CDATA[","shadow-xml-view-cdata",e.nodeValue,"shadow-xml-view-text","]]>","shadow-xml-view-cdata"]);return;case 7:this._setTitle(["<?"+e.nodeName+" "+e.nodeValue+"?>","shadow-xml-view-processing-instruction"]);return;case 8:this._setTitle(["\x3c!--"+e.nodeValue+"--\x3e","shadow-xml-view-comment"]);return}}_setTitle(e){const t=createDocumentFragment();for(let i=0;i<e.length;i+=2)t.createChild("span",e[i+1]).textContent=e[i];this.title=t;this._xmlView._innerPerformSearch(false,false)}onattach(){this.listItemElement.classList.toggle("shadow-xml-view-close-tag",this._closeTag)}onexpand(){this._updateTitle()}oncollapse(){this._updateTitle()}async onpopulate(){SourceFrame.XMLView.Node.populate(this,this._node,this._xmlView);this.appendChild(new SourceFrame.XMLView.Node(this._node,true,this._xmlView))}};SourceFrame.PreviewFactory=class{static async createPreview(e,t){let i=Common.ResourceType.fromMimeType(t);if(i===Common.resourceTypes.Other)i=e.contentType();switch(i){case Common.resourceTypes.Image:return new SourceFrame.ImageView(t,e);case Common.resourceTypes.Font:return new SourceFrame.FontView(t,e)}let r=await e.requestContent();if(!r)return new UI.EmptyWidget(Common.UIString("Nothing to preview"));if(await e.contentEncoded())r=window.atob(r);const s=SourceFrame.XMLView.parseXML(r,t);if(s)return SourceFrame.XMLView.createSearchableView(s);const n=await SourceFrame.JSONView.createView(r);if(n)return n;if(i.isTextType()){const i=e.contentType().canonicalMimeType()||t.replace(/;.*/,"");return SourceFrame.ResourceSourceFrame.createSearchableView(e,i,true)}return null}};SourceFrame.SourceCodeDiff=class{constructor(e){this._textEditor=e;this._animatedLines=[];this._animationTimeout=null}highlightModifiedLines(e,t){if(typeof e!=="string"||typeof t!=="string")return;const i=SourceFrame.SourceCodeDiff.computeDiff(Diff.Diff.lineDiff(e.split("\n"),t.split("\n")));const r=[];for(let e=0;e<i.length;++e){const t=i[e];if(t.type===SourceFrame.SourceCodeDiff.EditType.Delete)continue;for(let e=t.from;e<t.to;++e){const t=this._textEditor.textEditorPositionHandle(e,0);if(t)r.push(t)}}this._updateHighlightedLines(r);this._animationTimeout=setTimeout(this._updateHighlightedLines.bind(this,[]),400)}_updateHighlightedLines(e){if(this._animationTimeout)clearTimeout(this._animationTimeout);this._animationTimeout=null;this._textEditor.operation(t.bind(this));function t(){i.call(this,false);this._animatedLines=e;i.call(this,true)}function i(e){for(let t=0;t<this._animatedLines.length;++t){const i=this._animatedLines[t].resolve();if(i)this._textEditor.toggleLineClass(i.lineNumber,"highlight-line-modification",e)}}}static computeDiff(e){const t=[];let i=false;let r=false;let s=0;let n=0;let o=false;for(let t=0;t<e.length;++t){const a=e[t];if(a[0]===Diff.Diff.Operation.Equal){if(o)h();n+=a[1].length;continue}if(!o){o=true;s=n}if(a[0]===Diff.Diff.Operation.Delete){r=true}else{n+=a[1].length;i=true}}if(o)h();if(t.length>1&&t[0].from===0&&t[1].from===0){const e={type:SourceFrame.SourceCodeDiff.EditType.Modify,from:0,to:t[1].to};t.splice(0,2,e)}return t;function h(){let e=SourceFrame.SourceCodeDiff.EditType.Insert;let h=s;let a=n;if(i&&r){e=SourceFrame.SourceCodeDiff.EditType.Modify}else if(!i&&r&&h===0&&a===0){e=SourceFrame.SourceCodeDiff.EditType.Modify;a=1}else if(!i&&r){e=SourceFrame.SourceCodeDiff.EditType.Delete;h-=1}t.push({type:e,from:h,to:a});o=false;i=false;r=false}}};SourceFrame.SourceCodeDiff.EditType={Insert:Symbol("Insert"),Delete:Symbol("Delete"),Modify:Symbol("Modify")};Runtime.cachedResources["source_frame/fontView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.font-view {\n    font-size: 60px;\n    white-space: pre-wrap;\n    word-wrap: break-word;\n    text-align: center;\n    padding: 15px;\n}\n";Runtime.cachedResources["source_frame/imageView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.image-view {\n    overflow: auto;\n}\n\n.image-view > .image {\n    padding: 20px 20px 10px 20px;\n    text-align: center;\n}\n\n.image-view img.resource-image-view {\n    max-width: 100%;\n    max-height: 1000px;\n    background-image: url(Images/checker.png);\n    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.5);\n    -webkit-user-select: text;\n    -webkit-user-drag: auto;\n}\n";Runtime.cachedResources["source_frame/jsonView.css"]=".json-view {\n    padding: 2px 6px;\n    overflow: auto;\n}\n";Runtime.cachedResources["source_frame/messagesPopover.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.text-editor-messages-description-container {\n    display: inline-block;\n}\n\n.text-editor-row-message:first-child {\n    border-top-width: 0;\n}\n\n.text-editor-row-message {\n    line-height: 1.2;\n    white-space: nowrap;\n    display: flex;\n    align-items: center;\n    justify-content: flex-start;\n    margin-top: 2px;\n}\n\n.text-editor-row-message-repeat-count {\n    margin-right: 0.5em;\n}\n";Runtime.cachedResources["source_frame/xmlTree.css"]="/*\n * Copyright 2016 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.tree-outline ol {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    padding-inline-start: 16px;\n}\n\nol.tree-outline {\n    padding-inline-start: 0;\n}\n\n.tree-outline li {\n    min-height: 12px;\n}\n\n.tree-outline li.shadow-xml-view-close-tag {\n    margin-left: -16px;\n}\n\n.shadow-xml-view-tag {\n    color: rgb(136, 18, 128);\n}\n\n.shadow-xml-view-comment {\n    color: rgb(35, 110, 37);\n}\n\n.shadow-xml-view-processing-instruction {\n    color: rgb(35, 110, 37);\n}\n\n.shadow-xml-view-attribute-name {\n    color: rgb(153, 69, 0);\n}\n\n.shadow-xml-view-attribute-value {\n    color: rgb(26, 26, 166);\n}\n\n.shadow-xml-view-text {\n    color: rgb(0, 0, 0);\n    white-space: pre;\n}\n\n.shadow-xml-view-cdata {\n    color: rgb(0, 0, 0);\n}\n";Runtime.cachedResources["source_frame/xmlView.css"]="/*\n * Copyright (c) 2014 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.shadow-xml-view {\n    -webkit-user-select: text;\n    overflow: auto;\n    padding: 2px 4px;\n}\n";Runtime.cachedResources["source_frame/resourceSourceFrame.css"]="/*\n * Copyright 2017 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n.searchable-view {\n  flex: 1;\n}\n\n.toolbar {\n  background-color: #eee;\n  border-top: 1px solid #ccc;\n}\n";