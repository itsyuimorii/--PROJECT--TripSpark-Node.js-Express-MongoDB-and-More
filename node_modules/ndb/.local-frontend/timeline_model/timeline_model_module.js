self["TimelineModel"]=self["TimelineModel"]||{};TimelineModel.TimelineModelFilter=class{accept(e){return true}};TimelineModel.TimelineVisibleEventsFilter=class extends TimelineModel.TimelineModelFilter{constructor(e){super();this._visibleTypes=new Set(e)}accept(e){return this._visibleTypes.has(TimelineModel.TimelineVisibleEventsFilter._eventType(e))}static _eventType(e){if(e.hasCategory(TimelineModel.TimelineModel.Category.Console))return TimelineModel.TimelineModel.RecordType.ConsoleTime;if(e.hasCategory(TimelineModel.TimelineModel.Category.UserTiming))return TimelineModel.TimelineModel.RecordType.UserTiming;if(e.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo))return TimelineModel.TimelineModel.RecordType.LatencyInfo;return e.name}};TimelineModel.TimelineInvisibleEventsFilter=class extends TimelineModel.TimelineModelFilter{constructor(e){super();this._invisibleTypes=new Set(e)}accept(e){return!this._invisibleTypes.has(TimelineModel.TimelineVisibleEventsFilter._eventType(e))}};TimelineModel.ExclusiveNameFilter=class extends TimelineModel.TimelineModelFilter{constructor(e){super();this._excludeNames=new Set(e)}accept(e){return!this._excludeNames.has(e.name)}};TimelineModel.TracingLayerPayload;TimelineModel.TracingLayerTile;TimelineModel.TracingLayerTree=class extends SDK.LayerTreeBase{constructor(e){super(e);this._tileById=new Map;this._paintProfilerModel=e&&e.model(SDK.PaintProfilerModel)}async setLayers(e,t,i){const n=new Set;if(e){this._extractNodeIdsToResolve(n,{},e)}else{for(let e=0;e<t.length;++e)this._extractNodeIdsToResolve(n,{},t[e])}await this.resolveBackendNodeIds(n);const s=this._layersById;this._layersById={};this.setContentRoot(null);if(e){const t=this._innerSetLayers(s,e);this.setRoot(t)}else{const e=t.map(this._innerSetLayers.bind(this,s));const i=this.contentRoot();this.setRoot(i);for(let t=0;t<e.length;++t){if(e[t].id()!==i.id())i.addChild(e[t])}}this._setPaints(i)}setTiles(e){this._tileById=new Map;for(const t of e)this._tileById.set(t.id,t)}pictureForRasterTile(e){const t=this._tileById.get("cc::Tile/"+e);if(!t){Common.console.error(`Tile ${e} is missing`);return Promise.resolve(null)}const i=this.layerById(t.layer_id);if(!i){Common.console.error(`Layer ${t.layer_id} for tile ${e} is not found`);return Promise.resolve(null)}return i._pictureForRect(t.content_rect)}_setPaints(e){for(let t=0;t<e.length;++t){const i=this._layersById[e[t].layerId()];if(i)i._addPaintEvent(e[t])}}_innerSetLayers(e,t){let i=e[t.layer_id];if(i)i._reset(t);else i=new TimelineModel.TracingLayer(this._paintProfilerModel,t);this._layersById[t.layer_id]=i;if(t.owner_node)i._setNode(this.backendNodeIdToNode().get(t.owner_node)||null);if(!this.contentRoot()&&i.drawsContent())this.setContentRoot(i);for(let n=0;t.children&&n<t.children.length;++n)i.addChild(this._innerSetLayers(e,t.children[n]));return i}_extractNodeIdsToResolve(e,t,i){const n=i.owner_node;if(n&&!this.backendNodeIdToNode().has(n))e.add(n);for(let n=0;i.children&&n<i.children.length;++n)this._extractNodeIdsToResolve(e,t,i.children[n])}};TimelineModel.TracingLayer=class{constructor(e,t){this._paintProfilerModel=e;this._reset(t)}_reset(e){this._node=null;this._layerId=String(e.layer_id);this._offsetX=e.position[0];this._offsetY=e.position[1];this._width=e.bounds.width;this._height=e.bounds.height;this._children=[];this._parentLayerId=null;this._parent=null;this._quad=e.layer_quad||[];this._createScrollRects(e);this._compositingReasons=e.compositing_reasons||[];this._drawsContent=!!e.draws_content;this._gpuMemoryUsage=e.gpu_memory_usage;this._paints=[]}id(){return this._layerId}parentId(){return this._parentLayerId}parent(){return this._parent}isRoot(){return!this.parentId()}children(){return this._children}addChild(e){if(e._parent)console.assert(false,"Child already has a parent");this._children.push(e);e._parent=this;e._parentLayerId=this._layerId}_setNode(e){this._node=e}node(){return this._node}nodeForSelfOrAncestor(){for(let e=this;e;e=e._parent){if(e._node)return e._node}return null}offsetX(){return this._offsetX}offsetY(){return this._offsetY}width(){return this._width}height(){return this._height}transform(){return null}quad(){return this._quad}anchorPoint(){return[.5,.5,0]}invisible(){return false}paintCount(){return 0}lastPaintRect(){return null}scrollRects(){return this._scrollRects}stickyPositionConstraint(){return null}gpuMemoryUsage(){return this._gpuMemoryUsage}snapshots(){return this._paints.map(e=>e.snapshotPromise().then(e=>{if(!e)return null;const t={x:e.rect[0],y:e.rect[1],width:e.rect[2],height:e.rect[3]};return{rect:t,snapshot:e.snapshot}}))}_pictureForRect(e){return Promise.all(this._paints.map(e=>e.picturePromise())).then(t=>{const n=t.filter(t=>t&&i(t.rect,e)).map(e=>({x:e.rect[0],y:e.rect[1],picture:e.serializedPicture}));if(!n.length||!this._paintProfilerModel)return null;const s=n.reduce((e,t)=>Math.min(e,t.x),Infinity);const r=n.reduce((e,t)=>Math.min(e,t.y),Infinity);const a={x:e[0]-s,y:e[1]-r,width:e[2],height:e[3]};return this._paintProfilerModel.loadSnapshotFromFragments(n).then(e=>e?{rect:a,snapshot:e}:null)});function t(e,t,i,n){console.assert(e<=t&&i<=n,"segments should be specified as ordered pairs");return t>i&&e<n}function i(e,i){return t(e[0],e[0]+e[2],i[0],i[0]+i[2])&&t(e[1],e[1]+e[3],i[1],i[1]+i[3])}}_scrollRectsFromParams(e,t){return{rect:{x:e[0],y:e[1],width:e[2],height:e[3]},type:t}}_createScrollRects(e){this._scrollRects=[];if(e.non_fast_scrollable_region){this._scrollRects.push(this._scrollRectsFromParams(e.non_fast_scrollable_region,SDK.Layer.ScrollRectType.NonFastScrollable.name))}if(e.touch_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(e.touch_event_handler_region,SDK.Layer.ScrollRectType.TouchEventHandler.name))}if(e.wheel_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(e.wheel_event_handler_region,SDK.Layer.ScrollRectType.WheelEventHandler.name))}if(e.scroll_event_handler_region){this._scrollRects.push(this._scrollRectsFromParams(e.scroll_event_handler_region,SDK.Layer.ScrollRectType.RepaintsOnScroll.name))}}_addPaintEvent(e){this._paints.push(e)}requestCompositingReasons(){return Promise.resolve(this._compositingReasons)}drawsContent(){return this._drawsContent}};TimelineModel.TimelineModel=class{constructor(){this._reset()}static forEachEvent(e,t,i,n,s,r,a){s=s||0;r=r||Infinity;const o=[];const l=TimelineModel.TimelineModel._topLevelEventEndingAfter(e,s);for(let d=l;d<e.length;++d){const l=e[d];if((l.endTime||l.startTime)<s)continue;if(l.startTime>=r)break;if(SDK.TracingModel.isAsyncPhase(l.phase)||SDK.TracingModel.isFlowPhase(l.phase))continue;while(o.length&&o.peekLast().endTime<=l.startTime)i(o.pop());if(a&&!a(l))continue;if(l.duration){t(l);o.push(l)}else{n&&n(l,o.peekLast()||null)}}while(o.length)i(o.pop())}static _topLevelEventEndingAfter(e,t){let i=e.upperBound(t,(e,t)=>e-t.startTime)-1;while(i>0&&!SDK.TracingModel.isTopLevelEvent(e[i]))i--;return Math.max(i,0)}isMarkerEvent(e){const t=TimelineModel.TimelineModel.RecordType;switch(e.name){case t.TimeStamp:return true;case t.MarkFirstPaint:case t.MarkFCP:case t.MarkFMP:return this._mainFrame&&e.args.frame===this._mainFrame.frameId&&!!e.args.data;case t.MarkDOMContent:case t.MarkLoad:return!!e.args["data"]["isMainFrame"];default:return false}}static globalEventId(e,t){const i=e.args["data"]||e.args["beginData"];const n=i&&i[t];if(!n)return"";return`${e.thread.process().id()}.${n}`}static eventFrameId(e){const t=e.args["data"]||e.args["beginData"];return t&&t["frame"]||""}cpuProfiles(){return this._cpuProfiles}targetByEvent(e){const t=this._workerIdByThread.get(e.thread);const i=SDK.targetManager.mainTarget();return t?SDK.targetManager.targetById(t):i}setEvents(e){this._reset();this._resetProcessingState();this._tracingModel=e;this._minimumRecordTime=e.minimumRecordTime();this._maximumRecordTime=e.maximumRecordTime();this._processSyncBrowserEvents(e);if(this._browserFrameTracking){this._processThreadsForBrowserFrames(e)}else{const t=this._processMetadataEvents(e);this._isGenericTrace=!t;if(t)this._processMetadataAndThreads(e,t);else this._processGenericTrace(e)}this._inspectedTargetEvents.stableSort(SDK.TracingModel.Event.compareStartTime);this._processAsyncBrowserEvents(e);this._buildGPUEvents(e);this._resetProcessingState()}_processGenericTrace(e){let t=SDK.TracingModel.browserMainThread(e);if(!t&&e.sortedProcesses().length)t=e.sortedProcesses()[0].sortedThreads()[0];for(const i of e.sortedProcesses()){for(const n of i.sortedThreads()){this._processThreadEvents(e,[{from:0,to:Infinity}],n,n===t,false,true,null)}}}_processMetadataAndThreads(e,t){let i=0;for(let n=0,s=t.page.length;n<s;n++){const r=t.page[n];const a=r.thread.process();const o=n+1<s?t.page[n+1].startTime:Infinity;if(i===o)continue;this._legacyCurrentPage=r.args["data"]&&r.args["data"]["page"];for(const n of a.sortedThreads()){let s=null;if(n.name()===TimelineModel.TimelineModel.WorkerThreadName||n.name()===TimelineModel.TimelineModel.WorkerThreadNameLegacy){const e=t.workers.find(e=>{if(e.args["data"]["workerThreadId"]!==n.id())return false;if(e.args["data"]["sessionId"]===this._sessionId)return true;return!!this._pageFrames.get(TimelineModel.TimelineModel.eventFrameId(e))});if(!e)continue;const i=e.args["data"]["workerId"];if(i)this._workerIdByThread.set(n,i);s=e.args["data"]["url"]||""}this._processThreadEvents(e,[{from:i,to:o}],n,n===r.thread,!!s,true,s)}i=o}}_processThreadsForBrowserFrames(e){const t=new Map;for(const e of this._pageFrames.values()){for(let i=0;i<e.processes.length;i++){const n=e.processes[i].processId;let s=t.get(n);if(!s){s=[];t.set(n,s)}const r=i===e.processes.length-1?e.deletedTime||this._maximumRecordTime:e.processes[i+1].time;s.push({from:e.processes[i].time,to:r,main:!e.parent,url:e.processes[i].url})}}const i=e.devToolsMetadataEvents();for(const n of e.sortedProcesses()){const s=t.get(n.id());if(!s)continue;s.sort((e,t)=>e.from-t.from||e.to-t.to);const r=[];let a=null;let o=null;let l=false;for(const e of s){if(!r.length||e.from>r.peekLast().to)r.push({from:e.from,to:e.to});else r.peekLast().to=e.to;if(e.main)l=true;if(e.url){if(e.main)o=e.url;a=e.url}}for(const t of n.sortedThreads()){if(t.name()===TimelineModel.TimelineModel.RendererMainThreadName){this._processThreadEvents(e,r,t,true,false,l,l?o:a)}else if(t.name()===TimelineModel.TimelineModel.WorkerThreadName||t.name()===TimelineModel.TimelineModel.WorkerThreadNameLegacy){const s=i.find(e=>{if(e.name!==TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingSessionIdForWorker)return false;if(e.thread.process()!==n)return false;if(e.args["data"]["workerThreadId"]!==t.id())return false;return!!this._pageFrames.get(TimelineModel.TimelineModel.eventFrameId(e))});if(!s)continue;this._workerIdByThread.set(t,s.args["data"]["workerId"]||"");this._processThreadEvents(e,r,t,false,true,false,s.args["data"]["url"]||"")}else{this._processThreadEvents(e,r,t,false,false,false,null)}}}}_processMetadataEvents(e){const t=e.devToolsMetadataEvents();const i=[];const n=[];for(const e of t){if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInPage){i.push(e);if(e.args["data"]&&e.args["data"]["persistentIds"])this._persistentIds=true;const t=e.args["data"]&&e.args["data"]["frames"]||[];t.forEach(t=>this._addPageFrame(e,t));this._mainFrame=this.rootFrames()[0]}else if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingSessionIdForWorker){n.push(e)}else if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInBrowser){console.assert(!this._mainFrameNodeId,"Multiple sessions in trace");this._mainFrameNodeId=e.args["frameTreeNodeId"]}}if(!i.length)return null;const s=i[0].args["sessionId"]||i[0].args["data"]["sessionId"];this._sessionId=s;const r=new Set;function a(e){let t=e.args;if(t["data"])t=t["data"];const i=t["sessionId"];if(i===s)return true;r.add(i);return false}const o={page:i.filter(a).sort(SDK.TracingModel.Event.compareStartTime),workers:n.sort(SDK.TracingModel.Event.compareStartTime)};if(r.size){Common.console.error("Timeline recording was started in more than one page simultaneously. Session id mismatch: "+this._sessionId+" and "+r.valuesArray()+".")}return o}_processSyncBrowserEvents(e){const t=SDK.TracingModel.browserMainThread(e);if(t)t.events().forEach(this._processBrowserEvent,this)}_processAsyncBrowserEvents(e){const t=SDK.TracingModel.browserMainThread(e);if(t)this._processAsyncEvents(t,[{from:0,to:Infinity}])}_buildGPUEvents(e){const t=e.threadByName("GPU Process","CrGpuMain");if(!t)return;const i=TimelineModel.TimelineModel.RecordType.GPUTask;const n=this._ensureNamedTrack(TimelineModel.TimelineModel.TrackType.GPU);n.thread=t;n.events=t.events().filter(e=>e.name===i)}_resetProcessingState(){this._asyncEventTracker=new TimelineModel.TimelineAsyncEventTracker;this._invalidationTracker=new TimelineModel.InvalidationTracker;this._layoutInvalidate={};this._lastScheduleStyleRecalculation={};this._paintImageEventByPixelRefId={};this._lastPaintForLayer={};this._lastRecalculateStylesEvent=null;this._currentScriptEvent=null;this._eventStack=[];this._knownInputEvents=new Set;this._browserFrameTracking=false;this._persistentIds=false;this._legacyCurrentPage=null}_extractCpuProfile(e,t){const i=t.events();let n;let s=null;let r=i.peekLast();if(r&&r.name===TimelineModel.TimelineModel.RecordType.CpuProfile){const e=r.args["data"];n=e&&e["cpuProfile"];s=this.targetByEvent(r)}if(!n){r=i.find(e=>e.name===TimelineModel.TimelineModel.RecordType.Profile);if(!r)return null;s=this.targetByEvent(r);const t=e.profileGroup(r);if(!t){Common.console.error("Invalid CPU profile format.");return null}n={startTime:r.args["data"]["startTime"],endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]};for(const e of t.children){const t=e.args["data"];if("startTime"in t)n.startTime=t["startTime"];if("endTime"in t)n.endTime=t["endTime"];const i=t["cpuProfile"]||{};const s=i["samples"]||[];const r=t["lines"]||Array(s.length).fill(0);n.nodes.pushAll(i["nodes"]||[]);n.lines.pushAll(r);n.samples.pushAll(s);n.timeDeltas.pushAll(t["timeDeltas"]||[]);if(n.samples.length!==n.timeDeltas.length){Common.console.error("Failed to parse CPU profile.");return null}}if(!n.endTime)n.endTime=n.timeDeltas.reduce((e,t)=>e+t,n.startTime)}try{const e=new SDK.CPUProfileDataModel(n,s);this._cpuProfiles.push(e);return e}catch(e){Common.console.error("Failed to parse CPU profile.")}return null}_injectJSFrameEvents(e,t){const i=this._extractCpuProfile(e,t);let n=t.events();const s=i?TimelineModel.TimelineJSProfileProcessor.generateTracingEventsFromCpuProfile(i,t):null;if(s&&s.length)n=n.mergeOrdered(s,SDK.TracingModel.Event.orderedCompareStartTime);if(s||n.some(e=>e.name===TimelineModel.TimelineModel.RecordType.JSSample)){const e=TimelineModel.TimelineJSProfileProcessor.generateJSFrameEvents(n);if(e&&e.length)n=e.mergeOrdered(n,SDK.TracingModel.Event.orderedCompareStartTime)}return n}_processThreadEvents(e,t,i,n,s,r,a){const o=new TimelineModel.TimelineModel.Track;o.name=i.name()||ls`Thread ${i.id()}`;o.type=TimelineModel.TimelineModel.TrackType.Other;o.thread=i;if(n){o.type=TimelineModel.TimelineModel.TrackType.MainThread;o.url=a||null;o.forMainFrame=r}else if(s){o.type=TimelineModel.TimelineModel.TrackType.Worker;o.url=a}else if(i.name().startsWith("CompositorTileWorker")){o.type=TimelineModel.TimelineModel.TrackType.Raster}this._tracks.push(o);const l=this._injectJSFrameEvents(e,i);this._eventStack=[];const d=this._eventStack;for(const e of t){let t=l.lowerBound(e.from,(e,t)=>e-t.startTime);for(;t<l.length;t++){const i=l[t];if(i.startTime>=e.to)break;while(d.length&&d.peekLast().endTime<=i.startTime)d.pop();if(!this._processEvent(i))continue;if(!SDK.TracingModel.isAsyncPhase(i.phase)&&i.duration){if(d.length){const e=d.peekLast();e.selfTime-=i.duration;if(e.selfTime<0)this._fixNegativeDuration(e,i)}i.selfTime=i.duration;if(!d.length)o.tasks.push(i);d.push(i)}if(this.isMarkerEvent(i))this._timeMarkerEvents.push(i);o.events.push(i);this._inspectedTargetEvents.push(i)}}this._processAsyncEvents(i,t)}_fixNegativeDuration(e,t){const i=.001;if(e.selfTime<-i){console.error(`Children are longer than parent at ${e.startTime} `+`(${(t.startTime-this.minimumRecordTime()).toFixed(3)} by ${(-e.selfTime).toFixed(3)}`)}e.selfTime=0}_processAsyncEvents(e,t){const i=e.asyncEvents();const n=new Map;function s(e){if(!n.has(e))n.set(e,[]);return n.get(e)}for(const e of t){let t=i.lowerBound(e.from,function(e,t){return e-t.startTime});for(;t<i.length;++t){const n=i[t];if(n.startTime>=e.to)break;if(n.hasCategory(TimelineModel.TimelineModel.Category.Console)){s(TimelineModel.TimelineModel.TrackType.Console).push(n);continue}if(n.hasCategory(TimelineModel.TimelineModel.Category.UserTiming)){s(TimelineModel.TimelineModel.TrackType.Timings).push(n);continue}if(n.name===TimelineModel.TimelineModel.RecordType.Animation){s(TimelineModel.TimelineModel.TrackType.Animation).push(n);continue}if(n.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)||n.name===TimelineModel.TimelineModel.RecordType.ImplSideFling){const e=n.steps.peekLast();if(e.phase!==SDK.TracingModel.Phase.AsyncEnd)continue;const t=e.args["data"];n.causedFrame=!!(t&&t["INPUT_EVENT_LATENCY_RENDERER_SWAP_COMPONENT"]);if(n.hasCategory(TimelineModel.TimelineModel.Category.LatencyInfo)){if(!this._knownInputEvents.has(e.id))continue;if(n.name===TimelineModel.TimelineModel.RecordType.InputLatencyMouseMove&&!n.causedFrame)continue;const i=t["INPUT_EVENT_LATENCY_RENDERER_MAIN_COMPONENT"];if(i){const e=i["time"]/1e3;TimelineModel.TimelineData.forEvent(n.steps[0]).timeWaitingForMainThread=e-n.steps[0].startTime}}s(TimelineModel.TimelineModel.TrackType.Input).push(n);continue}}}for(const[t,i]of n){const n=this._ensureNamedTrack(t);n.thread=e;n.asyncEvents=n.asyncEvents.mergeOrdered(i,SDK.TracingModel.Event.compareStartTime)}}_processEvent(e){const t=TimelineModel.TimelineModel.RecordType;const i=this._eventStack;if(!i.length){if(this._currentTaskLayoutAndRecalcEvents&&this._currentTaskLayoutAndRecalcEvents.length){const e=this._currentTaskLayoutAndRecalcEvents.reduce((e,t)=>e+t.duration,0);if(e>TimelineModel.TimelineModel.Thresholds.ForcedLayout){for(const e of this._currentTaskLayoutAndRecalcEvents){const i=TimelineModel.TimelineData.forEvent(e);i.warning=e.name===t.Layout?TimelineModel.TimelineModel.WarningType.ForcedLayout:TimelineModel.TimelineModel.WarningType.ForcedStyle}}}this._currentTaskLayoutAndRecalcEvents=[]}if(this._currentScriptEvent&&e.startTime>this._currentScriptEvent.endTime)this._currentScriptEvent=null;const n=e.args["data"]||e.args["beginData"]||{};const s=TimelineModel.TimelineData.forEvent(e);if(n["stackTrace"])s.stackTrace=n["stackTrace"];if(s.stackTrace&&e.name!==t.JSSample){for(let e=0;e<s.stackTrace.length;++e){--s.stackTrace[e].lineNumber;--s.stackTrace[e].columnNumber}}let r=TimelineModel.TimelineModel.eventFrameId(e);if(!r&&i.length)r=TimelineModel.TimelineData.forEvent(i.peekLast()).frameId;s.frameId=r||this._mainFrame&&this._mainFrame.frameId||"";this._asyncEventTracker.processEvent(e);if(this.isMarkerEvent(e))this._ensureNamedTrack(TimelineModel.TimelineModel.TrackType.Timings);switch(e.name){case t.ResourceSendRequest:case t.WebSocketCreate:s.setInitiator(i.peekLast()||null);s.url=n["url"];break;case t.ScheduleStyleRecalculation:this._lastScheduleStyleRecalculation[n["frame"]]=e;break;case t.UpdateLayoutTree:case t.RecalculateStyles:this._invalidationTracker.didRecalcStyle(e);if(e.args["beginData"])s.setInitiator(this._lastScheduleStyleRecalculation[e.args["beginData"]["frame"]]);this._lastRecalculateStylesEvent=e;if(this._currentScriptEvent)this._currentTaskLayoutAndRecalcEvents.push(e);break;case t.ScheduleStyleInvalidationTracking:case t.StyleRecalcInvalidationTracking:case t.StyleInvalidatorInvalidationTracking:case t.LayoutInvalidationTracking:this._invalidationTracker.addInvalidation(new TimelineModel.InvalidationTrackingEvent(e));break;case t.InvalidateLayout:{let t=e;const i=n["frame"];if(!this._layoutInvalidate[i]&&this._lastRecalculateStylesEvent&&this._lastRecalculateStylesEvent.endTime>e.startTime)t=TimelineModel.TimelineData.forEvent(this._lastRecalculateStylesEvent).initiator();this._layoutInvalidate[i]=t;break}case t.Layout:{this._invalidationTracker.didLayout(e);const t=e.args["beginData"]["frame"];s.setInitiator(this._layoutInvalidate[t]);if(e.args["endData"])s.backendNodeId=e.args["endData"]["rootNode"];this._layoutInvalidate[t]=null;if(this._currentScriptEvent)this._currentTaskLayoutAndRecalcEvents.push(e);break}case t.Task:if(e.duration>TimelineModel.TimelineModel.Thresholds.LongTask)s.warning=TimelineModel.TimelineModel.WarningType.LongTask;break;case t.EventDispatch:if(e.duration>TimelineModel.TimelineModel.Thresholds.RecurringHandler)s.warning=TimelineModel.TimelineModel.WarningType.LongHandler;break;case t.TimerFire:case t.FireAnimationFrame:if(e.duration>TimelineModel.TimelineModel.Thresholds.RecurringHandler)s.warning=TimelineModel.TimelineModel.WarningType.LongRecurringHandler;break;case t.FunctionCall:if(typeof n["scriptName"]==="string")n["url"]=n["scriptName"];if(typeof n["scriptLine"]==="number")n["lineNumber"]=n["scriptLine"];case t.EvaluateScript:case t.CompileScript:if(typeof n["lineNumber"]==="number")--n["lineNumber"];if(typeof n["columnNumber"]==="number")--n["columnNumber"];case t.RunMicrotasks:if(!this._currentScriptEvent)this._currentScriptEvent=e;break;case t.SetLayerTreeId:if(this._sessionId&&n["sessionId"]&&this._sessionId===n["sessionId"]){this._mainFrameLayerTreeId=n["layerTreeId"];break}const r=TimelineModel.TimelineModel.eventFrameId(e);const a=this._pageFrames.get(r);if(!a||a.parent)return false;this._mainFrameLayerTreeId=n["layerTreeId"];break;case t.Paint:{this._invalidationTracker.didPaint(e);s.backendNodeId=n["nodeId"];if(!n["layerId"])break;const t=n["layerId"];this._lastPaintForLayer[t]=e;break}case t.DisplayItemListSnapshot:case t.PictureSnapshot:{const i=this._findAncestorEvent(t.UpdateLayer);if(!i||i.args["layerTreeId"]!==this._mainFrameLayerTreeId)break;const n=this._lastPaintForLayer[i.args["layerId"]];if(n){TimelineModel.TimelineData.forEvent(n).picture=e}break}case t.ScrollLayer:s.backendNodeId=n["nodeId"];break;case t.PaintImage:s.backendNodeId=n["nodeId"];s.url=n["url"];break;case t.DecodeImage:case t.ResizeImage:{let e=this._findAncestorEvent(t.PaintImage);if(!e){const i=this._findAncestorEvent(t.DecodeLazyPixelRef);e=i&&this._paintImageEventByPixelRefId[i.args["LazyPixelRef"]]}if(!e)break;const i=TimelineModel.TimelineData.forEvent(e);s.backendNodeId=i.backendNodeId;s.url=i.url;break}case t.DrawLazyPixelRef:{const i=this._findAncestorEvent(t.PaintImage);if(!i)break;this._paintImageEventByPixelRefId[e.args["LazyPixelRef"]]=i;const n=TimelineModel.TimelineData.forEvent(i);s.backendNodeId=n.backendNodeId;s.url=n.url;break}case t.FrameStartedLoading:if(s.frameId!==e.args["frame"])return false;break;case t.MarkDOMContent:case t.MarkLoad:{const t=TimelineModel.TimelineModel.eventFrameId(e);if(!this._pageFrames.has(t))return false;break}case t.CommitLoad:{if(this._browserFrameTracking)break;const t=TimelineModel.TimelineModel.eventFrameId(e);const i=!!n["isMainFrame"];const s=this._pageFrames.get(t);if(s){s.update(e.startTime,n)}else{if(!this._persistentIds){if(n["page"]&&n["page"]!==this._legacyCurrentPage)return false}else if(i){return false}else if(!this._addPageFrame(e,n)){return false}}if(i)this._mainFrame=this._pageFrames.get(t);break}case t.FireIdleCallback:if(e.duration>n["allottedMilliseconds"]+TimelineModel.TimelineModel.Thresholds.IdleCallbackAddon)s.warning=TimelineModel.TimelineModel.WarningType.IdleDeadlineExceeded;break}return true}_processBrowserEvent(e){if(e.name===TimelineModel.TimelineModel.RecordType.LatencyInfoFlow){const t=e.args["frameTreeNodeId"];if(typeof t==="number"&&t===this._mainFrameNodeId)this._knownInputEvents.add(e.bind_id);return}if(e.hasCategory(SDK.TracingModel.DevToolsMetadataEventCategory)&&e.args["data"]){const t=e.args["data"];if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.TracingStartedInBrowser){if(!t["persistentIds"])return;this._browserFrameTracking=true;this._mainFrameNodeId=t["frameTreeNodeId"];const e=t["frames"]||[];e.forEach(e=>{const t=e["parent"]&&this._pageFrames.get(e["parent"]);if(e["parent"]&&!t)return;let i=this._pageFrames.get(e["frame"]);if(!i){i=new TimelineModel.TimelineModel.PageFrame(e);this._pageFrames.set(i.frameId,i);if(t)t.addChild(i);else this._mainFrame=i}i.update(this._minimumRecordTime,e)});return}if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.FrameCommittedInBrowser&&this._browserFrameTracking){let i=this._pageFrames.get(t["frame"]);if(!i){const e=t["parent"]&&this._pageFrames.get(t["parent"]);if(!e)return;i=new TimelineModel.TimelineModel.PageFrame(t);this._pageFrames.set(i.frameId,i);e.addChild(i)}i.update(e.startTime,t);return}if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.ProcessReadyInBrowser&&this._browserFrameTracking){const e=this._pageFrames.get(t["frame"]);if(e)e.processReady(t["processPseudoId"],t["processId"]);return}if(e.name===TimelineModel.TimelineModel.DevToolsMetadataEvent.FrameDeletedInBrowser&&this._browserFrameTracking){const i=this._pageFrames.get(t["frame"]);if(i)i.deletedTime=e.startTime;return}}}_ensureNamedTrack(e){if(!this._namedTracks.has(e)){const t=new TimelineModel.TimelineModel.Track;t.type=e;this._tracks.push(t);this._namedTracks.set(e,t)}return this._namedTracks.get(e)}_findAncestorEvent(e){for(let t=this._eventStack.length-1;t>=0;--t){const i=this._eventStack[t];if(i.name===e)return i}return null}_addPageFrame(e,t){const i=t["parent"]&&this._pageFrames.get(t["parent"]);if(t["parent"]&&!i)return false;const n=new TimelineModel.TimelineModel.PageFrame(t);this._pageFrames.set(n.frameId,n);n.update(e.startTime,t);if(i)i.addChild(n);return true}_reset(){this._isGenericTrace=false;this._tracks=[];this._namedTracks=new Map;this._inspectedTargetEvents=[];this._timeMarkerEvents=[];this._sessionId=null;this._mainFrameNodeId=null;this._cpuProfiles=[];this._workerIdByThread=new WeakMap;this._pageFrames=new Map;this._mainFrame=null;this._minimumRecordTime=0;this._maximumRecordTime=0}isGenericTrace(){return this._isGenericTrace}tracingModel(){return this._tracingModel}minimumRecordTime(){return this._minimumRecordTime}maximumRecordTime(){return this._maximumRecordTime}inspectedTargetEvents(){return this._inspectedTargetEvents}tracks(){return this._tracks}isEmpty(){return this.minimumRecordTime()===0&&this.maximumRecordTime()===0}timeMarkerEvents(){return this._timeMarkerEvents}rootFrames(){return Array.from(this._pageFrames.values()).filter(e=>!e.parent)}pageURL(){return this._mainFrame&&this._mainFrame.url||""}pageFrameById(e){return e?this._pageFrames.get(e)||null:null}networkRequests(){if(this.isGenericTrace())return[];const e=new Map;const t=[];const i=[];const n=TimelineModel.TimelineModel.RecordType;const s=new Set([n.ResourceSendRequest,n.ResourceReceiveResponse,n.ResourceReceivedData,n.ResourceFinish]);const r=this.inspectedTargetEvents();for(let n=0;n<r.length;++n){const a=r[n];if(!s.has(a.name))continue;const o=TimelineModel.TimelineModel.globalEventId(a,"requestId");let l=e.get(o);if(l){l.addEvent(a)}else{l=new TimelineModel.TimelineModel.NetworkRequest(a);e.set(o,l);if(l.startTime)t.push(l);else i.push(l)}}return i.concat(t)}};TimelineModel.TimelineModel.RecordType={Task:"RunTask",Program:"Program",EventDispatch:"EventDispatch",GPUTask:"GPUTask",Animation:"Animation",RequestMainThreadFrame:"RequestMainThreadFrame",BeginFrame:"BeginFrame",NeedsBeginFrameChanged:"NeedsBeginFrameChanged",BeginMainThreadFrame:"BeginMainThreadFrame",ActivateLayerTree:"ActivateLayerTree",DrawFrame:"DrawFrame",HitTest:"HitTest",ScheduleStyleRecalculation:"ScheduleStyleRecalculation",RecalculateStyles:"RecalculateStyles",UpdateLayoutTree:"UpdateLayoutTree",InvalidateLayout:"InvalidateLayout",Layout:"Layout",UpdateLayer:"UpdateLayer",UpdateLayerTree:"UpdateLayerTree",PaintSetup:"PaintSetup",Paint:"Paint",PaintImage:"PaintImage",Rasterize:"Rasterize",RasterTask:"RasterTask",ScrollLayer:"ScrollLayer",CompositeLayers:"CompositeLayers",ScheduleStyleInvalidationTracking:"ScheduleStyleInvalidationTracking",StyleRecalcInvalidationTracking:"StyleRecalcInvalidationTracking",StyleInvalidatorInvalidationTracking:"StyleInvalidatorInvalidationTracking",LayoutInvalidationTracking:"LayoutInvalidationTracking",ParseHTML:"ParseHTML",ParseAuthorStyleSheet:"ParseAuthorStyleSheet",TimerInstall:"TimerInstall",TimerRemove:"TimerRemove",TimerFire:"TimerFire",XHRReadyStateChange:"XHRReadyStateChange",XHRLoad:"XHRLoad",CompileScript:"v8.compile",EvaluateScript:"EvaluateScript",CompileModule:"v8.compileModule",EvaluateModule:"v8.evaluateModule",WasmStreamFromResponseCallback:"v8.wasm.streamFromResponseCallback",WasmCompiledModule:"v8.wasm.compiledModule",WasmCachedModule:"v8.wasm.cachedModule",WasmModuleCacheHit:"v8.wasm.moduleCacheHit",WasmModuleCacheInvalid:"v8.wasm.moduleCacheInvalid",FrameStartedLoading:"FrameStartedLoading",CommitLoad:"CommitLoad",MarkLoad:"MarkLoad",MarkDOMContent:"MarkDOMContent",MarkFirstPaint:"firstPaint",MarkFCP:"firstContentfulPaint",MarkFMP:"firstMeaningfulPaint",TimeStamp:"TimeStamp",ConsoleTime:"ConsoleTime",UserTiming:"UserTiming",ResourceSendRequest:"ResourceSendRequest",ResourceReceiveResponse:"ResourceReceiveResponse",ResourceReceivedData:"ResourceReceivedData",ResourceFinish:"ResourceFinish",RunMicrotasks:"RunMicrotasks",FunctionCall:"FunctionCall",GCEvent:"GCEvent",MajorGC:"MajorGC",MinorGC:"MinorGC",JSFrame:"JSFrame",JSSample:"JSSample",V8Sample:"V8Sample",JitCodeAdded:"JitCodeAdded",JitCodeMoved:"JitCodeMoved",ParseScriptOnBackground:"v8.parseOnBackground",V8Execute:"V8.Execute",UpdateCounters:"UpdateCounters",RequestAnimationFrame:"RequestAnimationFrame",CancelAnimationFrame:"CancelAnimationFrame",FireAnimationFrame:"FireAnimationFrame",RequestIdleCallback:"RequestIdleCallback",CancelIdleCallback:"CancelIdleCallback",FireIdleCallback:"FireIdleCallback",WebSocketCreate:"WebSocketCreate",WebSocketSendHandshakeRequest:"WebSocketSendHandshakeRequest",WebSocketReceiveHandshakeResponse:"WebSocketReceiveHandshakeResponse",WebSocketDestroy:"WebSocketDestroy",EmbedderCallback:"EmbedderCallback",SetLayerTreeId:"SetLayerTreeId",TracingStartedInPage:"TracingStartedInPage",TracingSessionIdForWorker:"TracingSessionIdForWorker",DecodeImage:"Decode Image",ResizeImage:"Resize Image",DrawLazyPixelRef:"Draw LazyPixelRef",DecodeLazyPixelRef:"Decode LazyPixelRef",LazyPixelRef:"LazyPixelRef",LayerTreeHostImplSnapshot:"cc::LayerTreeHostImpl",PictureSnapshot:"cc::Picture",DisplayItemListSnapshot:"cc::DisplayItemList",LatencyInfo:"LatencyInfo",LatencyInfoFlow:"LatencyInfo.Flow",InputLatencyMouseMove:"InputLatency::MouseMove",InputLatencyMouseWheel:"InputLatency::MouseWheel",ImplSideFling:"InputHandlerProxy::HandleGestureFling::started",GCCollectGarbage:"BlinkGC.AtomicPhase",CryptoDoEncrypt:"DoEncrypt",CryptoDoEncryptReply:"DoEncryptReply",CryptoDoDecrypt:"DoDecrypt",CryptoDoDecryptReply:"DoDecryptReply",CryptoDoDigest:"DoDigest",CryptoDoDigestReply:"DoDigestReply",CryptoDoSign:"DoSign",CryptoDoSignReply:"DoSignReply",CryptoDoVerify:"DoVerify",CryptoDoVerifyReply:"DoVerifyReply",CpuProfile:"CpuProfile",Profile:"Profile",AsyncTask:"AsyncTask"};TimelineModel.TimelineModel.Category={Console:"blink.console",UserTiming:"blink.user_timing",LatencyInfo:"latencyInfo"};TimelineModel.TimelineModel.WarningType={LongTask:"LongTask",ForcedStyle:"ForcedStyle",ForcedLayout:"ForcedLayout",IdleDeadlineExceeded:"IdleDeadlineExceeded",LongHandler:"LongHandler",LongRecurringHandler:"LongRecurringHandler",V8Deopt:"V8Deopt"};TimelineModel.TimelineModel.WorkerThreadName="DedicatedWorker thread";TimelineModel.TimelineModel.WorkerThreadNameLegacy="DedicatedWorker Thread";TimelineModel.TimelineModel.RendererMainThreadName="CrRendererMain";TimelineModel.TimelineModel.BrowserMainThreadName="CrBrowserMain";TimelineModel.TimelineModel.DevToolsMetadataEvent={TracingStartedInBrowser:"TracingStartedInBrowser",TracingStartedInPage:"TracingStartedInPage",TracingSessionIdForWorker:"TracingSessionIdForWorker",FrameCommittedInBrowser:"FrameCommittedInBrowser",ProcessReadyInBrowser:"ProcessReadyInBrowser",FrameDeletedInBrowser:"FrameDeletedInBrowser"};TimelineModel.TimelineModel.Thresholds={LongTask:200,Handler:150,RecurringHandler:50,ForcedLayout:30,IdleCallbackAddon:5};TimelineModel.TimelineModel.Track=class{constructor(){this.name="";this.type=TimelineModel.TimelineModel.TrackType.Other;this.forMainFrame=false;this.url="";this.events=[];this.asyncEvents=[];this.tasks=[];this._syncEvents=null;this.thread=null}syncEvents(){if(this.events.length)return this.events;if(this._syncEvents)return this._syncEvents;const e=[];this._syncEvents=[];for(const t of this.asyncEvents){const i=t.startTime;const n=t.endTime;while(e.length&&i>=e.peekLast().endTime)e.pop();if(e.length&&n>e.peekLast().endTime){this._syncEvents=[];break}const s=new SDK.TracingModel.Event(t.categoriesString,t.name,SDK.TracingModel.Phase.Complete,i,t.thread);s.setEndTime(n);s.addArgs(t.args);this._syncEvents.push(s);e.push(s)}return this._syncEvents}};TimelineModel.TimelineModel.TrackType={MainThread:Symbol("MainThread"),Worker:Symbol("Worker"),Input:Symbol("Input"),Animation:Symbol("Animation"),Timings:Symbol("Timings"),Console:Symbol("Console"),Raster:Symbol("Raster"),GPU:Symbol("GPU"),Other:Symbol("Other")};TimelineModel.TimelineModel.PageFrame=class{constructor(e){this.frameId=e["frame"];this.url=e["url"]||"";this.name=e["name"];this.children=[];this.parent=null;this.processes=[];this.deletedTime=null;this.ownerNode=null}update(e,t){this.url=t["url"]||"";this.name=t["name"];if(t["processId"]){this.processes.push({time:e,processId:t["processId"],processPseudoId:"",url:t["url"]||""})}else{this.processes.push({time:e,processId:-1,processPseudoId:t["processPseudoId"],url:t["url"]||""})}}processReady(e,t){for(const i of this.processes){if(i.processPseudoId===e){i.processPseudoId="";i.processId=t}}}addChild(e){this.children.push(e);e.parent=this}};TimelineModel.TimelineModel.MetadataEvents;TimelineModel.TimelineModel.NetworkRequest=class{constructor(e){this.startTime=e.name===TimelineModel.TimelineModel.RecordType.ResourceSendRequest?e.startTime:0;this.endTime=Infinity;this.encodedDataLength=0;this.decodedBodyLength=0;this.children=[];this.timing;this.mimeType;this.url;this.requestMethod;this.addEvent(e)}addEvent(e){this.children.push(e);const t=TimelineModel.TimelineModel.RecordType;this.startTime=Math.min(this.startTime,e.startTime);const i=e.args["data"];if(i["mimeType"])this.mimeType=i["mimeType"];if("priority"in i)this.priority=i["priority"];if(e.name===t.ResourceFinish)this.endTime=e.startTime;if(i["finishTime"])this.finishTime=i["finishTime"]*1e3;if(!this.responseTime&&(e.name===t.ResourceReceiveResponse||e.name===t.ResourceReceivedData))this.responseTime=e.startTime;const n=i["encodedDataLength"]||0;if(e.name===t.ResourceReceiveResponse){if(i["fromCache"])this.fromCache=true;if(i["fromServiceWorker"])this.fromServiceWorker=true;this.encodedDataLength=n}if(e.name===t.ResourceReceivedData)this.encodedDataLength+=n;if(e.name===t.ResourceFinish&&n)this.encodedDataLength=n;const s=i["decodedBodyLength"];if(e.name===t.ResourceFinish&&s)this.decodedBodyLength=s;if(!this.url)this.url=i["url"];if(!this.requestMethod)this.requestMethod=i["requestMethod"];if(!this.timing)this.timing=i["timing"];if(i["fromServiceWorker"])this.fromServiceWorker=true}beginTime(){return Math.min(this.startTime,this.timing&&this.timing.requestTime*1e3||Infinity,this.timing&&this.timing.pushStart*1e3||Infinity)}};TimelineModel.InvalidationTrackingEvent=class{constructor(e){this.type=e.name;this.startTime=e.startTime;this._tracingEvent=e;const t=e.args["data"];this.frame=t["frame"];this.nodeId=t["nodeId"];this.nodeName=t["nodeName"];this.invalidationSet=t["invalidationSet"];this.invalidatedSelectorId=t["invalidatedSelectorId"];this.changedId=t["changedId"];this.changedClass=t["changedClass"];this.changedAttribute=t["changedAttribute"];this.changedPseudo=t["changedPseudo"];this.selectorPart=t["selectorPart"];this.extraData=t["extraData"];this.invalidationList=t["invalidationList"];this.cause={reason:t["reason"],stackTrace:t["stackTrace"]};if(!this.cause.reason&&this.cause.stackTrace&&this.type===TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking)this.cause.reason="Layout forced"}};TimelineModel.InvalidationCause;TimelineModel.InvalidationTracker=class{constructor(){this._lastRecalcStyle=null;this._lastPaintWithLayer=null;this._didPaint=false;this._initializePerFrameState()}static invalidationEventsFor(e){return e[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol]||null}addInvalidation(e){this._startNewFrameIfNeeded();if(!e.nodeId){console.error("Invalidation lacks node information.");console.error(e);return}const t=TimelineModel.TimelineModel.RecordType;if(e.type===t.StyleRecalcInvalidationTracking&&e.cause.reason==="StyleInvalidator")return;const i=e.type===t.ScheduleStyleInvalidationTracking||e.type===t.StyleInvalidatorInvalidationTracking||e.type===t.StyleRecalcInvalidationTracking;if(i){const t=e.startTime&&this._lastRecalcStyle&&e.startTime>=this._lastRecalcStyle.startTime&&e.startTime<=this._lastRecalcStyle.endTime;if(t)this._associateWithLastRecalcStyleEvent(e)}if(this._invalidations[e.type])this._invalidations[e.type].push(e);else this._invalidations[e.type]=[e];if(e.nodeId){if(this._invalidationsByNodeId[e.nodeId])this._invalidationsByNodeId[e.nodeId].push(e);else this._invalidationsByNodeId[e.nodeId]=[e]}}didRecalcStyle(e){this._lastRecalcStyle=e;const t=[TimelineModel.TimelineModel.RecordType.ScheduleStyleInvalidationTracking,TimelineModel.TimelineModel.RecordType.StyleInvalidatorInvalidationTracking,TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking];for(const e of this._invalidationsOfTypes(t))this._associateWithLastRecalcStyleEvent(e)}_associateWithLastRecalcStyleEvent(e){if(e.linkedRecalcStyleEvent)return;const t=TimelineModel.TimelineModel.RecordType;const i=this._lastRecalcStyle.args["beginData"]["frame"];if(e.type===t.StyleInvalidatorInvalidationTracking){this._addSyntheticStyleRecalcInvalidations(this._lastRecalcStyle,i,e)}else if(e.type===t.ScheduleStyleInvalidationTracking){}else{this._addInvalidationToEvent(this._lastRecalcStyle,i,e)}e.linkedRecalcStyleEvent=true}_addSyntheticStyleRecalcInvalidations(e,t,i){if(!i.invalidationList){this._addSyntheticStyleRecalcInvalidation(i._tracingEvent,i);return}if(!i.nodeId){console.error("Invalidation lacks node information.");console.error(i);return}for(let e=0;e<i.invalidationList.length;e++){const n=i.invalidationList[e]["id"];let s;const r=this._invalidationsByNodeId[i.nodeId]||[];for(let e=0;e<r.length;e++){const i=r[e];if(i.frame!==t||i.invalidationSet!==n||i.type!==TimelineModel.TimelineModel.RecordType.ScheduleStyleInvalidationTracking)continue;s=i}if(!s){console.error("Failed to lookup the event that scheduled a style invalidator invalidation.");continue}this._addSyntheticStyleRecalcInvalidation(s._tracingEvent,i)}}_addSyntheticStyleRecalcInvalidation(e,t){const i=new TimelineModel.InvalidationTrackingEvent(e);i.type=TimelineModel.TimelineModel.RecordType.StyleRecalcInvalidationTracking;if(t.cause.reason)i.cause.reason=t.cause.reason;if(t.selectorPart)i.selectorPart=t.selectorPart;this.addInvalidation(i);if(!i.linkedRecalcStyleEvent)this._associateWithLastRecalcStyleEvent(i)}didLayout(e){const t=e.args["beginData"]["frame"];for(const i of this._invalidationsOfTypes([TimelineModel.TimelineModel.RecordType.LayoutInvalidationTracking])){if(i.linkedLayoutEvent)continue;this._addInvalidationToEvent(e,t,i);i.linkedLayoutEvent=true}}didPaint(e){this._didPaint=true}_addInvalidationToEvent(e,t,i){if(t!==i.frame)return;if(!e[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol])e[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol]=[i];else e[TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol].push(i)}_invalidationsOfTypes(e){const t=this._invalidations;if(!e)e=Object.keys(t);function*i(){for(let i=0;i<e.length;++i){const n=t[e[i]]||[];for(let e=0;e<n.length;++e)yield n[e]}}return i()}_startNewFrameIfNeeded(){if(!this._didPaint)return;this._initializePerFrameState()}_initializePerFrameState(){this._invalidations={};this._invalidationsByNodeId={};this._lastRecalcStyle=null;this._lastPaintWithLayer=null;this._didPaint=false}};TimelineModel.InvalidationTracker._invalidationTrackingEventsSymbol=Symbol("invalidationTrackingEvents");TimelineModel.TimelineAsyncEventTracker=class{constructor(){TimelineModel.TimelineAsyncEventTracker._initialize();this._initiatorByType=new Map;for(const e of TimelineModel.TimelineAsyncEventTracker._asyncEvents.keys())this._initiatorByType.set(e,new Map)}static _initialize(){if(TimelineModel.TimelineAsyncEventTracker._asyncEvents)return;const e=new Map;let t=TimelineModel.TimelineModel.RecordType;e.set(t.TimerInstall,{causes:[t.TimerFire],joinBy:"timerId"});e.set(t.ResourceSendRequest,{causes:[t.ResourceReceiveResponse,t.ResourceReceivedData,t.ResourceFinish],joinBy:"requestId"});e.set(t.RequestAnimationFrame,{causes:[t.FireAnimationFrame],joinBy:"id"});e.set(t.RequestIdleCallback,{causes:[t.FireIdleCallback],joinBy:"id"});e.set(t.WebSocketCreate,{causes:[t.WebSocketSendHandshakeRequest,t.WebSocketReceiveHandshakeResponse,t.WebSocketDestroy],joinBy:"identifier"});TimelineModel.TimelineAsyncEventTracker._asyncEvents=e;TimelineModel.TimelineAsyncEventTracker._typeToInitiator=new Map;for(const i of e){const e=i[1].causes;for(t of e)TimelineModel.TimelineAsyncEventTracker._typeToInitiator.set(t,i[0])}}processEvent(e){let t=TimelineModel.TimelineAsyncEventTracker._typeToInitiator.get(e.name);const i=!t;if(!t)t=e.name;const n=TimelineModel.TimelineAsyncEventTracker._asyncEvents.get(t);if(!n)return;const s=TimelineModel.TimelineModel.globalEventId(e,n.joinBy);if(!s)return;const r=this._initiatorByType.get(t);if(i){r.set(s,e);return}const a=r.get(s)||null;const o=TimelineModel.TimelineData.forEvent(e);o.setInitiator(a);if(!o.frameId&&a)o.frameId=TimelineModel.TimelineModel.eventFrameId(a)}};TimelineModel.TimelineData=class{constructor(){this.warning=null;this.previewElement=null;this.url=null;this.backendNodeId=0;this.stackTrace=null;this.picture=null;this._initiator=null;this.frameId="";this.timeWaitingForMainThread}setInitiator(e){this._initiator=e;if(!e||this.url)return;const t=TimelineModel.TimelineData.forEvent(e).url;if(t)this.url=t}initiator(){return this._initiator}topFrame(){const e=this.stackTraceForSelfOrInitiator();return e&&e[0]||null}stackTraceForSelfOrInitiator(){return this.stackTrace||this._initiator&&TimelineModel.TimelineData.forEvent(this._initiator).stackTrace}static forEvent(e){let t=e[TimelineModel.TimelineData._symbol];if(!t){t=new TimelineModel.TimelineData;e[TimelineModel.TimelineData._symbol]=t}return t}};TimelineModel.TimelineData._symbol=Symbol("timelineData");TimelineModel.TimelineIRModel=class{constructor(){this.reset()}static phaseForEvent(e){return e[TimelineModel.TimelineIRModel._eventIRPhase]}populate(e,t){this.reset();if(!e)return;this._processInputLatencies(e);if(t)this._processAnimations(t);const i=new Common.SegmentedRange;i.appendRange(this._drags);i.appendRange(this._cssAnimations);i.appendRange(this._scrolls);i.appendRange(this._responses);this._segments=i.segments()}_processInputLatencies(e){const t=TimelineModel.TimelineIRModel.InputEvents;const i=TimelineModel.TimelineIRModel.Phases;const n=TimelineModel.TimelineIRModel._mergeThresholdsMs;let s;let r;let a;let o;let l;let d;let c;for(let h=0;h<e.length;++h){const T=e[h];if(h>0&&e[h].startTime<e[h-1].startTime)console.assert(false,"Unordered input events");const u=this._inputEventType(T.name);switch(u){case t.ScrollBegin:this._scrolls.append(this._segmentForEvent(T,i.Scroll));s=T;break;case t.ScrollEnd:if(s)this._scrolls.append(this._segmentForEventRange(s,T,i.Scroll));else this._scrolls.append(this._segmentForEvent(T,i.Scroll));s=null;break;case t.ScrollUpdate:a=null;this._scrolls.append(this._segmentForEvent(T,i.Scroll));break;case t.FlingStart:if(r){Common.console.error(Common.UIString("Two flings at the same time? %s vs %s",r.startTime,T.startTime));break}r=T;break;case t.FlingCancel:if(!r)break;this._scrolls.append(this._segmentForEventRange(r,T,i.Fling));r=null;break;case t.ImplSideFling:this._scrolls.append(this._segmentForEvent(T,i.Fling));break;case t.ShowPress:case t.Tap:case t.KeyDown:case t.KeyDownRaw:case t.KeyUp:case t.Char:case t.Click:case t.ContextMenu:this._responses.append(this._segmentForEvent(T,i.Response));break;case t.TouchStart:if(a){Common.console.error(Common.UIString("Two touches at the same time? %s vs %s",a.startTime,T.startTime));break}a=T;T.steps[0][TimelineModel.TimelineIRModel._eventIRPhase]=i.Response;o=null;break;case t.TouchCancel:a=null;break;case t.TouchMove:if(o){this._drags.append(this._segmentForEvent(T,i.Drag))}else if(a){o=T;this._responses.append(this._segmentForEventRange(a,T,i.Response))}break;case t.TouchEnd:a=null;break;case t.MouseDown:d=T;c=null;break;case t.MouseMove:if(d&&!c&&d.startTime+n.mouse>T.startTime){this._responses.append(this._segmentForEvent(d,i.Response));this._responses.append(this._segmentForEvent(T,i.Response))}else if(d){this._drags.append(this._segmentForEvent(T,i.Drag))}c=T;break;case t.MouseUp:this._responses.append(this._segmentForEvent(T,i.Response));d=null;break;case t.MouseWheel:if(l&&m(n.mouse,l,T))this._scrolls.append(this._segmentForEventRange(l,T,i.Scroll));else this._scrolls.append(this._segmentForEvent(T,i.Scroll));l=T;break}}function m(e,t,i){return t.endTime<i.startTime&&i.startTime<t.endTime+e}}_processAnimations(e){for(let t=0;t<e.length;++t)this._cssAnimations.append(this._segmentForEvent(e[t],TimelineModel.TimelineIRModel.Phases.Animation))}_segmentForEvent(e,t){this._setPhaseForEvent(e,t);return new Common.Segment(e.startTime,e.endTime,t)}_segmentForEventRange(e,t,i){this._setPhaseForEvent(e,i);this._setPhaseForEvent(t,i);return new Common.Segment(e.startTime,t.endTime,i)}_setPhaseForEvent(e,t){e.steps[0][TimelineModel.TimelineIRModel._eventIRPhase]=t}interactionRecords(){return this._segments}reset(){const e=TimelineModel.TimelineIRModel._mergeThresholdsMs;this._segments=[];this._drags=new Common.SegmentedRange(t.bind(null,e.mouse));this._cssAnimations=new Common.SegmentedRange(t.bind(null,e.animation));this._responses=new Common.SegmentedRange(t.bind(null,0));this._scrolls=new Common.SegmentedRange(t.bind(null,e.animation));function t(e,t,i){return t.end+e>=i.begin&&t.data===i.data?t:null}}_inputEventType(e){const t="InputLatency::";if(!e.startsWith(t)){if(e===TimelineModel.TimelineIRModel.InputEvents.ImplSideFling)return e;console.error("Unrecognized input latency event: "+e);return null}return e.substr(t.length)}};TimelineModel.TimelineIRModel.Phases={Idle:"Idle",Response:"Response",Scroll:"Scroll",Fling:"Fling",Drag:"Drag",Animation:"Animation",Uncategorized:"Uncategorized"};TimelineModel.TimelineIRModel.InputEvents={Char:"Char",Click:"GestureClick",ContextMenu:"ContextMenu",FlingCancel:"GestureFlingCancel",FlingStart:"GestureFlingStart",ImplSideFling:TimelineModel.TimelineModel.RecordType.ImplSideFling,KeyDown:"KeyDown",KeyDownRaw:"RawKeyDown",KeyUp:"KeyUp",LatencyScrollUpdate:"ScrollUpdate",MouseDown:"MouseDown",MouseMove:"MouseMove",MouseUp:"MouseUp",MouseWheel:"MouseWheel",PinchBegin:"GesturePinchBegin",PinchEnd:"GesturePinchEnd",PinchUpdate:"GesturePinchUpdate",ScrollBegin:"GestureScrollBegin",ScrollEnd:"GestureScrollEnd",ScrollUpdate:"GestureScrollUpdate",ScrollUpdateRenderer:"ScrollUpdate",ShowPress:"GestureShowPress",Tap:"GestureTap",TapCancel:"GestureTapCancel",TapDown:"GestureTapDown",TouchCancel:"TouchCancel",TouchEnd:"TouchEnd",TouchMove:"TouchMove",TouchStart:"TouchStart"};TimelineModel.TimelineIRModel._mergeThresholdsMs={animation:1,mouse:40};TimelineModel.TimelineIRModel._eventIRPhase=Symbol("eventIRPhase");TimelineModel.TimelineJSProfileProcessor=class{static generateTracingEventsFromCpuProfile(e,t){const i=e.idleNode;const n=e.programNode;const s=e.gcNode;const r=e.samples;const a=e.timestamps;const o=[];const l=new Map;l.set(n,[]);for(let n=0;n<r.length;++n){let d=e.nodeByIndex(n);if(!d){console.error(`Node with unknown id ${r[n]} at index ${n}`);continue}if(d===s||d===i)continue;let c=l.get(d);if(!c){c=new Array(d.depth+1);l.set(d,c);for(let e=0;d.parent;d=d.parent)c[e++]=d}const m=new SDK.TracingModel.Event(SDK.TracingModel.DevToolsTimelineEventCategory,TimelineModel.TimelineModel.RecordType.JSSample,SDK.TracingModel.Phase.Instant,a[n],t);m.args["data"]={stackTrace:c};o.push(m)}return o}static generateJSFrameEvents(e){function t(e,t){return e.scriptId===t.scriptId&&e.functionName===t.functionName&&e.lineNumber===t.lineNumber}function i(e){switch(e.name){case TimelineModel.TimelineModel.RecordType.RunMicrotasks:case TimelineModel.TimelineModel.RecordType.FunctionCall:case TimelineModel.TimelineModel.RecordType.EvaluateScript:case TimelineModel.TimelineModel.RecordType.EvaluateModule:case TimelineModel.TimelineModel.RecordType.EventDispatch:case TimelineModel.TimelineModel.RecordType.V8Execute:return true}return false}const n=[];const s=[];const r=[];let a=0;const o=Runtime.experiments.isEnabled("timelineShowAllEvents");const l=Runtime.experiments.isEnabled("timelineV8RuntimeCallStats");const d=Common.moduleSetting("showNativeFunctionsInJSProfile").get();function c(e){e.ordinal=++a;f(e);r.push(s.length)}function m(e,t){e.ordinal=++a;if(t&&i(t))f(e)}function h(e){T(r.pop(),e.endTime)}function T(e,t){if(r.length){const i=r.peekLast();if(e<i){console.error(`Child stack is shallower (${e}) than the parent stack (${i}) at ${t}`);e=i}}if(s.length<e){console.error(`Trying to truncate higher than the current stack size at ${t}`);e=s.length}for(let e=0;e<s.length;++e)s[e].setEndTime(t);s.length=e}function u(e){return l&&!!TimelineModel.TimelineJSProfileProcessor.nativeGroup(e)}function p(e){if(o)return;let t=null;let i=0;for(let n=0;n<e.length;++n){const s=e[n];const r=s.url;const a=r&&r.startsWith("native ");if(!d&&a)continue;const o=TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(s);if(o&&!u(s.functionName))continue;const l=o?TimelineModel.TimelineJSProfileProcessor.nativeGroup(s.functionName):null;if(t&&t===l)continue;t=l;e[i++]=s}e.length=i}function f(e){const i=TimelineModel.TimelineModel.RecordType;const a=e.name===i.JSSample?e.args["data"]["stackTrace"].slice().reverse():s.map(e=>e.args["data"]);p(a);const o=e.endTime||e.startTime;const l=Math.min(a.length,s.length);let d;for(d=r.peekLast()||0;d<l;++d){const e=a[d];const i=s[d].args["data"];if(!t(e,i))break;s[d].setEndTime(Math.max(s[d].endTime,o))}T(d,e.startTime);for(;d<a.length;++d){const t=a[d];const r=new SDK.TracingModel.Event(SDK.TracingModel.DevToolsTimelineEventCategory,i.JSFrame,SDK.TracingModel.Phase.Complete,e.startTime,e.thread);r.ordinal=e.ordinal;r.addArgs({data:t});r.setEndTime(o);s.push(r);n.push(r)}}const g=e.find(SDK.TracingModel.isTopLevelEvent);const _=g?g.startTime:0;TimelineModel.TimelineModel.forEachEvent(e,c,h,m,_);return n}static isNativeRuntimeFrame(e){return e.url==="native V8Runtime"}static nativeGroup(e){if(e.startsWith("Parse"))return TimelineModel.TimelineJSProfileProcessor.NativeGroups.Parse;if(e.startsWith("Compile")||e.startsWith("Recompile"))return TimelineModel.TimelineJSProfileProcessor.NativeGroups.Compile;return null}static buildTraceProfileFromCpuProfile(e,t,i,n){const s=[];if(i)u("TracingStartedInPage",{data:{sessionId:"1"}},0,0,"M");if(!n)n=ls`Thread ${t}`;u(SDK.TracingModel.MetadataEvent.ThreadName,{name:n},0,0,"M","__metadata");if(!e)return s;const r=new Map;const a=e["nodes"];for(let e=0;e<a.length;++e)r.set(a[e].id,a[e]);let o=null;let l=null;let d=e.startTime;let c;const m=e["samples"];const h=e["timeDeltas"];for(let e=0;e<m.length;++e){c=d;d+=h[e];const t=r.get(m[e]);const i=t.callFrame.functionName;if(i==="(idle)"){T();continue}if(!o)o=u("MessageLoop::RunTask",{},c,0,"X","toplevel");if(i==="(program)"){if(l){l.dur=c-l.ts;l=null}}else{if(!l)l=u("FunctionCall",{data:{sessionId:"1"}},c)}}T();u("CpuProfile",{data:{cpuProfile:e}},e.endTime,0,"I");return s;function T(){if(o)o.dur=c-o.ts;if(l)l.dur=c-l.ts;o=null;l=null}function u(e,i,n,r,a,o){const l={cat:o||"disabled-by-default-devtools.timeline",name:e,ph:a||"X",pid:1,tid:t,ts:n,args:i};if(r)l.dur=r;s.push(l);return l}}};TimelineModel.TimelineJSProfileProcessor.NativeGroups={Compile:"Compile",Parse:"Parse"};TimelineModel.TimelineFrameModel=class{constructor(e){this._categoryMapper=e;this.reset()}frames(e,t){if(!e&&!t)return this._frames;const i=this._frames.lowerBound(e||0,(e,t)=>e-t.endTime);const n=this._frames.lowerBound(t||Infinity,(e,t)=>e-t.startTime);return this._frames.slice(i,n)}hasRasterTile(e){const t=e.args["tileData"];if(!t)return false;const i=t["sourceFrameNumber"];const n=i&&this._frameById[i];if(!n||!n.layerTree)return false;return true}rasterTilePromise(e){if(!this._target)return Promise.resolve(null);const t=e.args["tileData"];const i=t["sourceFrameNumber"];const n=t["tileId"]&&t["tileId"]["id_ref"];const s=i&&this._frameById[i];if(!s||!s.layerTree||!n)return Promise.resolve(null);return s.layerTree.layerTreePromise().then(e=>e&&e.pictureForRasterTile(n))}reset(){this._minimumRecordTime=Infinity;this._frames=[];this._frameById={};this._lastFrame=null;this._lastLayerTree=null;this._mainFrameCommitted=false;this._mainFrameRequested=false;this._framePendingCommit=null;this._lastBeginFrame=null;this._lastNeedsBeginFrame=null;this._framePendingActivation=null;this._lastTaskBeginTime=null;this._target=null;this._layerTreeId=null;this._currentTaskTimeByCategory={}}handleBeginFrame(e){if(!this._lastFrame)this._startFrame(e);this._lastBeginFrame=e}handleDrawFrame(e){if(!this._lastFrame){this._startFrame(e);return}if(this._mainFrameCommitted||!this._mainFrameRequested){if(this._lastNeedsBeginFrame){const e=this._framePendingActivation?this._framePendingActivation.triggerTime:this._lastBeginFrame||this._lastNeedsBeginFrame;if(e>this._lastFrame.startTime){this._lastFrame.idle=true;this._startFrame(e);if(this._framePendingActivation)this._commitPendingFrame();this._lastBeginFrame=null}this._lastNeedsBeginFrame=null}this._startFrame(e)}this._mainFrameCommitted=false}handleActivateLayerTree(){if(!this._lastFrame)return;if(this._framePendingActivation&&!this._lastNeedsBeginFrame)this._commitPendingFrame()}handleRequestMainThreadFrame(){if(!this._lastFrame)return;this._mainFrameRequested=true}handleCompositeLayers(){if(!this._framePendingCommit)return;this._framePendingActivation=this._framePendingCommit;this._framePendingCommit=null;this._mainFrameRequested=false;this._mainFrameCommitted=true}handleLayerTreeSnapshot(e){this._lastLayerTree=e}handleNeedFrameChanged(e,t){if(t)this._lastNeedsBeginFrame=e}_startFrame(e){if(this._lastFrame)this._flushFrame(this._lastFrame,e);this._lastFrame=new TimelineModel.TimelineFrame(e,e-this._minimumRecordTime)}_flushFrame(e,t){e._setLayerTree(this._lastLayerTree);e._setEndTime(t);if(this._lastLayerTree)this._lastLayerTree._setPaints(e._paints);if(this._frames.length&&(e.startTime!==this._frames.peekLast().endTime||e.startTime>e.endTime)){console.assert(false,`Inconsistent frame time for frame ${this._frames.length} (${e.startTime} - ${e.endTime})`)}this._frames.push(e);if(typeof e._mainFrameId==="number")this._frameById[e._mainFrameId]=e}_commitPendingFrame(){this._lastFrame._addTimeForCategories(this._framePendingActivation.timeByCategory);this._lastFrame._paints=this._framePendingActivation.paints;this._lastFrame._mainFrameId=this._framePendingActivation.mainFrameId;this._framePendingActivation=null}addTraceEvents(e,t,i){this._target=e;let n=0;this._currentProcessMainThread=i.length&&i[0].thread||null;for(let e=0;e<t.length;++e){while(n+1<i.length&&i[n+1].time<=t[e].startTime)this._currentProcessMainThread=i[++n].thread;this._addTraceEvent(t[e])}this._currentProcessMainThread=null}_addTraceEvent(e){const t=TimelineModel.TimelineModel.RecordType;if(e.startTime&&e.startTime<this._minimumRecordTime)this._minimumRecordTime=e.startTime;if(e.name===t.SetLayerTreeId){this._layerTreeId=e.args["layerTreeId"]||e.args["data"]["layerTreeId"]}else if(e.phase===SDK.TracingModel.Phase.SnapshotObject&&e.name===t.LayerTreeHostImplSnapshot&&parseInt(e.id,0)===this._layerTreeId){const t=e;this.handleLayerTreeSnapshot(new TimelineModel.TracingFrameLayerTree(this._target,t))}else{this._processCompositorEvents(e);if(e.thread===this._currentProcessMainThread)this._addMainThreadTraceEvent(e);else if(this._lastFrame&&e.selfTime&&!SDK.TracingModel.isTopLevelEvent(e))this._lastFrame._addTimeForCategory(this._categoryMapper(e),e.selfTime)}}_processCompositorEvents(e){const t=TimelineModel.TimelineModel.RecordType;if(e.args["layerTreeId"]!==this._layerTreeId)return;const i=e.startTime;if(e.name===t.BeginFrame)this.handleBeginFrame(i);else if(e.name===t.DrawFrame)this.handleDrawFrame(i);else if(e.name===t.ActivateLayerTree)this.handleActivateLayerTree();else if(e.name===t.RequestMainThreadFrame)this.handleRequestMainThreadFrame();else if(e.name===t.NeedsBeginFrameChanged)this.handleNeedFrameChanged(i,e.args["data"]&&e.args["data"]["needsBeginFrame"])}_addMainThreadTraceEvent(e){const t=TimelineModel.TimelineModel.RecordType;if(SDK.TracingModel.isTopLevelEvent(e)){this._currentTaskTimeByCategory={};this._lastTaskBeginTime=e.startTime}if(!this._framePendingCommit&&TimelineModel.TimelineFrameModel._mainFrameMarkers.indexOf(e.name)>=0){this._framePendingCommit=new TimelineModel.PendingFrame(this._lastTaskBeginTime||e.startTime,this._currentTaskTimeByCategory)}if(!this._framePendingCommit){this._addTimeForCategory(this._currentTaskTimeByCategory,e);return}this._addTimeForCategory(this._framePendingCommit.timeByCategory,e);if(e.name===t.BeginMainThreadFrame&&e.args["data"]&&e.args["data"]["frameId"])this._framePendingCommit.mainFrameId=e.args["data"]["frameId"];if(e.name===t.Paint&&e.args["data"]["layerId"]&&TimelineModel.TimelineData.forEvent(e).picture&&this._target)this._framePendingCommit.paints.push(new TimelineModel.LayerPaintEvent(e,this._target));if(e.name===t.CompositeLayers&&e.args["layerTreeId"]===this._layerTreeId)this.handleCompositeLayers()}_addTimeForCategory(e,t){if(!t.selfTime)return;const i=this._categoryMapper(t);e[i]=(e[i]||0)+t.selfTime}};TimelineModel.TimelineFrameModel._mainFrameMarkers=[TimelineModel.TimelineModel.RecordType.ScheduleStyleRecalculation,TimelineModel.TimelineModel.RecordType.InvalidateLayout,TimelineModel.TimelineModel.RecordType.BeginMainThreadFrame,TimelineModel.TimelineModel.RecordType.ScrollLayer];TimelineModel.TracingFrameLayerTree=class{constructor(e,t){this._target=e;this._snapshot=t;this._paints}async layerTreePromise(){const e=await this._snapshot.objectPromise();if(!e)return null;const t=e["device_viewport_size"];const i=e["active_tiles"];const n=e["active_tree"]["root_layer"];const s=e["active_tree"]["layers"];const r=new TimelineModel.TracingLayerTree(this._target);r.setViewportSize(t);r.setTiles(i);await r.setLayers(n,s,this._paints||[]);return r}paints(){return this._paints||[]}_setPaints(e){this._paints=e}};TimelineModel.TimelineFrame=class{constructor(e,t){this.startTime=e;this.startTimeOffset=t;this.endTime=this.startTime;this.duration=0;this.timeByCategory={};this.cpuTime=0;this.idle=false;this.layerTree=null;this._paints=[];this._mainFrameId=undefined}hasWarnings(){return false}_setEndTime(e){this.endTime=e;this.duration=this.endTime-this.startTime}_setLayerTree(e){this.layerTree=e}_addTimeForCategories(e){for(const t in e)this._addTimeForCategory(t,e[t])}_addTimeForCategory(e,t){this.timeByCategory[e]=(this.timeByCategory[e]||0)+t;this.cpuTime+=t}};TimelineModel.LayerPaintEvent=class{constructor(e,t){this._event=e;this._target=t}layerId(){return this._event.args["data"]["layerId"]}event(){return this._event}picturePromise(){const e=TimelineModel.TimelineData.forEvent(this._event).picture;return e.objectPromise().then(e=>{if(!e)return null;const t=e["params"]&&e["params"]["layer_rect"];const i=e["skp64"];return t&&i?{rect:t,serializedPicture:i}:null})}snapshotPromise(){const e=this._target&&this._target.model(SDK.PaintProfilerModel);return this.picturePromise().then(t=>{if(!t||!e)return null;return e.loadSnapshot(t.serializedPicture).then(e=>e?{rect:t.rect,snapshot:e}:null)})}};TimelineModel.PendingFrame=class{constructor(e,t){this.timeByCategory=t;this.paints=[];this.mainFrameId=undefined;this.triggerTime=e}};TimelineModel.TimelineProfileTree={};TimelineModel.TimelineProfileTree.Node=class{constructor(e,t){this.totalTime=0;this.selfTime=0;this.id=e;this.event=t;this.parent;this._groupId="";this._isGroupNode=false}isGroupNode(){return this._isGroupNode}hasChildren(){throw"Not implemented"}children(){throw"Not implemented"}searchTree(e,t){t=t||[];if(this.event&&e(this.event))t.push(this);for(const i of this.children().values())i.searchTree(e,t);return t}};TimelineModel.TimelineProfileTree.TopDownNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(e,t,i){super(e,t);this._root=i&&i._root;this._hasChildren=false;this._children=null;this.parent=i}hasChildren(){return this._hasChildren}children(){return this._children||this._buildChildren()}_buildChildren(){const e=[];for(let t=this;t.parent&&!t._isGroupNode;t=t.parent)e.push(t);e.reverse();const t=new Map;const i=this;const n=this._root;const s=n._startTime;const r=n._endTime;const a=n._doNotAggregate?T:undefined;const o=n._doNotAggregate?undefined:TimelineModel.TimelineProfileTree._eventId;const l=n._eventGroupIdCallback;let d=0;let c=0;let m=null;TimelineModel.TimelineModel.forEachEvent(n._events,h,f,a,s,r,n._filter);function h(t){++d;if(d>e.length+2)return;if(!p(t))return;const i=Math.min(r,t.endTime)-Math.max(s,t.startTime);if(i<0)console.error("Negative event duration");u(t,i)}function T(t){++d;if(c===e.length&&d<=e.length+2)u(t,0);--d}function u(n,s){if(d===e.length+2){m._hasChildren=true;m.selfTime-=s;return}let r;let a="";if(!o){r=Symbol("uniqueId")}else{r=o(n);a=l?l(n):"";if(a)r+="/"+a}let c=t.get(r);if(!c){c=new TimelineModel.TimelineProfileTree.TopDownNode(r,n,i);c._groupId=a;t.set(r,c)}c.selfTime+=s;c.totalTime+=s;m=c}function p(t){if(c===e.length)return true;if(c!==d-1)return false;if(!t.endTime)return false;if(!o){if(t===e[c].event)++c;return false}let i=o(t);const n=l?l(t):"";if(n)i+="/"+n;if(i===e[c].id)++c;return false}function f(e){--d;if(c>d)c=d}this._children=t;return t}};TimelineModel.TimelineProfileTree.TopDownRootNode=class extends TimelineModel.TimelineProfileTree.TopDownNode{constructor(e,t,i,n,s,r){super("",null,null);this._root=this;this._events=e;this._filter=(e=>t.every(t=>t.accept(e)));this._startTime=i;this._endTime=n;this._eventGroupIdCallback=r;this._doNotAggregate=s;this.totalTime=n-i;this.selfTime=this.totalTime}children(){return this._children||this._grouppedTopNodes()}_grouppedTopNodes(){const e=super.children();for(const t of e.values())this.selfTime-=t.totalTime;if(!this._eventGroupIdCallback)return e;const t=new Map;for(const i of e.values()){const e=this._eventGroupIdCallback(i.event);let n=t.get(e);if(!n){n=new TimelineModel.TimelineProfileTree.GroupNode(e,this,i.event);t.set(e,n)}n.addChild(i,i.selfTime,i.totalTime)}this._children=t;return t}};TimelineModel.TimelineProfileTree.BottomUpRootNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(e,t,i,n,s){super("",null);this._children=null;this._events=e;this._filter=(e=>t.every(t=>t.accept(e)));this._startTime=i;this._endTime=n;this._eventGroupIdCallback=s;this.totalTime=n-i}hasChildren(){return true}children(){return this._children||this._grouppedTopNodes()}_ungrouppedTopNodes(){const e=this;const t=this._startTime;const i=this._endTime;const n=new Map;const s=[i-t];const r=[];const a=new Map;TimelineModel.TimelineModel.forEachEvent(this._events,o,l,undefined,t,i,this._filter);function o(e){const n=Math.min(e.endTime,i)-Math.max(e.startTime,t);s[s.length-1]-=n;s.push(n);const o=TimelineModel.TimelineProfileTree._eventId(e);const l=!a.has(o);if(l)a.set(o,n);r.push(l)}function l(t){const i=TimelineModel.TimelineProfileTree._eventId(t);let o=n.get(i);if(!o){o=new TimelineModel.TimelineProfileTree.BottomUpNode(e,i,t,false,e);n.set(i,o)}o.selfTime+=s.pop();if(r.pop()){o.totalTime+=a.get(i);a.delete(i)}if(r.length)o.setHasChildren()}this.selfTime=s.pop();for(const e of n){if(e[1].selfTime<=0)n.delete(e[0])}return n}_grouppedTopNodes(){const e=this._ungrouppedTopNodes();if(!this._eventGroupIdCallback){this._children=e;return e}const t=new Map;for(const i of e.values()){const e=this._eventGroupIdCallback(i.event);let n=t.get(e);if(!n){n=new TimelineModel.TimelineProfileTree.GroupNode(e,this,i.event);t.set(e,n)}n.addChild(i,i.selfTime,i.selfTime)}this._children=t;return t}};TimelineModel.TimelineProfileTree.GroupNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(e,t,i){super(e,i);this._children=new Map;this.parent=t;this._isGroupNode=true}addChild(e,t,i){this._children.set(e.id,e);this.selfTime+=t;this.totalTime+=i;e.parent=this}hasChildren(){return true}children(){return this._children}};TimelineModel.TimelineProfileTree.BottomUpNode=class extends TimelineModel.TimelineProfileTree.Node{constructor(e,t,i,n,s){super(t,i);this.parent=s;this._root=e;this._depth=(s._depth||0)+1;this._cachedChildren=null;this._hasChildren=n}setHasChildren(){this._hasChildren=true}hasChildren(){return this._hasChildren}children(){if(this._cachedChildren)return this._cachedChildren;const e=[0];const t=[];const i=[];const n=new Map;const s=this._root._startTime;const r=this._root._endTime;let a=s;const o=this;TimelineModel.TimelineModel.forEachEvent(this._root._events,l,d,undefined,s,r,this._root._filter);function l(n){const a=Math.min(n.endTime,r)-Math.max(n.startTime,s);if(a<0)console.assert(false,"Negative duration of an event");e[e.length-1]-=a;e.push(a);const o=TimelineModel.TimelineProfileTree._eventId(n);t.push(o);i.push(n)}function d(s){const l=e.pop();const d=t.pop();i.pop();let c;for(c=o;c._depth>1;c=c.parent){if(c.id!==t[t.length+1-c._depth])return}if(c.id!==d||t.length<o._depth)return;const m=t[t.length-o._depth];c=n.get(m);if(!c){const e=i[i.length-o._depth];const t=i.length>o._depth;c=new TimelineModel.TimelineProfileTree.BottomUpNode(o._root,m,e,t,o);n.set(m,c)}const h=Math.min(s.endTime,r)-Math.max(s.startTime,a);c.selfTime+=l;c.totalTime+=h;a=Math.min(s.endTime,r)}this._cachedChildren=n;return n}searchTree(e,t){t=t||[];if(this.event&&e(this.event))t.push(this);return t}};TimelineModel.TimelineProfileTree.eventURL=function(e){const t=e.args["data"]||e.args["beginData"];if(t&&t["url"])return t["url"];let i=TimelineModel.TimelineProfileTree.eventStackFrame(e);while(i){const e=i["url"];if(e)return e;i=i.parent}return null};TimelineModel.TimelineProfileTree.eventStackFrame=function(e){if(e.name===TimelineModel.TimelineModel.RecordType.JSFrame)return e.args["data"]||null;return TimelineModel.TimelineData.forEvent(e).topFrame()};TimelineModel.TimelineProfileTree._eventId=function(e){if(e.name===TimelineModel.TimelineModel.RecordType.TimeStamp)return`${e.name}:${e.args.data.message}`;if(e.name!==TimelineModel.TimelineModel.RecordType.JSFrame)return e.name;const t=e.args["data"];const i=t["scriptId"]||t["url"]||"";const n=t["functionName"];const s=TimelineModel.TimelineJSProfileProcessor.isNativeRuntimeFrame(t)?TimelineModel.TimelineJSProfileProcessor.nativeGroup(n)||n:`${n}:${t["lineNumber"]}:${t["columnNumber"]}`;return`f:${s}@${i}`};